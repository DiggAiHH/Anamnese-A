<!--
================================================================================
MEDIZINISCHER ANAMNESEBOGEN v8 - COMPLETE (FULLY INLINE VERSION)
================================================================================
Version: 8.2.0
Letzte Aktualisierung: 2025-12-24

NEUE FEATURES (v8.2.0):
- ALLE Repository-Module jetzt inline (vollst√§ndig offline!)
  * Translations (19 Sprachen) - 29KB inline
  * Encryption (AES-256) - 7KB inline
  * GDT Export/Import (alle Module) - 140KB inline
  * Vosk Integration + Worker - 10KB inline
  * AI Plausibility Check - 22KB inline
  * GDPR Compliance - 18KB inline
  * 14 Module total inline = +270KB f√ºr maximale Offline-F√§higkeit

- Repository Analysis Feature (Repo-Analyse)
  * Vollst√§ndige √úbersicht aller Projektdateien
  * Gruppierung nach Themen (Frontend, GDT, OCR, Tests, etc.)
  * Beziehungen zwischen Dateien (Imports, Referenzen)
  * Verbesserungsvorschl√§ge (Security, Performance, Offline, Maintainability)
  * Zug√§nglich √ºber Button im Footer: "üìä Repo-Analyse"

INLINE MODULE (NEU in v8.2.0):
‚úì Translations Module - Multi-language support (19 Sprachen)
‚úì Encryption Module - AES-256-GCM Web Crypto API
‚úì GDT Export Module - GDT 3.0/3.1 compliant export
‚úì GDT Import Module - Bidirectional data exchange
‚úì GDT Templates Module - Version-specific templates
‚úì GDT UI Module - Export configuration interface
‚úì GDT Encrypted Export - Secure GDT with encryption
‚úì GDT Batch Export - Multi-patient exports
‚úì GDT Audit Enhanced - GDPR-compliant logging
‚úì GDT Feature Detection - System compatibility
‚úì GDT Performance - Optimization monitoring
‚úì GDPR Compliance Module - Art. 13,17,30,32 utilities
‚úì Vosk Integration - Local speech recognition
‚úì AI Plausibility Check - Rule-based validation

FEATURES:
- 19 Sprachen mit RTL-Support (inline)
- AES-256-GCM Verschl√ºsselung (inline)
- DSGVO-konformes OCR (Tesseract.js lokal)
- Progressive Web App (PWA) mit Service Worker
- GDT Export f√ºr Praxissysteme (alle Module inline)
- Vosk Spracherkennung (lokal, inline)
- AI Plausibilit√§tspr√ºfung (regelbasiert, inline)
- WCAG 2.1 AA Barrierefreiheit
- 100% offline nach initialem Laden (KEINE externen JS-Dateien)

TECHNISCHER HINWEIS:
Diese Datei ist ~1.1MB gro√ü und enth√§lt ALLE Features inline f√ºr MAXIMALE
Offline-F√§higkeit. KEINE externen JavaScript-Dateien erforderlich (au√üer
CDN-Libraries f√ºr OCR/PDF/Crypto). Alle Repository-Module sind direkt
eingebettet f√ºr sofortige Verf√ºgbarkeit ohne Netzwerk-Requests.

Repository-Analyse am Ende eingebettet als window.REPO_ANALYSIS_DATA.

================================================================================
-->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Digital Medical History Questionnaire - Offline Medical App">
    <meta name="author" content="DiggAi GmbH">
    <meta name="theme-color" content="#667eea">
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://js.stripe.com; 
                   style-src 'self' 'unsafe-inline'; 
                   img-src 'self' data: blob:; 
                   connect-src 'self' https://api.stripe.com https://api.anamnese-a.eu;
                   frame-src https://js.stripe.com https://hooks.stripe.com;
                   frame-ancestors 'none';">
    <title>Medizinischer Anamnesebogen v8</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Anamnesebogen">
    
    <!-- Android PWA Support -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Tesseract.js for OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <!-- PDF.js for PDF text extraction -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <!-- CryptoJS for encryption -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" 
            integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNs8n9SBe7yLFSw7VHT6+rRMASB5QFcM/N7Yj4fBcN4A6L6JSNO+JKgFXkYRD+Faq==" 
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!-- Stripe.js for payment processing -->
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        // Configure PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
        }
    </script>
    <!-- GDPR-compliant OCR Module (INLINE) -->
    <script>
// ============================================================================
// OCR GDPR-Compliance Module (DSGVO-konformes OCR-Modul) - INLINE
// ============================================================================
// Version: 2.0
// Datum: 2025-12-23
// Zweck: DSGVO-konforme OCR-Verarbeitung mit vollst√§ndiger Datenschutzgarantie
//
// GARANTIEN:
// ‚úì Keine externen API-Calls (Google Vision, AWS Textract, etc.)
// ‚úì Vollst√§ndig lokale Verarbeitung im Browser
// ‚úì Audit-Logging aller OCR-Vorg√§nge (Art. 30, 32 DSGVO)
// ‚úì Datenschutz-Benachrichtigung vor Upload (Art. 13 DSGVO)
// ‚úì Recht auf Vergessenwerden implementiert (Art. 17 DSGVO)
// ‚úì Keine Vorhaltung l√§nger als erforderlich
// ============================================================================

// ============================================================================
// AUDIT-LOGGING SYSTEM (Art. 30, 32 DSGVO)
// ============================================================================

const OCR_AUDIT = {
    logs: [],
    
    /**
     * Protokolliert eine OCR-Operation
     * @param {string} action - Art der Aktion (ocr_started, ocr_completed, etc.)
     * @param {string} filename - Dateiname
     * @param {object} details - Zus√§tzliche Details
     */
    log(action, filename, details = {}) {
        const logEntry = {
            id: this.generateLogId(),
            timestamp: new Date().toISOString(),
            action: action,
            filename: filename,
            fileSize: details.fileSize || null,
            fileType: details.fileType || null,
            processingType: details.processingType || 'ocr',
            processingLocation: 'local_browser', // GARANTIE: Immer lokal
            textLength: details.textLength || null,
            userId: details.userId || this.getSessionUserId(),
            userAgent: this.anonymizeUserAgent(navigator.userAgent), // Anonymisiert f√ºr DSGVO
            language: details.language || 'deu',
            success: details.success !== false,
            errorMessage: details.errorMessage || null,
            metadata: details.metadata || {}
        };
        
        this.logs.push(logEntry);
        this.persistLog(logEntry);
        
        return logEntry;
    },
    
    /**
     * Anonymisiert User Agent String (Datensparsamkeit Art. 5 DSGVO)
     */
    anonymizeUserAgent(userAgent) {
        // Extrahiere nur Browser-Familie und grobes OS ohne detaillierte Versionsnummern
        const browserMatch = userAgent.match(/(Chrome|Firefox|Safari|Edge|Opera)\/[\d.]+/);
        const osMatch = userAgent.match(/(Windows|Mac OS|Linux|Android|iOS)/);
        
        const browser = browserMatch ? browserMatch[1] : 'Unknown';
        const os = osMatch ? osMatch[1] : 'Unknown';
        
        return `${browser} on ${os}`;
    },
    
    /**
     * Generiert eine eindeutige Log-ID
     */
    generateLogId() {
        return `OCR-LOG-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;
    },
    
    /**
     * Ermittelt eine Session-User-ID (pseudonymisiert)
     */
    getSessionUserId() {
        let userId = sessionStorage.getItem('ocrSessionUserId');
        if (!userId) {
            userId = `USER-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;
            sessionStorage.setItem('ocrSessionUserId', userId);
        }
        return userId;
    },
    
    /**
     * Speichert Log-Eintrag persistent (LocalStorage)
     */
    persistLog(logEntry) {
        try {
            const existingLogs = JSON.parse(localStorage.getItem('ocrAuditLogs') || '[]');
            existingLogs.push(logEntry);
            
            // Limitiere auf letzte 1000 Eintr√§ge (Performance)
            if (existingLogs.length > 1000) {
                existingLogs.shift();
            }
            
            localStorage.setItem('ocrAuditLogs', JSON.stringify(existingLogs));
        } catch (error) {
            console.error('Fehler beim Persistieren des Audit-Logs:', error);
        }
    },
    
    /**
     * Ruft alle Audit-Logs ab
     */
    getAllLogs() {
        try {
            const persistedLogs = JSON.parse(localStorage.getItem('ocrAuditLogs') || '[]');
            return [...this.logs, ...persistedLogs];
        } catch (error) {
            console.error('Fehler beim Abrufen der Audit-Logs:', error);
            return this.logs;
        }
    },
    
    /**
     * Filtert Logs nach Zeitraum
     */
    getLogsByDateRange(startDate, endDate) {
        const logs = this.getAllLogs();
        const start = new Date(startDate);
        const end = new Date(endDate);
        
        return logs.filter(log => {
            const logDate = new Date(log.timestamp);
            return logDate >= start && logDate <= end;
        });
    },
    
    /**
     * Generiert Audit-Report f√ºr DSB-Pr√ºfung
     */
    generateAuditReport() {
        const logs = this.getAllLogs();
        
        return {
            reportTimestamp: new Date().toISOString(),
            totalEntries: logs.length,
            dateRange: {
                earliest: logs.length > 0 ? logs[0].timestamp : null,
                latest: logs.length > 0 ? logs[logs.length - 1].timestamp : null
            },
            statistics: {
                ocrStarted: logs.filter(l => l.action === 'ocr_started').length,
                ocrCompleted: logs.filter(l => l.action === 'ocr_completed').length,
                ocrFailed: logs.filter(l => l.action === 'ocr_failed').length,
                documentsUploaded: logs.filter(l => l.action === 'document_uploaded').length,
                documentsDeleted: logs.filter(l => l.action === 'document_deleted').length,
                consentGiven: logs.filter(l => l.action === 'consent_given').length
            },
            logs: logs,
            gdprCompliance: {
                localProcessing: true, // GARANTIE
                noExternalAPIs: true, // GARANTIE
                auditTrailComplete: true,
                deletionRightsImplemented: true
            }
        };
    },
    
    /**
     * L√∂scht Audit-Logs √§lter als angegebene Tage
     * Standardm√§√üig 3 Jahre (1095 Tage) gem√§√ü ¬ß 630f BGB
     */
    deleteOldLogs(retentionDays = 1095) {
        try {
            const logs = this.getAllLogs();
            const cutoffDate = new Date();
            cutoffDate.setDate(cutoffDate.getDate() - retentionDays);
            
            const filteredLogs = logs.filter(log => {
                return new Date(log.timestamp) > cutoffDate;
            });
            
            localStorage.setItem('ocrAuditLogs', JSON.stringify(filteredLogs));
            this.logs = [];
            
            return {
                success: true,
                deletedCount: logs.length - filteredLogs.length,
                remainingCount: filteredLogs.length
            };
        } catch (error) {
            console.error('Fehler beim L√∂schen alter Logs:', error);
            return { success: false, error: error.message };
        }
    }
};

// ============================================================================
// DATENSCHUTZ-BENACHRICHTIGUNG (Art. 13 DSGVO)
// ============================================================================

const OCR_PRIVACY = {
    consentGiven: false,
    
    /**
     * Zeigt Datenschutz-Benachrichtigung an
     * Muss vor jedem OCR-Upload angezeigt werden
     */
    showPrivacyNotice() {
        return new Promise((resolve) => {
            // Pr√ºfe, ob Einwilligung bereits in dieser Session erteilt wurde
            if (sessionStorage.getItem('ocrConsentGiven') === 'true') {
                resolve(true);
                return;
            }
            
            // Erstelle Modal
            const modal = document.createElement('div');
            modal.id = 'ocrPrivacyModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 8px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            `;
            
            content.innerHTML = `
                <h2 style="margin-top: 0; color: #2196F3;">
                    üîí Datenschutz-Hinweis: Dokumenten-Upload & OCR
                </h2>
                
                <div style="margin: 20px 0; padding: 15px; background: #e3f2fd; border-left: 4px solid #2196F3; border-radius: 4px;">
                    <h3 style="margin-top: 0; font-size: 16px;">Lokale Verarbeitung - Ihre Daten bleiben bei Ihnen!</h3>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>‚úì Alle Daten werden <strong>ausschlie√ülich lokal</strong> auf Ihrem Ger√§t verarbeitet</li>
                        <li>‚úì OCR-Texterkennung erfolgt im Browser (Tesseract.js)</li>
                        <li>‚úì <strong>Keine √úbertragung</strong> an externe Server oder Cloud-Dienste</li>
                        <li>‚úì <strong>Kein Upload</strong> zu Google Vision, AWS oder anderen APIs</li>
                    </ul>
                </div>
                
                <h3 style="font-size: 15px; margin-top: 20px;">Informationen gem√§√ü Art. 13 DSGVO:</h3>
                <div style="font-size: 14px; line-height: 1.6;">
                    <p><strong>Verantwortlicher:</strong> Ihre Arztpraxis</p>
                    <p><strong>Zweck:</strong> Digitalisierung medizinischer Dokumente zur Integration in Ihre Patientenakte</p>
                    <p><strong>Rechtsgrundlage:</strong> Art. 6 Abs. 1 lit. a DSGVO (Einwilligung), Art. 9 Abs. 2 lit. a DSGVO (Gesundheitsdaten)</p>
                    <p><strong>Speicherdauer:</strong> Bis zur aktiven L√∂schung durch Sie oder nach Behandlungsabschluss</p>
                    <p><strong>Empf√§nger:</strong> Keine - Daten verbleiben lokal auf Ihrem Ger√§t</p>
                </div>
                
                <div style="margin: 20px 0; padding: 15px; background: #fff3e0; border-left: 4px solid #ff9800; border-radius: 4px;">
                    <h4 style="margin-top: 0; font-size: 14px;">‚ö†Ô∏è Sensible Gesundheitsdaten</h4>
                    <p style="margin: 5px 0; font-size: 13px;">
                        Die hochgeladenen Dokumente k√∂nnen sensible Gesundheitsdaten enthalten (Art. 9 DSGVO).
                        Ihre Einwilligung ist erforderlich.
                    </p>
                </div>
                
                <details style="margin: 15px 0; font-size: 13px;">
                    <summary style="cursor: pointer; font-weight: bold; color: #2196F3;">
                        üìã Ihre Rechte (anklicken zum Aufklappen)
                    </summary>
                    <ul style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
                        <li><strong>Auskunftsrecht (Art. 15 DSGVO):</strong> Sie k√∂nnen Auskunft √ºber Ihre gespeicherten Daten verlangen</li>
                        <li><strong>Berichtigungsrecht (Art. 16 DSGVO):</strong> Fehlerhafte Daten k√∂nnen korrigiert werden</li>
                        <li><strong>L√∂schungsrecht (Art. 17 DSGVO):</strong> Sie k√∂nnen Ihre Daten jederzeit l√∂schen</li>
                        <li><strong>Widerrufsrecht (Art. 7 Abs. 3 DSGVO):</strong> Diese Einwilligung ist jederzeit widerrufbar</li>
                        <li><strong>Beschwerderecht (Art. 77 DSGVO):</strong> Beschwerde bei der Datenschutzbeh√∂rde m√∂glich</li>
                    </ul>
                </details>
                
                <div style="margin: 20px 0;">
                    <label style="display: flex; align-items: start; cursor: pointer;">
                        <input type="checkbox" id="ocrConsentCheckbox" style="margin-right: 10px; margin-top: 4px;">
                        <span style="font-size: 14px;">
                            Ich habe die Datenschutz-Informationen gelesen und stimme der lokalen Verarbeitung 
                            meiner Dokumente mit OCR zu. Mir ist bewusst, dass ich diese Einwilligung jederzeit 
                            widerrufen kann.
                        </span>
                    </label>
                </div>
                
                <div style="display: flex; justify-content: space-between; gap: 10px; margin-top: 25px;">
                    <button id="ocrPrivacyCancel" style="
                        padding: 12px 24px;
                        background: #757575;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 14px;
                    ">Abbrechen</button>
                    <button id="ocrPrivacyAccept" disabled style="
                        padding: 12px 24px;
                        background: #4CAF50;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 14px;
                        opacity: 0.5;
                    ">Zustimmen & Fortfahren</button>
                </div>
                
                <p style="font-size: 11px; color: #666; margin-top: 15px; text-align: center;">
                    Diese Einwilligung gilt f√ºr die aktuelle Browser-Sitzung. Bei erneutem √ñffnen wird sie erneut abgefragt.
                </p>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Aktiviere Accept-Button nur wenn Checkbox aktiviert ist
            const checkbox = document.getElementById('ocrConsentCheckbox');
            const acceptBtn = document.getElementById('ocrPrivacyAccept');
            
            checkbox.addEventListener('change', () => {
                acceptBtn.disabled = !checkbox.checked;
                acceptBtn.style.opacity = checkbox.checked ? '1' : '0.5';
                acceptBtn.style.cursor = checkbox.checked ? 'pointer' : 'not-allowed';
            });
            
            // Handle Cancel
            document.getElementById('ocrPrivacyCancel').addEventListener('click', () => {
                document.body.removeChild(modal);
                OCR_AUDIT.log('consent_denied', 'privacy_notice', {
                    success: false,
                    errorMessage: 'User declined consent'
                });
                resolve(false);
            });
            
            // Handle Accept
            acceptBtn.addEventListener('click', () => {
                if (checkbox.checked) {
                    sessionStorage.setItem('ocrConsentGiven', 'true');
                    this.consentGiven = true;
                    
                    // Audit-Log
                    OCR_AUDIT.log('consent_given', 'privacy_notice', {
                        success: true,
                        metadata: {
                            timestamp: new Date().toISOString(),
                            userAgent: navigator.userAgent
                        }
                    });
                    
                    document.body.removeChild(modal);
                    resolve(true);
                }
            });
        });
    },
    
    /**
     * Widerruft die Einwilligung
     */
    revokeConsent() {
        sessionStorage.removeItem('ocrConsentGiven');
        this.consentGiven = false;
        
        OCR_AUDIT.log('consent_revoked', 'user_action', {
            success: true
        });
        
        return true;
    }
};

// ============================================================================
// ENHANCED DOCUMENT STORAGE (mit GDPR-Features)
// ============================================================================

const DOCUMENT_STORAGE_GDPR = {
    documents: [],
    
    /**
     * F√ºgt ein Dokument hinzu
     */
    addDocument(docData) {
        const doc = {
            id: this.generateDocId(),
            ...docData,
            uploadTimestamp: new Date().toISOString()
        };
        
        this.documents.push(doc);
        this.persistDocuments();
        
        OCR_AUDIT.log('document_uploaded', docData.filename, {
            fileSize: docData.originalSize,
            fileType: docData.type,
            textLength: docData.text?.length || 0,
            success: true
        });
        
        return doc;
    },
    
    /**
     * Generiert eindeutige Dokument-ID
     */
    generateDocId() {
        return `DOC-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;
    },
    
    /**
     * Persistiert Dokumente (verschl√ºsselt mit AES-256-GCM)
     * WICHTIG: Verwendet die Verschl√ºsselungsfunktion aus encryption.js wenn verf√ºgbar
     */
    persistDocuments() {
        try {
            const dataToStore = JSON.stringify(this.documents);
            
            // Versuche, mit encryption.js zu verschl√ºsseln (wenn geladen)
            if (typeof encryptData === 'function' && typeof getEncryptionKey === 'function') {
                // Verwende bestehenden Encryption-Key
                const key = getEncryptionKey();
                if (key) {
                    // Asynchrone Verschl√ºsselung - speichere mit Prefix f√ºr sp√§ter
                    encryptData(dataToStore, key).then(encrypted => {
                        localStorage.setItem('ocrDocuments_encrypted', encrypted);
                        localStorage.setItem('ocrDocuments_encryptionMethod', 'AES-256-GCM');
                    }).catch(err => {
                        console.error('Verschl√ºsselung fehlgeschlagen, speichere unverschl√ºsselt:', err);
                        localStorage.setItem('ocrDocuments', dataToStore);
                    });
                } else {
                    // Kein Key verf√ºgbar, speichere unverschl√ºsselt (mit Warnung)
                    console.warn('‚ö†Ô∏è WARNUNG: Dokumente werden unverschl√ºsselt gespeichert (kein Encryption-Key)');
                    localStorage.setItem('ocrDocuments', dataToStore);
                }
            } else {
                // encryption.js nicht geladen - speichere unverschl√ºsselt mit Warnung
                console.warn('‚ö†Ô∏è WARNUNG: Dokumente werden unverschl√ºsselt gespeichert (encryption.js nicht geladen)');
                localStorage.setItem('ocrDocuments', dataToStore);
            }
        } catch (error) {
            console.error('Fehler beim Persistieren der Dokumente:', error);
        }
    },
    
    /**
     * L√§dt Dokumente aus Storage (verschl√ºsselt oder unverschl√ºsselt)
     */
    async loadDocuments() {
        try {
            // Pr√ºfe zuerst auf verschl√ºsselte Daten
            const encryptedData = localStorage.getItem('ocrDocuments_encrypted');
            const encryptionMethod = localStorage.getItem('ocrDocuments_encryptionMethod');
            
            if (encryptedData && encryptionMethod === 'AES-256-GCM') {
                // Versuche zu entschl√ºsseln
                if (typeof decryptData === 'function' && typeof getEncryptionKey === 'function') {
                    const key = getEncryptionKey();
                    if (key) {
                        try {
                            const decrypted = await decryptData(encryptedData, key);
                            this.documents = JSON.parse(decrypted);
                            console.log('‚úì Dokumente erfolgreich entschl√ºsselt geladen');
                            return;
                        } catch (decryptError) {
                            console.error('Entschl√ºsselung fehlgeschlagen:', decryptError);
                            // Fallback auf unverschl√ºsselte Daten
                        }
                    }
                }
            }
            
            // Fallback: Lade unverschl√ºsselte Daten
            const stored = localStorage.getItem('ocrDocuments');
            if (stored) {
                this.documents = JSON.parse(stored);
                console.warn('‚ö†Ô∏è Dokumente wurden unverschl√ºsselt geladen');
            }
        } catch (error) {
            console.error('Fehler beim Laden der Dokumente:', error);
            this.documents = [];
        }
    },
    
    /**
     * L√∂scht einzelnes Dokument (Art. 17 DSGVO)
     */
    deleteDocument(documentId) {
        const docIndex = this.documents.findIndex(doc => doc.id === documentId);
        
        if (docIndex === -1) {
            return { success: false, error: 'Dokument nicht gefunden' };
        }
        
        const doc = this.documents[docIndex];
        this.documents.splice(docIndex, 1);
        this.persistDocuments();
        
        // Audit-Log
        OCR_AUDIT.log('document_deleted', doc.filename, {
            success: true,
            metadata: { deletionReason: 'user_request' }
        });
        
        return { success: true, deletedDocument: doc };
    },
    
    /**
     * L√∂scht alle Dokumente (Art. 17 DSGVO)
     */
    deleteAllDocuments() {
        const count = this.documents.length;
        const deletedDocs = [...this.documents];
        
        this.documents = [];
        this.persistDocuments();
        
        // Auch aus LocalStorage entfernen
        localStorage.removeItem('ocrDocuments');
        localStorage.removeItem('ocrDocuments_encrypted');
        localStorage.removeItem('ocrDocuments_encryptionMethod');
        
        // Audit-Log
        OCR_AUDIT.log('all_documents_deleted', `${count} documents`, {
            success: true,
            metadata: {
                deletedCount: count,
                deletionReason: 'user_request_bulk_delete'
            }
        });
        
        return {
            success: true,
            deletedCount: count,
            deletedDocuments: deletedDocs
        };
    },
    
    /**
     * √úberpr√ºft vollst√§ndige L√∂schung
     */
    verifyCompleteDeletion() {
        const docsRemaining = this.documents.length;
        
        // Pr√ºfe LocalStorage
        const storageKeys = Object.keys(localStorage).filter(key => 
            key.startsWith('ocr') || key.startsWith('document')
        );
        
        // Pr√ºfe SessionStorage
        const sessionKeys = Object.keys(sessionStorage).filter(key =>
            key.startsWith('ocr') || key.startsWith('document')
        );
        
        const isComplete = docsRemaining === 0 && 
                          storageKeys.length <= 1 && // ocrAuditLogs darf bleiben
                          sessionKeys.length === 0;
        
        return {
            complete: isComplete,
            details: {
                documentsRemaining: docsRemaining,
                localStorageKeys: storageKeys,
                sessionStorageKeys: sessionKeys
            }
        };
    },
    
    /**
     * Vollst√§ndige Datenl√∂schung (inkl. Audit-Logs)
     * Nur auf expliziten Wunsch des Nutzers
     */
    performCompleteDeletion(includeAuditLogs = false) {
        // 1. Dokumente l√∂schen
        this.deleteAllDocuments();
        
        // 2. Optional: Audit-Logs l√∂schen (normalerweise 3 Jahre Aufbewahrung)
        if (includeAuditLogs) {
            localStorage.removeItem('ocrAuditLogs');
            OCR_AUDIT.logs = [];
        }
        
        // 3. Session-Daten
        sessionStorage.removeItem('ocrConsentGiven');
        sessionStorage.removeItem('ocrSessionUserId');
        
        // 4. Finale Audit-Log-Eintrag (vor L√∂schung)
        const finalLog = OCR_AUDIT.log('complete_deletion_performed', 'all_data', {
            success: true,
            metadata: {
                includeAuditLogs: includeAuditLogs,
                deletionType: 'gdpr_art17_request'
            }
        });
        
        // 5. Verifikation
        const verification = this.verifyCompleteDeletion();
        
        return {
            success: true,
            verification: verification,
            finalLogEntry: finalLog
        };
    },
    
    /**
     * Ruft alle Dokumente ab
     */
    getAllDocuments() {
        return [...this.documents];
    },
    
    /**
     * Ruft einzelnes Dokument ab
     */
    getDocument(documentId) {
        return this.documents.find(doc => doc.id === documentId);
    }
};

// ============================================================================
// ENHANCED OCR FUNCTIONS (mit GDPR-Compliance)
// ============================================================================

/**
 * Extrahiert Text aus einem PDF-Dokument (LOKAL mit PDF.js)
 * @param {File} file - Die PDF-Datei
 * @returns {Promise<string>} - Der extrahierte Text
 */
async function extractTextFromPDF(file) {
    try {
        // Pr√ºfe ob PDF.js geladen ist
        if (typeof pdfjsLib === 'undefined') {
            throw new Error('PDF.js Bibliothek nicht geladen');
        }
        
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let fullText = '';
        
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n';
        }
        
        return fullText.trim();
    } catch (error) {
        console.error('PDF-Textextraktion fehlgeschlagen:', error);
        throw new Error('Fehler beim Extrahieren des Textes aus PDF: ' + error.message);
    }
}

/**
 * F√ºhrt OCR auf einem Bild durch (LOKAL - KEINE EXTERNEN APIs)
 * @param {File} file - Die Bilddatei
 * @returns {Promise<string>} - Der erkannte Text
 */
async function performOCRWithAudit(file) {
    // Audit-Log: OCR gestartet
    OCR_AUDIT.log('ocr_started', file.name, {
        fileSize: file.size,
        fileType: file.type,
        metadata: {
            imageWidth: null, // Wird nach Verarbeitung aktualisiert
            imageHeight: null
        }
    });
    
    try {
        // GARANTIE: Tesseract.js l√§uft vollst√§ndig lokal im Browser
        // KEINE API-Calls zu externen Servern
        const result = await Tesseract.recognize(
            file,
            'deu', // Deutsch als Hauptsprache
            {
                logger: m => {
                    if (m.status === 'recognizing text') {
                        console.log('OCR Fortschritt:', Math.round(m.progress * 100) + '%');
                    }
                }
            }
        );
        
        const extractedText = result.data.text;
        
        // Audit-Log: OCR erfolgreich
        OCR_AUDIT.log('ocr_completed', file.name, {
            fileSize: file.size,
            fileType: file.type,
            textLength: extractedText.length,
            success: true,
            metadata: {
                confidence: result.data.confidence || null
            }
        });
        
        return extractedText;
    } catch (error) {
        // Audit-Log: OCR fehlgeschlagen
        OCR_AUDIT.log('ocr_failed', file.name, {
            fileSize: file.size,
            fileType: file.type,
            success: false,
            errorMessage: error.message
        });
        
        console.error('OCR fehlgeschlagen:', error);
        throw new Error('Fehler bei der Texterkennung: ' + error.message);
    }
}

/**
 * Verarbeitet hochgeladene Datei mit GDPR-Compliance
 * @param {File} file - Die hochgeladene Datei
 * @returns {Promise<object>} - Dokumenten-Objekt
 */
async function processUploadedFileWithGDPR(file) {
    const timestamp = new Date().toISOString();
    const fileType = file.type;
    
    let extractedText = '';
    let processType = '';
    
    try {
        if (fileType === 'application/pdf') {
            // PDF-Verarbeitung (lokal mit PDF.js)
            processType = 'pdf-extraction';
            extractedText = await extractTextFromPDF(file);
            
            OCR_AUDIT.log('pdf_extraction_completed', file.name, {
                fileSize: file.size,
                fileType: file.type,
                textLength: extractedText.length,
                processingType: processType,
                success: true
            });
        } else if (fileType.startsWith('image/')) {
            // Bildverarbeitung mit OCR
            processType = 'ocr';
            extractedText = await performOCRWithAudit(file);
        } else if (fileType.startsWith('text/')) {
            // Textdatei direkt lesen
            processType = 'text-file';
            extractedText = await file.text();
            
            OCR_AUDIT.log('text_file_read', file.name, {
                fileSize: file.size,
                fileType: file.type,
                textLength: extractedText.length,
                processingType: processType,
                success: true
            });
        } else {
            throw new Error('Nicht unterst√ºtzter Dateityp: ' + fileType);
        }
        
        return {
            filename: file.name,
            text: extractedText,
            timestamp: timestamp,
            type: processType,
            originalSize: file.size
        };
    } catch (error) {
        throw new Error('Fehler beim Verarbeiten von ' + file.name + ': ' + error.message);
    }
}

/**
 * Zeigt Dialog zum Hochladen von Dokumenten mit GDPR-Compliance
 */
async function showDocumentUploadDialogGDPR() {
    // 1. SCHRITT: Datenschutz-Benachrichtigung anzeigen (Art. 13 DSGVO)
    const consentGiven = await OCR_PRIVACY.showPrivacyNotice();
    
    if (!consentGiven) {
        return {
            success: false,
            message: 'Upload abgebrochen - Einwilligung nicht erteilt'
        };
    }
    
    // 2. SCHRITT: File-Input erstellen
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*,.pdf,.txt';
    input.multiple = true;
    
    return new Promise((resolve) => {
        input.onchange = async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) {
                resolve({ success: false, message: 'Keine Dateien ausgew√§hlt' });
                return;
            }
            
            const processedDocs = [];
            const errors = [];
            
            for (const file of files) {
                try {
                    const docData = await processUploadedFileWithGDPR(file);
                    const doc = DOCUMENT_STORAGE_GDPR.addDocument(docData);
                    processedDocs.push(doc);
                } catch (error) {
                    console.error('Fehler beim Verarbeiten der Datei:', error);
                    errors.push({ filename: file.name, error: error.message });
                }
            }
            
            resolve({
                success: processedDocs.length > 0,
                processedCount: processedDocs.length,
                errorCount: errors.length,
                documents: processedDocs,
                errors: errors
            });
        };
        
        input.click();
    });
}

// ============================================================================
// UI-FUNKTIONEN F√úR GDPR-FEATURES
// ============================================================================

/**
 * Zeigt hochgeladene Dokumente mit L√∂sch-Optionen an
 */
function showUploadedDocumentsGDPR() {
    const docs = DOCUMENT_STORAGE_GDPR.getAllDocuments();
    
    if (docs.length === 0) {
        alert('Keine Dokumente hochgeladen.');
        return;
    }
    
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    `;
    
    const content = document.createElement('div');
    content.style.cssText = `
        background: white;
        padding: 30px;
        border-radius: 8px;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    `;
    
    // Erstelle Dokumente-Liste mit createElement statt innerHTML (XSS-sicher)
    const docListContainer = document.createElement('div');
    docListContainer.id = 'documentsList';
    
    docs.forEach((doc, index) => {
        const docDiv = document.createElement('div');
        docDiv.style.cssText = 'border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px;';
        
        const flexDiv = document.createElement('div');
        flexDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: start;';
        
        const infoDiv = document.createElement('div');
        infoDiv.style.flex = '1';
        
        const title = document.createElement('h4');
        title.style.cssText = 'margin: 0 0 10px 0;';
        title.textContent = `${index + 1}. ${doc.filename}`;
        
        const info = document.createElement('p');
        info.style.cssText = 'margin: 5px 0; font-size: 13px; color: #666;';
        info.textContent = `Typ: ${doc.type} | Gr√∂√üe: ${(doc.originalSize / 1024).toFixed(1)} KB | Text: ${doc.text?.length || 0} Zeichen`;
        
        const timestamp = document.createElement('p');
        timestamp.style.cssText = 'margin: 5px 0; font-size: 12px; color: #999;';
        timestamp.textContent = `Hochgeladen: ${new Date(doc.uploadTimestamp).toLocaleString('de-DE')}`;
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'üóëÔ∏è L√∂schen';
        deleteBtn.style.cssText = 'padding: 8px 16px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px;';
        deleteBtn.dataset.documentId = doc.id; // Verwende data-attribute statt onclick
        deleteBtn.className = 'delete-doc-btn';
        
        infoDiv.appendChild(title);
        infoDiv.appendChild(info);
        infoDiv.appendChild(timestamp);
        
        flexDiv.appendChild(infoDiv);
        flexDiv.appendChild(deleteBtn);
        
        docDiv.appendChild(flexDiv);
        docListContainer.appendChild(docDiv);
    });
    
    const header = document.createElement('h2');
    header.style.marginTop = '0';
    header.textContent = `üìã Hochgeladene Dokumente (${docs.length})`;
    
    const privacyNotice = document.createElement('div');
    privacyNotice.style.cssText = 'margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: 4px;';
    const noticeText = document.createElement('p');
    noticeText.style.cssText = 'margin: 0; font-size: 13px;';
    // Build text content safely without innerHTML
    const icon = document.createTextNode('‚ÑπÔ∏è ');
    const strong = document.createElement('strong');
    strong.textContent = 'Datenschutz-Hinweis:';
    const text = document.createTextNode(' Sie k√∂nnen einzelne Dokumente oder alle Dokumente gem√§√ü Art. 17 DSGVO (Recht auf Vergessenwerden) jederzeit l√∂schen.');
    noticeText.appendChild(icon);
    noticeText.appendChild(strong);
    noticeText.appendChild(text);
    privacyNotice.appendChild(noticeText);
    
    const buttonDiv = document.createElement('div');
    buttonDiv.style.cssText = 'display: flex; justify-content: space-between; gap: 10px; margin-top: 20px;';
    
    const deleteAllBtn = document.createElement('button');
    deleteAllBtn.id = 'deleteAllDocsBtn';
    deleteAllBtn.textContent = 'üóëÔ∏è Alle l√∂schen (Art. 17 DSGVO)';
    deleteAllBtn.style.cssText = 'padding: 12px 24px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;';
    
    const closeBtn = document.createElement('button');
    closeBtn.id = 'closeDocsModal';
    closeBtn.textContent = 'Schlie√üen';
    closeBtn.style.cssText = 'padding: 12px 24px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;';
    
    buttonDiv.appendChild(deleteAllBtn);
    buttonDiv.appendChild(closeBtn);
    
    content.appendChild(header);
    content.appendChild(docListContainer);
    content.appendChild(privacyNotice);
    content.appendChild(buttonDiv);
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Event Delegation f√ºr Delete-Buttons (XSS-sicher)
    docListContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-doc-btn')) {
            const documentId = e.target.dataset.documentId;
            if (confirm('Dokument wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) {
                const result = DOCUMENT_STORAGE_GDPR.deleteDocument(documentId);
                if (result.success) {
                    alert('‚úì Dokument erfolgreich gel√∂scht.');
                    document.body.removeChild(modal);
                    showUploadedDocumentsGDPR(); // Neu laden
                } else {
                    alert('‚ùå Fehler beim L√∂schen: ' + result.error);
                }
            }
        }
    });
    
    // Event Listeners
    deleteAllBtn.addEventListener('click', () => {
        if (confirm('M√∂chten Sie wirklich ALLE Dokumente unwiderruflich l√∂schen? (Art. 17 DSGVO)')) {
            deleteAllDocumentsGDPR();
            document.body.removeChild(modal);
        }
    });
    
    closeBtn.addEventListener('click', () => {
        document.body.removeChild(modal);
    });
}

/**
 * L√∂scht einzelnes Dokument mit Best√§tigung
 */
function deleteDocumentGDPR(documentId) {
    if (confirm('Dokument wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) {
        const result = DOCUMENT_STORAGE_GDPR.deleteDocument(documentId);
        
        if (result.success) {
            alert('‚úì Dokument erfolgreich gel√∂scht.');
            // Aktualisiere Anzeige
            const modal = document.getElementById('documentsList')?.parentElement?.parentElement;
            if (modal) {
                document.body.removeChild(modal);
                showUploadedDocumentsGDPR(); // Neu laden
            }
        } else {
            alert('‚ùå Fehler beim L√∂schen: ' + result.error);
        }
    }
}

/**
 * L√∂scht alle Dokumente mit Best√§tigung
 */
function deleteAllDocumentsGDPR() {
    const result = DOCUMENT_STORAGE_GDPR.deleteAllDocuments();
    
    if (result.success) {
        alert(`‚úì Alle Dokumente erfolgreich gel√∂scht (${result.deletedCount} Dokumente).`);
    } else {
        alert('‚ùå Fehler beim L√∂schen der Dokumente.');
    }
}

/**
 * Zeigt Audit-Report an (f√ºr DSB/Praxisinhaber)
 */
function showAuditReportGDPR() {
    const report = OCR_AUDIT.generateAuditReport();
    
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
    `;
    
    const content = document.createElement('div');
    content.style.cssText = `
        background: white;
        padding: 30px;
        border-radius: 8px;
        max-width: 900px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    `;
    
    content.innerHTML = `
        <h2 style="margin-top: 0;">üìä OCR Audit-Report (DSGVO)</h2>
        
        <div style="background: #e3f2fd; padding: 15px; border-radius: 4px; margin: 20px 0;">
            <h3 style="margin-top: 0;">GDPR-Compliance-Status:</h3>
            <p>‚úÖ Lokale Verarbeitung: ${report.gdprCompliance.localProcessing ? 'Ja' : 'Nein'}</p>
            <p>‚úÖ Keine externen APIs: ${report.gdprCompliance.noExternalAPIs ? 'Ja' : 'Nein'}</p>
            <p>‚úÖ Audit-Trail vollst√§ndig: ${report.gdprCompliance.auditTrailComplete ? 'Ja' : 'Nein'}</p>
            <p>‚úÖ L√∂schungsrechte: ${report.gdprCompliance.deletionRightsImplemented ? 'Ja' : 'Nein'}</p>
        </div>
        
        <h3>Statistiken:</h3>
        <ul>
            <li>Gesamt Eintr√§ge: ${report.totalEntries}</li>
            <li>OCR gestartet: ${report.statistics.ocrStarted}</li>
            <li>OCR abgeschlossen: ${report.statistics.ocrCompleted}</li>
            <li>OCR fehlgeschlagen: ${report.statistics.ocrFailed}</li>
            <li>Dokumente hochgeladen: ${report.statistics.documentsUploaded}</li>
            <li>Dokumente gel√∂scht: ${report.statistics.documentsDeleted}</li>
            <li>Einwilligungen erteilt: ${report.statistics.consentGiven}</li>
        </ul>
        
        <h3>Zeitraum:</h3>
        <p>Von: ${report.dateRange.earliest || 'N/A'}</p>
        <p>Bis: ${report.dateRange.latest || 'N/A'}</p>
        
        <button id="exportAuditReport" style="
            padding: 12px 24px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        ">üì• Report exportieren (JSON)</button>
        
        <button id="closeAuditModal" style="
            padding: 12px 24px;
            background: #757575;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        ">Schlie√üen</button>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    document.getElementById('exportAuditReport').addEventListener('click', () => {
        const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ocr-audit-report-${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
    });
    
    document.getElementById('closeAuditModal').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
}

// ============================================================================
// INITIALIZATION
// ============================================================================

// Beim Laden der Seite: Dokumente aus Storage laden
if (typeof window !== 'undefined') {
    window.addEventListener('DOMContentLoaded', () => {
        DOCUMENT_STORAGE_GDPR.loadDocuments();
        console.log('[OCR-GDPR] Module initialized (inline) - DSGVO-konform');
    });
}

// ============================================================================
// EXPORTS (f√ºr Verwendung in anderen Modulen)
// ============================================================================

// Diese Funktionen k√∂nnen in den HTML-Dateien verwendet werden
window.OCR_AUDIT = OCR_AUDIT;
window.OCR_PRIVACY = OCR_PRIVACY;
window.DOCUMENT_STORAGE_GDPR = DOCUMENT_STORAGE_GDPR;
window.performOCRWithAudit = performOCRWithAudit;
window.processUploadedFileWithGDPR = processUploadedFileWithGDPR;
window.showDocumentUploadDialogGDPR = showDocumentUploadDialogGDPR;
window.showUploadedDocumentsGDPR = showUploadedDocumentsGDPR;
window.deleteDocumentGDPR = deleteDocumentGDPR;
window.deleteAllDocumentsGDPR = deleteAllDocumentsGDPR;
window.showAuditReportGDPR = showAuditReportGDPR;
    </script>
    <script>
// =================================================================
// NEUE FUNKTIONEN F√úR LOGIK UND UI-VERBESSERUNGEN (MANUS)
// =================================================================

/**
 * Helper function to get answers from the appropriate state object
 * @returns {object} The answers object
 */
function getAnswers() {
    return (typeof APP_STATE !== 'undefined' && APP_STATE.answers) 
        ? APP_STATE.answers 
        : (typeof AppState !== 'undefined' && AppState.answers) 
            ? AppState.answers 
            : {};
}

// Constants for computed field mappings
const COMPUTED_FIELD_MAPPINGS = {
    'calculated_gender': '0002',
    'birthdate_day': '0003_tag',
    'birthdate_month': '0003_monat',
    'birthdate_year': '0003_jahr'
};

/**
 * Calculates age from birthdate fields
 * @returns {number|null} Age in years or null if incomplete or invalid
 */
function calculateAge() {
    const answers = getAnswers();
    
    const day = parseInt(answers[COMPUTED_FIELD_MAPPINGS.birthdate_day], 10);
    const month = parseInt(answers[COMPUTED_FIELD_MAPPINGS.birthdate_month], 10);
    const year = parseInt(answers[COMPUTED_FIELD_MAPPINGS.birthdate_year], 10);
    
    // Validate inputs
    if (!day || !month || !year || isNaN(day) || isNaN(month) || isNaN(year)) {
        return null;
    }
    
    // Validate month and day ranges
    if (month < 1 || month > 12 || day < 1 || day > 31) {
        return null;
    }
    
    // Create date and validate it's a valid date
    const birthDate = new Date(year, month - 1, day);
    
    // Check if the date is valid (handles cases like Feb 30)
    if (birthDate.getDate() !== day || birthDate.getMonth() !== month - 1 || birthDate.getFullYear() !== year) {
        return null;
    }
    
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    return age;
}

/**
 * Updates visibility of conditional questions without full re-render.
 * Deletes answers for hidden questions as per requirements.
 * NOTE: This intentionally deletes answers immediately when questions become hidden.
 */
function updateConditionalVisibility() {
    const section = APP_DATA.sections[APP_STATE.currentSectionIndex];
    const fields = section.fields || section.questions || [];
    
    fields.forEach(question => {
        const questionElement = document.getElementById(`question-${question.id}`);
        if (!questionElement) return;
        
        const isVisible = checkCondition(question);
        
        if (!isVisible) {
            questionElement.style.display = 'none';
            // Delete answer when question becomes hidden
            if (APP_STATE.answers[question.id] !== undefined) {
                delete APP_STATE.answers[question.id];
            }
        } else {
            questionElement.style.display = 'block';
        }
    });
}

/**
 * Updates the Next button state based on visible required questions.
 */
function updateNextButtonState() {
    const section = APP_DATA.sections[APP_STATE.currentSectionIndex];
    const fields = section.fields || section.questions || [];
    
    let allRequiredAnswered = true;
    
    fields.forEach(question => {
        // Only check visible questions
        const questionElement = document.getElementById(`question-${question.id}`);
        if (!questionElement || questionElement.style.display === 'none') {
            return;
        }
        
        if (question.required) {
            const answer = APP_STATE.answers[question.id];
            if (answer === undefined || answer === null || answer === '') {
                allRequiredAnswered = false;
            }
        }
    });
    
    const nextBtn = document.getElementById('next-btn');
    if (nextBtn) {
        nextBtn.disabled = !allRequiredAnswered;
    }
}

/**
 * Aggregates DOB fields into ISO format YYYY-MM-DD.
 * Stores in APP_STATE.answers['0003'] when all three parts are provided.
 * Clears '0003' otherwise.
 * @param {object} answers - The answers object (APP_STATE.answers or AppState.answers)
 */
function aggregateDOBToISO(answers) {
    const day = parseInt(answers['0003_tag'], 10);
    const month = parseInt(answers['0003_monat'], 10);
    const year = parseInt(answers['0003_jahr'], 10);
    
    if (day && month && year && !isNaN(day) && !isNaN(month) && !isNaN(year)) {
        // Validate date ranges
        if (month < 1 || month > 12 || day < 1 || day > 31 || year < 1900) {
            delete answers['0003'];
            return;
        }
        
        // Validate day is valid for the given month/year
        const daysInMonth = month === 2 
            ? (((year % 4 === 0 && year % 100 !== 0) || year % 400 === 0) ? 29 : 28)
            : ([4, 6, 9, 11].includes(month) ? 30 : 31);
            
        if (day > daysInMonth) {
            delete answers['0003'];
            return;
        }
        
        // Pad day and month with leading zeros
        const paddedDay = String(day).padStart(2, '0');
        const paddedMonth = String(month).padStart(2, '0');
        answers['0003'] = `${year}-${paddedMonth}-${paddedDay}`;
    } else {
        // Clear ISO date if any part is missing
        delete answers['0003'];
    }
}

/**
 * √úberpr√ºft die Bedingungen f√ºr eine Frage oder Sektion.
 * Enhanced to support computed fields and all operators.
 * @param {object} item - Die Frage oder Sektion mit einer optionalen 'condition' Eigenschaft.
 * @returns {boolean} - True, wenn die Bedingung erf√ºllt ist oder keine Bedingung existiert, sonst False.
 */
function checkCondition(item) {
    if (!item.condition) {
        return true;
    }

    const { field, value, operator = '==' } = item.condition;
    const answers = getAnswers();
    
    let answer;
    
    // Handle computed fields
    if (field === 'calculated_age') {
        answer = calculateAge();
    } else if (field === 'calculated_gender') {
        answer = answers[COMPUTED_FIELD_MAPPINGS.calculated_gender];
    } else {
        answer = answers[field];
    }

    if (answer === undefined || answer === null || answer === '') {
        return false; // Bedingung nicht erf√ºllt, wenn die abh√§ngige Frage noch nicht beantwortet wurde
    }

    // Normalisiere die Antwort f√ºr den Vergleich (z.B. Multiselect-Antworten)
    let normalizedAnswer = answer;
    if (Array.isArray(answer)) {
        // F√ºr Multiselect: Pr√ºfen, ob der Wert in der Liste der Antworten enthalten ist
        if (operator === 'includes') {
            return answer.includes(value);
        }
        // Ansonsten wird die Bedingung als nicht erf√ºllt betrachtet, da der einfache Vergleich nicht passt
        return false;
    }

    // F√ºhre den Vergleich basierend auf dem Operator durch
    switch (operator) {
        case '==':
            return normalizedAnswer == value;
        case '!=':
            return normalizedAnswer != value;
        case '>':
            return parseFloat(normalizedAnswer) > parseFloat(value);
        case '<':
            return parseFloat(normalizedAnswer) < parseFloat(value);
        case '>=':
            return parseFloat(normalizedAnswer) >= parseFloat(value);
        case '<=':
            return parseFloat(normalizedAnswer) <= parseFloat(value);
        default:
            return false;
    }
}

/**
 * Rendert die aktuelle Sektion und alle Fragen.
 * F√ºgt die Logik zur dynamischen Anzeige von Fragen hinzu.
 */
function renderCurrentSection() {
    const section = APP_DATA.sections[APP_STATE.currentSectionIndex];
    const formContainer = document.getElementById('form-container');
    formContainer.innerHTML = ''; // Leere den Container

    // Titel der Sektion
    const title = document.createElement('h2');
    title.textContent = getTranslation(section.id);
    formContainer.appendChild(title);

    let allQuestionsAnswered = true;

    // Fragen rendern
    const fields = section.fields || section.questions || [];
    fields.forEach(question => {
        const questionElement = document.createElement('div');
        questionElement.className = 'form-group question-card';
        questionElement.id = `question-${question.id}`;
        
        // NEUE LOGIK: √úberpr√ºfe die Bedingung, bevor die Frage gerendert wird
        const isVisible = checkCondition(question);
        
        if (!isVisible) {
            questionElement.style.display = 'none';
            // L√∂sche die Antwort, wenn die Frage ausgeblendet wird
            delete APP_STATE.answers[question.id];
            return; // Frage √ºberspringen
        }

        questionElement.style.display = 'block';

        // Label rendern mit for-Attribut und aria-label f√ºr Accessibility
        const label = document.createElement('label');
        label.className = 'question-label';
        label.setAttribute('for', question.id);
        label.innerHTML = getTranslation(question.id) + (question.required ? ' <span class="required-star">*</span>' : '');
        questionElement.appendChild(label);

        let inputElement;
        
        // Spezielle Behandlung f√ºr Geburtsdatum (0003_tag, 0003_monat, 0003_jahr)
        if (question.id.startsWith('0003_')) {
            inputElement = createDateSelect(question);
        } else {
            // Standard-Input-Typen (text, number, select, multiselect, etc.)
            inputElement = createStandardInput(question);
        }
        
        // F√ºge aria-label f√ºr Accessibility hinzu
        if (inputElement && inputElement.tagName !== 'DIV') {
            inputElement.setAttribute('aria-label', getTranslation(question.id));
        }

        questionElement.appendChild(inputElement);
        
        // F√ºge Hilfetext f√ºr Textarea hinzu
        if (question.type === 'textarea') {
            const helpText = document.createElement('small');
            helpText.id = question.id + '_help';
            helpText.className = 'help-text';
            helpText.style.cssText = 'display: block; margin-top: 0.25rem; color: #6c757d; font-size: 0.875rem;';
            const helpTextContent = getTranslation('textarea_help') || 'Bitte geben Sie hier weitere Details ein';
            helpText.textContent = helpTextContent;
            questionElement.appendChild(helpText);
        }
        
        formContainer.appendChild(questionElement);

        // Pr√ºfe, ob alle sichtbaren, erforderlichen Fragen beantwortet sind
        if (question.required && (APP_STATE.answers[question.id] === undefined || APP_STATE.answers[question.id] === null || APP_STATE.answers[question.id] === '')) {
            allQuestionsAnswered = false;
        }
    });
    
    // Update Next button state after rendering
    updateNextButtonState();
}

// Hilfsfunktion zum Erstellen der Geburtsdatum-Selects
function createDateSelect(question) {
    const wrapper = document.createElement('div');
    wrapper.className = 'date-select-wrapper';
    wrapper.style.display = 'flex';
    wrapper.style.gap = '10px';

    const currentYear = new Date().getFullYear();
    const isLeap = (year) => (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;

    const createSelect = (id, options, placeholder) => {
        const selectWrapper = document.createElement('div');
        selectWrapper.style.flex = '1';
        
        // Erstelle Label f√ºr jedes Select
        const selectLabel = document.createElement('label');
        selectLabel.setAttribute('for', id);
        selectLabel.textContent = placeholder;
        selectLabel.style.cssText = 'display: block; font-size: 0.875rem; margin-bottom: 0.25rem; color: #6c757d;';
        
        const select = document.createElement('select');
        select.id = id;
        select.name = id;
        select.required = question.required;
        select.setAttribute('aria-label', placeholder);
        
        const defaultOption = document.createElement('option');
        defaultOption.value = '';
        defaultOption.textContent = '-- ' + placeholder + ' --';
        select.appendChild(defaultOption);

        options.forEach(opt => {
            const option = document.createElement('option');
            option.value = opt.value;
            option.textContent = opt.label;
            select.appendChild(option);
        });
        
        select.value = APP_STATE.answers[id] || '';
        
        // Event-Listener f√ºr die Aktualisierung der Antworten
        select.addEventListener('change', () => {
            handleAnswerChange(select.id, select.value);
            // Zus√§tzliche Logik f√ºr die Tage, um Schaltjahre/Monate zu ber√ºcksichtigen
            if (select.id === '0003_monat' || select.id === '0003_jahr') {
                const daySelect = document.getElementById('0003_tag');
                const month = parseInt(document.getElementById('0003_monat').value);
                const year = parseInt(document.getElementById('0003_jahr').value);
                
                if (daySelect && month && year) {
                    let daysInMonth = 31;
                    if ([4, 6, 9, 11].includes(month)) daysInMonth = 30;
                    if (month === 2) daysInMonth = isLeap(year) ? 29 : 28;
                    
                    const currentDay = parseInt(daySelect.value);
                    daySelect.innerHTML = '';
                    
                    const dayDefaultOption = document.createElement('option');
                    dayDefaultOption.value = '';
                    dayDefaultOption.textContent = '-- ' + getTranslation('0003_tag') + ' --';
                    daySelect.appendChild(dayDefaultOption);

                    for (let i = 1; i <= daysInMonth; i++) {
                        const option = document.createElement('option');
                        option.value = String(i);
                        option.textContent = String(i);
                        daySelect.appendChild(option);
                    }
                    
                    // Behalte den aktuellen Tag bei, wenn er g√ºltig ist
                    if (currentDay && currentDay <= daysInMonth) {
                        daySelect.value = String(currentDay);
                        handleAnswerChange(daySelect.id, daySelect.value);
                    } else {
                        daySelect.value = '';
                        handleAnswerChange(daySelect.id, '');
                    }
                }
            }
        });
        
        selectWrapper.appendChild(selectLabel);
        selectWrapper.appendChild(select);
        return selectWrapper;
    };

    // Optionen f√ºr Tag, Monat, Jahr
    const dayOptions = Array.from({ length: 31 }, (_, i) => ({ value: String(i + 1), label: String(i + 1) }));
    const monthOptions = Array.from({ length: 12 }, (_, i) => ({ value: String(i + 1), label: String(i + 1) }));
    const yearOptions = Array.from({ length: 100 }, (_, i) => ({ value: String(currentYear - i), label: String(currentYear - i) }));

    // Erstelle die Select-Boxen
    const daySelect = createSelect('0003_tag', dayOptions, getTranslation('0003_tag'));
    const monthSelect = createSelect('0003_monat', monthOptions, getTranslation('0003_monat'));
    const yearSelect = createSelect('0003_jahr', yearOptions, getTranslation('0003_jahr'));

    wrapper.appendChild(daySelect);
    wrapper.appendChild(monthSelect);
    wrapper.appendChild(yearSelect);

    return wrapper;
}

// Hilfsfunktion zum Erstellen von Standard-Inputs
function createStandardInput(question) {
    let input;
    const currentAnswer = APP_STATE.answers[question.id];

    switch (question.type) {
        case 'text':
        case 'number':
            input = document.createElement('input');
            input.type = question.type;
            input.value = currentAnswer || '';
            // F√ºge Placeholder hinzu
            const placeholderKey = question.id + '_placeholder';
            const placeholderText = getTranslation(placeholderKey);
            if (placeholderText && placeholderText !== placeholderKey) {
                input.placeholder = placeholderText;
            }
            break;
        case 'textarea':
            input = document.createElement('textarea');
            input.value = currentAnswer || '';
            input.rows = 4;
            // F√ºge Placeholder f√ºr Textarea hinzu mit √úbersetzung
            const textareaPlaceholder = getTranslation('textarea_placeholder') || 'Bitte geben Sie hier weitere Details ein';
            input.placeholder = textareaPlaceholder;
            // F√ºge Hilfetext hinzu
            input.setAttribute('aria-describedby', question.id + '_help');
            break;
        case 'select':
            input = document.createElement('select');
            
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = getTranslation('select_placeholder'); // Platzhalter
            input.appendChild(defaultOption);

            question.options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt.value;
                option.textContent = getTranslation(opt.label_key || opt.value);
                if (currentAnswer === opt.value) {
                    option.selected = true;
                }
                input.appendChild(option);
            });
            break;
        case 'multiselect':
            input = document.createElement('div');
            input.className = 'options-list';
            input.setAttribute('role', 'group');
            input.setAttribute('aria-label', getTranslation(question.id));
            
            const selectedValues = Array.isArray(currentAnswer) ? currentAnswer : [];

            question.options.forEach(opt => {
                const item = document.createElement('div');
                item.className = 'option-item';
                if (selectedValues.includes(opt.value)) {
                    item.classList.add('selected');
                }
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `${question.id}-${opt.value}`;
                checkbox.value = opt.value;
                checkbox.checked = selectedValues.includes(opt.value);
                
                const label = document.createElement('label');
                label.setAttribute('for', `${question.id}-${opt.value}`);
                label.textContent = getTranslation(opt.label_key || opt.value);
                
                item.appendChild(checkbox);
                item.appendChild(label);
                
                item.addEventListener('click', () => {
                    checkbox.checked = !checkbox.checked;
                    item.classList.toggle('selected', checkbox.checked);
                    
                    let newValues = Array.from(input.querySelectorAll('input:checked')).map(cb => cb.value);
                    handleAnswerChange(question.id, newValues);
                    updateConditionalVisibility();
                    updateNextButtonState();
                });
                
                input.appendChild(item);
            });
            break;
        default:
            input = document.createElement('input');
            input.type = 'text';
            input.value = currentAnswer || '';
    }
    
    if (question.type !== 'multiselect') {
        input.id = question.id;
        input.name = question.id;
        input.required = question.required;
    }
    
    return input;
}

// Hilfsfunktion zum Abrufen des Input-Wertes
function getInputValue(input) {
    if (input.type === 'checkbox') {
        // Multiselect wird √ºber den Event-Listener im createStandardInput behandelt
        return Array.from(input.parentElement.querySelectorAll('input:checked')).map(cb => cb.value);
    }
    return input.value;
}

/**
 * Sanitize user input to prevent XSS attacks
 * @param {string|any} input - The input to sanitize
 * @returns {string|any} - Sanitized input
 */
function sanitizeInput(input) {
    if (typeof input === 'string') {
        // Entferne HTML-Tags und gef√§hrliche Zeichen
        return input
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#x27;')
            .replace(/\//g, '&#x2F;');
    }
    return input;
}

// Hilfsfunktion zum Speichern der Antwort
function handleAnswerChange(id, value) {
    // Sanitize input to prevent XSS
    const sanitizedValue = Array.isArray(value) 
        ? value.map(sanitizeInput)
        : sanitizeInput(value);
    
    // Entferne die Antwort, wenn sie leer ist
    if (sanitizedValue === '' || (Array.isArray(sanitizedValue) && sanitizedValue.length === 0)) {
        delete APP_STATE.answers[id];
    } else {
        APP_STATE.answers[id] = sanitizedValue;
    }
    
    // Aggregate DOB fields into ISO format
    if (id === '0003_tag' || id === '0003_monat' || id === '0003_jahr') {
        aggregateDOBToISO(APP_STATE.answers);
    }
    
    // Update conditional question visibility
    updateConditionalVisibility();
    
    // Update Next button state
    updateNextButtonState();
    
    // Schedule auto-save after changes
    scheduleAutoSave();
    // Aktualisiere die JSON-Box
    if (typeof updateJsonBox === 'function') {
        updateJsonBox();
    }
}


// =================================================================
// EXPORT-FUNKTIONALIT√ÑT UND VERSCHL√úSSELUNG (MANUS)
// =================================================================

// ‚ö†Ô∏è SECURITY CONFIGURATION ‚ö†Ô∏è
// WICHTIG: √Ñndern Sie diesen Schl√ºssel in der Produktion!
// Der Schl√ºssel muss genau 32 Bytes (32 Zeichen) lang sein f√ºr AES-256
// IMPORTANT: Change this key in production!
// The key must be exactly 32 bytes (32 characters) long for AES-256

/**
 * Verschl√ºsselungsschl√ºssel f√ºr AES-256
 * 
 * SICHERHEITSHINWEISE:
 * 1. Verwenden Sie einen einzigartigen, zuf√§lligen Schl√ºssel pro Einrichtung
 * 2. Bewahren Sie den Schl√ºssel sicher auf (nicht in √∂ffentlichen Repositories!)
 * 3. Teilen Sie den Schl√ºssel nur mit autorisierten Gesundheitsdienstleistern
 * 4. Verwenden Sie einen Passwort-Manager zur Schl√ºsselverwaltung
 * 
 * SECURITY NOTES:
 * 1. Use a unique, random key per facility
 * 2. Store the key securely (not in public repositories!)
 * 3. Share the key only with authorized healthcare providers
 * 4. Use a password manager for key management
 * 
 * Beispiel f√ºr sicheren Schl√ºssel / Example secure key:
 * - "a8f5f167f44f4964e6c998dee827110c" (32 hex characters)
 * - "MySecure32ByteEncryptionKey!!" (32 alphanumeric)
 */
// =================================================================
// SECURE ENCRYPTION KEY MANAGEMENT
// =================================================================

/**
 * Setup encryption key - prompts user for master password on first use
 * Stores hash of password, never the password itself
 * @param {number} retryCount - Internal retry counter to prevent infinite recursion
 * @returns {Promise<boolean>} - True if key is set up successfully
 */
async function setupEncryptionKey(retryCount = 0) {
    const MAX_RETRIES = 3;
    
    if (retryCount >= MAX_RETRIES) {
        alert('Maximale Anzahl an Versuchen √ºberschritten. Bitte laden Sie die Seite neu.');
        throw new Error('Max password attempts exceeded');
    }
    
    let storedKeyHash = localStorage.getItem('encryption_key_hash');
    
    if (!storedKeyHash) {
        // Erste Installation: Admin-Passwort-Setup
        const adminKey = prompt(
            'WICHTIG: Erstmalige Einrichtung\n\n' +
            'Bitte geben Sie ein sicheres Master-Passwort ein (min. 16 Zeichen).\n' +
            'ACHTUNG: Wenn Sie dieses Passwort vergessen, sind alle Daten unwiederbringlich verloren!'
        );
        
        if (!adminKey || adminKey.length < 16) {
            alert('Passwort muss mindestens 16 Zeichen lang sein!');
            return setupEncryptionKey(retryCount + 1);
        }
        
        // Hash f√ºr Verifikation speichern (NICHT das Passwort!)
        const keyHash = await crypto.subtle.digest(
            'SHA-256',
            new TextEncoder().encode(adminKey)
        );
        const keyHashHex = Array.from(new Uint8Array(keyHash))
            .map(b => b.toString(16).padStart(2, '0'))
            .join('');
        
        localStorage.setItem('encryption_key_hash', keyHashHex);
        sessionStorage.setItem('derived_key', adminKey);
        
        alert('‚úÖ Master-Passwort erfolgreich gesetzt!');
        return true;
    } else {
        // Key existiert: Bei Start erneut abfragen
        if (!sessionStorage.getItem('derived_key')) {
            const enteredKey = prompt('Bitte geben Sie Ihr Master-Passwort ein:');
            
            if (!enteredKey) {
                alert('‚ùå Passwort erforderlich!');
                return setupEncryptionKey(retryCount + 1);
            }
            
            const enteredHash = await crypto.subtle.digest(
                'SHA-256',
                new TextEncoder().encode(enteredKey)
            );
            const enteredHashHex = Array.from(new Uint8Array(enteredHash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
            
            if (enteredHashHex !== storedKeyHash) {
                alert('‚ùå Falsches Passwort!');
                return setupEncryptionKey(retryCount + 1);
            }
            
            sessionStorage.setItem('derived_key', enteredKey);
        }
        return true;
    }
}

/**
 * Erstellt das JSON-Objekt der Antworten.
 * @returns {object} - Das JSON-Objekt der Antworten.
 */
function getAnswerJson() {
    const answers = {};
    // Sammle alle Antworten aus APP_STATE.answers
    for (const [key, value] of Object.entries(APP_STATE.answers)) {
        // Filtere leere oder null-Werte
        if (value !== undefined && value !== null && value !== '' && !(Array.isArray(value) && value.length === 0)) {
            answers[key] = value;
        }
    }
    
    // F√ºge Metadaten hinzu
    const result = {
        metadata: {
            version: APP_DATA.version,
            timestamp: new Date().toISOString(),
            language: APP_STATE.currentLanguage,
            app_title: getTranslation('app_title')
        },
        answers: answers
    };
    
    return result;
}

/**
 * Derive encryption key from password using PBKDF2
 * @param {string} password - The password to derive the key from
 * @param {Uint8Array} salt - Salt for key derivation
 * @returns {Promise<CryptoKey>} - The derived key
 */
async function deriveKeyFromPassword(password, salt) {
    const encoder = new TextEncoder();
    const keyMaterial = await crypto.subtle.importKey(
        'raw',
        encoder.encode(password),
        'PBKDF2',
        false,
        ['deriveBits', 'deriveKey']
    );

    return crypto.subtle.deriveKey(
        {
            name: 'PBKDF2',
            salt: salt,
            iterations: 100000,
            hash: 'SHA-256'
        },
        keyMaterial,
        { name: 'AES-GCM', length: 256 },
        false,
        ['encrypt', 'decrypt']
    );
}

/**
 * Verschl√ºsselt einen String mit AES-256-GCM (Web Crypto API).
 * @param {string} data - Der zu verschl√ºsselnde String.
 * @returns {Promise<string>} - Der verschl√ºsselte String (Base64).
 */
async function encryptData(data) {
    try {
        const userKey = sessionStorage.getItem('derived_key');
        if (!userKey) {
            throw new Error('Kein Verschl√ºsselungsschl√ºssel verf√ºgbar. Bitte Master-Passwort eingeben.');
        }
        
        const encoder = new TextEncoder();
        const salt = crypto.getRandomValues(new Uint8Array(16));
        const iv = crypto.getRandomValues(new Uint8Array(12));
        
        const key = await deriveKeyFromPassword(userKey, salt);
        
        const encryptedData = await crypto.subtle.encrypt(
            {
                name: 'AES-GCM',
                iv: iv
            },
            key,
            encoder.encode(data)
        );

        // Combine salt, iv, and encrypted data
        const result = new Uint8Array(salt.length + iv.length + encryptedData.byteLength);
        result.set(salt, 0);
        result.set(iv, salt.length);
        result.set(new Uint8Array(encryptedData), salt.length + iv.length);

        // Convert to base64 safely for large data
        const base64 = btoa(result.reduce((data, byte) => data + String.fromCharCode(byte), ''));
        return base64;
    } catch (e) {
        console.error("Verschl√ºsselungsfehler:", e);
        throw new Error("Encryption failed: " + e.message);
    }
}

/**
 * Entschl√ºsselt einen String mit AES-256-GCM (Web Crypto API).
 * @param {string} encryptedBase64 - Der verschl√ºsselte String (Base64).
 * @returns {Promise<string|null>} - Der entschl√ºsselte String oder null im Fehlerfall.
 */
async function decryptData(encryptedBase64) {
    try {
        const userKey = sessionStorage.getItem('derived_key');
        if (!userKey) {
            throw new Error('Kein Verschl√ºsselungsschl√ºssel verf√ºgbar. Bitte Master-Passwort eingeben.');
        }
        
        const decoder = new TextDecoder();
        
        // Decode from base64 efficiently
        const binaryString = atob(encryptedBase64);
        const encryptedArray = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
            encryptedArray[i] = binaryString.charCodeAt(i);
        }

        // Extract salt, iv, and encrypted data
        const salt = encryptedArray.slice(0, 16);
        const iv = encryptedArray.slice(16, 28);
        const data = encryptedArray.slice(28);

        const key = await deriveKeyFromPassword(userKey, salt);

        const decryptedData = await crypto.subtle.decrypt(
            {
                name: 'AES-GCM',
                iv: iv
            },
            key,
            data
        );

        return decoder.decode(decryptedData);
    } catch (e) {
        console.error("Entschl√ºsselungsfehler:", e);
        throw new Error("Decryption failed - incorrect password or corrupted data");
    }
}

/**
 * Aktualisiert die JSON-Box mit den aktuellen Antworten.
 */
async function updateJsonBox() {
    const answerJson = getAnswerJson();
    const jsonString = JSON.stringify(answerJson, null, 2);
    
    const jsonBox = document.getElementById('json-answer-box');
    if (jsonBox) {
        try {
            // Verschl√ºsseln f√ºr die Anzeige in der Box
            const encryptedString = await encryptData(jsonString);
            jsonBox.value = encryptedString;
        } catch (e) {
            console.error("Failed to encrypt JSON box data:", e);
            jsonBox.value = "[Encryption Error: " + e.message + "]";
        }
    }
    
    // Aktualisiere die Zusammenfassung (Summary Box)
    updateSummaryBox(answerJson.answers);
}

/**
 * √úbersetzt einen Schl√ºssel in die aktuelle Sprache.
 * @param {string} key - Der √úbersetzungsschl√ºssel.
 * @returns {string} - Die √úbersetzung oder der Schl√ºssel selbst.
 */
function getTranslation(key) {
    // Falls APP_STATE existiert, verwende dessen Sprache, sonst verwende 'de'
    const lang = (typeof APP_STATE !== 'undefined' && APP_STATE.language) ? APP_STATE.language : 
                 (typeof AppState !== 'undefined' && AppState.language) ? AppState.language : 'en';
    
    if (!window.APP_DATA || !window.APP_DATA.translations) return key;
    const trans = window.APP_DATA.translations[lang];
    const labelKey = `label_${key}`;
    return trans?.[labelKey] || trans?.[key] || key;
}

// =================================================================
// AUTO-SAVE FUNCTIONALITY
// =================================================================

let autoSaveTimer = null;
let lastSaveTime = null;

/**
 * Schedule an auto-save after user stops typing for 2 seconds
 */
function scheduleAutoSave() {
    if (autoSaveTimer) {
        clearTimeout(autoSaveTimer);
    }
    
    showSaveIndicator('saving');
    
    autoSaveTimer = setTimeout(async () => {
        try {
            await saveToLocalStorage();
            lastSaveTime = new Date();
            showSaveIndicator('saved');
        } catch (e) {
            showSaveIndicator('error');
            console.error('Auto-save failed:', e);
        }
    }, 2000);
}

/**
 * Save current state to localStorage
 */
function saveToLocalStorage() {
    return new Promise((resolve, reject) => {
        try {
            // Check rate limit
            if (window.rateLimiter && !window.rateLimiter.isAllowed('save')) {
                console.warn('[Save] Rate limit exceeded, please wait');
                reject(new Error('Too many save attempts. Please wait a moment.'));
                return;
            }

            const answers = (typeof APP_STATE !== 'undefined' && APP_STATE.answers) 
                ? APP_STATE.answers 
                : (typeof AppState !== 'undefined' && AppState.answers) 
                    ? AppState.answers 
                    : {};
            const currentSection = (typeof APP_STATE !== 'undefined' && APP_STATE.currentSectionIndex !== undefined) 
                ? APP_STATE.currentSectionIndex 
                : (typeof AppState !== 'undefined' && AppState.currentStep !== undefined) 
                    ? AppState.currentStep 
                    : 0;
            
            const saveData = {
                answers: answers,
                currentSection: currentSection,
                timestamp: new Date().toISOString()
            };
            
            // Use SecureStorage wrapper
            if (window.SecureStorage) {
                if (SecureStorage.setItem('anamnese_autosave', saveData)) {
                    resolve();
                } else {
                    reject(new Error('LocalStorage full or unavailable'));
                }
            } else {
                // Fallback to direct localStorage
                localStorage.setItem('anamnese_autosave', JSON.stringify(saveData));
                resolve();
            }
        } catch (e) {
            reject(new Error('LocalStorage full or unavailable'));
        }
    });
}

/**
 * Show save indicator with status
 * @param {string} status - 'saving', 'saved', or 'error'
 */
function showSaveIndicator(status) {
    let indicator = document.getElementById('save-indicator');
    
    if (!indicator) {
        indicator = document.createElement('div');
        indicator.id = 'save-indicator';
        indicator.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            z-index: 10000;
        `;
        document.body.appendChild(indicator);
    }
    
    switch (status) {
        case 'saving':
            indicator.textContent = 'üíæ Speichert...';
            indicator.style.backgroundColor = '#3b82f6';
            indicator.style.color = 'white';
            indicator.style.opacity = '1';
            break;
        case 'saved':
            indicator.textContent = '‚úì Gespeichert ' + new Date().toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'});
            indicator.style.backgroundColor = '#10b981';
            indicator.style.color = 'white';
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
            break;
        case 'error':
            indicator.textContent = '‚ö†Ô∏è Speichern fehlgeschlagen';
            indicator.style.backgroundColor = '#ef4444';
            indicator.style.color = 'white';
            indicator.style.opacity = '1';
            break;
    }
}

/**
 * Restore auto-saved data on page load
 */
function restoreAutoSave() {
    try {
        const savedData = localStorage.getItem('anamnese_autosave');
        if (savedData) {
            const { answers, currentSection, timestamp } = JSON.parse(savedData);
            const savedDate = new Date(timestamp);
            const hoursSinceSave = (new Date() - savedDate) / 1000 / 3600;
            
            if (hoursSinceSave < 24) {
                const restore = confirm(
                    `Es wurde eine unvollst√§ndige Anamnese gefunden vom ${savedDate.toLocaleString('de-DE')}.\n\n` +
                    'M√∂chten Sie diese fortsetzen?'
                );
                
                if (restore) {
                    if (typeof APP_STATE !== 'undefined') {
                        APP_STATE.answers = answers;
                        APP_STATE.currentSectionIndex = currentSection;
                    }
                    if (typeof AppState !== 'undefined') {
                        AppState.answers = answers;
                        AppState.currentStep = currentSection;
                    }
                    return true;
                }
            }
        }
    } catch (e) {
        console.error('Failed to restore auto-save:', e);
    }
    return false;
}

/**
 * Findet ein Fragenobjekt anhand seiner ID.
 * @param {string} questionId - Die ID der Frage.
 * @returns {object|null} - Das Fragenobjekt oder null.
 */
function findQuestionById(questionId) {
    if (!window.APP_DATA || !window.APP_DATA.sections) return null;
    
    for (const section of window.APP_DATA.sections) {
        if (section.fields) {
            const field = section.fields.find(f => f.id === questionId);
            if (field) return field;
        }
    }
    return null;
}

/**
 * Aktualisiert die Zusammenfassungsbox.
 * @param {object} answers - Das Antworten-Objekt.
 */
function updateSummaryBox(answers) {
    const summaryContent = document.getElementById('summary-content');
    if (!summaryContent) return;
    
    summaryContent.innerHTML = '';
    
    for (const [id, value] of Object.entries(answers)) {
        const question = findQuestionById(id);
        if (!question) continue;
        
        const item = document.createElement('div');
        item.className = 'summary-item';
        item.setAttribute('data-question-id', id);
        item.onclick = () => App.jumpToQuestion(id); // Springe zur Frage
        
        const label = document.createElement('div');
        label.className = 'summary-label';
        label.textContent = getTranslation(question.id);
        
        const val = document.createElement('div');
        val.className = 'summary-value';
        val.textContent = formatAnswerValue(question, value);
        
        item.appendChild(label);
        item.appendChild(val);
        summaryContent.appendChild(item);
    }
}

/**
 * Formatiert den Antwortwert f√ºr die Anzeige.
 * @param {object} question - Das Fragenobjekt.
 * @param {*} value - Der Rohwert der Antwort.
 * @returns {string} - Der formatierte String.
 */
function formatAnswerValue(question, value) {
    if (Array.isArray(value)) {
        // Multiselect
        return value.map(v => getTranslation(v)).join(', ');
    }
    
    if (question.type === 'select' && question.options) {
        // Select
        const option = question.options.find(opt => opt.value === value);
        return option ? getTranslation(option.label_key || option.value) : value;
    }
    
    // Standard (Text, Number, etc.)
    return value;
}

/**
 * Springt zur Sektion der gegebenen Frage.
 * @param {string} questionId - Die ID der Frage.
 */
function jumpToQuestion(questionId) {
    const sectionIndex = APP_DATA.sections.findIndex(section => {
        // NOTE: section.questions is deprecated, use section.fields instead
        const fields = section.fields || section.questions || [];
        return fields.some(q => q.id === questionId);
    });
    
    if (sectionIndex !== -1) {
        APP_STATE.currentSectionIndex = sectionIndex;
        renderCurrentSection();
        updateProgress();
        
        // Scrolle zur Frage
        setTimeout(() => {
            const questionElement = document.getElementById(`question-${questionId}`);
            if (questionElement) {
                questionElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Optional: Hebe die Frage kurz hervor
                questionElement.style.boxShadow = '0 0 10px 5px var(--warning)';
                setTimeout(() => {
                    questionElement.style.boxShadow = '0 4px 12px var(--shadow)';
                }, 1000);
            }
        }, 100);
    }
}

/**
 * Exportiert die Antworten als verschl√ºsselte JSON-Datei.
 * @param {boolean} encrypted - Ob die Daten verschl√ºsselt werden sollen.
 */
async function exportJsonFile(encrypted = true) {
    const answerJson = getAnswerJson();
    const jsonString = JSON.stringify(answerJson, null, 2);
    
    let dataToExport = jsonString;
    let filename = 'anamnese_antworten.json';
    
    if (encrypted) {
        try {
            dataToExport = await encryptData(jsonString);
            filename = 'anamnese_antworten_enc.txt';
        } catch (e) {
            alert('Encryption error: ' + e.message);
            return;
        }
    }
    
    const blob = new Blob([dataToExport], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

/**
 * Sendet die Antworten per E-Mail (als verschl√ºsselten Anhang).
 */
async function sendEmail() {
    const answerJson = getAnswerJson();
    const jsonString = JSON.stringify(answerJson, null, 2);
    
    try {
        const encryptedData = await encryptData(jsonString);
        
        const subject = getTranslation('email_subject');
        const body = getTranslation('email_body') + '\n\n' + encryptedData;
        
        // Erstelle einen Mailto-Link
        const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.location.href = mailtoLink;
    } catch (e) {
        alert('Encryption error for email: ' + e.message);
    }
}

/**
 * Exportiert die Antworten √ºber NFC (simuliert, da NFC-API komplex ist).
 */
async function exportNFC() {
    if ('NDEFReader' in window) {
        // Echte NFC-Implementierung
        const answerJson = getAnswerJson();
        const jsonString = JSON.stringify(answerJson, null, 2);
        
        try {
            const encryptedData = await encryptData(jsonString);
            
            const reader = new NDEFReader();
            reader.write({ records: [{ recordType: "text", data: encryptedData }] })
                .then(() => alert(getTranslation('nfc_success')))
                .catch(error => alert(getTranslation('nfc_error') + error));
        } catch (e) {
            alert('Encryption error for NFC: ' + e.message);
        }
    } else {
        // Fallback/Simulation
        alert(getTranslation('nfc_simulation'));
        // Zeige die verschl√ºsselten Daten an, die √ºber NFC gesendet w√ºrden
        try {
            const encryptedData = await encryptData(JSON.stringify(getAnswerJson(), null, 2));
            document.getElementById('json-answer-box').value = encryptedData;
        } catch (e) {
            alert('Encryption error: ' + e.message);
        }
    }
}

// F√ºge die Entschl√ºsselungsfunktion f√ºr die Praxis/Klinik hinzu
async function showDecryptionModal() {
    const encryptedData = prompt(getTranslation('decryption_prompt'));
    if (encryptedData) {
        try {
            const decryptedData = await decryptData(encryptedData);
            if (decryptedData) {
                try {
                    const jsonObject = JSON.parse(decryptedData);
                    alert(getTranslation('decryption_success') + JSON.stringify(jsonObject, null, 2));
                } catch (e) {
                    alert(getTranslation('decryption_error_json'));
                }
            }
        } catch (e) {
            alert('Decryption failed: ' + e.message);
        }
    }
}

// =================================================================
// DOKUMENTEN-UPLOAD UND OCR-FUNKTIONALIT√ÑT (LEGACY)
// =================================================================
// HINWEIS: Diese Funktionen werden f√ºr R√ºckw√§rtskompatibilit√§t beibehalten.
// F√ºr DSGVO-konforme OCR-Verarbeitung verwenden Sie das neue Modul:
// - ocr-gdpr-module.js (inkl. Audit-Logging, Datenschutz-Benachrichtigung, etc.)
// - Funktionen: showDocumentUploadDialogGDPR(), DOCUMENT_STORAGE_GDPR, etc.
// =================================================================

/**
 * Speichert hochgeladene Dokumente und OCR-Texte (LEGACY)
 */
const DOCUMENT_STORAGE = {
    documents: [] // Array von {filename, text, timestamp, type}
};

/**
 * Extrahiert Text aus einem PDF-Dokument
 * @param {File} file - Die PDF-Datei
 * @returns {Promise<string>} - Der extrahierte Text
 */
async function extractTextFromPDF(file) {
    try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let fullText = '';
        
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n';
        }
        
        return fullText.trim();
    } catch (error) {
        console.error('PDF-Textextraktion fehlgeschlagen:', error);
        throw new Error('Fehler beim Extrahieren des Textes aus PDF: ' + error.message);
    }
}

/**
 * F√ºhrt OCR auf einem Bild durch
 * @param {File} file - Die Bilddatei
 * @returns {Promise<string>} - Der erkannte Text
 */
async function performOCR(file) {
    try {
        const result = await Tesseract.recognize(
            file,
            'deu', // Deutsch als Hauptsprache, kann auf 'eng' oder 'deu+eng' ge√§ndert werden
            {
                logger: m => {
                    if (m.status === 'recognizing text') {
                        console.log('OCR Fortschritt:', Math.round(m.progress * 100) + '%');
                    }
                }
            }
        );
        return result.data.text;
    } catch (error) {
        console.error('OCR fehlgeschlagen:', error);
        throw new Error('Fehler bei der Texterkennung: ' + error.message);
    }
}

/**
 * Verarbeitet eine hochgeladene Datei (Bild, PDF oder Text)
 * @param {File} file - Die hochgeladene Datei
 * @returns {Promise<object>} - Objekt mit filename, text, timestamp, type
 */
async function processUploadedFile(file) {
    const timestamp = new Date().toISOString();
    const fileType = file.type;
    
    let extractedText = '';
    let processType = '';
    
    try {
        if (fileType === 'application/pdf') {
            // PDF-Verarbeitung
            processType = 'pdf-extraction';
            extractedText = await extractTextFromPDF(file);
        } else if (fileType.startsWith('image/')) {
            // Bildverarbeitung mit OCR
            processType = 'ocr';
            extractedText = await performOCR(file);
        } else if (fileType.startsWith('text/')) {
            // Textdatei direkt lesen
            processType = 'text-file';
            extractedText = await file.text();
        } else {
            throw new Error('Nicht unterst√ºtzter Dateityp: ' + fileType);
        }
        
        return {
            filename: file.name,
            text: extractedText,
            timestamp: timestamp,
            type: processType,
            originalSize: file.size
        };
    } catch (error) {
        throw new Error('Fehler beim Verarbeiten von ' + file.name + ': ' + error.message);
    }
}

/**
 * Zeigt einen Dialog zum Hochladen von Dokumenten
 */
async function showDocumentUploadDialog() {
    // Erstelle ein verstecktes File-Input-Element
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*,.pdf,.txt';
    input.multiple = true;
    
    return new Promise((resolve) => {
        input.onchange = async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) {
                resolve(false);
                return;
            }
            
            // Zeige Fortschrittsanzeige
            const processedDocs = [];
            let processedCount = 0;
            
            for (const file of files) {
                try {
                    // Zeige Fortschritt
                    alert(`Verarbeite Dokument ${processedCount + 1} von ${files.length}: ${file.name}...`);
                    
                    const docData = await processUploadedFile(file);
                    DOCUMENT_STORAGE.documents.push(docData);
                    processedDocs.push(docData);
                    processedCount++;
                } catch (error) {
                    console.error('Fehler beim Verarbeiten der Datei:', error);
                    alert('Error: ' + error.message);
                }
            }
            
            if (processedDocs.length > 0) {
                alert(`${processedDocs.length} document(s) successfully processed and added.`);
                resolve(true);
            } else {
                alert('No documents could be processed.');
                resolve(false);
            }
        };
        
        input.click();
    });
}

/**
 * Erweiterte getAnswerJson-Funktion mit Dokumenten (GDPR-compliant)
 * @returns {object} - Das JSON-Objekt mit Antworten und Dokumenten
 */
function getAnswerJsonWithDocuments() {
    const baseJson = getAnswerJson();
    
    // F√ºge Dokumente hinzu aus GDPR-konformem Storage
    if (typeof DOCUMENT_STORAGE_GDPR !== 'undefined') {
        const documents = DOCUMENT_STORAGE_GDPR.getAllDocuments();
        if (documents.length > 0) {
            baseJson.attachedDocuments = documents;
            console.log(`‚úì ${documents.length} Dokument(e) aus GDPR-Storage hinzugef√ºgt`);
        }
    } else {
        // Fallback auf altes System (falls GDPR-Modul nicht geladen)
        console.warn('‚ö†Ô∏è GDPR-Modul nicht geladen - verwende Legacy-Storage');
        if (typeof DOCUMENT_STORAGE !== 'undefined' && DOCUMENT_STORAGE.documents.length > 0) {
            baseJson.attachedDocuments = DOCUMENT_STORAGE.documents;
            console.log(`‚úì ${DOCUMENT_STORAGE.documents.length} Dokument(e) aus Legacy-Storage hinzugef√ºgt`);
        }
    }
    
    return baseJson;
}

/**
 * Exportiert JSON mit optionalen Dokumenten
 * @param {boolean} encrypted - Ob die Daten verschl√ºsselt werden sollen
 * @param {boolean} includeDocuments - Ob Dokumente einbezogen werden sollen
 */
async function exportJsonFileWithDocuments(encrypted = true, includeDocuments = true) {
    let answerJson;
    
    if (includeDocuments && DOCUMENT_STORAGE.documents.length > 0) {
        answerJson = getAnswerJsonWithDocuments();
    } else {
        answerJson = getAnswerJson();
    }
    
    const jsonString = JSON.stringify(answerJson, null, 2);
    
    let dataToExport = jsonString;
    let filename = 'anamnese_antworten.json';
    
    if (encrypted) {
        try {
            dataToExport = await encryptData(jsonString);
            filename = 'anamnese_antworten_enc.txt';
        } catch (e) {
            alert('Encryption error: ' + e.message);
            return;
        }
    }
    
    const blob = new Blob([dataToExport], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

/**
 * Fragt vor dem Export, ob Dokumente hochgeladen werden sollen
 */
async function exportWithDocumentPrompt(encrypted = true) {
    const wantToUpload = confirm('Would you like to upload additional documents (images, PDFs, text files) before export?');
    
    if (wantToUpload) {
        await showDocumentUploadDialog();
    }
    
    // Exportiere mit allen verf√ºgbaren Dokumenten
    await exportJsonFileWithDocuments(encrypted, true);
}

/**
 * Sendet E-Mail mit Dokumenten
 */
async function sendEmailWithDocuments() {
    const wantToUpload = confirm('Would you like to upload additional documents (images, PDFs, text files) before sending?');
    
    if (wantToUpload) {
        await showDocumentUploadDialog();
    }
    
    const answerJson = DOCUMENT_STORAGE.documents.length > 0 
        ? getAnswerJsonWithDocuments() 
        : getAnswerJson();
    const jsonString = JSON.stringify(answerJson, null, 2);
    
    try {
        const encryptedData = await encryptData(jsonString);
        
        const subject = getTranslation('email_subject');
        let body = getTranslation('email_body') + '\n\n';
        
        if (DOCUMENT_STORAGE.documents.length > 0) {
            body += `(${DOCUMENT_STORAGE.documents.length} document(s) attached)\n\n`;
        }
        
        body += encryptedData;
        
        const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.location.href = mailtoLink;
    } catch (e) {
        alert('Encryption error for email: ' + e.message);
    }
}

/**
 * Zeigt die hochgeladenen Dokumente an
 */
function showUploadedDocuments() {
    if (DOCUMENT_STORAGE.documents.length === 0) {
        alert('No documents uploaded.');
        return;
    }
    
    let message = `Uploaded documents (${DOCUMENT_STORAGE.documents.length}):\n\n`;
    DOCUMENT_STORAGE.documents.forEach((doc, index) => {
        message += `${index + 1}. ${doc.filename}\n`;
        message += `   Typ: ${doc.type}\n`;
        message += `   Text-L√§nge: ${doc.text.length} Zeichen\n`;
        message += `   Zeitstempel: ${doc.timestamp}\n\n`;
    });
    
    alert(message);
}

/**
 * L√∂scht alle hochgeladenen Dokumente
 */
function clearUploadedDocuments() {
    if (DOCUMENT_STORAGE.documents.length === 0) {
        alert('No documents available to delete.');
        return;
    }
    
    if (confirm(`Do you want to delete all ${DOCUMENT_STORAGE.documents.length} uploaded documents?`)) {
        DOCUMENT_STORAGE.documents = [];
        alert('All documents have been deleted.');
    }
}


// NOTE: These function assignments have been commented out because App object
// is defined later in the file. The functions are already accessible globally.
// App.exportJsonFile = exportJsonFile;
// App.sendEmail = sendEmail;
// App.exportNFC = exportNFC;
// App.jumpToQuestion = jumpToQuestion;
// App.showDecryptionModal = showDecryptionModal;
// App.updateJsonBox = updateJsonBox;
// App.exportWithDocumentPrompt = exportWithDocumentPrompt;
// App.sendEmailWithDocuments = sendEmailWithDocuments;
// App.showDocumentUploadDialog = showDocumentUploadDialog;
// App.showUploadedDocuments = showUploadedDocuments;
// App.clearUploadedDocuments = clearUploadedDocuments;
// ... (Rest des Original-Codes)
</script>

    <style>
        /* =================================================================
           CSS VARIABLEN & THEME
           ================================================================= */
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --input-text: #212529;
            --input-border: #ced4da;
            --input-focus: #80bdff;
            --primary: #007bff;
            --primary-hover: #0056b3;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --border-color: #dee2e6;
            --shadow: rgba(0, 0, 0, 0.1);
            --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        body.dark {
            --bg-color: #1a1a2e;
            --text-color: #f1f1f1;
            --card-bg: #16213e;
            --input-bg: #0f3460;
            --input-text: #f1f1f1;
            --input-border: #0f3460;
            --input-focus: #e94560;
            --primary: #e94560;
            --primary-hover: #ff6b6b;
            --secondary: #4a5568;
            --border-color: #2d3748;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* =================================================================
           ACCESSIBILITY: SKIP LINKS
           ================================================================= */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 0 0 4px 0;
            z-index: 10000;
            font-weight: bold;
            transition: top 0.2s ease;
        }

        .skip-link:focus {
            top: 0;
            outline: 3px solid var(--warning);
            outline-offset: 2px;
        }

        /* Screen Reader Only content */
        .sr-only {
            position: absolute;
            left: -10000px;
            width: 1px;
            height: 1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
        }

        /* =================================================================
           ACCESSIBILITY: FOCUS INDICATORS
           ================================================================= */
        *:focus {
            outline: 3px solid var(--warning);
            outline-offset: 2px;
        }

        button:focus, input:focus, select:focus, textarea:focus, a:focus {
            outline: 3px solid var(--warning);
            outline-offset: 2px;
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --input-border: #000;
                --border-color: #000;
            }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* =================================================================
           MOBILE & PWA OPTIMIZATIONS
           ================================================================= */
        /* Touch device optimizations */
        .touch-device button,
        .touch-device input[type="button"],
        .touch-device input[type="submit"],
        .touch-device .btn {
            min-height: 44px; /* iOS recommendation */
            min-width: 44px;
        }

        /* Offline indicator */
        body.offline::before {
            content: '‚ö†Ô∏è Offline - Changes will be saved locally';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--warning);
            color: #000;
            text-align: center;
            padding: 8px;
            z-index: 9998;
            font-weight: bold;
        }

        /* Safe area insets for iOS notch */
        @supports (padding: max(0px)) {
            body {
                padding-left: max(0px, env(safe-area-inset-left));
                padding-right: max(0px, env(safe-area-inset-right));
            }
        }

        /* PWA standalone mode detection */
        @media (display-mode: standalone) {
            body::after {
                content: '';
                /* PWA-specific styles can go here */
            }
        }

        /* =================================================================
           MODAL (Datenschutz)
           ================================================================= */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .modal-overlay.hidden { display: none; }
        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px var(--shadow);
        }
        .modal-content h2 { margin-top: 0; color: var(--primary); }
        .modal-content p { margin-bottom: 1.5rem; }

        /* =================================================================
           CONTAINER & LAYOUT
           ================================================================= */
        .app-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .app-container.hidden { display: none; }

        /* =================================================================
           HEADER
           ================================================================= */
        header {
            text-align: center;
            padding: 1rem 0;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1rem;
        }
        header h1 {
            font-size: 1.8rem;
            margin: 0 0 0.5rem 0;
            color: var(--primary);
        }
        .header-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            align-items: center;
            margin-top: 1rem;
        }
        .header-controls select,
        .header-controls button {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background: var(--input-bg);
            color: var(--input-text);
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* =================================================================
           DISCLAIMER BANNERS
           ================================================================= */
        .disclaimer {
            padding: 0.75rem 1rem;
            border-radius: 6px;
            margin-bottom: 0.75rem;
            font-weight: 500;
            text-align: center;
        }
        .disclaimer.warning { background: var(--warning); color: #212529; }
        .disclaimer.success { background: var(--success); color: #fff; }
        .disclaimer.danger { background: var(--danger); color: #fff; }

        /* =================================================================
           PROGRESS BAR
           ================================================================= */
        .progress-container { 
            margin-bottom: 1.5rem; 
            position: relative;
        }
        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .progress-text::before {
            content: 'üìä';
            font-size: 1rem;
        }
        .progress-bar {
            height: 16px;
            background: var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            transition: width 0.4s ease, background-color 0.3s ease;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Progress fill animation */
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(
                90deg,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.3) 50%,
                rgba(255,255,255,0) 100%
            );
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Responsive progress */
        @media (max-width: 640px) {
            .progress-text {
                font-size: 0.8rem;
            }
            .progress-bar {
                height: 12px;
            }
        }

        /* =================================================================
           QUESTION CARD
           ================================================================= */
        .question-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px var(--shadow);
        }
        .question-card h2 {
            margin: 0 0 1rem 0;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            font-size: 1.3rem;
            color: var(--primary);
        }

        /* =================================================================
           FORM ELEMENTS
           ================================================================= */
        .form-group { margin-bottom: 1.25rem; }
        .question-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-color);
        }
        .question-label .required-star {
            color: var(--danger);
            margin-left: 4px;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--input-text);
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
        }
        input.invalid, select.invalid, textarea.invalid {
            border-color: var(--danger);
        }
        .error-message {
            color: var(--danger);
            font-size: 0.85rem;
            margin-top: 0.25rem;
            display: none;
        }
        .error-message.visible { display: block; }

        /* Radio & Checkbox */
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .option-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--input-bg);
        }
        .option-item:hover {
            border-color: var(--primary);
            background: rgba(0, 123, 255, 0.05);
        }
        .option-item.selected {
            border-color: var(--primary);
            background: rgba(0, 123, 255, 0.1);
        }
        .option-item input {
            margin-right: 0.75rem;
            width: auto;
            cursor: pointer;
        }
        .option-item span {
            flex: 1;
            color: var(--text-color);
        }

        /* =================================================================
           BUTTONS
           ================================================================= */
        .nav-buttons, .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .btn {
            flex: 1;
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 120px;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover:not(:disabled) { background: var(--primary-hover); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-secondary:hover:not(:disabled) { background: #5a6268; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-info { background: #17a2b8; color: white; border: none; }
        .btn-info:hover:not(:disabled) { background: #138496; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn.hidden { display: none; }

        /* =================================================================
           SUMMARY BOX
           ================================================================= */
        .summary-box {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .summary-box.hidden { display: none; }
        .summary-box h3 { margin: 0 0 1rem 0; color: var(--primary); }
        .summary-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s;
        }
        .summary-item:hover { background: rgba(0, 123, 255, 0.05); }
        .summary-item:last-child { border-bottom: none; }
        .summary-label { font-weight: 600; color: var(--secondary); font-size: 0.85rem; }
        .summary-value { color: var(--text-color); margin-top: 0.25rem; }

        /* =================================================================
           FOOTER
           ================================================================= */
        footer {
            margin-top: auto;
            padding: 1.5rem 0;
            text-align: center;
            border-top: 1px solid var(--border-color);
            font-size: 0.85rem;
            color: var(--secondary);
        }
        footer p { margin: 0.25rem 0; }

        /* =================================================================
           DATE SELECT WRAPPER (BIRTHDAY PICKER) - IMPROVED STYLING
           ================================================================= */
        .date-select-wrapper {
            display: grid;
            grid-template-columns: 1fr 2fr 1.5fr;
            gap: 12px;
            margin: 10px 0;
        }
        .date-select-wrapper select {
            padding: 12px 16px;
            font-size: 1rem;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            background: var(--input-bg);
            color: var(--input-text);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .date-select-wrapper select:hover {
            border-color: var(--primary);
            background: rgba(0, 123, 255, 0.05);
        }
        .date-select-wrapper select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.2);
        }
        .date-select-wrapper select option {
            padding: 8px;
        }

        /* =================================================================
           RTL SUPPORT FOR ARABIC
           ================================================================= */
        body[dir="rtl"] {
            text-align: right;
            direction: rtl;
        }

        body[dir="rtl"] .app-container {
            direction: rtl;
        }

        body[dir="rtl"] .question-card,
        body[dir="rtl"] .nav-buttons,
        body[dir="rtl"] .action-buttons,
        body[dir="rtl"] .header-controls {
            direction: rtl;
        }

        body[dir="rtl"] .field-group {
            text-align: right;
        }

        body[dir="rtl"] .field-label {
            text-align: right;
        }

        body[dir="rtl"] .disclaimer {
            text-align: right;
        }

        body[dir="rtl"] .modal-content {
            direction: rtl;
            text-align: right;
        }

        body[dir="rtl"] .summary-box {
            direction: rtl;
            text-align: right;
        }

        body[dir="rtl"] footer {
            direction: rtl;
            text-align: right;
        }

        /* Adjust button icon positions for RTL */
        body[dir="rtl"] .btn {
            flex-direction: row-reverse;
        }

        /* Adjust input fields for RTL */
        body[dir="rtl"] input[type="text"],
        body[dir="rtl"] select,
        body[dir="rtl"] textarea {
            text-align: right;
            direction: rtl;
        }

        /* Adjust checkbox and radio alignment for RTL */
        body[dir="rtl"] .field-checkbox label,
        body[dir="rtl"] .field-radio label {
            flex-direction: row-reverse;
            text-align: right;
        }

        body[dir="rtl"] .field-checkbox input,
        body[dir="rtl"] .field-radio input {
            margin-left: 8px;
            margin-right: 0;
        }

        /* =================================================================
           RESPONSIVE
           ================================================================= */
        @media (max-width: 600px) {
            .header-controls { flex-direction: column; }
            .nav-buttons, .action-buttons { flex-direction: column; }
            .btn { min-width: 100%; }
            .date-select-wrapper {
                grid-template-columns: 1fr;
            }
        }

        /* =================================================================
           VALIDATION FEEDBACK & ENHANCED UX STYLES
           ================================================================= */
        
        /* Validation feedback styles */
        .validation-feedback {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            min-height: 1.5rem;
            transition: all 0.3s ease;
        }

        .validation-feedback.error {
            color: #dc2626;
            font-weight: 500;
        }

        .validation-feedback.success {
            color: #059669;
            font-weight: 500;
        }

        /* Question card enhanced states */
        .form-group {
            transition: border-color 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
        }

        .form-group:has(.validation-feedback.error) {
            border-left: 4px solid #dc2626;
            background-color: #fef2f2;
        }

        .form-group:has(.validation-feedback.success) {
            border-left: 4px solid #059669;
        }

        /* Dark mode adjustments for validation */
        .dark .form-group:has(.validation-feedback.error) {
            background-color: rgba(220, 38, 38, 0.1);
        }

        /* Save indicator animation */
        #save-indicator {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Progress bar transitions */
        #progress-fill {
            transition: width 0.3s ease, background-color 0.5s ease;
        }

        /* Enhanced button states */
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: 0 2px 4px var(--shadow);
        }
    </style>
</head>
<body>
    <!-- Skip Links for Accessibility -->
    <a href="#app-container" class="skip-link">Skip to main content</a>
    <a href="#language-select" class="skip-link">Skip to language selector</a>

    <!-- ================================================================
         DATENSCHUTZ MODAL
         ================================================================ -->
    <div id="privacy-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 data-translate="privacy_notice">üîí Privacy Notice</h2>
            <p id="modal-text" data-translate="privacy_text">
                This application processes your health data exclusively locally on your device. 
                No data is transmitted to external servers (except for one-time loading of language models, if online). 
                By clicking 'Accept & Start' you agree to local processing.
            </p>
            <button class="btn btn-primary" onclick="App.acceptPrivacy()">
                ‚úì <span data-translate="accept_start">Accept & Start</span>
            </button>
        </div>
    </div>

    <!-- ================================================================
         MAIN APPLICATION
         ================================================================ -->
    <div id="app-container" class="app-container hidden" role="main" aria-label="Medical questionnaire application">
        <header role="banner">
            <h1 id="app-title"><span data-translate="app_title">üè• Medical History Questionnaire</span></h1>
            
            <div class="disclaimer warning" id="disclaimer-medical" data-translate="disclaimer_medical" role="alert" aria-live="polite">
                This is a digital medical history tool and does not replace a medical examination.
            </div>
            <div class="disclaimer success" id="disclaimer-privacy" data-translate="disclaimer_privacy" role="status">
                Your entries are stored locally and only transferred as a file.
            </div>

            <nav class="header-controls" role="navigation" aria-label="Application settings">
                <label for="language-select" class="sr-only">Select language</label>
                <select id="language-select" onchange="App.changeLanguage(this.value)" aria-label="Language selection"></select>
                <button id="theme-toggle" onclick="App.toggleTheme()" aria-label="Toggle dark mode">üåô Dark Mode</button>
            </nav>
        </header>

        <div class="progress-container" role="complementary" aria-label="Form completion progress">
            <div class="progress-text" id="progress-text" aria-live="polite" aria-atomic="true">Schritt 1 von 3</div>
            <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="10">
                <div class="progress-fill" id="progress-fill" style="width: 10%;"></div>
            </div>
        </div>

        <div id="question-area" class="question-card"></div>

        <div class="nav-buttons">
            <button id="back-btn" class="btn btn-secondary" onclick="App.prevStep()" disabled>‚Üê <span data-translate="btn_back">Back</span></button>
            <button id="next-btn" class="btn btn-primary" onclick="App.nextStep()"><span data-translate="btn_next">Next</span> ‚Üí</button>
            <button id="submit-btn" class="btn btn-success hidden" onclick="App.showSummary()">‚úì <span data-translate="btn_summary">Summary</span></button>
        </div>

        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="App.saveToFile()">üíæ <span data-translate="btn_save">Save</span></button>
            <button class="btn btn-secondary" onclick="document.getElementById('load-file').click()">üìÇ <span data-translate="btn_load">Load</span></button>
            <input type="file" id="load-file" accept=".json" style="display:none" onchange="App.loadFromFile(event)">
            <button class="btn btn-danger" onclick="App.resetAll()">üîÑ <span data-translate="btn_restart">Restart</span></button>
        </div>

        <!-- ================================================================
             JSON ANSWER BOX
             ================================================================ -->
        <div class="question-card" style="margin-bottom: 1.5rem;">
            <h3 style="margin: 0 0 0.5rem 0; font-size: 1.3rem; color: var(--primary);">
                üîí <span data-translate="json_box_title">Encrypted Answers (AES-256)</span>
            </h3>
            <textarea id="json-answer-box" rows="10" readonly style="font-family: monospace; font-size: 0.8rem;"></textarea>
            
            <!-- Document Upload Section -->
            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg-secondary); border-radius: 8px; border-left: 3px solid var(--primary);">
                <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem; color: var(--text);">üìÑ <span data-translate="additional_documents">Additional Documents</span></h4>
                <p style="font-size: 0.85rem; color: var(--secondary); margin: 0 0 0.5rem 0;" data-translate="additional_documents_desc">
                    You can upload additional documents (images, PDFs, text files). These will be processed with OCR and exported encrypted.
                </p>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn btn-info" onclick="App.showDocumentUploadDialog()" style="font-size: 0.9rem;">
                        üì§ <span data-translate="upload_documents">Upload Documents</span>
                    </button>
                    <button class="btn btn-secondary" onclick="App.showUploadedDocuments()" style="font-size: 0.9rem;">
                        üìã <span data-translate="view_documents">View Documents</span>
                    </button>
                    <button class="btn btn-danger" onclick="App.clearUploadedDocuments()" style="font-size: 0.9rem;">
                        üóëÔ∏è <span data-translate="delete_documents">Delete Documents</span>
                    </button>
                </div>
            </div>
            
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
                <button class="btn btn-primary" onclick="App.exportWithDocumentPrompt(true)">
                    üíæ <span data-translate="export_encrypted_docs">Export (Encrypted + Documents)</span>
                </button>
                <button class="btn btn-secondary" onclick="App.exportJsonFile(false)">
                    üíæ <span data-translate="export_file_raw">Export (Raw JSON)</span>
                </button>
                <button class="btn btn-success" onclick="App.showDecryptionModal()">
                    üîë <span data-translate="decrypt_data">Decrypt Data</span>
                </button>
                <button class="btn btn-secondary" onclick="App.exportNFC()">
                    üì≤ <span data-translate="export_nfc">Export (NFC)</span>
                </button>
                <button class="btn btn-secondary" onclick="App.sendEmailWithDocuments()">
                    üìß <span data-translate="export_email">Export (Email + Documents)</span>
                </button>
            </div>
            
            <!-- Enhanced Offline Features -->
            <div style="margin-top: 1rem; padding: 15px; background: #e8f5e9; border-radius: 8px; border-left: 4px solid #4caf50;">
                <h4 style="margin: 0 0 10px 0; font-size: 1rem; color: #2e7d32;">‚ú® Erweiterte Offline-Features</h4>
                <p style="font-size: 0.85rem; color: #666; margin: 0 0 10px 0;">
                    Alle Features funktionieren 100% offline. Ihre Daten verlassen niemals dieses Ger√§t.
                </p>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="window.EnhancedOfflineFeaturesUI?.showBackupDialog()" style="font-size: 0.9rem;">
                        üíæ <span>Backup-Verwaltung</span>
                    </button>
                    <button class="btn btn-info" onclick="window.EnhancedOfflineFeaturesUI?.showSearchDialog()" style="font-size: 0.9rem;">
                        üîç <span>Offline-Suche</span>
                    </button>
                    <button class="btn btn-secondary" onclick="alert('Auto-Vervollst√§ndigung aktiv! Geben Sie Text in Formularfelder ein, um Vorschl√§ge zu erhalten.')" style="font-size: 0.9rem;">
                        ‚ö° <span>Auto-Vervollst√§ndigung</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="summary-box" class="summary-box hidden">
            <h3><span data-translate="summary_title">üìã Summary of Your Information</span></h3>
            <p style="color: var(--secondary); font-size: 0.85rem;" data-translate="summary_desc">Click on an entry to jump to the question.</p>
            <div id="summary-content"></div>
            <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                <button class="btn btn-primary" onclick="App.exportJSON(true)">üì§ <span data-translate="export_full">Export (Full)</span></button>
                <button class="btn btn-secondary" onclick="App.exportJSON(false)">üì§ <span data-translate="export_anonymous">Export (Anonymous)</span></button>
            </div>
        </div>

        <footer role="contentinfo">
            <p><strong data-translate="medical_concept">Medical Concept: Dr. Christian Klapproth</strong></p>
            <p data-translate="technical_implementation">Technical Implementation: DiggAi GmbH</p>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; margin-top: 1rem;">
                <button id="shortcuts-help-btn" class="btn btn-info" 
                        onclick="document.getElementById('shortcuts-modal').style.display='flex'"
                        style="font-size: 0.9rem;"
                        aria-label="Show keyboard shortcuts">
                    ‚å®Ô∏è Tastenk√ºrzel anzeigen / Show Keyboard Shortcuts
                </button>
                <button id="repo-analysis-btn" class="btn btn-info" 
                        onclick="RepoAnalysis.open()"
                        style="font-size: 0.9rem;"
                        aria-label="Open repository analysis">
                    üìä Repo-Analyse / Repository Analysis
                </button>
            </div>
        </footer>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcuts-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2 style="margin: 0;">‚å®Ô∏è Tastenk√ºrzel / Keyboard Shortcuts</h2>
                <button onclick="document.getElementById('shortcuts-modal').style.display='none'" 
                        class="btn btn-secondary" style="padding: 0.5rem 1rem;"
                        aria-label="Close shortcuts modal">
                    ‚úï
                </button>
            </div>
            
            <div style="display: grid; gap: 0.75rem;">
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; padding: 0.75rem; background: var(--bg-color); border-radius: 8px;">
                    <strong style="font-family: monospace; color: var(--primary);">Ctrl + S</strong>
                    <span>Daten speichern / Save data</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; padding: 0.75rem; background: var(--bg-color); border-radius: 8px;">
                    <strong style="font-family: monospace; color: var(--primary);">Ctrl + ‚Üí</strong>
                    <span>N√§chste Sektion / Next section</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; padding: 0.75rem; background: var(--bg-color); border-radius: 8px;">
                    <strong style="font-family: monospace; color: var(--primary);">Ctrl + ‚Üê</strong>
                    <span>Vorherige Sektion / Previous section</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; padding: 0.75rem; background: var(--bg-color); border-radius: 8px;">
                    <strong style="font-family: monospace; color: var(--primary);">Esc</strong>
                    <span>Modal schlie√üen / Close modal</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; padding: 0.75rem; background: var(--bg-color); border-radius: 8px;">
                    <strong style="font-family: monospace; color: var(--primary);">Tab</strong>
                    <span>Vorw√§rts navigieren / Navigate forward</span>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 1rem; padding: 0.75rem; background: var(--bg-color); border-radius: 8px;">
                    <strong style="font-family: monospace; color: var(--primary);">Shift + Tab</strong>
                    <span>R√ºckw√§rts navigieren / Navigate backward</span>
                </div>
            </div>
            
            <div style="margin-top: 1rem; padding: 0.75rem; background: var(--warning); color: #000; border-radius: 8px; font-size: 0.9rem;">
                <strong>üí° Tipp / Tip:</strong> Diese Tastenk√ºrzel funktionieren √ºberall in der App. / These shortcuts work anywhere in the app.
            </div>
        </div>
    </div>

    <!-- ================================================================
         REPOSITORY ANALYSIS MODAL
         ================================================================ -->
    <div id="repo-analysis-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
            <!-- Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; flex-shrink: 0;">
                <h2 style="margin: 0;">üìä Repository Analysis / Repo-Analyse</h2>
                <button onclick="RepoAnalysis.close()" 
                        class="btn btn-secondary" style="padding: 0.5rem 1rem;"
                        aria-label="Close repository analysis">
                    ‚úï
                </button>
            </div>

            <!-- Warning Notice -->
            <div style="padding: 0.75rem; background: var(--warning); color: #000; border-radius: 8px; font-size: 0.9rem; margin-bottom: 1rem; flex-shrink: 0;">
                <strong>‚ö†Ô∏è Hinweis / Notice:</strong> Diese Analyse kann unvollst√§ndig sein aufgrund von Tool-Limits. Vollst√§ndige Dateiliste: 
                <a href="https://github.com/DiggAiHH/Anamnese-A/tree/main" target="_blank" rel="noopener noreferrer" style="color: var(--primary); text-decoration: underline;">
                    GitHub Repository
                </a>
            </div>

            <!-- Search and Filter Bar -->
            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; flex-shrink: 0;">
                <input type="text" 
                       id="repo-search" 
                       placeholder="üîç Suche nach Dateiname... / Search by filename..."
                       style="flex: 1; min-width: 200px; padding: 0.5rem; border: 1px solid var(--secondary); border-radius: 4px; background: var(--bg-color); color: var(--text);"
                       oninput="RepoAnalysis.search(this.value)">
                <select id="repo-filter" 
                        onchange="RepoAnalysis.filterByGroup(this.value)"
                        style="padding: 0.5rem; border: 1px solid var(--secondary); border-radius: 4px; background: var(--bg-color); color: var(--text);">
                    <option value="">üìÅ Alle Gruppen / All Groups</option>
                </select>
            </div>

            <!-- Statistics -->
            <div id="repo-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; margin-bottom: 1rem; flex-shrink: 0;">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- File List -->
            <div id="repo-file-list" style="flex: 1; overflow-y: auto; border: 1px solid var(--secondary); border-radius: 8px; padding: 1rem; background: var(--bg-secondary);">
                <!-- Will be populated by JavaScript -->
            </div>

            <!-- File Detail View -->
            <div id="repo-file-detail" style="display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-color); overflow-y: auto; padding: 2rem; z-index: 10;">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- =================================================================
         EMBEDDED MOCK DATA (REPLACEMENT FOR app_data.js)
         ================================================================= -->
    <script>
    // This simulates data that would normally be generated by build_anamnese.py
    window.APP_DATA = window.APP_DATA = window.APP_DATA = {
        "version": "3.0.0 (Updated by Manus)",
        "language_names": {
            "de": "Deutsch",
            "en": "English",
            "fr": "Fran√ßais",
            "es": "Espa√±ol",
            "it": "Italiano",
            "pt": "Portugu√™s",
            "nl": "Nederlands",
            "tr": "T√ºrk√ße",
            "pl": "Polski",
            "sq": "Shqip",
            "ro": "Rom√¢nƒÉ",
            "ru": "–†—É—Å—Å–∫–∏–π",
            "uk": "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞",
            "ar": "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
            "fa": "ŸÅÿßÿ±ÿ≥€å",
            "ur": "ÿßÿ±ÿØŸà",
            "zh": "‰∏≠Êñá",
            "hi": "‡§π‡§ø‡§®‡•ç‡§¶‡•Ä",
            "ja": "Êó•Êú¨Ë™û"
        },
        "translations": {
                "de": {
                        "title_q0000": "Basisdaten",
                        "label_0000": "Nachname",
                        "label_0001": "Vorname",
                        "label_0002": "Geschlecht",
                        "label_0003_tag": "Tag",
                        "label_0003_monat": "Monat",
                        "label_0003_jahr": "Jahr",
                        "app_title": "Anamnese-Fragebogen",
                        "privacy_notice": "Datenschutzhinweis",
                        "privacy_text": "Diese Anwendung verarbeitet Ihre Gesundheitsdaten ausschlie√ülich lokal auf Ihrem Ger√§t. Es werden keine Daten an externe Server √ºbermittelt (au√üer f√ºr das einmalige Laden der Sprachmodelle, falls online). Mit dem Klick auf 'Akzeptieren & Starten' stimmen Sie der lokalen Verarbeitung zu.",
                        "accept_start": "Akzeptieren & Starten",
                        "disclaimer_medical": "Dies ist ein digitales Anamnese-Werkzeug und ersetzt keine √§rztliche Untersuchung.",
                        "disclaimer_privacy": "Ihre Eingaben werden lokal gespeichert und nur als Datei √ºbergeben.",
                        "json_box_title": "Verschl√ºsselte Antworten (AES-256)",
                        "additional_documents": "Zus√§tzliche Dokumente",
                        "additional_documents_desc": "Sie k√∂nnen zus√§tzliche Dokumente (Bilder, PDFs, Textdateien) hochladen. Diese werden mit OCR verarbeitet und verschl√ºsselt exportiert.",
                        "upload_documents": "Dokumente hochladen",
                        "view_documents": "Dokumente anzeigen",
                        "delete_documents": "Dokumente l√∂schen",
                        "export_encrypted_docs": "Export (Verschl√ºsselt + Dokumente)",
                        "export_file_enc": "Export (Verschl√ºsselt)",
                        "export_file_raw": "Export (Roh-JSON)",
                        "decrypt_data": "Daten entschl√ºsseln",
                        "export_nfc": "Export (NFC)",
                        "export_email": "Export (E-Mail + Dokumente)",
                        "email_subject": "Anamnese Antworten",
                        "email_body": "Anbei die verschl√ºsselten Anamnese-Antworten:",
                        "summary_title": "Zusammenfassung Ihrer Angaben",
                        "summary_desc": "Klicken Sie auf einen Eintrag, um zur Frage zu springen.",
                        "export_full": "Export (Voll)",
                        "export_anonymous": "Export (Anonym)",
                        "transcribed_voice": "Transkribierte Spracheingaben",
                        "btn_back": "Zur√ºck",
                        "btn_next": "Weiter",
                        "btn_summary": "Zusammenfassung",
                        "btn_save": "Speichern",
                        "btn_load": "Laden",
                        "btn_restart": "Neu starten",
                        "nfc_success": "NFC-√úbertragung erfolgreich.",
                        "nfc_error": "Fehler bei der NFC-√úbertragung: ",
                        "nfc_simulation": "NFC wird simuliert. Die verschl√ºsselten Daten werden in der JSON-Box angezeigt.",
                        "decryption_prompt": "Bitte geben Sie die verschl√ºsselten Daten ein:",
                        "decryption_success": "Entschl√ºsselung erfolgreich:",
                        "decryption_error_json": "Entschl√ºsselung erfolgreich, aber das Ergebnis ist kein g√ºltiges JSON.",
                        "select_placeholder": "Bitte ausw√§hlen...",
                        "please_select": "Bitte ausw√§hlen...",
                        "step_of": "Schritt {current} von {total}",
                        "red_flag_warning": "‚ö†Ô∏è Achtung: Es wurden wichtige Symptome erkannt, die eine sofortige √§rztliche Untersuchung erfordern!",
                        "medical_concept": "Medizinische Konzeption: Dr. Christian Klapproth",
                        "technical_implementation": "Technische Umsetzung: DiggAi GmbH",
                        "0003_tag": "Tag",
                        "0003_monat": "Monat",
                        "0003_jahr": "Jahr",
                        "label_0003": "Geburtsdatum Tag 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 Monat Januar Februar M√§rz April Mai Juni Juli August September Oktober November Dezember Jahr 2025 2024 2023 2022 2021 2020 2019 2018 2017 2016 2015 2014 2013 2012 2011 2010 2009 2008 2007 2006 2005 2004 2003 2002 2001 2000 1999 1998 1997 1996 1995 1994 1993 1992 1991 1990 1989 1988 1987 1986 1985 1984 1983 1982 1981 1980 1979 1978 1977 1976 1975 1974 1973 1972 1971 1970 1969 1968 1967 1966 1965 1964 1963 1962 1961 1960 1959 1958 1957 1956 1955 1954 1953 1952 1951 1950 1949 1948 1947 1946 1945 1944 1943 1942 1941 1940 1939 1938 1937 1936 1935 1934 1933 1932 1931 1930 1929 1928 1927 1926 1925",
                        "title_q1A00": "Welche Augenbeschwerden haben Sie?",
                        "label_1A00": "Schleiersehen",
                        "title_q1B00": "Welche HNO-Beschwerden haben Sie?",
                        "label_1B00": "Stimmst√∂rung",
                        "title_q1B01": "Art der H√∂rst√∂rung",
                        "label_1B01": "Tonh√∂henverzerrung",
                        "title_q1B02": "Art der Nasenst√∂rung",
                        "label_1B02": "Verstopfte Nase",
                        "title_q1B03": "Art der Ohrenst√∂rung",
                        "label_1B03": "Verstopfte Ohren",
                        "title_q1B04": "Art der Rachenbeschwerden",
                        "label_1B04": "R√§usperzwang",
                        "title_q1B05": "Art der Schluckst√∂rungen",
                        "label_1B05": "W√ºrgreiz",
                        "title_q1B06": "Welche Stimmst√∂rung haben Sie?",
                        "label_1B06": "Totaler Stimmverlust",
                        "title_q1C00": "F√ºhlten Sie sich in den letzten 2 Wochen h√§ufig traurig oder hoffnungslos?",
                        "label_1C00": "Nein",
                        "title_q1C01": "Hatten Sie deutlich weniger Freude an Aktivit√§ten?",
                        "label_1C01": "Nein",
                        "title_q1C02": "F√ºhlten Sie sich oft antriebslos oder ersch√∂pft?",
                        "label_1C02": "Nein",
                        "title_q1C03": "Leiden Sie unter st√§ndiger Nervosit√§t oder Sorgen?",
                        "label_1C03": "Nein",
                        "title_q1C04": "Hatten Sie schon einmal pl√∂tzliche Angstanf√§lle (Herzrasen, Atemnot, Schwindel)?",
                        "label_1C04": "Nein",
                        "title_q1C05": "Vermeiden Sie Orte oder Situationen aus Angst?",
                        "label_1C05": "Nein",
                        "title_q1C06": "Haben Sie Ein- oder Durchschlafst√∂rungen?",
                        "label_1C06": "Nein",
                        "title_q1C07": "F√ºhlen Sie sich morgens unausgeruht?",
                        "label_1C07": "Nein",
                        "title_q1C08": "Haben Sie Schwierigkeiten, sich zu konzentrieren?",
                        "label_1C08": "Nein",
                        "title_q1C09": "Vergessen Sie h√§ufiger Dinge?",
                        "label_1C09": "Nein",
                        "title_q1C10": "H√∂ren oder sehen Sie Dinge, die andere nicht wahrnehmen?",
                        "label_1C10": "Nein",
                        "title_q1C11": "Haben Sie √úberzeugungen, die andere als ungew√∂hnlich ansehen?",
                        "label_1C11": "Nein",
                        "title_q1C12": "Trinken Sie regelm√§√üig Alkohol oder nehmen Sie Drogen/Medikamente au√üerhalb √§rztlicher Vorgaben?",
                        "label_1C12": "Nein",
                        "title_q1C13": "Haben Sie das Gef√ºhl, die Kontrolle √ºber den Konsum zu verlieren?",
                        "label_1C13": "Nein",
                        "title_q1C14": "Hatten Sie schon einmal Gedanken, nicht mehr leben zu wollen?",
                        "label_1C14": "Nein",
                        "title_q1C15": "Haben Sie konkrete Pl√§ne, sich etwas anzutun?",
                        "label_1C15": "Nein",
                        "title_q1P00": "Kinder- und Jugendmedizin ¬∑ Basisangaben",
                        "label_1P00_geburtsmodus": "Wie kam Ihr Kind zur Welt?",
                        "label_1P00_frueh_neonatal": "Gab es Startprobleme nach der Geburt? (z. B. Gelbsucht, Atemnot)",
                        "label_1P00_ernaehrung1LJ": "Wie wurde Ihr Kind im 1. Jahr ern√§hrt?",
                        "label_1P00_freitext": "1P00_freitext",
                        "label_1P00_geburtsgewicht_g": "Geburtsgewicht (g)",
                        "label_1P00_geburtslaenge_cm": "Geburtsl√§nge (cm)",
                        "label_1P00_ssw": "SSW bei Geburt (Wochen+Tage) Format: Wochen+Tage, z. B. 38+0",
                        "title_q1P10": "Entwicklung und Wachstum",
                        "label_1P10_motorik": "Motorik",
                        "label_1P10_sprache": "Sprache",
                        "label_1P10_lernen": "Lern- oder Konzentrationsprobleme?",
                        "label_1P10_pubertaet": "Beginn der Pubert√§t",
                        "label_1P10_wachstum": "Wachstum bisher",
                        "label_1P10_freitext": "1P10_freitext",
                        "title_q1P20": "Impfstatus und Infektionen",
                        "label_1P20_stiko": "Impfungen laut STIKO",
                        "label_1P20_mmrw": "Kinderkrankheiten durchgemacht (Masern/Mumps/R√∂teln/Windpocken)",
                        "label_1P20_mmrw_impf": "Gegen Kinderkrankheiten geimpft (Masern/Mumps/R√∂teln/Windpocken)",
                        "label_1P20_infekte": "Mehr als 6 Infekte pro Jahr?",
                        "label_1P20_hno": "Ohrentz√ºndungen wiederkehrend?",
                        "label_1P20_bronchitiden": "Bronchitiden wiederkehrend?",
                        "label_1P20_tonsillitis": "Mandelentz√ºndungen wiederkehrend?",
                        "label_1P20_freitext": "1P20_freitext",
                        "title_q1P30": "Chronische oder angeborene Erkrankungen",
                        "label_1P30_asthma": "Asthma bronchiale",
                        "label_1P30_dermatitis": "Neurodermitis",
                        "label_1P30_allergien": "Allergien/Nahrungsmittelunvertr√§glichkeiten?",
                        "label_1P30_herz": "Herzfehler",
                        "label_1P30_stoffwechsel": "Stoffwechsel- oder Hormonst√∂rung?",
                        "label_1P30_fehlbildungen": "Fehlbildungen/genetische Erkrankungen?",
                        "label_1P30_medikation": "Nimmt Ihr Kind regelm√§√üig Medikamente?",
                        "label_1P30_freitext": "1P30_freitext",
                        "title_q1P40": "Soziale und psychische Aspekte",
                        "label_1P40_betreuung": "Geht Ihr Kind in ‚Ä¶?",
                        "label_1P40_leistung": "Schwierigkeiten in Schule/Kita?",
                        "label_1P40_schlaf": "Schlafst√∂rungen",
                        "label_1P40_aengste": "√Ñngste/auff√§lliges Verhalten?",
                        "label_1P40_familie": "Besondere Belastungen zuhause?",
                        "label_1P40_medien": "Mediennutzung",
                        "label_1P40_bewegung": "Freizeit/Bewegung",
                        "label_1P40_ernaehrung": "Ern√§hrung",
                        "label_1P40_freitext": "1P40_freitext",
                        "title_q1P51": "Neonatologie ¬∑ Spezialmodul",
                        "label_1P51_beatmung": "Beatmung, Intensivaufenthalt",
                        "label_P_apgar_1min": "Apgar-Wert nach 1 Minute",
                        "label_P_apgar_5min": "Apgar-Wert nach 5 Minuten",
                        "label_P_apgar_10min": "Apgar-Wert nach 10 Minuten",
                        "label_1P51_freitext": "1P51_freitext",
                        "title_q1P52": "Adoleszenz ¬∑ Spezialmodul",
                        "label_1P52_substanz": "Substanzgebrauch",
                        "label_1P52_reife": "Menarche/Spermarche",
                        "label_1P52_koerperbild": "K√∂rperbild-Thematik",
                        "label_1P52_sexual": "Sexualverhalten relevant",
                        "label_1P52_freitext": "1P52_freitext",
                        "title_q1P53": "Allergologie ¬∑ Spezialmodul",
                        "label_1P53_atopie_familie": "Atopische Familienanamnese",
                        "label_1P53_expo": "Expositionsfaktoren",
                        "label_1P53_freitext": "1P53_freitext",
                        "title_q1P54": "Impfaufkl√§rung ¬∑ Spezialmodul",
                        "label_1P54_elternentscheidung": "Elternentscheidung dokumentiert",
                        "label_1P54_nebenwirkungen": "Dokumentierte Nebenwirkungen",
                        "label_1P54_freitext": "1P54_freitext",
                        "title_q1000": "Haben Sie aktuell Beschwerden?",
                        "label_1000": "Nein",
                        "title_q1001": "Wie lange bestehen Ihre Beschwerden?",
                        "label_1001_select": "1001_select",
                        "title_q1002": "Wie h√§ufig treten diese Beschwerden auf?",
                        "label_1002_select": "1002_select",
                        "title_q1003": "Wodurch werden Ihre Beschwerden ausgel√∂st?",
                        "label_1003": "keine",
                        "label_1003_freitext": "1003_freitext",
                        "title_q1004": "Haben sich Ihre Beschwerden ver√§ndert?",
                        "label_1004_select": "1004_select",
                        "title_q1005": "Haben Sie sonstige Auff√§lligkeiten?",
                        "label_1005": "ungewollter Gewichtsverlust",
                        "label_1005_freitext": "1005_freitext",
                        "title_q1006": "Welche Beschwerden haben Sie?",
                        "label_1006": "Urologische/Gyn√§kologische Beschwerden",
                        "title_q1010": "Welche angiologischen Beschwerden haben Sie?",
                        "label_1010": "Shuntprobleme",
                        "label_1010_freitext": "1010_freitext",
                        "title_q1020": "Welche Atembeschwerden haben Sie?",
                        "label_1020": "Beklemmung im Brustkorb",
                        "title_q1030": "Welche Verdauungs-/Bauchbeschwerden haben Sie?",
                        "label_1030": "Verstopfung",
                        "label_1030_freitext": "1030_freitext",
                        "title_q1040": "Welche Hautver√§nderungen haben Sie?",
                        "label_1040": "Wunden/Geschw√ºre",
                        "label_1040_freitext": "1040_freitext",
                        "title_q1050": "Welche Herz-Kreislauf Beschwerden haben Sie?",
                        "label_1050": "Ohnmachtsanf√§lle/Schwindel",
                        "title_q1060": "Welche hormonell bedingten Beschwerden haben Sie?",
                        "label_1060": "Wechseljahrbeschwerden",
                        "label_1060_freitext": "1060_freitext",
                        "title_q1070": "Wo bestehen Beschwerden im Bewegungsapparat?",
                        "label_1070": "Wirbels√§ule",
                        "title_q1080": "Welche neurologischen Beeintr√§chtigungen haben Sie?",
                        "label_1080": "Konzentration/Merkf√§higkeit",
                        "title_q1090": "Welche urologischen/gyn√§kologischen St√∂rungen treten auf?",
                        "label_1090": "schmerzhafte Menstruation",
                        "title_q1105": "Fieber ‚Äì Tagesprofil",
                        "label_1105_tagesprofil": "intermittierend",
                        "label_1105_schuettelfrost": "nein",
                        "title_q1110": "Gehleistung",
                        "label_1110_select": "1110_select",
                        "title_q1111": "Welche der folgenden Venenbeschwerden haben Sie?",
                        "label_1111": "Gef√§√ümalformation (Blutschwamm)",
                        "title_q1112": "Wo treten die √ñdeme auf?",
                        "label_1112": "Zehen",
                        "title_q1113": "Schmerzcharakter",
                        "label_1113_select": "1113_select",
                        "title_q1114": "Ordnen Sie Ihre Schmerzen auf einer Skala von 0 ‚Äì 10 ein",
                        "label_1114": "1114",
                        "title_q1115": "Schmerzlokalisation",
                        "label_1115": "diffus/ganzer K√∂rper",
                        "label_1115_freitext": "1115_freitext",
                        "title_q1116": "Wo befinden sich die Wunden?",
                        "label_1116": "Unterschenkel",
                        "label_1116_freitext": "1116_freitext",
                        "title_q1117": "Wie lange besteht die Wunde?",
                        "label_1117_select": "1117_select",
                        "title_q1121": "Belastungsbezug der Atemnot",
                        "label_1121": "Abh√§ngigkeit vom Respirator",
                        "title_q1130": "H√§ufigkeit",
                        "label_1130_freq_per_day": "Anzahl Episoden pro Tag",
                        "title_q1131": "Nahrungsabh√§ngigkeit",
                        "label_1131_nahrungsabhaengig": "n√ºchtern",
                        "title_q1132": "Charakter",
                        "label_1132_uebelkeit": "√úbelkeit: Nein",
                        "title_q1133": "Inhalt des Erbrochenen",
                        "label_1133_inhalt": "blutig",
                        "title_q1134": "Bauchschmerz",
                        "label_1134_ort": "linker Unterbauch",
                        "label_1134_kolik": "nein",
                        "title_q1135": "Stuhlgang",
                        "label_1135_stuhl": "Meteorismus",
                        "title_q1136": "Fieber/Sch√ºttelfrost",
                        "label_1136_fieber": "Nein",
                        "title_q1136a": "Neuro-vestibul√§r",
                        "label_1136_neuro": "Nackensteifigkeit",
                        "title_q1136b": "Ausl√∂ser und Exposition",
                        "label_1136_expo": "Kontakt zu Erkrankten",
                        "title_q1137": "Schwangerschaft ausgeschlossen?",
                        "label_1137_schwangerschaft": "Nein",
                        "title_q1141": "Seit wann haben Sie die Hautver√§nderungen?",
                        "label_1141_select": "1141_select",
                        "title_q1150": "Schmerzcharakter und Lokalisation",
                        "label_1150_qualitaet": "stechend",
                        "label_1150_ausstrahlung": "epigastrisch",
                        "label_1150_redflags": "Synkope",
                        "title_q1151": "Trigger/Provokation und Linderung",
                        "label_1151_trigger": "nachts in Ruhe",
                        "label_1151_ruhebesserung": "nein",
                        "label_1151_ntg": "nein",
                        "label_1151_ntg_min": "Wirkung von sublingualem Nitroglyzerin? ja nein",
                        "title_q1152": "Zeitprofil",
                        "label_1152_dauer_min": "Dauer einer Episode (Minuten)",
                        "label_1152_verlauf_select": "Verlauf",
                        "label_1152_erstauftreten_select": "Erstauftreten seit wann",
                        "title_q1153": "Begleitsymptome und nicht-isch√§mische Hinweise",
                        "label_1153_begleit": "Palpitationen",
                        "label_1153_nicht_isch": "Sodbrennen",
                        "title_q1171": "Art der Gelenkbeschwerden",
                        "label_1171": "√úberw√§rmung",
                        "title_q1172": "Schmerzcharakter",
                        "label_1172_select": "1172_select",
                        "title_q1173": "Ordnen Sie Ihre Schmerzen auf einer Skala von 0 ‚Äì 10 ein",
                        "label_1173": "1173",
                        "title_q1174": "Art der Muskelbeschwerden",
                        "label_1174": "pl√∂tzliche Form√§nderung",
                        "title_q1175": "Art der Wirbels√§ulenbeschwerden",
                        "label_1175": "Steifigkeit",
                        "title_q1181": "Was kennzeichnet den Kopfschmerz?",
                        "label_1181": "√úbelkeit und Erbrechen",
                        "title_q1182": "Schmerzcharakter",
                        "label_1182_select": "1182_select",
                        "title_q1183": "Ordnen Sie Ihre Schmerzen auf einer Skala von 0 ‚Äì 10 ein",
                        "label_1183": "1183",
                        "title_q1184": "Beschreiben Sie die Gef√ºhlsst√∂rungen",
                        "label_1184": "√ºberm√§√üiges Schmerzempfinden durch normalerweise nicht schmerzhafte Reize",
                        "title_q1185": "Welche Kontrollst√∂rungen haben Sie?",
                        "label_1185": "Sprachkontrollverlust",
                        "title_q1186": "Art des Schwindels",
                        "label_1186": "Wie auf Watte gehen",
                        "title_q1187": "Was l√∂st Ihren Schwindel aus?",
                        "label_1187": "√úberkopfarbeiten",
                        "label_1187_freitext": "1187_freitext",
                        "title_q1188": "Auftreten und Dauer des Schwindels?",
                        "label_1188": "Dauerschwindel",
                        "title_q1189": "Was begleitet den Schwindel?",
                        "label_1189": "Verwirrtheit",
                        "title_q1190": "Zyklus ‚Äì Basisdaten",
                        "label_1190_menarche_j": "Menarchealter (Jahre)",
                        "label_1190_lmp": "Letzte Regel (Datum)",
                        "title_q1191": "Zyklus ‚Äì √úblicher Zyklus",
                        "label_1191_flags": "Dauer der Blutung >8 Tage",
                        "title_q1192": "Zyklus ‚Äì Aktuell",
                        "label_1192_aktuell": "Schwangerschaft m√∂glich",
                        "title_q1193": "Zyklus ‚Äì Blutungsst√§rke",
                        "label_1193_pads_per_day": "Binden/Tampons pro Tag",
                        "label_1193_flags": "Koagel >2‚Äì3 cm",
                        "title_q1194": "Zyklus ‚Äì Vorgeschichte",
                        "label_1194_geburten": "Fehl-/Geburten (Anzahl)",
                        "label_1194_abbrueche": "Abbr√ºche (Anzahl)",
                        "label_1194_ops": "OPs an Uterus/Zervix",
                        "label_1194_myome": "Nein",
                        "label_1194_endo": "Nein",
                        "label_1194_pcos": "Nein",
                        "title_q1205": "Fieber ‚Äì H√∂chsttemperatur & Messmethode",
                        "label_1205_tmax_c": "H√∂chsttemperatur (¬∞C)",
                        "label_1205_methode": "Geh√∂rgang",
                        "title_q1230": "Durchfall ‚Äì H√§ufigkeit und Dehydratation",
                        "label_1230_stuehle_24h": "Anzahl ungeformter St√ºhle / 24 h",
                        "label_1230_nacht": "Nein",
                        "label_1230_dranginko": "Dranginkontinenz",
                        "label_1230_tenesmen": "Tenesmen",
                        "label_1230_durst": "starker Durst",
                        "label_1230_orthostat": "Schwindel beim Aufstehen",
                        "label_1230_oligurie": "reduzierte Urinmenge",
                        "title_q1231": "Durchfall ‚Äì Stuhlcharakter",
                        "label_1231_char": "schwarz",
                        "title_q1232": "Durchfall ‚Äì Exposition/Risiko",
                        "label_1232_expo": "Rohmilch",
                        "title_q1233": "Durchfall ‚Äì Umfeld & Kontakte",
                        "label_1233_umfeld": "Tierkontakte (insb. Reptilien)",
                        "title_q1290": "Schwangerschaft ‚Äì Akute Beschwerden/Red Flags",
                        "label_1290_flags": "H√§morrhoiden",
                        "title_q1305": "Fieber ‚Äì Begleitsymptome",
                        "label_1305_begleit": "Lichtempfindlichkeit",
                        "title_q1330": "Koliken ‚Äì Lokalisation und Ausstrahlung",
                        "label_1330_lokal": "Unterbauch",
                        "label_1330_ausstrahl": "Genitale",
                        "title_q1331": "Koliken ‚Äì Begleitsymptome",
                        "label_1331_begleit": "verminderte Urinmenge",
                        "title_q1332": "Koliken ‚Äì Vorerkrankungen und Risiken",
                        "label_1332_vor": "Verwachsungen",
                        "title_q1334": "Gyn√§kologische Zusatzfragen",
                        "label_1334_lrb": "Letzte Regelblutung",
                        "label_1334_gyn": "Schwangerschaftstest positiv",
                        "title_q1390": "Schwangerschaft ‚Äì Vorgeschichte",
                        "label_1390_gravida": "Schwangerschaften (Anzahl)",
                        "label_1390_abortus": "Fehlgeburten (Anzahl)",
                        "label_1390_preterm": "Fr√ºhgeburten (Anzahl)",
                        "label_1390_sectio": "Nein",
                        "label_1390_preeclampsia": "Nein",
                        "label_1390_gdm": "Nein",
                        "label_1390_rh": "Nein",
                        "title_q1405": "Fieber ‚Äì Ausl√∂sende Ursachen / Exposition",
                        "label_1405_expo": "i.v.-Drogen",
                        "title_q1430": "Verstopfung ‚Äì Frequenz & letzte normale Entleerung",
                        "label_1430_freq_woche": "Stuhlfrequenz pro Woche",
                        "label_1430_letzte_normale_entleerung": "Letzte normale Entleerung",
                        "title_q1431": "Verstopfung ‚Äì Stuhlbeschaffenheit & Symptome",
                        "label_1431_sympt": "Harnverhalt",
                        "title_q1505": "Gewichtsverlust ‚Äì Appetit",
                        "label_1505_appetit": "fr√ºhe S√§ttigung",
                        "title_q1605": "Gewichtsverlust ‚Äì Nahrungsaufnahme",
                        "label_1605_kcal_tag": "Kalorienzufuhr / Tag",
                        "label_1605_mahlzeiten_tag": "Mahlzeiten / Tag",
                        "label_1605_trinkmenge_l": "Trinkmenge / Tag (Liter)",
                        "title_q1705": "Gewichtsverlust ‚Äì Symptome",
                        "label_1705_sympt": "vermehrtes Durstgef√ºhl",
                        "title_q1805": "starkes Ersch√∂pfungsgef√ºhl",
                        "label_1805_erschoepfung": "Nein",
                        "title_q1815": "spontanes ungewolltes Einschlafen",
                        "label_1815_einschlafen": "Nein",
                        "title_q1825": "Aufstehen vom Stuhl ohne Armeinsatz m√∂glich",
                        "label_1825_stuhl_ohne_arme": "Nein",
                        "title_q1835": "Kraftlosigkeit ‚Äì St√ºrze",
                        "label_1835_stuerze_4w": "St√ºrze in den vergangenen 4 Wochen",
                        "title_q2000": "Versicherungsstatus?",
                        "label_2000": "Gesetzlich",
                        "title_q2001": "Haben Sie bereits einen Termin bei uns?",
                        "label_2001": "Nein",
                        "title_q2002": "Termin (√ºber Arztdirekt Online) gebucht f√ºr:",
                        "label_2002_date": "2002_date",
                        "label_2002_format": "2002_format",
                        "title_q2003": "Waren Sie schon einmal bei uns?",
                        "label_2003": "Nein",
                        "label_2003_freitext": "2003_freitext",
                        "title_q2004": "Welche Wochentage bevorzugen Sie?",
                        "label_2004": "egal",
                        "title_q2005": "Waren Sie schon einmal bei uns?",
                        "label_2005": "Nein",
                        "title_q2006": "Weshalb kommen Sie zu uns?",
                        "label_2006": "Einholung einer Zweitmeinung",
                        "label_2006_freitext": "2006_freitext",
                        "title_q2010": "Kontrolluntersuchung",
                        "label_2010": "Laborwerte allgemein",
                        "label_2010_freitext": "2010_freitext",
                        "title_q2020": "Welche Vorsorge- oder Pr√§ventionsma√ünahmen w√ºnschen Sie",
                        "label_2020": "Lebensstil-Check (Bewegung, Ern√§hrung, Gewicht, Stress)",
                        "title_q2030": "Er√∂rterung auff√§lliger Befunde",
                        "label_2030": "Laborauff√§lligkeiten",
                        "label_2030_freitext": "2030_freitext",
                        "title_q2040": "Um welche chronische Erkrankung handelt es sich?",
                        "label_2040": "Atemwege (Asthma, COPD)",
                        "label_2040_freitext": "2040_freitext",
                        "title_q2041": "Herz-Kreislauferkrankung",
                        "label_2041": "Herzrhythmusst√∂rung",
                        "label_2041_freitext": "2041_freitext",
                        "title_q2042": "Gef√§√üerkrankung",
                        "label_2042": "Vaskulitis",
                        "label_2042_freitext": "2042_freitext",
                        "title_q2043": "Stoffwechselst√∂rung",
                        "label_2043": "√úberwachung/Kontrolle der Schilddr√ºsenfunktion",
                        "label_2043_freitext": "2043_freitext",
                        "title_q2044": "Welche Asthma/COPD Probleme sind aufgetreten?",
                        "label_2044": "Rauchstopp-Intervention",
                        "label_2044_freitext": "2044_freitext",
                        "title_q2050": "Tumorverdacht",
                        "label_2050": "Gewichtsverlust",
                        "label_2050_freitext": "2050_freitext",
                        "title_q2060": "Neurologische Symptome",
                        "label_2060": "Krampfanf√§lle",
                        "label_2060_freitext": "2060_freitext",
                        "title_q2070": "Orthop√§dische Probleme",
                        "label_2070": "Deformit√§ten/Mi√übildungen",
                        "label_2070_freitext": "2070_freitext",
                        "title_q2080": "Welchen Beruf bzw. welche T√§tigkeit √ºben Sie aus?",
                        "label_2080": "2080",
                        "title_q2081": "Wer ist Ihr Arbeitgeber (Name, Anschrift)?",
                        "label_2081_text": "2081_text",
                        "title_q2082": "Seit wann sind Sie bei diesem Arbeitgeber besch√§ftigt?",
                        "label_2082_date": "2082_date",
                        "label_2082_format": "2082_format",
                        "title_q2083": "Welche Berufsgenossenschaft ist f√ºr Sie zust√§ndig?",
                        "label_2083_select": "2083_select",
                        "title_q2084": "An welchem Tag ist der Unfall passiert?",
                        "label_2084_date": "2084_date",
                        "label_2084_format": "2084_format",
                        "title_q2085": "Zu welcher Uhrzeit ist der Unfall passiert?",
                        "label_2085_time": "2085_time",
                        "title_q2086": "Es handelt sich um:",
                        "label_2086": "Pause",
                        "title_q2087": "Unfallort",
                        "label_2087": "Arbeitsweg",
                        "label_2087_freitext": "2087_freitext",
                        "title_q2088": "Unfallhergang",
                        "label_2088_text": "2088_text",
                        "title_q2089": "Unfallfolgen",
                        "label_2089_text": "2089_text",
                        "title_q2090": "Wurde der Unfall im Betrieb gemeldet?",
                        "label_2090": "Nein",
                        "title_q2091": "Wurde eine √§rztliche Erstversorgung durchgef√ºhrt?",
                        "label_2091": "Nein",
                        "title_q2092": "Wer hat die √§rztliche Erstversorgung durchgef√ºhrt?",
                        "label_2092_text": "2092_text",
                        "title_q2100": "Gutachten/Reha- Kurantr√§ge",
                        "label_2100": "Reha Antrag",
                        "label_2100_freitext": "2100_freitext",
                        "title_q3000": "Wie lautet Ihre PLZ?",
                        "label_3000": "3000",
                        "title_q3001": "Wohnort",
                        "label_3001": "3001",
                        "title_q3002": "Wohnanschrift",
                        "label_3002": "3002",
                        "title_q3003": "E‚ÄëMail f√ºr Ihre Terminbest√§tigung",
                        "label_3003": "3003",
                        "title_q3004": "Mobilrufnummer f√ºr R√ºckfragen?",
                        "label_3004": "3004",
                        "title_q3005": "Geben Sie hier ‚Äì wenn bekannt ‚Äì Ihre Patienten-ID ein",
                        "label_3005": "3005",
                        "title_q4000": "Wie gro√ü sind Sie?",
                        "label_4000": "4000",
                        "title_q4001": "Wie schwer sind Sie (in kg)?",
                        "label_4001": "4001",
                        "title_q4002": "Haben Sie jemals geraucht?",
                        "label_4002": "Nein",
                        "title_q4003": "Durchschnittlich wie viele Zigaretten pro Tag?",
                        "label_4003": "4003",
                        "title_q4004": "Wie viele Jahre haben Sie geraucht?",
                        "label_4004": "4004",
                        "title_q4005": "Rauchen Sie immer noch?",
                        "label_4005": "Nein",
                        "title_q4006": "Wann (Jahr) haben Sie aufgeh√∂rt?",
                        "label_4006": "4006",
                        "title_q4100": "Haben Sie eine der folgenden Impfungen erhalten?",
                        "label_4100": "keine der √ºblichen Impfungen erhalten",
                        "label_4100_freitext": "4100_freitext",
                        "title_q4110": "Gibt es in Ihrer Familie folgende Erkrankungen?",
                        "label_4110": "keine",
                        "label_4110_freitext": "4110_freitext",
                        "title_q4120": "Berufliche Situation",
                        "label_4120": "4120",
                        "title_q4121": "Stressbelastung",
                        "label_4121": "4121",
                        "title_q4122": "Schlafqualit√§t",
                        "label_4122": "4122",
                        "title_q4123": "Bewegung im Alltag",
                        "label_4123": "4123",
                        "title_q4130": "Alkoholkonsum",
                        "label_4130": "4130",
                        "title_q4131": "Drogen/Substanzen",
                        "label_4131": "4131",
                        "title_q4140": "Haben Sie an folgenden Vorsorgeuntersuchungen teilgenommen?",
                        "label_4140": "Hepatitis B / C Screening einmalig ab 35 Jahren m√∂glich",
                        "title_q5000": "Leiden Sie an Diabetes?",
                        "label_5000": "Nein",
                        "title_q5001": "Welcher Typ?",
                        "label_5001": "5001",
                        "title_q5002": "Medikament√∂se Diabetestherapie",
                        "label_5002": "Metformin",
                        "label_5002_freitext": "5002_freitext",
                        "title_q5003": "Haben Sie eine der folgenden Komplikationen?",
                        "label_5003": "Nephropathie",
                        "title_q6000": "Haben Sie k√∂rperliche Beeintr√§chtigungen?",
                        "label_6000": "Nein",
                        "title_q6000_gdb": "Geben Sie den Grad Ihrer Behinderung (GdB) an und markieren Sie Merkzeichen",
                        "label_6000_gdb": "6000_gdb",
                        "label_6000_merkzeichen": "6000_merkzeichen",
                        "title_q6000_pflegegrad": "Welcher Pflegegrad liegt vor?",
                        "label_6000_pflegegrad": "6000_pflegegrad",
                        "title_q6001": "Welche Beeintr√§chtigungen haben Sie?",
                        "label_6001": "Stuhlinkontinenz",
                        "label_6001_freitext": "6001_freitext",
                        "title_q6002": "Tragen Sie Implantate?",
                        "label_6002": "Nein",
                        "title_q6003": "Welche Implantate?",
                        "label_6003": "K√ºnstliche Herzklappe",
                        "label_6003_freitext": "6003_freitext",
                        "title_q6004": "Erhalten Sie blutverd√ºnnende Medikamente?",
                        "label_6004": "Nein",
                        "title_q6005": "Welche Blutverd√ºnner erhalten Sie?",
                        "label_6005": "Xarelto",
                        "title_q6006": "Leiden Sie unter Allergien?",
                        "label_6006": "Nein",
                        "title_q6007": "Ich leide unter folgenden Allergien/Intoleranzen:",
                        "label_6007": "Nahrungsmittel (z. B. N√ºsse, Obst, Gluten, Milch)",
                        "label_6007_freitext": "6007_freitext",
                        "title_q7000": "Haben Sie eine der folgenden Gesundheitsst√∂rungen?",
                        "label_7000": "Schilddr√ºsenerkrankung",
                        "label_7000_freitext": "7000_freitext",
                        "label_7102_leitsymptome": "Brustenge",
                        "label_7102_hustenart": "2. Husten vorwiegend",
                        "label_7102_saison": "Winter",
                        "label_7102_trigger_allergie": "Wetterwechsel",
                        "label_7102_freq_day": "t√§glich",
                        "label_7102_night": "‚â•1√ó/Woche",
                        "label_7102_saba_use": "t√§glich",
                        "label_7102_activity": "deutlich",
                        "label_7102_exac_count": "Anzahl",
                        "label_7102_exac_ocs": "OCS n√∂tig? nein",
                        "label_7102_exac_hosp": "Klinikaufnahme? nein",
                        "label_7102_exac_intub": "notwendige Intubation nein",
                        "label_7102_pneumothorax": "Fr√ºhere Pneumothorax: nein",
                        "label_7102_trigger2": "Arbeit",
                        "title_q7001": "Welche Gerinnungsst√∂rung haben Sie?",
                        "label_7001": "Von-Willebrand-Syndrom",
                        "label_7001_freitext": "7001_freitext",
                        "title_q7002": "Welche Lungenerkrankung haben Sie?",
                        "label_7002": "Sarkoidose (Lunge)",
                        "label_7002_freitext": "7002_freitext",
                        "title_q7003": "Angaben zur Dialyseform",
                        "label_7003": "√úber Dialysekatheter",
                        "title_q7004": "Unter welcher Gem√ºtsst√∂rung leiden Sie?",
                        "label_7004": "Anpassungsst√∂rung mit depressiver Reaktion",
                        "label_7004_freitext": "7004_freitext",
                        "title_q7005": "Angaben zu Herzerkrankungen",
                        "label_7005": "Vorhofflimmern",
                        "label_7005_freitext": "7005_freitext",
                        "title_q7006": "Angaben zu Magen-Darmerkrankungen",
                        "label_7006": "Pfortaderthrombose",
                        "label_7006_freitext": "7006_freitext",
                        "title_q7007": "Angaben zu MRSA",
                        "label_7007": "weiterhin vorhanden",
                        "title_q7008": "Um welchen Nierenerkrankung handelt es sich?",
                        "label_7008": "Glomerulonephritis",
                        "label_7008_freitext": "7008_freitext",
                        "title_q7009": "Welche Nervenerkrankung haben Sie?",
                        "label_7009": "Polyneuropathie",
                        "label_7009_freitext": "7009_freitext",
                        "title_q7010": "Welche Rheumerkrankung haben Sie?",
                        "label_7010": "Gichtarthritis",
                        "label_7010_freitext": "7010_freitext",
                        "title_q7011": "Unter welcher Schilddr√ºsenerkrankung leiden Sie?",
                        "label_7011": "Unterfunktion",
                        "label_7011_freitext": "7011_freitext",
                        "title_q7102": "Asthma/COPD ‚Äì Verlauf und Kontrolle",
                        "title_q8000": "Gab es bei Ihnen bereits folgende Erkrankungen oder Eingriffe?",
                        "label_8000": "keine",
                        "label_8000_freitext": "8000_freitext",
                        "title_q8001": "Wo befand sich das Aneurysma?",
                        "label_8001": "Kopf",
                        "label_8001_freitext": "8001_freitext",
                        "title_q8002": "Wie wurde das Aneurysma behandelt?",
                        "label_8002": "ohne Behandlung - Beobachtung",
                        "title_q8003": "Welche Arterienerkrankung hatten Sie?",
                        "label_8003": "Embolie",
                        "label_8003_freitext": "8003_freitext",
                        "title_q8004": "Welche Behandlungen wurden durchgef√ºhrt?",
                        "label_8004": "Y-Prothese",
                        "label_8004_freitext": "8004_freitext",
                        "title_q8005": "Wie oft hatten Sie eine Thrombose?",
                        "label_8005": "8005",
                        "title_q8006": "Wann und wo (Bein/Arm) hatten Sie eine Thrombose?",
                        "label_8006": "8006",
                        "title_q8007": "Welche Gef√§√ü- oder Herzoperationen wurden durchgef√ºhrt?",
                        "label_8007": "Herzklappenersatz",
                        "label_8007_freitext": "8007_freitext",
                        "title_q8008": "Wann hatten Sie einen Herzinfarkt?",
                        "label_8008": "8008",
                        "title_q8009": "Welche Behandlung wurde durchgef√ºhrt?",
                        "label_8009": "Lysetherapie",
                        "label_8009_freitext": "8009_freitext",
                        "title_q8010": "Welche Krebserkrankungen hatten Sie?",
                        "label_8010": "Prostatakrebs",
                        "label_8010_freitext": "8010_freitext",
                        "title_q8011": "Welche Behandlung wurde durchgef√ºhrt?",
                        "label_8011": "Strahlentherapie",
                        "label_8011_freitext": "8011_freitext",
                        "title_q8012": "Ist die Krebsbehandlung abgeschlossen?",
                        "label_8012": "Nein",
                        "title_q8013": "Wann hatten Sie eine Lungenarterienembolie?",
                        "label_8013": "8013",
                        "title_q8014": "Was wurde transplantiert?",
                        "label_8014": "Pankreas",
                        "label_8014_freitext": "8014_freitext",
                        "title_q8015": "Wann hatten Sie Ihren Schlaganfall?",
                        "label_8015": "8015",
                        "title_q8016": "Welche Infektionskrankheiten hatten Sie?",
                        "label_8016": "Tuberkulose",
                        "label_8016_freitext": "8016_freitext",
                        "title_q8501": "Mammographie-Screening (Frauen ‚â• 50 Jahre)",
                        "label_8501": "keine Teilnahme in den letzten 2 Jahren",
                        "label_8501_freitext": "8501_freitext",
                        "title_q8502": "Prostata-Tastuntersuchung (M√§nner ‚â• 45 Jahre)",
                        "label_8502": "> 12 Monate oder noch nie",
                        "label_8502_freitext": "8502_freitext",
                        "title_q8503": "Bauchaortenaneurysma-Screening (M√§nner ‚â• 65 Jahre, einmalig)",
                        "label_8503": "noch nicht durchgef√ºhrt",
                        "label_8503_freitext": "8503_freitext",
                        "title_q8504": "Menopausen-Status (Frauen ‚â• 40 Jahre, optional)",
                        "label_8504": "nicht angeben",
                        "label_8504_freitext": "8504_freitext",
                        "title_q8800": "Nehmen Sie die Antibabypille?",
                        "label_8800": "Nein",
                        "title_q8900": "üíä Welche Medikamente erhalten Sie?",
                        "label_8900": "Vitamine / Mineralstoffe (Vitamin D; Calcium; B12)",
                        "label_8900_gesamt": "8900_gesamt",
                        "title_q9000": "Kontaktdaten vor Versand pr√ºfen",
                        "label_confirm_email": "Ich best√§tige, dass ich die Daten √ºbermitteln m√∂chte.",
                        "label_9001": "eMail-Adresse",
                        "label_9002": "mobile R√ºckrufnummer",
                        "label_9001_gesamt": "9001_gesamt",
                        "label_9002_gesamt": "9002_gesamt",
                        "title_q9001": "q9001",
                        "title_q9900": "Wie zufrieden sind Sie mit diesem Fragebogen?",
                        "label_9900": "9900",
                        "label_9900_freitext": "9900_freitext",
                        "json_box_title": "Verschl√ºsselte Antworten (AES-256)",
                        "export_file_enc": "Export (Verschl√ºsselt)",
                        "export_file_raw": "Export (Roh-JSON)",
                        "decrypt_data": "Daten entschl√ºsseln",
                        "export_nfc": "Export (NFC)",
                        "export_email": "Export (E-Mail)",
                        "email_subject": "Anamnese Antworten",
                        "email_body": "Anbei die verschl√ºsselten Anamnese-Antworten:",
                        "nfc_success": "NFC-√úbertragung erfolgreich.",
                        "nfc_error": "Fehler bei der NFC-√úbertragung: ",
                        "nfc_simulation": "NFC wird simuliert. Die verschl√ºsselten Daten werden in der JSON-Box angezeigt.",
                        "decryption_prompt": "Bitte geben Sie die verschl√ºsselten Daten ein:",
                        "decryption_success": "Entschl√ºsselung erfolgreich:",
                        "decryption_error_json": "Entschl√ºsselung erfolgreich, aber das Ergebnis ist kein g√ºltiges JSON.",
                        "select_placeholder": "Bitte ausw√§hlen...",
                        "please_select": "Bitte ausw√§hlen...",
                        "disclaimer_medical": "Dies ist ein digitales Anamnese-Werkzeug und ersetzt keine √§rztliche Untersuchung.",
                        "disclaimer_privacy": "Ihre Eingaben werden lokal gespeichert und nur als Datei √ºbergeben.",
                        "step_of": "Schritt {current} von {total}",
                        "red_flag_warning": "‚ö†Ô∏è Achtung: Es wurden wichtige Symptome erkannt, die eine sofortige √§rztliche Untersuchung erfordern!",
                        "0003_tag": "Tag",
                        "0003_monat": "Monat",
                        "0003_jahr": "Jahr",
                        
                        // Additional UI labels from gemini.txt
                        "add_entry": "Weitere hinzuf√ºgen",
                        "additional_notes": "Weitere Anmerkungen",
                        "app_subtitle": "Bitte f√ºllen Sie alle Pflichtfelder aus",
                        "upload_title": "Medizinisches Dokument hochladen",
                        "upload_subtitle": "Drag & Drop oder klicken zum Hochladen (PDF, JPG, PNG)",
                        "btn_export": "Daten exportieren",
                        "anliegen": "Ihr Anliegen",
                        "anliegen_termin": "Terminvereinbarung",
                        "anliegen_rezept": "Rezept/Verordnung",
                        "anliegen_sonstiges": "Sonstiges Anliegen",
                        "complaints_main": "Beschwerden",
                        "complaints_details": "Details zu Ihren Beschwerden",
                        "personal_info": "Pers√∂nliche Daten",
                        
                        // Validation messages
                        "validation_number": "Bitte geben Sie eine g√ºltige Zahl ein",
                        "validation_min": "Wert muss mindestens {min} sein",
                        "validation_max": "Wert darf maximal {max} sein",
                        "validation_max_length": "Maximal {max} Zeichen erlaubt",
                        "validation_pattern": "Ung√ºltiges Format. Nur Buchstaben erlaubt",
                        "validation_email": "Ung√ºltige E-Mail-Adresse",
                        "validation_phone": "Ung√ºltige Telefonnummer",
                        "validation_min_length": "Mindestens {min} Zeichen erforderlich",
                        
                        // OCR messages
                        "ocr_processing": "Dokument wird verarbeitet...",
                        "ocr_unsupported_format": "Nicht unterst√ºtztes Dateiformat",
                        "ocr_success": "‚úÖ Dokument erfolgreich verarbeitet!",
                        "ocr_error": "‚ùå Fehler beim Verarbeiten:",
                        
                        // Encryption messages
                        "encryption_max_retries": "Maximale Anzahl an Versuchen √ºberschritten. Bitte laden Sie die Seite neu.",
                        "encryption_test_mode": "TEST MODUS\n\nM√∂chten Sie den Test-Schl√ºssel verwenden?\n(F√ºr Produktion 'Abbrechen' klicken)",
                        "encryption_first_setup": "WICHTIG: Erstmalige Einrichtung\n\nBitte geben Sie ein sicheres Master-Passwort ein (min. 16 Zeichen).\nACHTUNG: Wenn Sie dieses Passwort vergessen, sind alle Daten unwiederbringlich verloren!",
                        "encryption_min_length": "Passwort muss mindestens 16 Zeichen lang sein!",
                        "encryption_success": "‚úÖ Master-Passwort erfolgreich gesetzt!",
                        "encryption_enter_password": "Bitte geben Sie Ihr Master-Passwort ein:",
                        "encryption_required": "‚ùå Passwort erforderlich!",
                        "encryption_wrong_password": "‚ùå Falsches Passwort!",
                        
                        // Restart messages
                        "restart_confirmation": "ACHTUNG: Alle gespeicherten Daten werden gel√∂scht!\n\nM√∂chten Sie wirklich neu starten?",
                        "restart_delete_key": "M√∂chten Sie auch den Verschl√ºsselungsschl√ºssel l√∂schen?\n\n(Falls Nein, k√∂nnen Sie gespeicherte verschl√ºsselte Daten sp√§ter noch laden)"
                },
                "en": {
                        "title_q0000": "Basic Data",
                        "label_0000": "Last Name",
                        "label_0001": "First Name",
                        "label_0002": "Gender",
                        "label_0003_tag": "Day",
                        "label_0003_monat": "Month",
                        "label_0003_jahr": "Year",
                        "app_title": "Medical History Questionnaire",
                        "privacy_notice": "Privacy Notice",
                        "privacy_text": "This application processes your health data exclusively locally on your device. No data is transmitted to external servers (except for one-time loading of language models, if online). By clicking 'Accept & Start' you agree to local processing.",
                        "accept_start": "Accept & Start",
                        "disclaimer_medical": "This is a digital medical history tool and does not replace a medical examination.",
                        "disclaimer_privacy": "Your entries are stored locally and only transferred as a file.",
                        "json_box_title": "Encrypted Answers (AES-256)",
                        "additional_documents": "Additional Documents",
                        "additional_documents_desc": "You can upload additional documents (images, PDFs, text files). These will be processed with OCR and exported encrypted.",
                        "upload_documents": "Upload Documents",
                        "view_documents": "View Documents",
                        "delete_documents": "Delete Documents",
                        "export_encrypted_docs": "Export (Encrypted + Documents)",
                        "export_file_enc": "Export (Encrypted)",
                        "export_file_raw": "Export (Raw JSON)",
                        "decrypt_data": "Decrypt Data",
                        "export_nfc": "Export (NFC)",
                        "export_email": "Export (Email + Documents)",
                        "email_subject": "Medical History Answers",
                        "email_body": "Attached are the encrypted medical history answers:",
                        "summary_title": "Summary of Your Information",
                        "summary_desc": "Click on an entry to jump to the question.",
                        "export_full": "Export (Full)",
                        "export_anonymous": "Export (Anonymous)",
                        "transcribed_voice": "Transcribed Voice Inputs",
                        "btn_back": "Back",
                        "btn_next": "Next",
                        "btn_summary": "Summary",
                        "btn_save": "Save",
                        "btn_load": "Load",
                        "btn_restart": "Restart",
                        "nfc_success": "NFC transfer successful.",
                        "nfc_error": "NFC transfer error: ",
                        "nfc_simulation": "NFC simulated. Encrypted data is displayed in the JSON field.",
                        "decryption_prompt": "Please enter encrypted data:",
                        "decryption_success": "Decryption successful:",
                        "decryption_error_json": "Decryption successful, but result is not valid JSON.",
                        "select_placeholder": "Please select...",
                        "please_select": "Please select...",
                        "step_of": "Step {current} of {total}",
                        "red_flag_warning": "‚ö†Ô∏è Warning: Important symptoms detected that require immediate medical attention!",
                        "medical_concept": "Medical Concept: Dr. Christian Klapproth",
                        "technical_implementation": "Technical Implementation: DiggAi GmbH",
                        "0003_tag": "Day",
                        "0003_monat": "Month",
                        "0003_jahr": "Year",
                        
                        // Additional UI labels from gemini.txt
                        "add_entry": "Add Another",
                        "additional_notes": "Additional Notes",
                        "app_subtitle": "Please fill out all required fields",
                        "upload_title": "Upload Medical Document",
                        "upload_subtitle": "Drag & drop or click to upload (PDF, JPG, PNG)",
                        "btn_export": "Export Data",
                        "anliegen": "Your Concern",
                        "anliegen_termin": "Appointment",
                        "anliegen_rezept": "Prescription",
                        "anliegen_sonstiges": "Other Concern",
                        "complaints_main": "Complaints",
                        "complaints_details": "Details of Your Complaints",
                        "personal_info": "Personal Information",
                        
                        // Validation messages
                        "validation_number": "Please enter a valid number",
                        "validation_min": "Value must be at least {min}",
                        "validation_max": "Value must be at most {max}",
                        "validation_max_length": "Maximum {max} characters allowed",
                        "validation_pattern": "Invalid format. Only letters allowed",
                        "validation_email": "Invalid email address",
                        "validation_phone": "Invalid phone number",
                        "validation_min_length": "Minimum {min} characters required",
                        
                        // OCR messages
                        "ocr_processing": "Processing document...",
                        "ocr_unsupported_format": "Unsupported file format",
                        "ocr_success": "‚úÖ Document processed successfully!",
                        "ocr_error": "‚ùå Processing error:",
                        
                        // Encryption messages
                        "encryption_max_retries": "Maximum number of attempts exceeded. Please reload the page.",
                        "encryption_test_mode": "TEST MODE\n\nWould you like to use the test key?\n(For production, click 'Cancel')",
                        "encryption_first_setup": "IMPORTANT: First-time setup\n\nPlease enter a secure master password (min. 16 characters).\nWARNING: If you forget this password, all data will be permanently lost!",
                        "encryption_min_length": "Password must be at least 16 characters long!",
                        "encryption_success": "‚úÖ Master password set successfully!",
                        "encryption_enter_password": "Please enter your master password:",
                        "encryption_required": "‚ùå Password required!",
                        "encryption_wrong_password": "‚ùå Wrong password!",
                        
                        // Restart messages
                        "restart_confirmation": "WARNING: All saved data will be deleted!\n\nDo you really want to restart?",
                        "restart_delete_key": "Do you also want to delete the encryption key?\n\n(If No, you can load saved encrypted data later)"
                },
                "es": {
                        "title_q0000": "Datos B√°sicos",
                        "label_0000": "Apellido",
                        "label_0001": "Nombre",
                        "label_0002": "G√©nero",
                        "label_0003_tag": "D√≠a",
                        "label_0003_monat": "Mes",
                        "label_0003_jahr": "A√±o",
                        "app_title": "Cuestionario de Historia M√©dica",
                        "privacy_notice": "Aviso de Privacidad",
                        "privacy_text": "Esta aplicaci√≥n procesa sus datos de salud exclusivamente de forma local en su dispositivo. No se transmiten datos a servidores externos (excepto para la carga √∫nica de modelos de idioma, si est√° en l√≠nea). Al hacer clic en 'Aceptar e Iniciar', acepta el procesamiento local.",
                        "accept_start": "Aceptar e Iniciar",
                        "disclaimer_medical": "Esta es una herramienta de anamnesis digital y no reemplaza un examen m√©dico.",
                        "disclaimer_privacy": "Sus entradas se almacenan localmente y solo se transfieren como archivo.",
                        "json_box_title": "Respuestas Cifradas (AES-256)",
                        "additional_documents": "Documentos Adicionales",
                        "additional_documents_desc": "Puede cargar documentos adicionales (im√°genes, PDFs, archivos de texto). Ser√°n procesados con OCR y exportados cifrados.",
                        "upload_documents": "Cargar Documentos",
                        "view_documents": "Ver Documentos",
                        "delete_documents": "Eliminar Documentos",
                        "export_encrypted_docs": "Exportar (Cifrado + Documentos)",
                        "export_file_enc": "Exportar (Cifrado)",
                        "export_file_raw": "Exportar (JSON Crudo)",
                        "decrypt_data": "Descifrar Datos",
                        "export_nfc": "Exportar (NFC)",
                        "export_email": "Exportar (Correo + Documentos)",
                        "btn_back": "Atr√°s",
                        "btn_next": "Siguiente",
                        "btn_summary": "Resumen",
                        "btn_save": "Guardar",
                        "btn_load": "Cargar",
                        "btn_restart": "Reiniciar",
                        "transcribed_voice": "Entradas de Voz Transcritas",
                        "summary_title": "Resumen de Su Informaci√≥n",
                        "summary_desc": "Haga clic en una entrada para saltar a la pregunta",
                        "medical_concept": "Concepto M√©dico: Dr. Christian Klapproth",
                        "technical_implementation": "Implementaci√≥n T√©cnica: DiggAi GmbH",
                        "email_subject": "Respuestas de Anamnesis",
                        "email_body": "Se adjuntan las respuestas cifradas de la anamnesis:",
                        "nfc_success": "Transferencia NFC exitosa.",
                        "nfc_error": "Error en la transferencia NFC: ",
                        "nfc_simulation": "NFC simulado. Los datos cifrados se muestran en el cuadro JSON.",
                        "decryption_prompt": "Por favor, ingrese los datos cifrados:",
                        "decryption_success": "Descifrado exitoso:",
                        "decryption_error_json": "Descifrado exitoso, pero el resultado no es un JSON v√°lido.",
                        "select_placeholder": "Por favor seleccione...",
                        "please_select": "Por favor seleccione...",
                        "step_of": "Paso {current} de {total}",
                        "red_flag_warning": "‚ö†Ô∏è Advertencia: Se detectaron s√≠ntomas importantes que requieren atenci√≥n m√©dica inmediata!",
                        "0003_tag": "D√≠a",
                        "0003_monat": "Mes",
                        "0003_jahr": "A√±o"
                },
                "fr": {
                        "title_q0000": "Donn√©es de Base",
                        "label_0000": "Nom",
                        "label_0001": "Pr√©nom",
                        "label_0002": "Genre",
                        "label_0003_tag": "Jour",
                        "label_0003_monat": "Mois",
                        "label_0003_jahr": "Ann√©e",
                        "app_title": "Questionnaire d'Anamn√®se M√©dicale",
                        "privacy_notice": "Avis de Confidentialit√©",
                        "privacy_text": "Cette application traite vos donn√©es de sant√© exclusivement localement sur votre appareil. Aucune donn√©e n'est transmise √† des serveurs externes (sauf pour le chargement ponctuel des mod√®les linguistiques, si en ligne). En cliquant sur 'Accepter et D√©marrer', vous acceptez le traitement local.",
                        "accept_start": "Accepter et D√©marrer",
                        "disclaimer_medical": "Ceci est un outil d'anamn√®se num√©rique et ne remplace pas un examen m√©dical.",
                        "disclaimer_privacy": "Vos entr√©es sont stock√©es localement et uniquement transf√©r√©es sous forme de fichier.",
                        "json_box_title": "R√©ponses Chiffr√©es (AES-256)",
                        "additional_documents": "Documents Suppl√©mentaires",
                        "additional_documents_desc": "Vous pouvez t√©l√©charger des documents suppl√©mentaires (images, PDFs, fichiers texte). Ils seront trait√©s avec OCR et export√©s chiffr√©s.",
                        "upload_documents": "T√©l√©charger des Documents",
                        "view_documents": "Voir les Documents",
                        "delete_documents": "Supprimer les Documents",
                        "export_encrypted_docs": "Exporter (Chiffr√© + Documents)",
                        "export_file_enc": "Exporter (Chiffr√©)",
                        "export_file_raw": "Exporter (JSON Brut)",
                        "decrypt_data": "D√©chiffrer les Donn√©es",
                        "export_nfc": "Exporter (NFC)",
                        "export_email": "Exporter (E-mail + Documents)",
                        "email_subject": "R√©ponses d'Anamn√®se",
                        "email_body": "Ci-joint les r√©ponses chiffr√©es de l'anamn√®se:",
                        "summary_title": "R√©sum√© de Vos Informations",
                        "summary_desc": "Cliquez sur une entr√©e pour acc√©der √† la question.",
                        "export_full": "Exporter (Complet)",
                        "export_anonymous": "Exporter (Anonyme)",
                        "transcribed_voice": "Saisies Vocales Transcrites",
                        "btn_back": "Retour",
                        "btn_next": "Suivant",
                        "btn_summary": "R√©sum√©",
                        "btn_save": "Sauvegarder",
                        "btn_load": "Charger",
                        "btn_restart": "Recommencer",
                        "nfc_success": "Transfert NFC r√©ussi.",
                        "nfc_error": "Erreur de transfert NFC: ",
                        "nfc_simulation": "NFC simul√©. Les donn√©es chiffr√©es sont affich√©es dans la bo√Æte JSON.",
                        "decryption_prompt": "Veuillez saisir les donn√©es chiffr√©es:",
                        "decryption_success": "D√©chiffrement r√©ussi:",
                        "decryption_error_json": "D√©chiffrement r√©ussi, mais le r√©sultat n'est pas un JSON valide.",
                        "select_placeholder": "Veuillez s√©lectionner...",
                        "please_select": "Veuillez s√©lectionner...",
                        "step_of": "√âtape {current} sur {total}",
                        "red_flag_warning": "‚ö†Ô∏è Attention: Des sympt√¥mes importants ont √©t√© d√©tect√©s qui n√©cessitent une attention m√©dicale imm√©diate!",
                        "medical_concept": "Concept M√©dical: Dr. Christian Klapproth",
                        "technical_implementation": "Mise en ≈íuvre Technique: DiggAi GmbH",
                        "0003_tag": "Jour",
                        "0003_monat": "Mois",
                        "0003_jahr": "Ann√©e"
                },
                "it": {
                        "title_q0000": "Dati di Base",
                        "label_0000": "Cognome",
                        "label_0001": "Nome",
                        "label_0002": "Genere",
                        "label_0003_tag": "Giorno",
                        "label_0003_monat": "Mese",
                        "label_0003_jahr": "Anno",
                        "app_title": "Questionario di Anamnesi Medica",
                        "privacy_notice": "Avviso sulla Privacy",
                        "privacy_text": "Questa applicazione elabora i tuoi dati sanitari esclusivamente in locale sul tuo dispositivo. Nessun dato viene trasmesso a server esterni (eccetto per il caricamento una tantum dei modelli linguistici, se online). Cliccando su 'Accetta e Inizia', accetti l'elaborazione locale.",
                        "accept_start": "Accetta e Inizia",
                        "disclaimer_medical": "Questo √® uno strumento di anamnesi digitale e non sostituisce un esame medico.",
                        "disclaimer_privacy": "I tuoi inserimenti sono memorizzati localmente e trasferiti solo come file.",
                        "json_box_title": "Risposte Cifrate (AES-256)",
                        "additional_documents": "Documenti Aggiuntivi",
                        "additional_documents_desc": "Puoi caricare documenti aggiuntivi (immagini, PDF, file di testo). Verranno elaborati con OCR ed esportati cifrati.",
                        "upload_documents": "Carica Documenti",
                        "view_documents": "Visualizza Documenti",
                        "delete_documents": "Elimina Documenti",
                        "export_encrypted_docs": "Esporta (Cifrato + Documenti)",
                        "export_file_enc": "Esporta (Cifrato)",
                        "export_file_raw": "Esporta (JSON Grezzo)",
                        "decrypt_data": "Decifra Dati",
                        "export_nfc": "Esporta (NFC)",
                        "export_email": "Esporta (E-mail + Documenti)",
                        "btn_back": "Indietro",
                        "btn_next": "Avanti",
                        "btn_summary": "Riepilogo",
                        "btn_save": "Salva",
                        "btn_load": "Carica",
                        "btn_restart": "Ricomincia",
                        "transcribed_voice": "Voci Trascritte",
                        "summary_title": "Riepilogo delle Tue Informazioni",
                        "summary_desc": "Clicca su una voce per saltare alla domanda",
                        "medical_concept": "Concetto Medico: Dr. Christian Klapproth",
                        "technical_implementation": "Implementazione Tecnica: DiggAi GmbH",
                        "email_subject": "Risposte Anamnesi",
                        "email_body": "In allegato le risposte cifrate dell'anamnesi:",
                        "nfc_success": "Trasferimento NFC riuscito.",
                        "nfc_error": "Errore di trasferimento NFC: ",
                        "nfc_simulation": "NFC simulato. I dati cifrati vengono visualizzati nella casella JSON.",
                        "decryption_prompt": "Inserisci i dati cifrati:",
                        "decryption_success": "Decifrazione riuscita:",
                        "decryption_error_json": "Decifrazione riuscita, ma il risultato non √® un JSON valido.",
                        "select_placeholder": "Seleziona...",
                        "please_select": "Seleziona...",
                        "step_of": "Passo {current} di {total}",
                        "red_flag_warning": "‚ö†Ô∏è Attenzione: Sono stati rilevati sintomi importanti che richiedono attenzione medica immediata!",
                        "0003_tag": "Giorno",
                        "0003_monat": "Mese",
                        "0003_jahr": "Anno"
                },
                "pt": {
                        "title_q0000": "Dados B√°sicos",
                        "label_0000": "Sobrenome",
                        "label_0001": "Nome",
                        "label_0002": "G√™nero",
                        "label_0003_tag": "Dia",
                        "label_0003_monat": "M√™s",
                        "label_0003_jahr": "Ano",
                        "json_box_title": "Respostas Criptografadas (AES-256)",
                        "export_file_enc": "Exportar (Criptografado)",
                        "export_file_raw": "Exportar (JSON Bruto)",
                        "decrypt_data": "Descriptografar Dados",
                        "export_nfc": "Exportar (NFC)",
                        "export_email": "Exportar (E-Mail)",
                        "email_subject": "Respostas da Anamnese",
                        "email_body": "Em anexo, as respostas criptografadas da anamnese:",
                        "nfc_success": "Transfer√™ncia NFC bem-sucedida.",
                        "nfc_error": "Erro na transfer√™ncia NFC: ",
                        "nfc_simulation": "NFC simulado. Os dados criptografados s√£o exibidos na caixa JSON.",
                        "decryption_prompt": "Por favor, insira os dados criptografados:",
                        "decryption_success": "Descriptografia bem-sucedida:",
                        "decryption_error_json": "Descriptografia bem-sucedida, mas o resultado n√£o √© um JSON v√°lido.",
                        "select_placeholder": "Selecione...",
                        "please_select": "Selecione...",
                        "disclaimer_medical": "Esta √© uma ferramenta de anamnese digital e n√£o substitui um exame m√©dico.",
                        "disclaimer_privacy": "Suas entradas s√£o armazenadas localmente e transferidas apenas como arquivo.",
                        "step_of": "Passo {current} de {total}",
                        "red_flag_warning": "‚ö†Ô∏è Aviso: Sintomas importantes detectados que requerem aten√ß√£o m√©dica imediata!",
                        "0003_tag": "Dia",
                        "0003_monat": "M√™s",
                        "0003_jahr": "Ano"
                },
                "ru": {
                        "app_title": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ê–Ω–∫–µ—Ç–∞",
                        "privacy_notice": "–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
                        "privacy_text": "–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞—à–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ. –ù–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π, –µ—Å–ª–∏ –æ–Ω–ª–∞–π–Ω). –ù–∞–∂–∏–º–∞—è '–ü—Ä–∏–Ω—è—Ç—å –∏ –ù–∞—á–∞—Ç—å', –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.",
                        "accept_start": "–ü—Ä–∏–Ω—è—Ç—å –∏ –ù–∞—á–∞—Ç—å",
                        "additional_documents": "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –î–æ–∫—É–º–µ–Ω—Ç—ã",
                        "upload_documents": "–ó–∞–≥—Ä—É–∑–∏—Ç—å –î–æ–∫—É–º–µ–Ω—Ç—ã",
                        "view_documents": "–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –î–æ–∫—É–º–µ–Ω—Ç—ã",
                        "delete_documents": "–£–¥–∞–ª–∏—Ç—å –î–æ–∫—É–º–µ–Ω—Ç—ã",
                        "export_encrypted_docs": "–≠–∫—Å–ø–æ—Ä—Ç (–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ + –î–æ–∫—É–º–µ–Ω—Ç—ã)",
                        "export_file_raw": "–≠–∫—Å–ø–æ—Ä—Ç (–ò—Å—Ö–æ–¥–Ω—ã–π JSON)",
                        "decrypt_data": "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å –î–∞–Ω–Ω—ã–µ",
                        "export_nfc": "–≠–∫—Å–ø–æ—Ä—Ç (NFC)",
                        "export_email": "–≠–∫—Å–ø–æ—Ä—Ç (E-mail + –î–æ–∫—É–º–µ–Ω—Ç—ã)",
                        "transcribed_voice": "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ì–æ–ª–æ—Å–æ–≤—ã–µ –ó–∞–ø–∏—Å–∏",
                        "encrypted_answers": "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –û—Ç–≤–µ—Ç—ã (AES-256)",
                        "summary_title": "–°–≤–æ–¥–∫–∞ –í–∞—à–µ–π –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏",
                        "summary_desc": "–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∑–∞–ø–∏—Å—å, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–æ–ø—Ä–æ—Å—É",
                        "btn_back": "–ù–∞–∑–∞–¥",
                        "btn_next": "–î–∞–ª–µ–µ",
                        "btn_summary": "–°–≤–æ–¥–∫–∞",
                        "btn_save": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",
                        "btn_load": "–ó–∞–≥—Ä—É–∑–∏—Ç—å",
                        "btn_restart": "–ù–∞—á–∞—Ç—å –ó–∞–Ω–æ–≤–æ",
                        "disclaimer_medical": "–≠—Ç–æ —Ü–∏—Ñ—Ä–æ–≤–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–Ω–∞–º–Ω–µ–∑–∞ –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.",
                        "disclaimer_privacy": "–í–∞—à–∏ –∑–∞–ø–∏—Å–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ —Ñ–∞–π–ª.",
                        "medical_concept": "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –î-—Ä –ö—Ä–∏—Å—Ç–∏–∞–Ω –ö–ª–∞–ø–ø—Ä–æ—Ç",
                        "technical_implementation": "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: DiggAi GmbH",
                        "title_q0000": "–û—Å–Ω–æ–≤–Ω—ã–µ –î–∞–Ω–Ω—ã–µ",
                        "label_0000": "–§–∞–º–∏–ª–∏—è",
                        "label_0001": "–ò–º—è",
                        "label_0002": "–ü–æ–ª",
                        "label_0003_tag": "–î–µ–Ω—å",
                        "label_0003_monat": "–ú–µ—Å—è—Ü",
                        "label_0003_jahr": "–ì–æ–¥",
                        "json_box_title": "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –û—Ç–≤–µ—Ç—ã (AES-256)",
                        "export_file_enc": "–≠–∫—Å–ø–æ—Ä—Ç (–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π)",
                        "email_subject": "–û—Ç–≤–µ—Ç—ã –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ê–Ω–∫–µ—Ç—ã",
                        "email_body": "–ü—Ä–∏–ª–∞–≥–∞—é—Ç—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∞–Ω–∫–µ—Ç—ã:",
                        "nfc_success": "–ü–µ—Ä–µ–¥–∞—á–∞ NFC –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.",
                        "nfc_error": "–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–¥–∞—á–∏ NFC: ",
                        "nfc_simulation": "NFC —Å–∏–º—É–ª–∏—Ä—É–µ—Ç—Å—è. –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø–æ–ª–µ JSON.",
                        "decryption_prompt": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:",
                        "decryption_success": "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ:",
                        "decryption_error_json": "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ, –Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø—É—Å—Ç–∏–º—ã–º JSON.",
                        "select_placeholder": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ...",
                        "please_select": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ...",
                        "step_of": "–®–∞–≥ {current} –∏–∑ {total}",
                        "red_flag_warning": "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –≤–∞–∂–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –ø–æ–º–æ—â–∏!",
                        "0003_tag": "–î–µ–Ω—å",
                        "0003_monat": "–ú–µ—Å—è—Ü",
                        "0003_jahr": "–ì–æ–¥"
                },
                "uk": {
                        "app_title": "–ú–µ–¥–∏—á–Ω–∞ –ê–Ω–∫–µ—Ç–∞",
                        "privacy_notice": "–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ö–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω—ñ—Å—Ç—å",
                        "privacy_text": "–¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –æ–±—Ä–æ–±–ª—è—î –≤–∞—à—ñ –º–µ–¥–∏—á–Ω—ñ –¥–∞–Ω—ñ –≤–∏–∫–ª—é—á–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤–∞—à–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó. –ñ–æ–¥–Ω—ñ –¥–∞–Ω—ñ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –Ω–∞ –∑–æ–≤–Ω—ñ—à–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∏ (–∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–≤–Ω–∏—Ö –º–æ–¥–µ–ª–µ–π, —è–∫—â–æ –æ–Ω–ª–∞–π–Ω). –ù–∞—Ç–∏—Å–∫–∞—é—á–∏ '–ü—Ä–∏–π–Ω—è—Ç–∏ —ñ –ü–æ—á–∞—Ç–∏', –≤–∏ –ø–æ–≥–æ–¥–∂—É—î—Ç–µ—Å—å –∑ –ª–æ–∫–∞–ª—å–Ω–æ—é –æ–±—Ä–æ–±–∫–æ—é.",
                        "accept_start": "–ü—Ä–∏–π–Ω—è—Ç–∏ —ñ –ü–æ—á–∞—Ç–∏",
                        "additional_documents": "–î–æ–¥–∞—Ç–∫–æ–≤—ñ –î–æ–∫—É–º–µ–Ω—Ç–∏",
                        "upload_documents": "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –î–æ–∫—É–º–µ–Ω—Ç–∏",
                        "view_documents": "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –î–æ–∫—É–º–µ–Ω—Ç–∏",
                        "delete_documents": "–í–∏–¥–∞–ª–∏—Ç–∏ –î–æ–∫—É–º–µ–Ω—Ç–∏",
                        "export_encrypted_docs": "–ï–∫—Å–ø–æ—Ä—Ç (–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ + –î–æ–∫—É–º–µ–Ω—Ç–∏)",
                        "export_file_raw": "–ï–∫—Å–ø–æ—Ä—Ç (–í–∏—Ö—ñ–¥–Ω–∏–π JSON)",
                        "decrypt_data": "–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞—Ç–∏ –î–∞–Ω—ñ",
                        "export_nfc": "–ï–∫—Å–ø–æ—Ä—Ç (NFC)",
                        "export_email": "–ï–∫—Å–ø–æ—Ä—Ç (E-mail + –î–æ–∫—É–º–µ–Ω—Ç–∏)",
                        "transcribed_voice": "–¢—Ä–∞–Ω—Å–∫—Ä–∏–±–æ–≤–∞–Ω—ñ –ì–æ–ª–æ—Å–æ–≤—ñ –ó–∞–ø–∏—Å–∏",
                        "encrypted_answers": "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –í—ñ–¥–ø–æ–≤—ñ–¥—ñ (AES-256)",
                        "summary_title": "–ó–≤–µ–¥–µ–Ω–Ω—è –í–∞—à–æ—ó –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó",
                        "summary_desc": "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –∑–∞–ø–∏—Å, —â–æ–± –ø–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–∏—Ç–∞–Ω–Ω—è",
                        "btn_back": "–ù–∞–∑–∞–¥",
                        "btn_next": "–î–∞–ª—ñ",
                        "btn_summary": "–ó–≤–µ–¥–µ–Ω–Ω—è",
                        "btn_save": "–ó–±–µ—Ä–µ–≥—Ç–∏",
                        "btn_load": "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏",
                        "btn_restart": "–ü–æ—á–∞—Ç–∏ –ó–∞–Ω–æ–≤–æ",
                        "disclaimer_medical": "–¶–µ —Ü–∏—Ñ—Ä–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–Ω–∞–º–Ω–µ–∑—É —ñ –Ω–µ –∑–∞–º—ñ–Ω—é—î –º–µ–¥–∏—á–Ω–µ –æ–±—Å—Ç–µ–∂–µ–Ω–Ω—è.",
                        "disclaimer_privacy": "–í–∞—à—ñ –∑–∞–ø–∏—Å–∏ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ —ñ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫ —Ñ–∞–π–ª.",
                        "medical_concept": "–ú–µ–¥–∏—á–Ω–∞ –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è: –î-—Ä –ö—Ä—ñ—Å—Ç—ñ–∞–Ω –ö–ª–∞–ø–ø—Ä–æ—Ç",
                        "technical_implementation": "–¢–µ—Ö–Ω—ñ—á–Ω–∞ –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è: DiggAi GmbH",
                        "title_q0000": "–û—Å–Ω–æ–≤–Ω—ñ –î–∞–Ω—ñ",
                        "label_0000": "–ü—Ä—ñ–∑–≤–∏—â–µ",
                        "label_0001": "–Ü–º'—è",
                        "label_0002": "–°—Ç–∞—Ç—å",
                        "label_0003_tag": "–î–µ–Ω—å",
                        "label_0003_monat": "–ú—ñ—Å—è—Ü—å",
                        "label_0003_jahr": "–†—ñ–∫",
                        "json_box_title": "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –í—ñ–¥–ø–æ–≤—ñ–¥—ñ (AES-256)",
                        "export_file_enc": "–ï–∫—Å–ø–æ—Ä—Ç (–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π)",
                        "email_subject": "–í—ñ–¥–ø–æ–≤—ñ–¥—ñ –ú–µ–¥–∏—á–Ω–æ—ó –ê–Ω–∫–µ—Ç–∏",
                        "email_body": "–î–æ–¥–∞—é—Ç—å—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –º–µ–¥–∏—á–Ω–æ—ó –∞–Ω–∫–µ—Ç–∏:",
                        "nfc_success": "–ü–µ—Ä–µ–¥–∞—á–∞ NFC –ø—Ä–æ–π—à–ª–∞ —É—Å–ø—ñ—à–Ω–æ.",
                        "nfc_error": "–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–¥–∞—á—ñ NFC: ",
                        "nfc_simulation": "NFC —Å–∏–º—É–ª—é—î—Ç—å—Å—è. –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –≤ –ø–æ–ª—ñ JSON.",
                        "decryption_prompt": "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ:",
                        "decryption_success": "–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ–π—à–ª–æ —É—Å–ø—ñ—à–Ω–æ:",
                        "decryption_error_json": "–†–æ–∑—à–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–æ–π—à–ª–æ —É—Å–ø—ñ—à–Ω–æ, –∞–ª–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ —î –¥–æ–ø—É—Å—Ç–∏–º–∏–º JSON.",
                        "select_placeholder": "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å...",
                        "please_select": "–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å...",
                        "step_of": "–ö—Ä–æ–∫ {current} –∑ {total}",
                        "red_flag_warning": "‚ö†Ô∏è –£–≤–∞–≥–∞: –í–∏—è–≤–ª–µ–Ω–æ –≤–∞–∂–ª–∏–≤—ñ —Å–∏–º–ø—Ç–æ–º–∏, —è–∫—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –Ω–µ–≥–∞–π–Ω–æ—ó –º–µ–¥–∏—á–Ω–æ—ó –¥–æ–ø–æ–º–æ–≥–∏!",
                        "0003_tag": "–î–µ–Ω—å",
                        "0003_monat": "–ú—ñ—Å—è—Ü—å",
                        "0003_jahr": "–†—ñ–∫"
                },
                "zh": {
                        "title_q0000": "Âü∫Êú¨‰ø°ÊÅØ",
                        "label_0000": "Âßì",
                        "label_0001": "Âêç",
                        "label_0002": "ÊÄßÂà´",
                        "label_0003_tag": "Êó•",
                        "label_0003_monat": "Êúà",
                        "label_0003_jahr": "Âπ¥",
                        "app_title": "ÁóÖÂéÜÈóÆÂç∑",
                        "privacy_notice": "ÈöêÁßÅÂ£∞Êòé",
                        "privacy_text": "Êú¨Â∫îÁî®Á®ãÂ∫è‰ªÖÂú®ÊÇ®ÁöÑËÆæÂ§á‰∏äÊú¨Âú∞Â§ÑÁêÜÊÇ®ÁöÑÂÅ•Â∫∑Êï∞ÊçÆ„ÄÇ‰∏ç‰ºöÂ∞Ü‰ªª‰ΩïÊï∞ÊçÆ‰º†ËæìÂà∞Â§ñÈÉ®ÊúçÂä°Âô®ÔºàÈô§‰∫Ü‰∏ÄÊ¨°ÊÄßÂä†ËΩΩËØ≠Ë®ÄÊ®°ÂûãÔºåÂ¶ÇÊûúÂú®Á∫øÁöÑËØùÔºâ„ÄÇÁÇπÂáª'Êé•ÂèóÂπ∂ÂºÄÂßã'Âç≥Ë°®Á§∫ÊÇ®ÂêåÊÑèÊú¨Âú∞Â§ÑÁêÜ„ÄÇ",
                        "accept_start": "Êé•ÂèóÂπ∂ÂºÄÂßã",
                        "disclaimer_medical": "ËøôÊòØ‰∏Ä‰∏™Êï∞Â≠óÁóÖÂéÜÂ∑•ÂÖ∑Ôºå‰∏çËÉΩÊõø‰ª£ÂåªÂ≠¶Ê£ÄÊü•„ÄÇ",
                        "disclaimer_privacy": "ÊÇ®ÁöÑËæìÂÖ•Â∞ÜÂú®Êú¨Âú∞Â≠òÂÇ®Ôºå‰ªÖ‰Ωú‰∏∫Êñá‰ª∂‰º†Ëæì„ÄÇ",
                        "json_box_title": "Âä†ÂØÜÁ≠îÊ°à (AES-256)",
                        "additional_documents": "ÈôÑÂä†ÊñáÊ°£",
                        "additional_documents_desc": "ÊÇ®ÂèØ‰ª•‰∏ä‰º†ÈôÑÂä†ÊñáÊ°£ÔºàÂõæÁâá„ÄÅPDF„ÄÅÊñáÊú¨Êñá‰ª∂Ôºâ„ÄÇËøô‰∫õÂ∞ÜÈÄöËøáOCRÂ§ÑÁêÜÂπ∂Âä†ÂØÜÂØºÂá∫„ÄÇ",
                        "upload_documents": "‰∏ä‰º†ÊñáÊ°£",
                        "view_documents": "Êü•ÁúãÊñáÊ°£",
                        "delete_documents": "Âà†Èô§ÊñáÊ°£",
                        "export_encrypted_docs": "ÂØºÂá∫ÔºàÂä†ÂØÜ + ÊñáÊ°£Ôºâ",
                        "export_file_enc": "ÂØºÂá∫ÔºàÂä†ÂØÜÔºâ",
                        "export_file_raw": "ÂØºÂá∫ÔºàÂéüÂßãJSONÔºâ",
                        "decrypt_data": "Ëß£ÂØÜÊï∞ÊçÆ",
                        "export_nfc": "ÂØºÂá∫ÔºàNFCÔºâ",
                        "export_email": "ÂØºÂá∫ÔºàÁîµÂ≠êÈÇÆ‰ª∂ + ÊñáÊ°£Ôºâ",
                        "email_subject": "ÁóÖÂéÜÈóÆÂç∑Á≠îÊ°à",
                        "email_body": "ÈôÑ‰ª∂ÊòØÂä†ÂØÜÁöÑÁóÖÂéÜÈóÆÂç∑Á≠îÊ°àÔºö",
                        "summary_title": "ÊÇ®ÁöÑ‰ø°ÊÅØÊëòË¶Å",
                        "summary_desc": "ÁÇπÂáªÊù°ÁõÆË∑≥ËΩ¨Âà∞ÈóÆÈ¢ò„ÄÇ",
                        "export_full": "ÂØºÂá∫ÔºàÂÆåÊï¥Ôºâ",
                        "export_anonymous": "ÂØºÂá∫ÔºàÂåøÂêçÔºâ",
                        "transcribed_voice": "ËΩ¨ÂΩïÁöÑËØ≠Èü≥ËæìÂÖ•",
                        "btn_back": "ËøîÂõû",
                        "btn_next": "‰∏ã‰∏ÄÊ≠•",
                        "btn_summary": "ÊëòË¶Å",
                        "btn_save": "‰øùÂ≠ò",
                        "btn_load": "Âä†ËΩΩ",
                        "btn_restart": "ÈáçÊñ∞ÂºÄÂßã",
                        "medical_concept": "ÂåªÂ≠¶Ê¶ÇÂøµÔºöDr. Christian Klapproth",
                        "technical_implementation": "ÊäÄÊúØÂÆûÁé∞ÔºöDiggAi GmbH",
                        "nfc_success": "NFC‰º†ËæìÊàêÂäü„ÄÇ",
                        "nfc_error": "NFC‰º†ËæìÈîôËØØÔºö",
                        "nfc_simulation": "NFCÂ∑≤Ê®°Êãü„ÄÇÂä†ÂØÜÊï∞ÊçÆÊòæÁ§∫Âú®JSONÊ°Ü‰∏≠„ÄÇ",
                        "decryption_prompt": "ËØ∑ËæìÂÖ•Âä†ÂØÜÊï∞ÊçÆÔºö",
                        "decryption_success": "Ëß£ÂØÜÊàêÂäüÔºö",
                        "decryption_error_json": "Ëß£ÂØÜÊàêÂäüÔºå‰ΩÜÁªìÊûú‰∏çÊòØÊúâÊïàÁöÑJSON„ÄÇ",
                        "select_placeholder": "ËØ∑ÈÄâÊã©...",
                        "please_select": "ËØ∑ÈÄâÊã©...",
                        "step_of": "Á¨¨ {current} Ê≠•ÔºåÂÖ± {total} Ê≠•",
                        "red_flag_warning": "‚ö†Ô∏è Ë≠¶ÂëäÔºöÊ£ÄÊµãÂà∞ÈúÄË¶ÅÁ´ãÂç≥Â∞±ÂåªÁöÑÈáçË¶ÅÁóáÁä∂ÔºÅ",
                        "0003_tag": "Êó•",
                        "0003_monat": "Êúà",
                        "0003_jahr": "Âπ¥"
                },
                "ar": {
                        "title_q0000": "ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ©",
                        "label_0000": "ÿßŸÑŸÑŸÇÿ®",
                        "label_0001": "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ£ŸàŸÑ",
                        "label_0002": "ÿßŸÑÿ¨ŸÜÿ≥",
                        "label_0003_tag": "ŸäŸàŸÖ",
                        "label_0003_monat": "ÿ¥Ÿáÿ±",
                        "label_0003_jahr": "ÿ≥ŸÜÿ©",
                        "app_title": "ÿßÿ≥ÿ™ÿ®ŸäÿßŸÜ ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ÿ®Ÿä",
                        "privacy_notice": "ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑÿÆÿµŸàÿµŸäÿ©",
                        "privacy_text": "ŸäŸÇŸàŸÖ Ÿáÿ∞ÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ŸÖÿπÿßŸÑÿ¨ÿ© ÿ®ŸäÿßŸÜÿßÿ™ŸÉ ÿßŸÑÿµÿ≠Ÿäÿ© ŸÖÿ≠ŸÑŸäŸãÿß ÿπŸÑŸâ ÿ¨Ÿáÿßÿ≤ŸÉ ŸÅŸÇÿ∑. ŸÑÿß Ÿäÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ£Ÿä ÿ®ŸäÿßŸÜÿßÿ™ ÿ•ŸÑŸâ ÿÆŸàÿßÿØŸÖ ÿÆÿßÿ±ÿ¨Ÿäÿ© (ÿ®ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ŸàŸÑŸä ŸÑŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑŸÑÿ∫ÿ©ÿå ÿ•ÿ∞ÿß ŸÉŸÜÿ™ ŸÖÿ™ÿµŸÑÿßŸã ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™). ÿ®ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ 'ŸÇÿ®ŸàŸÑ Ÿàÿ®ÿØÿ°' ŸÅÿ•ŸÜŸÉ ÿ™ŸàÿßŸÅŸÇ ÿπŸÑŸâ ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖÿ≠ŸÑŸäÿ©.",
                        "accept_start": "ŸÇÿ®ŸàŸÑ Ÿàÿ®ÿØÿ°",
                        "disclaimer_medical": "Ÿáÿ∞Ÿá ÿ£ÿØÿßÿ© ÿ™ÿßÿ±ŸäÿÆ ÿ∑ÿ®Ÿä ÿ±ŸÇŸÖŸä ŸàŸÑÿß ÿ™ÿ≠ŸÑ ŸÖÿ≠ŸÑ ÿßŸÑŸÅÿ≠ÿµ ÿßŸÑÿ∑ÿ®Ÿä.",
                        "disclaimer_privacy": "Ÿäÿ™ŸÖ ÿ™ÿÆÿ≤ŸäŸÜ ÿ•ÿØÿÆÿßŸÑÿßÿ™ŸÉ ŸÖÿ≠ŸÑŸäŸãÿß Ÿàÿ™ŸÜŸÇŸÑ ŸÅŸÇÿ∑ ŸÉŸÖŸÑŸÅ.",
                        "json_box_title": "ÿßŸÑÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ© (AES-256)",
                        "additional_documents": "ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©",
                        "additional_documents_desc": "ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ≠ŸÖŸäŸÑ ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© (ÿµŸàÿ±ÿå ŸÖŸÑŸÅÿßÿ™ PDFÿå ŸÖŸÑŸÅÿßÿ™ ŸÜÿµŸäÿ©). ÿ≥Ÿäÿ™ŸÖ ŸÖÿπÿßŸÑÿ¨ÿ™Ÿáÿß ÿ®ÿ™ŸÇŸÜŸäÿ© OCR Ÿàÿ™ÿµÿØŸäÿ±Ÿáÿß ŸÖÿ¥ŸÅÿ±ÿ©.",
                        "upload_documents": "ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™",
                        "view_documents": "ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™",
                        "delete_documents": "ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™",
                        "export_encrypted_docs": "ÿ™ÿµÿØŸäÿ± (ŸÖÿ¥ŸÅÿ± + ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™)",
                        "export_file_enc": "ÿ™ÿµÿØŸäÿ± (ŸÖÿ¥ŸÅÿ±)",
                        "export_file_raw": "ÿ™ÿµÿØŸäÿ± (JSON ÿÆÿßŸÖ)",
                        "decrypt_data": "ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™",
                        "export_nfc": "ÿ™ÿµÿØŸäÿ± (NFC)",
                        "export_email": "ÿ™ÿµÿØŸäÿ± (ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä + ŸÖÿ≥ÿ™ŸÜÿØÿßÿ™)",
                        "email_subject": "ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ®ŸäÿßŸÜ ÿßŸÑÿ∑ÿ®Ÿä",
                        "email_body": "ŸÖÿ±ŸÅŸÇ ÿ∑ŸäŸá ÿ•ÿ¨ÿßÿ®ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿ®ŸäÿßŸÜ ÿßŸÑÿ∑ÿ®Ÿä ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ©:",
                        "summary_title": "ŸÖŸÑÿÆÿµ ŸÖÿπŸÑŸàŸÖÿßÿ™ŸÉ",
                        "summary_desc": "ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ£Ÿä ÿ•ÿØÿÆÿßŸÑ ŸÑŸÑÿßŸÜÿ™ŸÇÿßŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ≥ÿ§ÿßŸÑ.",
                        "export_full": "ÿ™ÿµÿØŸäÿ± (ŸÉÿßŸÖŸÑ)",
                        "export_anonymous": "ÿ™ÿµÿØŸäÿ± (ŸÖÿ¨ŸáŸàŸÑ)",
                        "transcribed_voice": "ÿßŸÑÿ•ÿØÿÆÿßŸÑÿßÿ™ ÿßŸÑÿµŸàÿ™Ÿäÿ© ÿßŸÑŸÖŸÜÿ≥ŸàÿÆÿ©",
                        "btn_back": "ÿ±ÿ¨Ÿàÿπ",
                        "btn_next": "ÿßŸÑÿ™ÿßŸÑŸä",
                        "btn_summary": "ÿßŸÑŸÖŸÑÿÆÿµ",
                        "btn_save": "ÿ≠ŸÅÿ∏",
                        "btn_load": "ÿ™ÿ≠ŸÖŸäŸÑ",
                        "btn_restart": "ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ®ÿØÿ°",
                        "nfc_success": "ÿ™ŸÖ ŸÜŸÇŸÑ NFC ÿ®ŸÜÿ¨ÿßÿ≠.",
                        "nfc_error": "ÿÆÿ∑ÿ£ ŸÅŸä ŸÜŸÇŸÑ NFC: ",
                        "nfc_simulation": "ÿ™ŸÖÿ™ ŸÖÿ≠ÿßŸÉÿßÿ© NFC. Ÿäÿ™ŸÖ ÿπÿ±ÿ∂ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ© ŸÅŸä ŸÖÿ±ÿ®ÿπ JSON.",
                        "decryption_prompt": "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ¥ŸÅÿ±ÿ©:",
                        "decryption_success": "ÿ™ŸÖ ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ± ÿ®ŸÜÿ¨ÿßÿ≠:",
                        "decryption_error_json": "ÿ™ŸÖ ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ± ÿ®ŸÜÿ¨ÿßÿ≠ÿå ŸÑŸÉŸÜ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ŸÑŸäÿ≥ÿ™ JSON ÿµÿßŸÑÿ≠Ÿãÿß.",
                        "select_placeholder": "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±...",
                        "please_select": "ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±...",
                        "step_of": "ÿßŸÑÿÆÿ∑Ÿàÿ© {current} ŸÖŸÜ {total}",
                        "red_flag_warning": "‚ö†Ô∏è ÿ™ÿ≠ÿ∞Ÿäÿ±: ÿ™ŸÖ ÿßŸÉÿ™ÿ¥ÿßŸÅ ÿ£ÿπÿ±ÿßÿ∂ ŸÖŸáŸÖÿ© ÿ™ÿ™ÿ∑ŸÑÿ® ÿπŸÜÿßŸäÿ© ÿ∑ÿ®Ÿäÿ© ŸÅŸàÿ±Ÿäÿ©!",
                        "medical_concept": "ÿßŸÑŸÖŸÅŸáŸàŸÖ ÿßŸÑÿ∑ÿ®Ÿä: ÿØ. ŸÉÿ±Ÿäÿ≥ÿ™ŸäÿßŸÜ ŸÉŸÑÿßÿ®ÿ±Ÿàÿ™",
                        "technical_implementation": "ÿßŸÑÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑÿ™ŸÇŸÜŸä: DiggAi GmbH",
                        "0003_tag": "ŸäŸàŸÖ",
                        "0003_monat": "ÿ¥Ÿáÿ±",
                        "0003_jahr": "ÿ≥ŸÜÿ©",
                        "label_0003": "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ ŸäŸàŸÖ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ÿ¥Ÿáÿ± 1 2 3 4 5 6 7 8 9 10 11 12 ÿ≥ŸÜÿ© 2025 2024 2023 2022 2021 2020 2019 2018 2017 2016 2015 2014 2013 2012 2011 2010 2009 2008 2007 2006 2005 2004 2003 2002 2001 2000 1999 1998 1997 1996 1995 1994 1993 1992 1991 1990 1989 1988 1987 1986 1985 1984 1983 1982 1981 1980 1979 1978 1977 1976 1975 1974 1973 1972 1971 1970 1969 1968 1967 1966 1965 1964 1963 1962 1961 1960 1959 1958 1957 1956 1955 1954 1953 1952 1951 1950 1949 1948 1947 1946 1945 1944 1943 1942 1941 1940 1939 1938 1937 1936 1935 1934 1933 1932 1931 1930 1929 1928 1927 1926 1925"
                },
                "fa": {
                        "title_q0000": "ÿßÿ∑ŸÑÿßÿπÿßÿ™ Ÿæÿß€åŸá",
                        "label_0000": "ŸÜÿßŸÖ ÿÆÿßŸÜŸàÿßÿØ⁄Ø€å",
                        "label_0001": "ŸÜÿßŸÖ",
                        "label_0002": "ÿ¨ŸÜÿ≥€åÿ™",
                        "label_0003_tag": "ÿ±Ÿàÿ≤",
                        "label_0003_monat": "ŸÖÿßŸá",
                        "label_0003_jahr": "ÿ≥ÿßŸÑ",
                        "app_title": "Ÿæÿ±ÿ≥ÿ¥ŸÜÿßŸÖŸá ÿ™ÿßÿ±€åÿÆ⁄ÜŸá Ÿæÿ≤ÿ¥⁄©€å",
                        "privacy_notice": "ÿßÿ∑ŸÑÿßÿπ€åŸá ÿ≠ÿ±€åŸÖ ÿÆÿµŸàÿµ€å",
                        "privacy_text": "ÿß€åŸÜ ÿ®ÿ±ŸÜÿßŸÖŸá ÿØÿßÿØŸá‚ÄåŸáÿß€å ÿ≥ŸÑÿßŸÖÿ™ ÿ¥ŸÖÿß ÿ±ÿß ŸÅŸÇÿ∑ ÿ®Ÿá ÿµŸàÿ±ÿ™ ŸÖÿ≠ŸÑ€å ÿ®ÿ± ÿ±Ÿà€å ÿØÿ≥ÿ™⁄ØÿßŸá ÿ¥ŸÖÿß Ÿæÿ±ÿØÿßÿ≤ÿ¥ ŸÖ€å‚Äå⁄©ŸÜÿØ. Ÿá€å⁄Ü ÿØÿßÿØŸá‚Äåÿß€å ÿ®Ÿá ÿ≥ÿ±Ÿàÿ±Ÿáÿß€å ÿÆÿßÿ±ÿ¨€å ÿßÿ±ÿ≥ÿßŸÑ ŸÜŸÖ€å‚Äåÿ¥ŸàÿØ (ÿ®Ÿá ÿ¨ÿ≤ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å €å⁄©ÿ®ÿßÿ±Ÿá ŸÖÿØŸÑ‚ÄåŸáÿß€å ÿ≤ÿ®ÿßŸÜÿå ÿØÿ± ÿµŸàÿ±ÿ™ ÿßÿ™ÿµÿßŸÑ ÿ®Ÿá ÿß€åŸÜÿ™ÿ±ŸÜÿ™). ÿ®ÿß ⁄©ŸÑ€å⁄© ÿ®ÿ± ÿ±Ÿà€å 'ŸÇÿ®ŸàŸÑ Ÿà ÿ¥ÿ±Ÿàÿπ' ÿ¥ŸÖÿß ÿ®ÿß Ÿæÿ±ÿØÿßÿ≤ÿ¥ ŸÖÿ≠ŸÑ€å ŸÖŸàÿßŸÅŸÇÿ™ ŸÖ€å‚Äå⁄©ŸÜ€åÿØ.",
                        "accept_start": "ŸÇÿ®ŸàŸÑ Ÿà ÿ¥ÿ±Ÿàÿπ",
                        "disclaimer_medical": "ÿß€åŸÜ €å⁄© ÿßÿ®ÿ≤ÿßÿ± ÿ™ÿßÿ±€åÿÆ⁄ÜŸá Ÿæÿ≤ÿ¥⁄©€å ÿØ€åÿ¨€åÿ™ÿßŸÑ ÿßÿ≥ÿ™ Ÿà ÿ¨ÿß€å⁄Øÿ≤€åŸÜ ŸÖÿπÿß€åŸÜŸá Ÿæÿ≤ÿ¥⁄©€å ŸÜ€åÿ≥ÿ™.",
                        "disclaimer_privacy": "Ÿàÿ±ŸàÿØ€å‚ÄåŸáÿß€å ÿ¥ŸÖÿß ÿ®Ÿá ÿµŸàÿ±ÿ™ ŸÖÿ≠ŸÑ€å ÿ∞ÿÆ€åÿ±Ÿá ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ Ÿà ŸÅŸÇÿ∑ ÿ®Ÿá ÿπŸÜŸàÿßŸÜ ŸÅÿß€åŸÑ ŸÖŸÜÿ™ŸÇŸÑ ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ.",
                        "json_box_title": "Ÿæÿßÿ≥ÿÆ‚ÄåŸáÿß€å ÿ±ŸÖÿ≤⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá (AES-256)",
                        "additional_documents": "ŸÖÿØÿßÿ±⁄© ÿßÿ∂ÿßŸÅ€å",
                        "additional_documents_desc": "ÿ¥ŸÖÿß ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ŸÖÿØÿßÿ±⁄© ÿßÿ∂ÿßŸÅ€å (ÿ™ÿµÿßŸà€åÿ±ÿå ŸÅÿß€åŸÑ‚ÄåŸáÿß€å PDFÿå ŸÅÿß€åŸÑ‚ÄåŸáÿß€å ŸÖÿ™ŸÜ€å) ÿ¢ŸæŸÑŸàÿØ ⁄©ŸÜ€åÿØ. ÿß€åŸÜ‚ÄåŸáÿß ÿ®ÿß OCR Ÿæÿ±ÿØÿßÿ≤ÿ¥ ÿ¥ÿØŸá Ÿà ÿ®Ÿá ÿµŸàÿ±ÿ™ ÿ±ŸÖÿ≤⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá ÿµÿßÿØÿ± ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ.",
                        "upload_documents": "ÿ¢ŸæŸÑŸàÿØ ŸÖÿØÿßÿ±⁄©",
                        "view_documents": "ŸÖÿ¥ÿßŸáÿØŸá ŸÖÿØÿßÿ±⁄©",
                        "delete_documents": "ÿ≠ÿ∞ŸÅ ŸÖÿØÿßÿ±⁄©",
                        "export_encrypted_docs": "ÿµÿßÿØÿ±ÿßÿ™ (ÿ±ŸÖÿ≤⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá + ŸÖÿØÿßÿ±⁄©)",
                        "export_file_enc": "ÿµÿßÿØÿ±ÿßÿ™ (ÿ±ŸÖÿ≤⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá)",
                        "export_file_raw": "ÿµÿßÿØÿ±ÿßÿ™ (JSON ÿÆÿßŸÖ)",
                        "decrypt_data": "ÿ±ŸÖÿ≤⁄Øÿ¥ÿß€å€å ÿØÿßÿØŸá‚ÄåŸáÿß",
                        "export_nfc": "ÿµÿßÿØÿ±ÿßÿ™ (NFC)",
                        "export_email": "ÿµÿßÿØÿ±ÿßÿ™ (ÿß€åŸÖ€åŸÑ + ŸÖÿØÿßÿ±⁄©)",
                        "email_subject": "Ÿæÿßÿ≥ÿÆ‚ÄåŸáÿß€å Ÿæÿ±ÿ≥ÿ¥ŸÜÿßŸÖŸá Ÿæÿ≤ÿ¥⁄©€å",
                        "email_body": "Ÿæ€åŸàÿ≥ÿ™: Ÿæÿßÿ≥ÿÆ‚ÄåŸáÿß€å ÿ±ŸÖÿ≤⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá Ÿæÿ±ÿ≥ÿ¥ŸÜÿßŸÖŸá Ÿæÿ≤ÿ¥⁄©€å:",
                        "summary_title": "ÿÆŸÑÿßÿµŸá ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ¥ŸÖÿß",
                        "summary_desc": "ÿ®ÿ±ÿß€å Ÿæÿ±ÿ¥ ÿ®Ÿá ÿ≥ŸàÿßŸÑÿå ÿ±Ÿà€å Ÿáÿ± Ÿàÿ±ŸàÿØ€å ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ.",
                        "export_full": "ÿµÿßÿØÿ±ÿßÿ™ (⁄©ÿßŸÖŸÑ)",
                        "export_anonymous": "ÿµÿßÿØÿ±ÿßÿ™ (ŸÜÿßÿ¥ŸÜÿßÿ≥)",
                        "transcribed_voice": "Ÿàÿ±ŸàÿØ€å‚ÄåŸáÿß€å ÿµŸàÿ™€å ÿ±ŸàŸÜŸà€åÿ≥€å ÿ¥ÿØŸá",
                        "btn_back": "ÿ®ÿßÿ≤⁄Øÿ¥ÿ™",
                        "btn_next": "ÿ®ÿπÿØ€å",
                        "btn_summary": "ÿÆŸÑÿßÿµŸá",
                        "btn_save": "ÿ∞ÿÆ€åÿ±Ÿá",
                        "btn_load": "ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å",
                        "btn_restart": "ÿ¥ÿ±Ÿàÿπ ŸÖÿ¨ÿØÿØ",
                        "nfc_success": "ÿßŸÜÿ™ŸÇÿßŸÑ NFC ŸÖŸàŸÅŸÇ€åÿ™‚Äåÿ¢ŸÖ€åÿ≤ ÿ®ŸàÿØ.",
                        "nfc_error": "ÿÆÿ∑ÿß ÿØÿ± ÿßŸÜÿ™ŸÇÿßŸÑ NFC: ",
                        "nfc_simulation": "NFC ÿ¥ÿ®€åŸá‚Äåÿ≥ÿßÿ≤€å ÿ¥ÿØ. ÿØÿßÿØŸá‚ÄåŸáÿß€å ÿ±ŸÖÿ≤⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá ÿØÿ± ⁄©ÿßÿØÿ± JSON ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ.",
                        "decryption_prompt": "ŸÑÿ∑ŸÅÿßŸã ÿØÿßÿØŸá‚ÄåŸáÿß€å ÿ±ŸÖÿ≤⁄Øÿ∞ÿßÿ±€å ÿ¥ÿØŸá ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ:",
                        "decryption_success": "ÿ±ŸÖÿ≤⁄Øÿ¥ÿß€å€å ŸÖŸàŸÅŸÇ€åÿ™‚Äåÿ¢ŸÖ€åÿ≤:",
                        "decryption_error_json": "ÿ±ŸÖÿ≤⁄Øÿ¥ÿß€å€å ŸÖŸàŸÅŸÇ€åÿ™‚Äåÿ¢ŸÖ€åÿ≤ ÿ®ŸàÿØÿå ÿßŸÖÿß ŸÜÿ™€åÿ¨Ÿá JSON ŸÖÿπÿ™ÿ®ÿ± ŸÜ€åÿ≥ÿ™.",
                        "select_placeholder": "ŸÑÿ∑ŸÅÿßŸã ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ...",
                        "please_select": "ŸÑÿ∑ŸÅÿßŸã ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ...",
                        "step_of": "ŸÇÿØŸÖ {current} ÿßÿ≤ {total}",
                        "red_flag_warning": "‚ö†Ô∏è Ÿáÿ¥ÿØÿßÿ±: ÿπŸÑÿßÿ¶ŸÖ ŸÖŸáŸÖ€å ÿ¥ŸÜÿßÿ≥ÿß€å€å ÿ¥ÿØŸÜÿØ ⁄©Ÿá ŸÜ€åÿßÿ≤ ÿ®Ÿá ŸÖÿ±ÿßŸÇÿ®ÿ™ Ÿæÿ≤ÿ¥⁄©€å ŸÅŸàÿ±€å ÿØÿßÿ±ŸÜÿØ!",
                        "medical_concept": "ŸÖŸÅŸáŸàŸÖ Ÿæÿ≤ÿ¥⁄©€å: ÿØ⁄©ÿ™ÿ± ⁄©ÿ±€åÿ≥ÿ™€åÿßŸÜ ⁄©ŸÑÿßŸæÿ±Ÿàÿ™",
                        "technical_implementation": "Ÿæ€åÿßÿØŸá‚Äåÿ≥ÿßÿ≤€å ŸÅŸÜ€å: DiggAi GmbH",
                        "0003_tag": "ÿ±Ÿàÿ≤",
                        "0003_monat": "ŸÖÿßŸá",
                        "0003_jahr": "ÿ≥ÿßŸÑ",
                        "label_0003": "ÿ™ÿßÿ±€åÿÆ ÿ™ŸàŸÑÿØ ÿ±Ÿàÿ≤ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ŸÖÿßŸá 1 2 3 4 5 6 7 8 9 10 11 12 ÿ≥ÿßŸÑ 2025 2024 2023 2022 2021 2020 2019 2018 2017 2016 2015 2014 2013 2012 2011 2010 2009 2008 2007 2006 2005 2004 2003 2002 2001 2000 1999 1998 1997 1996 1995 1994 1993 1992 1991 1990 1989 1988 1987 1986 1985 1984 1983 1982 1981 1980 1979 1978 1977 1976 1975 1974 1973 1972 1971 1970 1969 1968 1967 1966 1965 1964 1963 1962 1961 1960 1959 1958 1957 1956 1955 1954 1953 1952 1951 1950 1949 1948 1947 1946 1945 1944 1943 1942 1941 1940 1939 1938 1937 1936 1935 1934 1933 1932 1931 1930 1929 1928 1927 1926 1925"
                },
                "ur": {
                        "title_q0000": "ÿ®ŸÜ€åÿßÿØ€å ŸÖÿπŸÑŸàŸÖÿßÿ™",
                        "label_0000": "ÿÆÿßŸÜÿØÿßŸÜ€å ŸÜÿßŸÖ",
                        "label_0001": "Ÿæ€ÅŸÑÿß ŸÜÿßŸÖ",
                        "label_0002": "ÿ¨ŸÜÿ≥",
                        "label_0003_tag": "ÿØŸÜ",
                        "label_0003_monat": "ŸÖ€Å€åŸÜ€Å",
                        "label_0003_jahr": "ÿ≥ÿßŸÑ",
                        "app_title": "ÿ∑ÿ®€å ÿ™ÿßÿ±€åÿÆ ⁄©ÿß ÿ≥ŸàÿßŸÑŸÜÿßŸÖ€Å",
                        "privacy_notice": "ÿ±ÿßÿ≤ÿØÿßÿ±€å ⁄©ÿß ŸÜŸàŸπÿ≥",
                        "privacy_text": "€å€Å ÿß€åŸæŸÑ€å⁄©€åÿ¥ŸÜ ÿ¢Ÿæ ⁄©€í ÿµÿ≠ÿ™ ⁄©€í ⁄à€åŸπÿß ⁄©Ÿà ÿµÿ±ŸÅ ÿ¢Ÿæ ⁄©€í ⁄à€åŸàÿßÿ¶ÿ≥ Ÿæÿ± ŸÖŸÇÿßŸÖ€å ÿ∑Ÿàÿ± Ÿæÿ± Ÿæÿ±Ÿàÿ≥€åÿ≥ ⁄©ÿ±ÿ™€å €Å€í€î ⁄©Ÿàÿ¶€å ⁄à€åŸπÿß ÿ®€åÿ±ŸàŸÜ€å ÿ≥ÿ±Ÿàÿ±ÿ≤ ⁄©Ÿà ŸÜ€Å€å⁄∫ ÿ®⁄æ€åÿ¨ÿß ÿ¨ÿßÿ™ÿß (ÿ≥Ÿàÿßÿ¶€í ÿß€å⁄© ÿ®ÿßÿ± ÿ≤ÿ®ÿßŸÜ ⁄©€í ŸÖÿß⁄àŸÑÿ≤ ŸÑŸà⁄à ⁄©ÿ±ŸÜ€í ⁄©€íÿå ÿß⁄Øÿ± ÿ¢ŸÜ ŸÑÿßÿ¶ŸÜ €ÅŸà⁄∫)€î 'ŸÇÿ®ŸàŸÑ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫' Ÿæÿ± ⁄©ŸÑ⁄© ⁄©ÿ±⁄©€í ÿ¢Ÿæ ŸÖŸÇÿßŸÖ€å Ÿæÿ±Ÿàÿ≥€åÿ≥ŸÜ⁄Ø ÿ≥€í ÿßÿ™ŸÅÿßŸÇ ⁄©ÿ±ÿ™€í €Å€å⁄∫€î",
                        "accept_start": "ŸÇÿ®ŸàŸÑ ⁄©ÿ±€å⁄∫ ÿßŸàÿ± ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫",
                        "disclaimer_medical": "€å€Å ÿß€å⁄© ⁄à€åÿ¨€åŸπŸÑ ÿ∑ÿ®€å ÿ™ÿßÿ±€åÿÆ ⁄©ÿß ŸπŸàŸÑ €Å€í ÿßŸàÿ± ÿ∑ÿ®€å ŸÖÿπÿßÿ¶ŸÜ€í ⁄©€å ÿ¨⁄Ø€Å ŸÜ€Å€å⁄∫ ŸÑ€åÿ™ÿß€î",
                        "disclaimer_privacy": "ÿ¢Ÿæ ⁄©€í ÿßŸÜÿØÿ±ÿßÿ¨ÿßÿ™ ŸÖŸÇÿßŸÖ€å ÿ∑Ÿàÿ± Ÿæÿ± ŸÖÿ≠ŸÅŸàÿ∏ €Å€å⁄∫ ÿßŸàÿ± ÿµÿ±ŸÅ ÿß€å⁄© ŸÅÿßÿ¶ŸÑ ⁄©€í ÿ∑Ÿàÿ± Ÿæÿ± ŸÖŸÜÿ™ŸÇŸÑ €ÅŸàÿ™€í €Å€å⁄∫€î",
                        "json_box_title": "ÿÆŸÅ€å€Å ⁄©ÿ±ÿØ€Å ÿ¨Ÿàÿßÿ®ÿßÿ™ (AES-256)",
                        "additional_documents": "ÿßÿ∂ÿßŸÅ€å ÿØÿ≥ÿ™ÿßŸà€åÿ≤ÿßÿ™",
                        "additional_documents_desc": "ÿ¢Ÿæ ÿßÿ∂ÿßŸÅ€å ÿØÿ≥ÿ™ÿßŸà€åÿ≤ÿßÿ™ (ÿ™ÿµÿßŸà€åÿ±ÿå PDFsÿå Ÿπ€å⁄©ÿ≥Ÿπ ŸÅÿßÿ¶ŸÑ€å⁄∫) ÿßŸæ ŸÑŸà⁄à ⁄©ÿ± ÿ≥⁄©ÿ™€í €Å€å⁄∫€î €å€Å OCR ÿ≥€í Ÿæÿ±Ÿàÿ≥€åÿ≥ €ÅŸà⁄∫ ⁄Ø€å ÿßŸàÿ± ÿÆŸÅ€å€Å ⁄©ÿ±⁄©€í ÿ®ÿ±ÿ¢ŸÖÿØ €ÅŸà⁄∫ ⁄Ø€å€î",
                        "upload_documents": "ÿØÿ≥ÿ™ÿßŸà€åÿ≤ÿßÿ™ ÿßŸæ ŸÑŸà⁄à ⁄©ÿ±€å⁄∫",
                        "view_documents": "ÿØÿ≥ÿ™ÿßŸà€åÿ≤ÿßÿ™ ÿØ€å⁄©⁄æ€å⁄∫",
                        "delete_documents": "ÿØÿ≥ÿ™ÿßŸà€åÿ≤ÿßÿ™ ÿ≠ÿ∞ŸÅ ⁄©ÿ±€å⁄∫",
                        "export_encrypted_docs": "ÿ®ÿ±ÿ¢ŸÖÿØ ⁄©ÿ±€å⁄∫ (ÿÆŸÅ€å€Å + ÿØÿ≥ÿ™ÿßŸà€åÿ≤ÿßÿ™)",
                        "export_file_enc": "ÿ®ÿ±ÿ¢ŸÖÿØ ⁄©ÿ±€å⁄∫ (ÿÆŸÅ€å€Å)",
                        "export_file_raw": "ÿ®ÿ±ÿ¢ŸÖÿØ ⁄©ÿ±€å⁄∫ (ÿÆÿßŸÖ JSON)",
                        "decrypt_data": "⁄à€åŸπÿß ⁄©Ÿà ⁄à⁄©ÿ±ŸæŸπ ⁄©ÿ±€å⁄∫",
                        "export_nfc": "ÿ®ÿ±ÿ¢ŸÖÿØ ⁄©ÿ±€å⁄∫ (NFC)",
                        "export_email": "ÿ®ÿ±ÿ¢ŸÖÿØ ⁄©ÿ±€å⁄∫ (ÿß€å ŸÖ€åŸÑ + ÿØÿ≥ÿ™ÿßŸà€åÿ≤ÿßÿ™)",
                        "email_subject": "ÿ∑ÿ®€å ÿ≥ŸàÿßŸÑŸÜÿßŸÖ€í ⁄©€í ÿ¨Ÿàÿßÿ®ÿßÿ™",
                        "email_body": "ŸÖŸÜÿ≥ŸÑ⁄©: ÿÆŸÅ€å€Å ⁄©ÿ±ÿØ€Å ÿ∑ÿ®€å ÿ≥ŸàÿßŸÑŸÜÿßŸÖ€í ⁄©€í ÿ¨Ÿàÿßÿ®ÿßÿ™:",
                        "summary_title": "ÿ¢Ÿæ ⁄©€å ŸÖÿπŸÑŸàŸÖÿßÿ™ ⁄©ÿß ÿÆŸÑÿßÿµ€Å",
                        "summary_desc": "ÿ≥ŸàÿßŸÑ Ÿæÿ± ÿ¨ÿßŸÜ€í ⁄©€í ŸÑ€å€í ⁄©ÿ≥€å ÿ®⁄æ€å ÿßŸÜÿØÿ±ÿßÿ¨ Ÿæÿ± ⁄©ŸÑ⁄© ⁄©ÿ±€å⁄∫€î",
                        "export_full": "ÿ®ÿ±ÿ¢ŸÖÿØ ⁄©ÿ±€å⁄∫ (ŸÖ⁄©ŸÖŸÑ)",
                        "export_anonymous": "ÿ®ÿ±ÿ¢ŸÖÿØ ⁄©ÿ±€å⁄∫ (⁄ØŸÖŸÜÿßŸÖ)",
                        "transcribed_voice": "ŸÜŸÇŸÑ ÿ¥ÿØ€Å ÿ¢Ÿàÿßÿ≤ ⁄©€í ÿßŸÜÿØÿ±ÿßÿ¨ÿßÿ™",
                        "btn_back": "ŸàÿßŸæÿ≥",
                        "btn_next": "ÿß⁄ØŸÑÿß",
                        "btn_summary": "ÿÆŸÑÿßÿµ€Å",
                        "btn_save": "ŸÖÿ≠ŸÅŸàÿ∏ ⁄©ÿ±€å⁄∫",
                        "btn_load": "ŸÑŸà⁄à ⁄©ÿ±€å⁄∫",
                        "btn_restart": "ÿØŸàÿ®ÿßÿ±€Å ÿ¥ÿ±Ÿàÿπ ⁄©ÿ±€å⁄∫",
                        "nfc_success": "NFC ŸÖŸÜÿ™ŸÇŸÑ€å ⁄©ÿßŸÖ€åÿßÿ® ÿ±€Å€å€î",
                        "nfc_error": "NFC ŸÖŸÜÿ™ŸÇŸÑ€å ŸÖ€å⁄∫ ÿÆÿ±ÿßÿ®€å: ",
                        "nfc_simulation": "NFC ⁄©€å ŸÜŸÇŸÑ ⁄©€å ⁄Øÿ¶€å€î ÿÆŸÅ€å€Å ⁄©ÿ±ÿØ€Å ⁄à€åŸπÿß JSON ÿ®ÿß⁄©ÿ≥ ŸÖ€å⁄∫ ÿØ⁄©⁄æÿß€åÿß ⁄Ø€åÿß €Å€í€î",
                        "decryption_prompt": "ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ÿÆŸÅ€å€Å ⁄©ÿ±ÿØ€Å ⁄à€åŸπÿß ÿØÿ±ÿ¨ ⁄©ÿ±€å⁄∫:",
                        "decryption_success": "⁄à⁄©ÿ±Ÿæÿ¥ŸÜ ⁄©ÿßŸÖ€åÿßÿ®:",
                        "decryption_error_json": "⁄à⁄©ÿ±Ÿæÿ¥ŸÜ ⁄©ÿßŸÖ€åÿßÿ® ÿ±€Å€åÿå ŸÑ€å⁄©ŸÜ ŸÜÿ™€åÿ¨€Å ÿØÿ±ÿ≥ÿ™ JSON ŸÜ€Å€å⁄∫ €Å€í€î",
                        "select_placeholder": "ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫...",
                        "please_select": "ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫...",
                        "step_of": "ŸÇÿØŸÖ {current} ÿßÿ≤ {total}",
                        "red_flag_warning": "‚ö†Ô∏è ÿßŸÜÿ™ÿ®ÿß€Å: ÿß€ÅŸÖ ÿπŸÑÿßŸÖÿßÿ™ ⁄©ÿß Ÿæÿ™€Å ⁄ÜŸÑÿß €Å€í ÿ¨ŸÜ ⁄©Ÿà ŸÅŸàÿ±€å ÿ∑ÿ®€å ÿØ€å⁄©⁄æ ÿ®⁄æÿßŸÑ ⁄©€å ÿ∂ÿ±Ÿàÿ±ÿ™ €Å€í!",
                        "medical_concept": "ÿ∑ÿ®€å ÿ™ÿµŸàÿ±: ⁄àÿß⁄©Ÿπÿ± ⁄©ÿ±ÿ≥⁄ÜŸÜ ⁄©ŸÑÿßŸæÿ±Ÿàÿ™",
                        "technical_implementation": "ÿ™⁄©ŸÜ€å⁄©€å ŸÜŸÅÿßÿ∞: DiggAi GmbH",
                        "0003_tag": "ÿØŸÜ",
                        "0003_monat": "ŸÖ€Å€åŸÜ€Å",
                        "0003_jahr": "ÿ≥ÿßŸÑ",
                        "label_0003": "ÿ™ÿßÿ±€åÿÆ Ÿæ€åÿØÿßÿ¶ÿ¥ ÿØŸÜ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ŸÖ€Å€åŸÜ€Å 1 2 3 4 5 6 7 8 9 10 11 12 ÿ≥ÿßŸÑ 2025 2024 2023 2022 2021 2020 2019 2018 2017 2016 2015 2014 2013 2012 2011 2010 2009 2008 2007 2006 2005 2004 2003 2002 2001 2000 1999 1998 1997 1996 1995 1994 1993 1992 1991 1990 1989 1988 1987 1986 1985 1984 1983 1982 1981 1980 1979 1978 1977 1976 1975 1974 1973 1972 1971 1970 1969 1968 1967 1966 1965 1964 1963 1962 1961 1960 1959 1958 1957 1956 1955 1954 1953 1952 1951 1950 1949 1948 1947 1946 1945 1944 1943 1942 1941 1940 1939 1938 1937 1936 1935 1934 1933 1932 1931 1930 1929 1928 1927 1926 1925"
                },
                "tr": {
                        "app_title": "Tƒ±bbi Ge√ßmi≈ü Anketi",
                        "privacy_notice": "Gizlilik Bildirimi",
                        "privacy_text": "Bu uygulama saƒülƒ±k verilerinizi yalnƒ±zca cihazƒ±nƒ±zda yerel olarak i≈üler. Dƒ±≈ü sunuculara veri aktarƒ±lmaz (√ßevrimi√ßi dil modellerinin bir kerelik y√ºklenmesi hari√ß). 'Kabul Et ve Ba≈üla' se√ßeneƒüine tƒ±klayarak yerel i≈ülemeyi kabul etmi≈ü olursunuz.",
                        "accept_start": "Kabul Et ve Ba≈üla",
                        "additional_documents": "Ek Belgeler",
                        "upload_documents": "Belgeleri Y√ºkle",
                        "view_documents": "Belgeleri G√∂r√ºnt√ºle",
                        "delete_documents": "Belgeleri Sil",
                        "export_encrypted_docs": "Dƒ±≈üa Aktar (≈ûifreli + Belgeler)",
                        "export_file_raw": "Dƒ±≈üa Aktar (Ham JSON)",
                        "decrypt_data": "Verileri √á√∂z",
                        "export_nfc": "Dƒ±≈üa Aktar (NFC)",
                        "export_email": "Dƒ±≈üa Aktar (E-posta + Belgeler)",
                        "transcribed_voice": "Transkribe Edilmi≈ü Ses Giri≈üleri",
                        "encrypted_answers": "≈ûifreli Yanƒ±tlar (AES-256)",
                        "summary_title": "Bilgilerinizin √ñzeti",
                        "summary_desc": "Soruya atlamak i√ßin bir giri≈üe tƒ±klayƒ±n",
                        "btn_back": "Geri",
                        "btn_next": "ƒ∞leri",
                        "btn_summary": "√ñzet",
                        "btn_save": "Kaydet",
                        "btn_load": "Y√ºkle",
                        "btn_restart": "Yeniden Ba≈ülat",
                        "disclaimer_medical": "Bu dijital bir tƒ±bbi ge√ßmi≈ü aracƒ±dƒ±r ve tƒ±bbi muayenenin yerini tutmaz.",
                        "disclaimer_privacy": "Giri≈üleriniz yerel olarak saklanƒ±r ve yalnƒ±zca dosya olarak aktarƒ±lƒ±r.",
                        "medical_concept": "Tƒ±bbi Konsept: Dr. Christian Klapproth",
                        "technical_implementation": "Teknik Uygulama: DiggAi GmbH",
                        "title_q0000": "Temel Veriler",
                        "label_0000": "Soyadƒ±",
                        "label_0001": "Adƒ±",
                        "label_0002": "Cinsiyet",
                        "label_0003_tag": "G√ºn",
                        "label_0003_monat": "Ay",
                        "label_0003_jahr": "Yƒ±l",
                        "json_box_title": "≈ûifreli Yanƒ±tlar (AES-256)",
                        "export_file_enc": "Dƒ±≈üa Aktar (≈ûifreli)",
                        "email_subject": "Anamnez Yanƒ±tlarƒ±",
                        "email_body": "Ekli, ≈üifreli anamnez yanƒ±tlarƒ±dƒ±r:",
                        "nfc_success": "NFC aktarƒ±mƒ± ba≈üarƒ±lƒ±.",
                        "nfc_error": "NFC aktarƒ±m hatasƒ±: ",
                        "nfc_simulation": "NFC sim√ºle edildi. ≈ûifreli veriler JSON kutusunda g√∂r√ºnt√ºlenir.",
                        "decryption_prompt": "L√ºtfen ≈üifreli verileri girin:",
                        "decryption_success": "≈ûifre √ß√∂zme ba≈üarƒ±lƒ±:",
                        "decryption_error_json": "≈ûifre √ß√∂zme ba≈üarƒ±lƒ±, ancak sonu√ß ge√ßerli bir JSON deƒüil.",
                        "select_placeholder": "L√ºtfen se√ßin...",
                        "please_select": "L√ºtfen se√ßin...",
                        "step_of": "Adƒ±m {current} / {total}",
                        "red_flag_warning": "‚ö†Ô∏è Uyarƒ±: Acil tƒ±bbi m√ºdahale gerektiren √∂nemli semptomlar tespit edildi!",
                        "0003_tag": "G√ºn",
                        "0003_monat": "Ay",
                        "0003_jahr": "Yƒ±l"
                },
                "pl": {
                        "app_title": "Ankieta Wywiadu Medycznego",
                        "privacy_notice": "Powiadomienie o Prywatno≈õci",
                        "privacy_text": "Ta aplikacja przetwarza dane zdrowotne wy≈ÇƒÖcznie lokalnie na Twoim urzƒÖdzeniu. ≈ªadne dane nie sƒÖ przesy≈Çane do zewnƒôtrznych serwer√≥w (z wyjƒÖtkiem jednorazowego ≈Çadowania modeli jƒôzykowych online). KlikajƒÖc 'Akceptuj i Rozpocznij' zgadzasz siƒô na lokalne przetwarzanie.",
                        "accept_start": "Akceptuj i Rozpocznij",
                        "additional_documents": "Dodatkowe Dokumenty",
                        "upload_documents": "Prze≈õlij Dokumenty",
                        "view_documents": "Wy≈õwietl Dokumenty",
                        "delete_documents": "Usu≈Ñ Dokumenty",
                        "export_encrypted_docs": "Eksportuj (Zaszyfrowane + Dokumenty)",
                        "export_file_raw": "Eksportuj (Surowy JSON)",
                        "decrypt_data": "Odszyfruj Dane",
                        "export_nfc": "Eksportuj (NFC)",
                        "export_email": "Eksportuj (E-mail + Dokumenty)",
                        "transcribed_voice": "Transkrybowane Wpisy G≈Çosowe",
                        "encrypted_answers": "Zaszyfrowane Odpowiedzi (AES-256)",
                        "summary_title": "Podsumowanie Twoich Informacji",
                        "summary_desc": "Kliknij wpis, aby przej≈õƒá do pytania",
                        "btn_back": "Wstecz",
                        "btn_next": "Dalej",
                        "btn_summary": "Podsumowanie",
                        "btn_save": "Zapisz",
                        "btn_load": "Wczytaj",
                        "btn_restart": "Zacznij od Nowa",
                        "disclaimer_medical": "To cyfrowe narzƒôdzie wywiadu medycznego i nie zastƒôpuje badania lekarskiego.",
                        "disclaimer_privacy": "Twoje wpisy sƒÖ przechowywane lokalnie i przesy≈Çane tylko jako plik.",
                        "medical_concept": "Koncepcja Medyczna: Dr. Christian Klapproth",
                        "technical_implementation": "Realizacja Techniczna: DiggAi GmbH",
                        "title_q0000": "Dane Podstawowe",
                        "label_0000": "Nazwisko",
                        "label_0001": "Imiƒô",
                        "label_0002": "P≈Çeƒá",
                        "label_0003_tag": "Dzie≈Ñ",
                        "label_0003_monat": "MiesiƒÖc",
                        "label_0003_jahr": "Rok",
                        "json_box_title": "Zaszyfrowane Odpowiedzi (AES-256)",
                        "export_file_enc": "Eksportuj (Zaszyfrowane)",
                        "email_subject": "Odpowiedzi na Wywiad Medyczny",
                        "email_body": "Za≈ÇƒÖczone sƒÖ zaszyfrowane odpowiedzi na wywiad medyczny:",
                        "nfc_success": "Transfer NFC pomy≈õlny.",
                        "nfc_error": "B≈ÇƒÖd transferu NFC: ",
                        "nfc_simulation": "NFC symulowane. Zaszyfrowane dane sƒÖ wy≈õwietlane w polu JSON.",
                        "decryption_prompt": "Proszƒô wprowadziƒá zaszyfrowane dane:",
                        "decryption_success": "Odszyfrowanie pomy≈õlne:",
                        "decryption_error_json": "Odszyfrowanie pomy≈õlne, ale wynik nie jest prawid≈Çowym JSON.",
                        "select_placeholder": "Proszƒô wybraƒá...",
                        "please_select": "Proszƒô wybraƒá...",
                        "step_of": "Krok {current} z {total}",
                        "red_flag_warning": "‚ö†Ô∏è Ostrze≈ºenie: Wykryto wa≈ºne objawy wymagajƒÖce natychmiastowej uwagi medycznej!",
                        "0003_tag": "Dzie≈Ñ",
                        "0003_monat": "MiesiƒÖc",
                        "0003_jahr": "Rok"
                },
                "nl": {
                        "title_q0000": "Basisgegevens",
                        "label_0000": "Achternaam",
                        "label_0001": "Voornaam",
                        "label_0002": "Geslacht",
                        "app_title": "Medische Anamnese Vragenlijst",
                        "privacy_notice": "Privacyverklaring",
                        "privacy_text": "Deze applicatie verwerkt uw gezondheidsgegevens uitsluitend lokaal op uw apparaat. Er worden geen gegevens verzonden naar externe servers (behalve voor het eenmalig laden van taalmodellen, indien online). Door te klikken op 'Accepteren & Starten' stemt u in met lokale verwerking.",
                        "accept_start": "Accepteren & Starten",
                        "btn_back": "Terug",
                        "btn_next": "Volgende",
                        "btn_summary": "Samenvatting",
                        "btn_save": "Opslaan",
                        "btn_load": "Laden",
                        "btn_restart": "Opnieuw starten",
                        "select_placeholder": "Selecteer alstublieft...",
                        "please_select": "Selecteer alstublieft...",
                        "step_of": "Stap {current} van {total}",
                        "0003_tag": "Dag",
                        "0003_monat": "Maand",
                        "0003_jahr": "Jaar"
                },
                "sq": {
                        "title_q0000": "T√´ dh√´nat baz√´",
                        "label_0000": "Mbiemri",
                        "label_0001": "Emri",
                        "label_0002": "Gjinia",
                        "app_title": "Pyet√´sori i Historis√´ Mjek√´sore",
                        "privacy_notice": "Njoftimi i Privat√´sis√´",
                        "privacy_text": "Ky aplikacion p√´rpunon t√´ dh√´nat tuaja sh√´ndet√´sore vet√´m lokalisht n√´ pajisjen tuaj. Asnj√´ t√´ dh√´n√´ nuk transmetohet n√´ server√´ t√´ jasht√´m (p√´rve√ß ngarkimit nj√´her√´sh t√´ modeleve gjuh√´sore, n√´se jeni online). Duke klikuar 'Prano & Fillo' ju pranoni p√´rpunimin lokal.",
                        "accept_start": "Prano & Fillo",
                        "btn_back": "Prapa",
                        "btn_next": "P√´rpara",
                        "btn_summary": "P√´rmbledhje",
                        "btn_save": "Ruaj",
                        "btn_load": "Ngarko",
                        "btn_restart": "Filloni p√´rs√´ri",
                        "select_placeholder": "Ju lutem zgjidhni...",
                        "please_select": "Ju lutem zgjidhni...",
                        "step_of": "Hapi {current} nga {total}",
                        "0003_tag": "Dita",
                        "0003_monat": "Muaji",
                        "0003_jahr": "Viti"
                },
                "ro": {
                        "title_q0000": "Date de bazƒÉ",
                        "label_0000": "Nume de familie",
                        "label_0001": "Prenume",
                        "label_0002": "Sex",
                        "app_title": "Chestionar de AnamnezƒÉ MedicalƒÉ",
                        "privacy_notice": "Notificare de confiden»õialitate",
                        "privacy_text": "AceastƒÉ aplica»õie proceseazƒÉ datele dumneavoastrƒÉ de sƒÉnƒÉtate exclusiv local pe dispozitivul dumneavoastrƒÉ. Nu se transmit date cƒÉtre servere externe (cu excep»õia √ÆncƒÉrcƒÉrii unice a modelelor de limbƒÉ, dacƒÉ sunte»õi online). FƒÉc√¢nd clic pe 'Acceptare & √éncepere' sunte»õi de acord cu procesarea localƒÉ.",
                        "accept_start": "Acceptare & √éncepere",
                        "btn_back": "√énapoi",
                        "btn_next": "UrmƒÉtorul",
                        "btn_summary": "Rezumat",
                        "btn_save": "Salvare",
                        "btn_load": "√éncƒÉrcare",
                        "btn_restart": "Repornire",
                        "select_placeholder": "VƒÉ rugƒÉm sƒÉ selecta»õi...",
                        "please_select": "VƒÉ rugƒÉm sƒÉ selecta»õi...",
                        "step_of": "Pasul {current} din {total}",
                        "0003_tag": "Zi",
                        "0003_monat": "LunƒÉ",
                        "0003_jahr": "An"
                },
                "hi": {
                        "title_q0000": "‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§°‡•á‡§ü‡§æ",
                        "label_0000": "‡§â‡§™‡§®‡§æ‡§Æ",
                        "label_0001": "‡§™‡•ç‡§∞‡§•‡§Æ ‡§®‡§æ‡§Æ",
                        "label_0002": "‡§≤‡§ø‡§Ç‡§ó",
                        "app_title": "‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡§æ‡§µ‡§≤‡•Ä",
                        "privacy_notice": "‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ",
                        "privacy_text": "‡§Ø‡§π ‡§è‡§™‡•ç‡§≤‡§ø‡§ï‡•á‡§∂‡§® ‡§Ü‡§™‡§ï‡•á ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§ï‡•á‡§µ‡§≤ ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§™‡§∞ ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§™‡§∞ ‡§™‡•ç‡§∞‡§∏‡§æ‡§∞‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à (‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•â‡§°‡§≤ ‡§ï‡•Ä ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§≤‡•ã‡§°‡§ø‡§Ç‡§ó ‡§ï‡•ã ‡§õ‡•ã‡§°‡§º‡§ï‡§∞, ‡§Ø‡§¶‡§ø ‡§ë‡§®‡§≤‡§æ‡§á‡§® ‡§π‡•à)‡•§ '‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§ï‡§∞‡•á‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§ï‡•á ‡§Ü‡§™ ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§™‡•ç‡§∞‡§∏‡§Ç‡§∏‡•ç‡§ï‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§π‡§Æ‡§§ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§",
                        "accept_start": "‡§∏‡•ç‡§µ‡•Ä‡§ï‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§ï‡§∞‡•á‡§Ç",
                        "btn_back": "‡§µ‡§æ‡§™‡§∏",
                        "btn_next": "‡§Ü‡§ó‡•á",
                        "btn_summary": "‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂",
                        "btn_save": "‡§∏‡§π‡•á‡§ú‡•á‡§Ç",
                        "btn_load": "‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
                        "btn_restart": "‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠ ‡§ï‡§∞‡•á‡§Ç",
                        "select_placeholder": "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç...",
                        "please_select": "‡§ï‡•É‡§™‡§Ø‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç...",
                        "step_of": "‡§ö‡§∞‡§£ {current} ‡§ï‡§æ {total}",
                        "0003_tag": "‡§¶‡§ø‡§®",
                        "0003_monat": "‡§Æ‡§π‡•Ä‡§®‡§æ",
                        "0003_jahr": "‡§µ‡§∞‡•ç‡§∑"
                },
                "ja": {
                        "title_q0000": "Âü∫Êú¨„Éá„Éº„Çø",
                        "label_0000": "Âßì",
                        "label_0001": "Âêç",
                        "label_0002": "ÊÄßÂà•",
                        "app_title": "ÂåªÁôÇÂïèË®∫Á•®",
                        "privacy_notice": "„Éó„É©„Ç§„Éê„Ç∑„ÉºÈÄöÁü•",
                        "privacy_text": "„Åì„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅØ„ÄÅ„ÅäÂÆ¢Êßò„ÅÆÂÅ•Â∫∑„Éá„Éº„Çø„Çí„ÅäÂÆ¢Êßò„ÅÆ„Éá„Éê„Ç§„Çπ‰∏ä„Åß„É≠„Éº„Ç´„É´„Å´„ÅÆ„ÅøÂá¶ÁêÜ„Åó„Åæ„Åô„ÄÇÂ§ñÈÉ®„Çµ„Éº„Éê„Éº„Å´„Éá„Éº„Çø„ÅåÈÄÅ‰ø°„Åï„Çå„Çã„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åõ„ÇìÔºà„Ç™„É≥„É©„Ç§„É≥„ÅÆÂ†¥Âêà„ÄÅË®ÄË™û„É¢„Éá„É´„ÅÆ1ÂõûÈôê„Çä„ÅÆË™≠„ÅøËæº„Åø„ÇíÈô§„ÅèÔºâ„ÄÇ„ÄåÂêåÊÑè„Åó„Å¶ÈñãÂßã„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Åì„Å®„Åß„ÄÅ„É≠„Éº„Ç´„É´Âá¶ÁêÜ„Å´ÂêåÊÑè„Åó„Åü„Åì„Å®„Å´„Å™„Çä„Åæ„Åô„ÄÇ",
                        "accept_start": "ÂêåÊÑè„Åó„Å¶ÈñãÂßã",
                        "btn_back": "Êàª„Çã",
                        "btn_next": "Ê¨°„Å∏",
                        "btn_summary": "Ê¶ÇË¶Å",
                        "btn_save": "‰øùÂ≠ò",
                        "btn_load": "Ë™≠„ÅøËæº„Åø",
                        "btn_restart": "ÂÜçÈñã",
                        "select_placeholder": "ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",
                        "please_select": "ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ...",
                        "step_of": "„Çπ„ÉÜ„ÉÉ„Éó {current} / {total}",
                        "0003_tag": "Êó•",
                        "0003_monat": "Êúà",
                        "0003_jahr": "Âπ¥"
                }
        },
        "red_flag_fields": [],
        "sections": [
                {
                        "id": "q0000",
                        "title": "Basisdaten",
                        "fields": [
                                {
                                        "id": "0000",
                                        "type": "text",
                                        "label": "Nachname",
                                        "required": true
                                },
                                {
                                        "id": "0001",
                                        "type": "text",
                                        "label": "Vorname",
                                        "required": true
                                },
                                {
                                        "id": "0002",
                                        "type": "select",
                                        "label": "Geschlecht",
                                        "required": true,
                                        "options": [
                                                "m√§nnlich",
                                                "weiblich",
                                                "divers/wei√ü",
                                                "nicht"
                                        ]
                                },
                                {
                                        "id": "0003_tag",
                                        "type": "select",
                                        "label": "0003_tag",
                                        "required": true
                                },
                                {
                                        "id": "0003_monat",
                                        "type": "select",
                                        "label": "0003_monat",
                                        "required": true
                                },
                                {
                                        "id": "0003_jahr",
                                        "type": "select",
                                        "label": "0003_jahr",
                                        "required": true
                                }
                        ]
                },
                {
                        "id": "q1A00",
                        "title": "Welche Augenbeschwerden haben Sie?",
                        "fields": [
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Aderhautr√∂tung",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Blendempfindlichkeit",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Doppelbilder",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "eingeschr√§nkte Beweglichkeit",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Gesichtsfeldausf√§lle",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Lichtblitze",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Lidschluss nicht m√∂glich",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Rotes schmerzhaftes Auge",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Ru√üregen",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "pl√∂tzlicher Sehverlust",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Schmerz hinter dem Auge",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Schwellung und R√∂tung",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "vermehrter Tr√§nenfluss",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "verminderte Augenbeweglichkeit",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "verschwommenes/unscharfes Sehen",
                                        "required": false
                                },
                                {
                                        "id": "1A00",
                                        "type": "checkbox",
                                        "label": "Schleiersehen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1B00",
                        "title": "Welche HNO-Beschwerden haben Sie?",
                        "fields": [
                                {
                                        "id": "1B00",
                                        "type": "checkbox",
                                        "label": "H√∂rst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "1B00",
                                        "type": "checkbox",
                                        "label": "Nase",
                                        "required": false
                                },
                                {
                                        "id": "1B00",
                                        "type": "checkbox",
                                        "label": "Ohren",
                                        "required": false
                                },
                                {
                                        "id": "1B00",
                                        "type": "checkbox",
                                        "label": "Rachen",
                                        "required": false
                                },
                                {
                                        "id": "1B00",
                                        "type": "checkbox",
                                        "label": "Schlucken",
                                        "required": false
                                },
                                {
                                        "id": "1B00",
                                        "type": "checkbox",
                                        "label": "Schwindel",
                                        "required": false
                                },
                                {
                                        "id": "1B00",
                                        "type": "checkbox",
                                        "label": "Stimmst√∂rung",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1B01",
                        "title": "Art der H√∂rst√∂rung",
                        "fields": [
                                {
                                        "id": "1B01",
                                        "type": "checkbox",
                                        "label": "H√∂rsturz",
                                        "required": false
                                },
                                {
                                        "id": "1B01",
                                        "type": "checkbox",
                                        "label": "√úberempfindlichkeit",
                                        "required": false
                                },
                                {
                                        "id": "1B01",
                                        "type": "checkbox",
                                        "label": "vermindertes H√∂rverm√∂gen",
                                        "required": false
                                },
                                {
                                        "id": "1B01",
                                        "type": "checkbox",
                                        "label": "Ohrger√§usche/Tinnitus",
                                        "required": false
                                },
                                {
                                        "id": "1B01",
                                        "type": "checkbox",
                                        "label": "Tonh√∂henverzerrung",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1B02",
                        "title": "Art der Nasenst√∂rung",
                        "fields": [
                                {
                                        "id": "1B02",
                                        "type": "checkbox",
                                        "label": "Geruchsst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "1B02",
                                        "type": "checkbox",
                                        "label": "Borkenbildung",
                                        "required": false
                                },
                                {
                                        "id": "1B02",
                                        "type": "checkbox",
                                        "label": "Eiterabsonderung",
                                        "required": false
                                },
                                {
                                        "id": "1B02",
                                        "type": "checkbox",
                                        "label": "Formver√§nderung",
                                        "required": false
                                },
                                {
                                        "id": "1B02",
                                        "type": "checkbox",
                                        "label": "Laufende Nase",
                                        "required": false
                                },
                                {
                                        "id": "1B02",
                                        "type": "checkbox",
                                        "label": "Nasenbluten",
                                        "required": false
                                },
                                {
                                        "id": "1B02",
                                        "type": "checkbox",
                                        "label": "Verstopfte Nase",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1B03",
                        "title": "Art der Ohrenst√∂rung",
                        "fields": [
                                {
                                        "id": "1B03",
                                        "type": "checkbox",
                                        "label": "Ausfluss",
                                        "required": false
                                },
                                {
                                        "id": "1B03",
                                        "type": "checkbox",
                                        "label": "Fremdk√∂rper",
                                        "required": false
                                },
                                {
                                        "id": "1B03",
                                        "type": "checkbox",
                                        "label": "Ohrenbluten",
                                        "required": false
                                },
                                {
                                        "id": "1B03",
                                        "type": "checkbox",
                                        "label": "Ohrmuschelentz√ºndung",
                                        "required": false
                                },
                                {
                                        "id": "1B03",
                                        "type": "checkbox",
                                        "label": "Verstopfte Ohren",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1B04",
                        "title": "Art der Rachenbeschwerden",
                        "fields": [
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Bel√§ge",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Blutung",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Geschwollene Rachenmandeln",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Kratzen",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Halslymphknoten (Schwellung/Schmerzen)",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Heiserkeit",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Hustenreiz",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "Mundgeruch",
                                        "required": false
                                },
                                {
                                        "id": "1B04",
                                        "type": "checkbox",
                                        "label": "R√§usperzwang",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1B05",
                        "title": "Art der Schluckst√∂rungen",
                        "fields": [
                                {
                                        "id": "1B05",
                                        "type": "checkbox",
                                        "label": "Regurgitation",
                                        "required": false
                                },
                                {
                                        "id": "1B05",
                                        "type": "checkbox",
                                        "label": "Fremdk√∂rpergef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1B05",
                                        "type": "checkbox",
                                        "label": "Klo√ügef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1B05",
                                        "type": "checkbox",
                                        "label": "Schluckschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1B05",
                                        "type": "checkbox",
                                        "label": "Steckenbleiben",
                                        "required": false
                                },
                                {
                                        "id": "1B05",
                                        "type": "checkbox",
                                        "label": "Verschlucken",
                                        "required": false
                                },
                                {
                                        "id": "1B05",
                                        "type": "checkbox",
                                        "label": "W√ºrgreiz",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1B06",
                        "title": "Welche Stimmst√∂rung haben Sie?",
                        "fields": [
                                {
                                        "id": "1B06",
                                        "type": "checkbox",
                                        "label": "Abhusten erschwert",
                                        "required": false
                                },
                                {
                                        "id": "1B06",
                                        "type": "checkbox",
                                        "label": "Heiserkeit",
                                        "required": false
                                },
                                {
                                        "id": "1B06",
                                        "type": "checkbox",
                                        "label": "Kraftlose Stimme",
                                        "required": false
                                },
                                {
                                        "id": "1B06",
                                        "type": "checkbox",
                                        "label": "Rauhe Stimme",
                                        "required": false
                                },
                                {
                                        "id": "1B06",
                                        "type": "checkbox",
                                        "label": "Totaler Stimmverlust",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C00",
                        "title": "F√ºhlten Sie sich in den letzten 2 Wochen h√§ufig traurig oder hoffnungslos?",
                        "fields": [
                                {
                                        "id": "1C00",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C00",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C01",
                        "title": "Hatten Sie deutlich weniger Freude an Aktivit√§ten?",
                        "fields": [
                                {
                                        "id": "1C01",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C01",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C02",
                        "title": "F√ºhlten Sie sich oft antriebslos oder ersch√∂pft?",
                        "fields": [
                                {
                                        "id": "1C02",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C02",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C03",
                        "title": "Leiden Sie unter st√§ndiger Nervosit√§t oder Sorgen?",
                        "fields": [
                                {
                                        "id": "1C03",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C03",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C04",
                        "title": "Hatten Sie schon einmal pl√∂tzliche Angstanf√§lle (Herzrasen, Atemnot, Schwindel)?",
                        "fields": [
                                {
                                        "id": "1C04",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C04",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C05",
                        "title": "Vermeiden Sie Orte oder Situationen aus Angst?",
                        "fields": [
                                {
                                        "id": "1C05",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C05",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C06",
                        "title": "Haben Sie Ein- oder Durchschlafst√∂rungen?",
                        "fields": [
                                {
                                        "id": "1C06",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C06",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C07",
                        "title": "F√ºhlen Sie sich morgens unausgeruht?",
                        "fields": [
                                {
                                        "id": "1C07",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C07",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C08",
                        "title": "Haben Sie Schwierigkeiten, sich zu konzentrieren?",
                        "fields": [
                                {
                                        "id": "1C08",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C08",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C09",
                        "title": "Vergessen Sie h√§ufiger Dinge?",
                        "fields": [
                                {
                                        "id": "1C09",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C09",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C10",
                        "title": "H√∂ren oder sehen Sie Dinge, die andere nicht wahrnehmen?",
                        "fields": [
                                {
                                        "id": "1C10",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C10",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C11",
                        "title": "Haben Sie √úberzeugungen, die andere als ungew√∂hnlich ansehen?",
                        "fields": [
                                {
                                        "id": "1C11",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C11",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C12",
                        "title": "Trinken Sie regelm√§√üig Alkohol oder nehmen Sie Drogen/Medikamente au√üerhalb √§rztlicher Vorgaben?",
                        "fields": [
                                {
                                        "id": "1C12",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C12",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C13",
                        "title": "Haben Sie das Gef√ºhl, die Kontrolle √ºber den Konsum zu verlieren?",
                        "fields": [
                                {
                                        "id": "1C13",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C13",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C14",
                        "title": "Hatten Sie schon einmal Gedanken, nicht mehr leben zu wollen?",
                        "fields": [
                                {
                                        "id": "1C14",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C14",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1C15",
                        "title": "Haben Sie konkrete Pl√§ne, sich etwas anzutun?",
                        "fields": [
                                {
                                        "id": "1C15",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1C15",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P00",
                        "title": "Kinder- und Jugendmedizin ¬∑ Basisangaben",
                        "fields": [
                                {
                                        "id": "1P00_geburtsmodus",
                                        "type": "select",
                                        "label": "Wie kam Ihr Kind zur Welt?",
                                        "required": false,
                                        "options": [
                                                "Spontan",
                                                "Sectio",
                                                "Saugglocke",
                                                "Forceps"
                                        ]
                                },
                                {
                                        "id": "1P00_frueh_neonatal",
                                        "type": "checkbox",
                                        "label": "Gab es Startprobleme nach der Geburt? (z. B. Gelbsucht, Atemnot)",
                                        "required": false
                                },
                                {
                                        "id": "1P00_ernaehrung1LJ",
                                        "type": "select",
                                        "label": "Wie wurde Ihr Kind im 1. Jahr ern√§hrt?",
                                        "required": false,
                                        "options": [
                                                "Stillen",
                                                "Mischform",
                                                "(Stillen/Flasche)",
                                                "Flasche",
                                                "Beikost",
                                                "altersgerecht"
                                        ]
                                },
                                {
                                        "id": "1P00_freitext",
                                        "type": "text",
                                        "label": "1P00_freitext",
                                        "required": false
                                },
                                {
                                        "id": "1P00_geburtsgewicht_g",
                                        "type": "text",
                                        "label": "Geburtsgewicht (g)",
                                        "required": false
                                },
                                {
                                        "id": "1P00_geburtslaenge_cm",
                                        "type": "text",
                                        "label": "Geburtsl√§nge (cm)",
                                        "required": false
                                },
                                {
                                        "id": "1P00_ssw",
                                        "type": "text",
                                        "label": "SSW bei Geburt (Wochen+Tage) Format: Wochen+Tage, z. B. 38+0",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P10",
                        "title": "Entwicklung und Wachstum",
                        "fields": [
                                {
                                        "id": "1P10_motorik",
                                        "type": "select",
                                        "label": "Motorik",
                                        "required": false,
                                        "options": [
                                                "Unauff√§llig",
                                                "Verz√∂gert",
                                                "Unsicher"
                                        ]
                                },
                                {
                                        "id": "1P10_sprache",
                                        "type": "select",
                                        "label": "Sprache",
                                        "required": false,
                                        "options": [
                                                "Unauff√§llig",
                                                "Verz√∂gert"
                                        ]
                                },
                                {
                                        "id": "1P10_lernen",
                                        "type": "checkbox",
                                        "label": "Lern- oder Konzentrationsprobleme?",
                                        "required": false
                                },
                                {
                                        "id": "1P10_pubertaet",
                                        "type": "select",
                                        "label": "Beginn der Pubert√§t",
                                        "required": false,
                                        "options": [
                                                "Fr√ºh",
                                                "Normal",
                                                "Sp√§t"
                                        ]
                                },
                                {
                                        "id": "1P10_wachstum",
                                        "type": "select",
                                        "label": "Wachstum bisher",
                                        "required": false,
                                        "options": [
                                                "Unauff√§llig",
                                                "Auff√§llig"
                                        ]
                                },
                                {
                                        "id": "1P10_freitext",
                                        "type": "text",
                                        "label": "1P10_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P20",
                        "title": "Impfstatus und Infektionen",
                        "fields": [
                                {
                                        "id": "1P20_stiko",
                                        "type": "select",
                                        "label": "Impfungen laut STIKO",
                                        "required": false,
                                        "options": [
                                                "Vollst√§ndig",
                                                "Unvollst√§ndig",
                                                "Unbekannt"
                                        ]
                                },
                                {
                                        "id": "1P20_mmrw",
                                        "type": "checkbox",
                                        "label": "Kinderkrankheiten durchgemacht (Masern/Mumps/R√∂teln/Windpocken)",
                                        "required": false
                                },
                                {
                                        "id": "1P20_mmrw_impf",
                                        "type": "checkbox",
                                        "label": "Gegen Kinderkrankheiten geimpft (Masern/Mumps/R√∂teln/Windpocken)",
                                        "required": false
                                },
                                {
                                        "id": "1P20_infekte",
                                        "type": "checkbox",
                                        "label": "Mehr als 6 Infekte pro Jahr?",
                                        "required": false
                                },
                                {
                                        "id": "1P20_hno",
                                        "type": "checkbox",
                                        "label": "Ohrentz√ºndungen wiederkehrend?",
                                        "required": false
                                },
                                {
                                        "id": "1P20_bronchitiden",
                                        "type": "checkbox",
                                        "label": "Bronchitiden wiederkehrend?",
                                        "required": false
                                },
                                {
                                        "id": "1P20_tonsillitis",
                                        "type": "checkbox",
                                        "label": "Mandelentz√ºndungen wiederkehrend?",
                                        "required": false
                                },
                                {
                                        "id": "1P20_freitext",
                                        "type": "text",
                                        "label": "1P20_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P30",
                        "title": "Chronische oder angeborene Erkrankungen",
                        "fields": [
                                {
                                        "id": "1P30_asthma",
                                        "type": "checkbox",
                                        "label": "Asthma bronchiale",
                                        "required": false
                                },
                                {
                                        "id": "1P30_dermatitis",
                                        "type": "checkbox",
                                        "label": "Neurodermitis",
                                        "required": false
                                },
                                {
                                        "id": "1P30_allergien",
                                        "type": "checkbox",
                                        "label": "Allergien/Nahrungsmittelunvertr√§glichkeiten?",
                                        "required": false
                                },
                                {
                                        "id": "1P30_herz",
                                        "type": "checkbox",
                                        "label": "Herzfehler",
                                        "required": false
                                },
                                {
                                        "id": "1P30_stoffwechsel",
                                        "type": "checkbox",
                                        "label": "Stoffwechsel- oder Hormonst√∂rung?",
                                        "required": false
                                },
                                {
                                        "id": "1P30_fehlbildungen",
                                        "type": "checkbox",
                                        "label": "Fehlbildungen/genetische Erkrankungen?",
                                        "required": false
                                },
                                {
                                        "id": "1P30_medikation",
                                        "type": "checkbox",
                                        "label": "Nimmt Ihr Kind regelm√§√üig Medikamente?",
                                        "required": false
                                },
                                {
                                        "id": "1P30_freitext",
                                        "type": "text",
                                        "label": "1P30_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P40",
                        "title": "Soziale und psychische Aspekte",
                        "fields": [
                                {
                                        "id": "1P40_betreuung",
                                        "type": "select",
                                        "label": "Geht Ihr Kind in ‚Ä¶?",
                                        "required": false,
                                        "options": [
                                                "Kindergarten",
                                                "Schule",
                                                "Tagesst√§tte",
                                                "Keine",
                                                "Einrichtung"
                                        ]
                                },
                                {
                                        "id": "1P40_leistung",
                                        "type": "checkbox",
                                        "label": "Schwierigkeiten in Schule/Kita?",
                                        "required": false
                                },
                                {
                                        "id": "1P40_schlaf",
                                        "type": "checkbox",
                                        "label": "Schlafst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1P40_aengste",
                                        "type": "checkbox",
                                        "label": "√Ñngste/auff√§lliges Verhalten?",
                                        "required": false
                                },
                                {
                                        "id": "1P40_familie",
                                        "type": "checkbox",
                                        "label": "Besondere Belastungen zuhause?",
                                        "required": false
                                },
                                {
                                        "id": "1P40_medien",
                                        "type": "select",
                                        "label": "Mediennutzung",
                                        "required": false,
                                        "options": [
                                                "altersgerecht",
                                                "erh√∂ht",
                                                "problematisch"
                                        ]
                                },
                                {
                                        "id": "1P40_bewegung",
                                        "type": "select",
                                        "label": "Freizeit/Bewegung",
                                        "required": false,
                                        "options": [
                                                "ausreichend",
                                                "zu",
                                                "wenig"
                                        ]
                                },
                                {
                                        "id": "1P40_ernaehrung",
                                        "type": "select",
                                        "label": "Ern√§hrung",
                                        "required": false,
                                        "options": [
                                                "ausgewogen",
                                                "verbesserungsbed√ºrftig"
                                        ]
                                },
                                {
                                        "id": "1P40_freitext",
                                        "type": "text",
                                        "label": "1P40_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P51",
                        "title": "Neonatologie ¬∑ Spezialmodul",
                        "fields": [
                                {
                                        "id": "1P51_beatmung",
                                        "type": "checkbox",
                                        "label": "Beatmung, Intensivaufenthalt",
                                        "required": false
                                },
                                {
                                        "id": "P_apgar_1min",
                                        "type": "select",
                                        "label": "Apgar-Wert nach 1 Minute",
                                        "required": true,
                                        "options": [
                                                "0‚Äì3",
                                                "(Poor)",
                                                "4‚Äì6",
                                                "(Mittelgradig",
                                                "beeintr√§chtigt)",
                                                "7‚Äì10",
                                                "(Gut)"
                                        ]
                                },
                                {
                                        "id": "P_apgar_5min",
                                        "type": "select",
                                        "label": "Apgar-Wert nach 5 Minuten",
                                        "required": false,
                                        "options": [
                                                "0‚Äì3",
                                                "(Poor)",
                                                "4‚Äì6",
                                                "(Mittelgradig",
                                                "beeintr√§chtigt)",
                                                "7‚Äì10",
                                                "(Gut)"
                                        ]
                                },
                                {
                                        "id": "P_apgar_10min",
                                        "type": "select",
                                        "label": "Apgar-Wert nach 10 Minuten",
                                        "required": false,
                                        "options": [
                                                "0‚Äì3",
                                                "(Poor)",
                                                "4‚Äì6",
                                                "(Mittelgradig",
                                                "beeintr√§chtigt)",
                                                "7‚Äì10",
                                                "(Gut)"
                                        ]
                                },
                                {
                                        "id": "1P51_freitext",
                                        "type": "text",
                                        "label": "1P51_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P52",
                        "title": "Adoleszenz ¬∑ Spezialmodul",
                        "fields": [
                                {
                                        "id": "1P52_substanz",
                                        "type": "checkbox",
                                        "label": "Substanzgebrauch",
                                        "required": false
                                },
                                {
                                        "id": "1P52_reife",
                                        "type": "select",
                                        "label": "Menarche/Spermarche",
                                        "required": false,
                                        "options": [
                                                "Erfolgt",
                                                "Nicht",
                                                "erfolgt",
                                                "Unklar"
                                        ]
                                },
                                {
                                        "id": "1P52_koerperbild",
                                        "type": "checkbox",
                                        "label": "K√∂rperbild-Thematik",
                                        "required": false
                                },
                                {
                                        "id": "1P52_sexual",
                                        "type": "checkbox",
                                        "label": "Sexualverhalten relevant",
                                        "required": false
                                },
                                {
                                        "id": "1P52_freitext",
                                        "type": "text",
                                        "label": "1P52_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P53",
                        "title": "Allergologie ¬∑ Spezialmodul",
                        "fields": [
                                {
                                        "id": "1P53_atopie_familie",
                                        "type": "checkbox",
                                        "label": "Atopische Familienanamnese",
                                        "required": false
                                },
                                {
                                        "id": "1P53_expo",
                                        "type": "checkbox",
                                        "label": "Expositionsfaktoren",
                                        "required": false
                                },
                                {
                                        "id": "1P53_freitext",
                                        "type": "text",
                                        "label": "1P53_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1P54",
                        "title": "Impfaufkl√§rung ¬∑ Spezialmodul",
                        "fields": [
                                {
                                        "id": "1P54_elternentscheidung",
                                        "type": "checkbox",
                                        "label": "Elternentscheidung dokumentiert",
                                        "required": false
                                },
                                {
                                        "id": "1P54_nebenwirkungen",
                                        "type": "checkbox",
                                        "label": "Dokumentierte Nebenwirkungen",
                                        "required": false
                                },
                                {
                                        "id": "1P54_freitext",
                                        "type": "text",
                                        "label": "1P54_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1000",
                        "title": "Haben Sie aktuell Beschwerden?",
                        "fields": [
                                {
                                        "id": "1000",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1000",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1001",
                        "title": "Wie lange bestehen Ihre Beschwerden?",
                        "condition": {
                                "field": "1000",
                                "value": "Ja",
                                "operator": "=="
                        },
                        "fields": [
                                {
                                        "id": "1001_select",
                                        "type": "select",
                                        "label": "1001_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1002",
                        "title": "Wie h√§ufig treten diese Beschwerden auf?",
                        "condition": {
                                "field": "1000",
                                "value": "Ja",
                                "operator": "=="
                        },
                        "fields": [
                                {
                                        "id": "1002_select",
                                        "type": "select",
                                        "label": "1002_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1003",
                        "title": "Wodurch werden Ihre Beschwerden ausgel√∂st?",
                        "condition": {
                                "field": "1000",
                                "value": "Ja",
                                "operator": "=="
                        },
                        "fields": [
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "Belastung/Gehen",
                                        "required": false
                                },
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "K√§lteexposition",
                                        "required": false
                                },
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "L√§ngeres Stehen oder Sitzen",
                                        "required": false
                                },
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "Nahrungsaufnahme",
                                        "required": false
                                },
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "W√§rme",
                                        "required": false
                                },
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "ohne Ausl√∂ser",
                                        "required": false
                                },
                                {
                                        "id": "1003_freitext",
                                        "type": "text",
                                        "label": "1003_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1004",
                        "title": "Haben sich Ihre Beschwerden ver√§ndert?",
                        "condition": {
                                "field": "1000",
                                "value": "Ja",
                                "operator": "=="
                        },
                        "fields": [
                                {
                                        "id": "1004_select",
                                        "type": "select",
                                        "label": "1004_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1005",
                        "title": "Haben Sie sonstige Auff√§lligkeiten?",
                        "condition": {
                                "field": "1000",
                                "value": "Ja",
                                "operator": "=="
                        },
                        "fields": [
                                {
                                        "id": "1005",
                                        "type": "checkbox",
                                        "label": "Fieber",
                                        "required": false
                                },
                                {
                                        "id": "1005",
                                        "type": "checkbox",
                                        "label": "Kraftlosigkeit",
                                        "required": false
                                },
                                {
                                        "id": "1005",
                                        "type": "checkbox",
                                        "label": "Nachtschwei√ü",
                                        "required": false
                                },
                                {
                                        "id": "1005",
                                        "type": "checkbox",
                                        "label": "ungewollter Gewichtsverlust",
                                        "required": false
                                },
                                {
                                        "id": "1005_freitext",
                                        "type": "text",
                                        "label": "1005_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1006",
                        "title": "Welche Beschwerden haben Sie?",
                        "condition": {
                                "field": "1000",
                                "value": "Ja",
                                "operator": "=="
                        },
                        "fields": [
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Angiologische Beschwerden - Durchblutungsprobleme (Blut und Lymphgef√§√üe)",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Atemwegs- und Lungenbeschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Augenbeschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Haut und Weichteilbeschwerden (z.B. Wunden/Ekzem)",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Herz-Kreislaufbeschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "HNO Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Magen-Darm-Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Metabolische/Hormonelle Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Muskuloskelettale Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Neurologische Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Psychische/Psychosomatische Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1006",
                                        "type": "checkbox",
                                        "label": "Urologische/Gyn√§kologische Beschwerden",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1010",
                        "title": "Welche angiologischen Beschwerden haben Sie?",
                        "condition": {
                                "field": "1006",
                                "value": "Angiologische Beschwerden - Durchblutungsprobleme (Blut und Lymphgef√§√üe)",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1010",
                                        "type": "checkbox",
                                        "label": "Einschr√§nkung der Gehstrecke",
                                        "required": false
                                },
                                {
                                        "id": "1010",
                                        "type": "checkbox",
                                        "label": "Gef√ºhlsst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1010",
                                        "type": "checkbox",
                                        "label": "Venenerkrankungen und Gef√§√üfehlbildungen",
                                        "required": false
                                },
                                {
                                        "id": "1010",
                                        "type": "checkbox",
                                        "label": "√ñdeme",
                                        "required": false
                                },
                                {
                                        "id": "1010",
                                        "type": "checkbox",
                                        "label": "Schmerzen",
                                        "required": false
                                },
                                {
                                        "id": "1010",
                                        "type": "checkbox",
                                        "label": "Wunden/Geschw√ºre",
                                        "required": false
                                },
                                {
                                        "id": "1010",
                                        "type": "checkbox",
                                        "label": "Shuntprobleme",
                                        "required": false
                                },
                                {
                                        "id": "1010_freitext",
                                        "type": "text",
                                        "label": "1010_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1020",
                        "title": "Welche Atembeschwerden haben Sie?",
                        "condition": {
                                "field": "1006",
                                "value": "Atemwegs- und Lungenbeschwerden",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1020",
                                        "type": "checkbox",
                                        "label": "Atemnot",
                                        "required": false
                                },
                                {
                                        "id": "1020",
                                        "type": "checkbox",
                                        "label": "Erk√§ltung",
                                        "required": false
                                },
                                {
                                        "id": "1020",
                                        "type": "checkbox",
                                        "label": "Husten",
                                        "required": false
                                },
                                {
                                        "id": "1020",
                                        "type": "checkbox",
                                        "label": "Infektion mit Fieber (Bronchitis/Lungenentz√ºndung)",
                                        "required": false
                                },
                                {
                                        "id": "1020",
                                        "type": "checkbox",
                                        "label": "N√§chtliche Atemaussetzer",
                                        "required": false
                                },
                                {
                                        "id": "1020",
                                        "type": "checkbox",
                                        "label": "Schnarchen",
                                        "required": false
                                },
                                {
                                        "id": "1020",
                                        "type": "checkbox",
                                        "label": "Beklemmung im Brustkorb",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1030",
                        "title": "Welche Verdauungs-/Bauchbeschwerden haben Sie?",
                        "condition": {
                                "field": "1006",
                                "value": "Magen-Darm-Beschwerden",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1030",
                                        "type": "checkbox",
                                        "label": "Erbrechen",
                                        "required": false
                                },
                                {
                                        "id": "1030",
                                        "type": "checkbox",
                                        "label": "Bauchschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1030",
                                        "type": "checkbox",
                                        "label": "Bl√§hungen",
                                        "required": false
                                },
                                {
                                        "id": "1030",
                                        "type": "checkbox",
                                        "label": "Durchfall",
                                        "required": false
                                },
                                {
                                        "id": "1030",
                                        "type": "checkbox",
                                        "label": "Koliken",
                                        "required": false
                                },
                                {
                                        "id": "1030",
                                        "type": "checkbox",
                                        "label": "Reflux",
                                        "required": false
                                },
                                {
                                        "id": "1030",
                                        "type": "checkbox",
                                        "label": "Verstopfung",
                                        "required": false
                                },
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "keine",
                                        "required": false
                                },
                                {
                                        "id": "1030_freitext",
                                        "type": "text",
                                        "label": "1030_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1040",
                        "title": "Welche Hautver√§nderungen haben Sie?",
                        "fields": [
                                {
                                        "id": "1040",
                                        "type": "checkbox",
                                        "label": "Ausschlag",
                                        "required": false
                                },
                                {
                                        "id": "1040",
                                        "type": "checkbox",
                                        "label": "Ekzem",
                                        "required": false
                                },
                                {
                                        "id": "1040",
                                        "type": "checkbox",
                                        "label": "Juckreiz",
                                        "required": false
                                },
                                {
                                        "id": "1040",
                                        "type": "checkbox",
                                        "label": "Wunden/Geschw√ºre",
                                        "required": false
                                },
                                {
                                        "id": "1040_freitext",
                                        "type": "text",
                                        "label": "1040_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1050",
                        "title": "Welche Herz-Kreislauf Beschwerden haben Sie?",
                        "fields": [
                                {
                                        "id": "1050",
                                        "type": "checkbox",
                                        "label": "Bluthochdruck",
                                        "required": false
                                },
                                {
                                        "id": "1050",
                                        "type": "checkbox",
                                        "label": "Brustschmerz/Angina Pectoris",
                                        "required": false
                                },
                                {
                                        "id": "1050",
                                        "type": "checkbox",
                                        "label": "Herzstolpern",
                                        "required": false
                                },
                                {
                                        "id": "1050",
                                        "type": "checkbox",
                                        "label": "Hypotonie/niedriger Blutdruck",
                                        "required": false
                                },
                                {
                                        "id": "1050",
                                        "type": "checkbox",
                                        "label": "Ohnmachtsanf√§lle/Schwindel",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1060",
                        "title": "Welche hormonell bedingten Beschwerden haben Sie?",
                        "fields": [
                                {
                                        "id": "1060",
                                        "type": "checkbox",
                                        "label": "Gewichtsschwankungen",
                                        "required": false
                                },
                                {
                                        "id": "1060",
                                        "type": "checkbox",
                                        "label": "Appetitst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1060",
                                        "type": "checkbox",
                                        "label": "Osteoporose",
                                        "required": false
                                },
                                {
                                        "id": "1060",
                                        "type": "checkbox",
                                        "label": "polyzystisches Ovar",
                                        "required": false
                                },
                                {
                                        "id": "1060",
                                        "type": "checkbox",
                                        "label": "Hitzewallungen",
                                        "required": false
                                },
                                {
                                        "id": "1060",
                                        "type": "checkbox",
                                        "label": "Wechseljahrbeschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1060_freitext",
                                        "type": "text",
                                        "label": "1060_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1070",
                        "title": "Wo bestehen Beschwerden im Bewegungsapparat?",
                        "fields": [
                                {
                                        "id": "1070",
                                        "type": "checkbox",
                                        "label": "Gelenke",
                                        "required": false
                                },
                                {
                                        "id": "1070",
                                        "type": "checkbox",
                                        "label": "Muskeln",
                                        "required": false
                                },
                                {
                                        "id": "1070",
                                        "type": "checkbox",
                                        "label": "Wirbels√§ule",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1080",
                        "title": "Welche neurologischen Beeintr√§chtigungen haben Sie?",
                        "fields": [
                                {
                                        "id": "1080",
                                        "type": "checkbox",
                                        "label": "Kopfschmerzen",
                                        "required": false
                                },
                                {
                                        "id": "1080",
                                        "type": "checkbox",
                                        "label": "Gef√ºhlsst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1080",
                                        "type": "checkbox",
                                        "label": "Kontrollverlust",
                                        "required": false
                                },
                                {
                                        "id": "1080",
                                        "type": "checkbox",
                                        "label": "Gleichgewicht/Schwindel",
                                        "required": false
                                },
                                {
                                        "id": "1080",
                                        "type": "checkbox",
                                        "label": "Konzentration/Merkf√§higkeit",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1090",
                        "title": "Welche urologischen/gyn√§kologischen St√∂rungen treten auf?",
                        "fields": [
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Schwangerschaftsprobleme",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Abschw√§chung oder erschwertes Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Blutiger Urin",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Brennen beim Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Dranginkontinenz",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Erektionsst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Harndrang",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "H√§ufiges Wasserlassen in kleinen Mengen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Hodenbeschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Nierenkolik",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Restharngef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Retrograder Samenerguss",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Sekretion der Harnr√∂hre",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "√úbelriechender Urin",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Varikozele/Hodenkrampfader",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "h√§ufiges n√§chtliches Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Schwangerschaftsprobleme",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Abschw√§chung oder erschwertes Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Blutiger Urin",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Brennen beim Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Dranginkontinenz",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Harndrang",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "H√§ufiges Wasserlassen in kleinen Mengen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "klimakterische Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Nierenkolik",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Restharngef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "√úbelriechender Urin",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Zyklusst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Vaginaler Ausfluss",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Juckreiz im Genitalbereich",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Dyspareunie (Schmerzen beim Geschlechtsverkehr)",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Postmenopausale Blutung",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Zwischenblutungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "starke oder verl√§ngerte Regelblutungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "schmerzhafte Menstruation",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "h√§ufiges n√§chtliches Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Schwangerschaftsprobleme",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Abschw√§chung oder erschwertes Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Blutiger Urin",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Brennen beim Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Dranginkontinenz",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Erektionsst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Harndrang",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "H√§ufiges Wasserlassen in kleinen Mengen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Hodenbeschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Nierenkolik",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Restharngef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Retrograder Samenerguss",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Sekretion der Harnr√∂hre",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "√úbelriechender Urin",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Varikozele/Hodenkrampfader",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "h√§ufiges n√§chtliches Wasserlassen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "klimakterische Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Zyklusst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Vaginaler Ausfluss",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Juckreiz im Genitalbereich",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Dyspareunie (Schmerzen beim Geschlechtsverkehr)",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Postmenopausale Blutung",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "Zwischenblutungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "starke oder verl√§ngerte Regelblutungen",
                                        "required": false
                                },
                                {
                                        "id": "1090",
                                        "type": "checkbox",
                                        "label": "schmerzhafte Menstruation",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1105",
                        "title": "Fieber ‚Äì Tagesprofil",
                        "condition": {
                                "field": "1005",
                                "value": "Fieber",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1105_tagesprofil",
                                        "type": "radio",
                                        "label": "kontinuierlich",
                                        "required": false
                                },
                                {
                                        "id": "1105_tagesprofil",
                                        "type": "radio",
                                        "label": "remittierend",
                                        "required": false
                                },
                                {
                                        "id": "1105_tagesprofil",
                                        "type": "radio",
                                        "label": "intermittierend",
                                        "required": false
                                },
                                {
                                        "id": "1105_schuettelfrost",
                                        "type": "radio",
                                        "label": "ja",
                                        "required": false
                                },
                                {
                                        "id": "1105_schuettelfrost",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1110",
                        "title": "Gehleistung",
                        "condition": {
                                "field": "1010",
                                "value": "Einschr√§nkung der Gehstrecke",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1110_select",
                                        "type": "select",
                                        "label": "1110_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1111",
                        "title": "Welche der folgenden Venenbeschwerden haben Sie?",
                        "condition": {
                                "field": "1010",
                                "value": "Venenerkrankungen und Gef√§√üfehlbildungen",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1111",
                                        "type": "checkbox",
                                        "label": "Schmerzen entlang geschl√§ngelter Venen",
                                        "required": false
                                },
                                {
                                        "id": "1111",
                                        "type": "checkbox",
                                        "label": "Juckreiz oder Brennen",
                                        "required": false
                                },
                                {
                                        "id": "1111",
                                        "type": "checkbox",
                                        "label": "Im Tagesverlauf zunehmende Schwellneigung",
                                        "required": false
                                },
                                {
                                        "id": "1111",
                                        "type": "checkbox",
                                        "label": "Schwere Beine",
                                        "required": false
                                },
                                {
                                        "id": "1111",
                                        "type": "checkbox",
                                        "label": "Optisch st√∂rend (Besenreiser)",
                                        "required": false
                                },
                                {
                                        "id": "1111",
                                        "type": "checkbox",
                                        "label": "Gef√§√ümalformation (Blutschwamm)",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1112",
                        "title": "Wo treten die √ñdeme auf?",
                        "condition": {
                                "field": "1010",
                                "value": "√ñdeme",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1112",
                                        "type": "checkbox",
                                        "label": "Arme/H√§nde",
                                        "required": false
                                },
                                {
                                        "id": "1112",
                                        "type": "checkbox",
                                        "label": "Gesicht",
                                        "required": false
                                },
                                {
                                        "id": "1112",
                                        "type": "checkbox",
                                        "label": "Fu√ür√ºcken",
                                        "required": false
                                },
                                {
                                        "id": "1112",
                                        "type": "checkbox",
                                        "label": "Kn√∂chel",
                                        "required": false
                                },
                                {
                                        "id": "1112",
                                        "type": "checkbox",
                                        "label": "Waden",
                                        "required": false
                                },
                                {
                                        "id": "1112",
                                        "type": "checkbox",
                                        "label": "Zehen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1113",
                        "title": "Schmerzcharakter",
                        "fields": [
                                {
                                        "id": "1113_select",
                                        "type": "select",
                                        "label": "1113_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1114",
                        "title": "Ordnen Sie Ihre Schmerzen auf einer Skala von 0 ‚Äì 10 ein",
                        "fields": [
                                {
                                        "id": "1114",
                                        "type": "text",
                                        "label": "1114",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1115",
                        "title": "Schmerzlokalisation",
                        "fields": [
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Kopf/Gesicht",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Hals/Nacken",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Brustkorb/Thorax",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Bauch/Abdomen",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Lenden-/Kreuzbereich",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Becken/Genitalbereich",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Schulter/Arm",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Hand/Finger",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "H√ºfte/Oberschenkel",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Knie/Unterschenkel",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "Fu√ü/Zehen",
                                        "required": false
                                },
                                {
                                        "id": "1115",
                                        "type": "checkbox",
                                        "label": "diffus/ganzer K√∂rper",
                                        "required": false
                                },
                                {
                                        "id": "1115_freitext",
                                        "type": "text",
                                        "label": "1115_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1116",
                        "title": "Wo befinden sich die Wunden?",
                        "fields": [
                                {
                                        "id": "1116",
                                        "type": "checkbox",
                                        "label": "Fu√ü",
                                        "required": false
                                },
                                {
                                        "id": "1116",
                                        "type": "checkbox",
                                        "label": "Hand",
                                        "required": false
                                },
                                {
                                        "id": "1116",
                                        "type": "checkbox",
                                        "label": "Rumpf",
                                        "required": false
                                },
                                {
                                        "id": "1116",
                                        "type": "checkbox",
                                        "label": "Unterschenkel",
                                        "required": false
                                },
                                {
                                        "id": "1003",
                                        "type": "checkbox",
                                        "label": "keine",
                                        "required": false
                                },
                                {
                                        "id": "1116_freitext",
                                        "type": "text",
                                        "label": "1116_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1117",
                        "title": "Wie lange besteht die Wunde?",
                        "fields": [
                                {
                                        "id": "1117_select",
                                        "type": "select",
                                        "label": "1117_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1121",
                        "title": "Belastungsbezug der Atemnot",
                        "condition": {
                                "field": "1020",
                                "value": "Atemnot",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "Atemnot nur bei starker Anstrengung",
                                        "required": false
                                },
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "Atemnot beim Eilen auf ebener Strecke oder bei leichter Steigung",
                                        "required": false
                                },
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "Notwendigkeit auf ebener Strecke langsamer zu gehen",
                                        "required": false
                                },
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "Pause nach ~100 m oder wenigen Minuten Gehen",
                                        "required": false
                                },
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "Zu atemlos, um das Haus zu verlassen",
                                        "required": false
                                },
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "Atemnot beim An-/Auskleiden",
                                        "required": false
                                },
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "n√§chtliche Atemnot",
                                        "required": false
                                },
                                {
                                        "id": "1121",
                                        "type": "checkbox",
                                        "label": "Abh√§ngigkeit vom Respirator",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1130",
                        "title": "H√§ufigkeit",
                        "condition": {
                                "field": "1030",
                                "value": "Erbrechen",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1130_freq_per_day",
                                        "type": "text",
                                        "label": "Anzahl Episoden pro Tag",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1131",
                        "title": "Nahrungsabh√§ngigkeit",
                        "fields": [
                                {
                                        "id": "1131_nahrungsabhaengig",
                                        "type": "radio",
                                        "label": "postprandial",
                                        "required": false
                                },
                                {
                                        "id": "1131_nahrungsabhaengig",
                                        "type": "radio",
                                        "label": "n√ºchtern",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1132",
                        "title": "Charakter",
                        "fields": [
                                {
                                        "id": "1132_uebelkeit",
                                        "type": "radio",
                                        "label": "√úbelkeit: Ja",
                                        "required": false
                                },
                                {
                                        "id": "1132_uebelkeit",
                                        "type": "radio",
                                        "label": "√úbelkeit: Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1133",
                        "title": "Inhalt des Erbrochenen",
                        "fields": [
                                {
                                        "id": "1133_inhalt",
                                        "type": "checkbox",
                                        "label": "Nahrungsreste",
                                        "required": false
                                },
                                {
                                        "id": "1133_inhalt",
                                        "type": "checkbox",
                                        "label": "gallig",
                                        "required": false
                                },
                                {
                                        "id": "1133_inhalt",
                                        "type": "checkbox",
                                        "label": "kaffeesatzartig",
                                        "required": false
                                },
                                {
                                        "id": "1133_inhalt",
                                        "type": "checkbox",
                                        "label": "blutig",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1134",
                        "title": "Bauchschmerz",
                        "fields": [
                                {
                                        "id": "1134_ort",
                                        "type": "checkbox",
                                        "label": "epigastrisch",
                                        "required": false
                                },
                                {
                                        "id": "1134_ort",
                                        "type": "checkbox",
                                        "label": "rechter Unterbauch",
                                        "required": false
                                },
                                {
                                        "id": "1134_ort",
                                        "type": "checkbox",
                                        "label": "linker Unterbauch",
                                        "required": false
                                },
                                {
                                        "id": "1134_kolik",
                                        "type": "radio",
                                        "label": "ja",
                                        "required": false
                                },
                                {
                                        "id": "1134_kolik",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1135",
                        "title": "Stuhlgang",
                        "fields": [
                                {
                                        "id": "1135_stuhl",
                                        "type": "checkbox",
                                        "label": "Diarrh√∂",
                                        "required": false
                                },
                                {
                                        "id": "1135_stuhl",
                                        "type": "checkbox",
                                        "label": "Obstipation",
                                        "required": false
                                },
                                {
                                        "id": "1135_stuhl",
                                        "type": "checkbox",
                                        "label": "Meteorismus",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1136",
                        "title": "Fieber/Sch√ºttelfrost",
                        "fields": [
                                {
                                        "id": "1136_fieber",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1136_fieber",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1136a",
                        "title": "Neuro-vestibul√§r",
                        "fields": [
                                {
                                        "id": "1136_neuro",
                                        "type": "checkbox",
                                        "label": "Schwindel: lagewechsel-getriggert",
                                        "required": false
                                },
                                {
                                        "id": "1136_neuro",
                                        "type": "checkbox",
                                        "label": "Doppelbilder",
                                        "required": false
                                },
                                {
                                        "id": "1136_neuro",
                                        "type": "checkbox",
                                        "label": "Nackensteifigkeit",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1136b",
                        "title": "Ausl√∂ser und Exposition",
                        "fields": [
                                {
                                        "id": "1136_expo",
                                        "type": "checkbox",
                                        "label": "verdorbene Speisen",
                                        "required": false
                                },
                                {
                                        "id": "1136_expo",
                                        "type": "checkbox",
                                        "label": "Mitbetroffene",
                                        "required": false
                                },
                                {
                                        "id": "1136_expo",
                                        "type": "checkbox",
                                        "label": "Reise",
                                        "required": false
                                },
                                {
                                        "id": "1136_expo",
                                        "type": "checkbox",
                                        "label": "Kontakt zu Erkrankten",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1137",
                        "title": "Schwangerschaft ausgeschlossen?",
                        "fields": [
                                {
                                        "id": "1137_schwangerschaft",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1137_schwangerschaft",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1141",
                        "title": "Seit wann haben Sie die Hautver√§nderungen?",
                        "fields": [
                                {
                                        "id": "1141_select",
                                        "type": "select",
                                        "label": "1141_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1150",
                        "title": "Schmerzcharakter und Lokalisation",
                        "fields": [
                                {
                                        "id": "1150_qualitaet",
                                        "type": "checkbox",
                                        "label": "dr√ºckend",
                                        "required": false
                                },
                                {
                                        "id": "1150_qualitaet",
                                        "type": "checkbox",
                                        "label": "beklemmend",
                                        "required": false
                                },
                                {
                                        "id": "1150_qualitaet",
                                        "type": "checkbox",
                                        "label": "brennend",
                                        "required": false
                                },
                                {
                                        "id": "1150_qualitaet",
                                        "type": "checkbox",
                                        "label": "stechend",
                                        "required": false
                                },
                                {
                                        "id": "1150_ausstrahlung",
                                        "type": "checkbox",
                                        "label": "linker Arm",
                                        "required": false
                                },
                                {
                                        "id": "1150_ausstrahlung",
                                        "type": "checkbox",
                                        "label": "rechter Arm",
                                        "required": false
                                },
                                {
                                        "id": "1150_ausstrahlung",
                                        "type": "checkbox",
                                        "label": "Schulter",
                                        "required": false
                                },
                                {
                                        "id": "1150_ausstrahlung",
                                        "type": "checkbox",
                                        "label": "R√ºcken",
                                        "required": false
                                },
                                {
                                        "id": "1150_ausstrahlung",
                                        "type": "checkbox",
                                        "label": "Hals/Kiefer",
                                        "required": false
                                },
                                {
                                        "id": "1150_ausstrahlung",
                                        "type": "checkbox",
                                        "label": "epigastrisch",
                                        "required": false
                                },
                                {
                                        "id": "1150_redflags",
                                        "type": "checkbox",
                                        "label": "Anhaltender Druck >20 Minuten",
                                        "required": false
                                },
                                {
                                        "id": "1150_redflags",
                                        "type": "checkbox",
                                        "label": "rasch progredient",
                                        "required": false
                                },
                                {
                                        "id": "1150_redflags",
                                        "type": "checkbox",
                                        "label": "Ruheangina neu",
                                        "required": false
                                },
                                {
                                        "id": "1150_redflags",
                                        "type": "checkbox",
                                        "label": "schlimmster Schmerz",
                                        "required": false
                                },
                                {
                                        "id": "1150_redflags",
                                        "type": "checkbox",
                                        "label": "neu aufgetretene Dyspnoe",
                                        "required": false
                                },
                                {
                                        "id": "1150_redflags",
                                        "type": "checkbox",
                                        "label": "Synkope",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1151",
                        "title": "Trigger/Provokation und Linderung",
                        "fields": [
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "k√∂rperliche Belastung",
                                        "required": false
                                },
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "emotionaler Stress",
                                        "required": false
                                },
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "K√§lte",
                                        "required": false
                                },
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "Wind",
                                        "required": false
                                },
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "schwere Mahlzeiten",
                                        "required": false
                                },
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "Ruheangina vorhanden",
                                        "required": false
                                },
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "morgens in Ruhe",
                                        "required": false
                                },
                                {
                                        "id": "1151_trigger",
                                        "type": "checkbox",
                                        "label": "nachts in Ruhe",
                                        "required": false
                                },
                                {
                                        "id": "1151_ruhebesserung",
                                        "type": "radio",
                                        "label": "ja",
                                        "required": false
                                },
                                {
                                        "id": "1151_ruhebesserung",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                },
                                {
                                        "id": "1151_ntg",
                                        "type": "radio",
                                        "label": "ja",
                                        "required": false
                                },
                                {
                                        "id": "1151_ntg",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                },
                                {
                                        "id": "1151_ntg_min",
                                        "type": "text",
                                        "label": "Wirkung von sublingualem Nitroglyzerin? ja nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1152",
                        "title": "Zeitprofil",
                        "fields": [
                                {
                                        "id": "1152_dauer_min",
                                        "type": "text",
                                        "label": "Dauer einer Episode (Minuten)",
                                        "required": false
                                },
                                {
                                        "id": "1152_verlauf_select",
                                        "type": "select",
                                        "label": "Verlauf",
                                        "required": false,
                                        "options": [
                                                "neu",
                                                "progredient",
                                                "gleichbleibend"
                                        ]
                                },
                                {
                                        "id": "1152_erstauftreten_select",
                                        "type": "select",
                                        "label": "Erstauftreten seit wann",
                                        "required": false,
                                        "options": [
                                                "akut",
                                                "wenige",
                                                "Tage",
                                                "l√§nger",
                                                "als",
                                                "1",
                                                "Woche"
                                        ]
                                }
                        ]
                },
                {
                        "id": "q1153",
                        "title": "Begleitsymptome und nicht-isch√§mische Hinweise",
                        "fields": [
                                {
                                        "id": "1153_begleit",
                                        "type": "checkbox",
                                        "label": "Dyspnoe",
                                        "required": false
                                },
                                {
                                        "id": "1153_begleit",
                                        "type": "checkbox",
                                        "label": "Schwitzen",
                                        "required": false
                                },
                                {
                                        "id": "1153_begleit",
                                        "type": "checkbox",
                                        "label": "√úbelkeit/Erbrechen",
                                        "required": false
                                },
                                {
                                        "id": "1153_begleit",
                                        "type": "checkbox",
                                        "label": "Schwindel/Pr√§synkope/Synkope",
                                        "required": false
                                },
                                {
                                        "id": "1153_begleit",
                                        "type": "checkbox",
                                        "label": "Palpitationen",
                                        "required": false
                                },
                                {
                                        "id": "1153_nicht_isch",
                                        "type": "checkbox",
                                        "label": "atemabh√§ngig",
                                        "required": false
                                },
                                {
                                        "id": "1153_nicht_isch",
                                        "type": "checkbox",
                                        "label": "lageabh√§ngig",
                                        "required": false
                                },
                                {
                                        "id": "1153_nicht_isch",
                                        "type": "checkbox",
                                        "label": "Palpationsschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1153_nicht_isch",
                                        "type": "checkbox",
                                        "label": "Hustenassoziation",
                                        "required": false
                                },
                                {
                                        "id": "1153_nicht_isch",
                                        "type": "checkbox",
                                        "label": "Schluckassoziation",
                                        "required": false
                                },
                                {
                                        "id": "1153_nicht_isch",
                                        "type": "checkbox",
                                        "label": "Sodbrennen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1171",
                        "title": "Art der Gelenkbeschwerden",
                        "fields": [
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "Ber√ºhrungsschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "Bewegungsschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "Formabweichung/Auftreibung",
                                        "required": false
                                },
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "Instabilit√§t",
                                        "required": false
                                },
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "Schmerzen",
                                        "required": false
                                },
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "Schwellungen",
                                        "required": false
                                },
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "Steifigkeit",
                                        "required": false
                                },
                                {
                                        "id": "1171",
                                        "type": "checkbox",
                                        "label": "√úberw√§rmung",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1172",
                        "title": "Schmerzcharakter",
                        "fields": [
                                {
                                        "id": "1172_select",
                                        "type": "select",
                                        "label": "1172_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1173",
                        "title": "Ordnen Sie Ihre Schmerzen auf einer Skala von 0 ‚Äì 10 ein",
                        "fields": [
                                {
                                        "id": "1173",
                                        "type": "text",
                                        "label": "1173",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1174",
                        "title": "Art der Muskelbeschwerden",
                        "fields": [
                                {
                                        "id": "1174",
                                        "type": "checkbox",
                                        "label": "Kraftverlust",
                                        "required": false
                                },
                                {
                                        "id": "1174",
                                        "type": "checkbox",
                                        "label": "Muskelkr√§mpfe",
                                        "required": false
                                },
                                {
                                        "id": "1174",
                                        "type": "checkbox",
                                        "label": "Muskelschwund",
                                        "required": false
                                },
                                {
                                        "id": "1174",
                                        "type": "checkbox",
                                        "label": "Muskelverh√§rtung",
                                        "required": false
                                },
                                {
                                        "id": "1174",
                                        "type": "checkbox",
                                        "label": "pl√∂tzliche Form√§nderung",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1175",
                        "title": "Art der Wirbels√§ulenbeschwerden",
                        "fields": [
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Bekannte Osteoporose",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Bewegungsschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Fehlhaltung (Skoliose)",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Heben und B√ºcken eingeschr√§nkt",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Instabilit√§tsgef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Muskelverspannung",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Probleme beim Wasserlassen oder Stuhlgang (Harnverhalt, Inkontinenz)",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Pl√∂tzlich und sehr stark aufgetretener Schmerz",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Schmerzverst√§rkung beim Husten oder Niesen",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Schw√§che oder Gef√ºhlsst√∂rung in den Beinen",
                                        "required": false
                                },
                                {
                                        "id": "1175",
                                        "type": "checkbox",
                                        "label": "Steifigkeit",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1181",
                        "title": "Was kennzeichnet den Kopfschmerz?",
                        "fields": [
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Fieber, Nackensteife oder Bewusstseinsst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Halbseitenkopfschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Hinterhauptschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Krampfanf√§lle",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Kopfschmerz nach Trauma",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Licht- oder L√§rmempfindlichkeit w√§hrend des Schmerzes",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Pl√∂tzlicher, heftigster Kopfschmerz (Donnerschlagkopfschmerz)",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Sehst√∂rungen, Sprachst√∂rungen oder L√§hmungserscheinungen",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Spannungsgef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Stirnkopfschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "Schl√§fenschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1181",
                                        "type": "checkbox",
                                        "label": "√úbelkeit und Erbrechen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1182",
                        "title": "Schmerzcharakter",
                        "fields": [
                                {
                                        "id": "1182_select",
                                        "type": "select",
                                        "label": "1182_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1183",
                        "title": "Ordnen Sie Ihre Schmerzen auf einer Skala von 0 ‚Äì 10 ein",
                        "fields": [
                                {
                                        "id": "1183",
                                        "type": "text",
                                        "label": "1183",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1184",
                        "title": "Beschreiben Sie die Gef√ºhlsst√∂rungen",
                        "fields": [
                                {
                                        "id": "1184",
                                        "type": "checkbox",
                                        "label": "herabgesetzte Empfindung",
                                        "required": false
                                },
                                {
                                        "id": "1184",
                                        "type": "checkbox",
                                        "label": "vollst√§ndiger Empfindungsausfall/Taubheitsgef√ºhl",
                                        "required": false
                                },
                                {
                                        "id": "1184",
                                        "type": "checkbox",
                                        "label": "√ºbersteigerte Empfindlichkeit",
                                        "required": false
                                },
                                {
                                        "id": "1184",
                                        "type": "checkbox",
                                        "label": "unangenehm ver√§nderte Wahrnehmung (z. B. Ber√ºhrung schmerzhaft)",
                                        "required": false
                                },
                                {
                                        "id": "1184",
                                        "type": "checkbox",
                                        "label": "Missempfindungen ohne ad√§quaten Reiz (Kribbeln, Ameisenlaufen)",
                                        "required": false
                                },
                                {
                                        "id": "1184",
                                        "type": "checkbox",
                                        "label": "√ºberm√§√üiges Schmerzempfinden durch normalerweise nicht schmerzhafte Reize",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1185",
                        "title": "Welche Kontrollst√∂rungen haben Sie?",
                        "fields": [
                                {
                                        "id": "1185",
                                        "type": "checkbox",
                                        "label": "Bewusstseinsverlust",
                                        "required": false
                                },
                                {
                                        "id": "1185",
                                        "type": "checkbox",
                                        "label": "Gang- und Standunsicherheit",
                                        "required": false
                                },
                                {
                                        "id": "1185",
                                        "type": "checkbox",
                                        "label": "Harn- und/oder Stuhlinkontinenz",
                                        "required": false
                                },
                                {
                                        "id": "1185",
                                        "type": "checkbox",
                                        "label": "Impulskontrollverlust/Enthemmung",
                                        "required": false
                                },
                                {
                                        "id": "1185",
                                        "type": "checkbox",
                                        "label": "L√§hmungserscheinungen",
                                        "required": false
                                },
                                {
                                        "id": "1185",
                                        "type": "checkbox",
                                        "label": "Sprachkontrollverlust",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1186",
                        "title": "Art des Schwindels",
                        "fields": [
                                {
                                        "id": "1186",
                                        "type": "checkbox",
                                        "label": "Drehschwindel (wie im Karussell)",
                                        "required": false
                                },
                                {
                                        "id": "1186",
                                        "type": "checkbox",
                                        "label": "Liftschwindel (wie im Aufzug)",
                                        "required": false
                                },
                                {
                                        "id": "1186",
                                        "type": "checkbox",
                                        "label": "Schwankschwindel (wie auf einem Schiff)",
                                        "required": false
                                },
                                {
                                        "id": "1186",
                                        "type": "checkbox",
                                        "label": "Benommenheit",
                                        "required": false
                                },
                                {
                                        "id": "1186",
                                        "type": "checkbox",
                                        "label": "Schwarzwerden vor den Augen",
                                        "required": false
                                },
                                {
                                        "id": "1186",
                                        "type": "checkbox",
                                        "label": "Unsicher auf den Beinen",
                                        "required": false
                                },
                                {
                                        "id": "1186",
                                        "type": "checkbox",
                                        "label": "Wie auf Watte gehen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1187",
                        "title": "Was l√∂st Ihren Schwindel aus?",
                        "fields": [
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "Dunkelheit",
                                        "required": false
                                },
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "Flackerlicht",
                                        "required": false
                                },
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "Lagewechsel (z. B. Aufstehen)",
                                        "required": false
                                },
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "L√§rm",
                                        "required": false
                                },
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "Kopfbewegungen",
                                        "required": false
                                },
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "k√∂rperliche Anstrengung",
                                        "required": false
                                },
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "Stress/Schlafmangel",
                                        "required": false
                                },
                                {
                                        "id": "1187",
                                        "type": "checkbox",
                                        "label": "√úberkopfarbeiten",
                                        "required": false
                                },
                                {
                                        "id": "1187_freitext",
                                        "type": "text",
                                        "label": "1187_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1188",
                        "title": "Auftreten und Dauer des Schwindels?",
                        "fields": [
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Pl√∂tzlich einsetzend",
                                        "required": false
                                },
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Langsam, allm√§hlich, schleichend",
                                        "required": false
                                },
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Sekunden bis Minuten",
                                        "required": false
                                },
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Minuten bis Stunden",
                                        "required": false
                                },
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Mehrere Tage",
                                        "required": false
                                },
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Wochen bis Monate",
                                        "required": false
                                },
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Schwindelattacken",
                                        "required": false
                                },
                                {
                                        "id": "1188",
                                        "type": "checkbox",
                                        "label": "Dauerschwindel",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1189",
                        "title": "Was begleitet den Schwindel?",
                        "fields": [
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Bewusstseinsverlust",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Gef√ºhlsst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Herzrasen",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "H√∂rminderung",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Kopfschmerzen",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Kribbelmissempfindungen",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "L√§hmungen",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Nystagmus/Augenpendeln",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Ohrger√§usche",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Sprachst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Schwei√üausbruch",
                                        "required": false
                                },
                                {
                                        "id": "1189",
                                        "type": "checkbox",
                                        "label": "Verwirrtheit",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1190",
                        "title": "Zyklus ‚Äì Basisdaten",
                        "fields": [
                                {
                                        "id": "1190_menarche_j",
                                        "type": "text",
                                        "label": "Menarchealter (Jahre)",
                                        "required": false
                                },
                                {
                                        "id": "1190_lmp",
                                        "type": "text",
                                        "label": "Letzte Regel (Datum)",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1191",
                        "title": "Zyklus ‚Äì √úblicher Zyklus",
                        "fields": [
                                {
                                        "id": "1191_flags",
                                        "type": "checkbox",
                                        "label": "L√§nge 24‚Äì38 Tage",
                                        "required": false
                                },
                                {
                                        "id": "1191_flags",
                                        "type": "checkbox",
                                        "label": "Schwankung >7‚Äì9 Tage",
                                        "required": false
                                },
                                {
                                        "id": "1191_flags",
                                        "type": "checkbox",
                                        "label": "Dauer der Blutung >8 Tage",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1192",
                        "title": "Zyklus ‚Äì Aktuell",
                        "fields": [
                                {
                                        "id": "1192_aktuell",
                                        "type": "checkbox",
                                        "label": "Amenorrh√∂",
                                        "required": false
                                },
                                {
                                        "id": "1192_aktuell",
                                        "type": "checkbox",
                                        "label": "Polymenorrh√∂",
                                        "required": false
                                },
                                {
                                        "id": "1192_aktuell",
                                        "type": "checkbox",
                                        "label": "Zwischen-/Kontaktblutungen",
                                        "required": false
                                },
                                {
                                        "id": "1192_aktuell",
                                        "type": "checkbox",
                                        "label": "postkoitale Blutung",
                                        "required": false
                                },
                                {
                                        "id": "1192_aktuell",
                                        "type": "checkbox",
                                        "label": "Intrauterinpessar vorhanden",
                                        "required": false
                                },
                                {
                                        "id": "1192_aktuell",
                                        "type": "checkbox",
                                        "label": "Schwangerschaft m√∂glich",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1193",
                        "title": "Zyklus ‚Äì Blutungsst√§rke",
                        "fields": [
                                {
                                        "id": "1193_pads_per_day",
                                        "type": "text",
                                        "label": "Binden/Tampons pro Tag",
                                        "required": false
                                },
                                {
                                        "id": "1193_flags",
                                        "type": "checkbox",
                                        "label": "n√§chtliches Wechseln erforderlich",
                                        "required": false
                                },
                                {
                                        "id": "1193_flags",
                                        "type": "checkbox",
                                        "label": "Koagel >2‚Äì3 cm",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1194",
                        "title": "Zyklus ‚Äì Vorgeschichte",
                        "fields": [
                                {
                                        "id": "1194_geburten",
                                        "type": "text",
                                        "label": "Fehl-/Geburten (Anzahl)",
                                        "required": false
                                },
                                {
                                        "id": "1194_abbrueche",
                                        "type": "text",
                                        "label": "Abbr√ºche (Anzahl)",
                                        "required": false
                                },
                                {
                                        "id": "1194_ops",
                                        "type": "text",
                                        "label": "OPs an Uterus/Zervix",
                                        "required": false
                                },
                                {
                                        "id": "1194_myome",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1194_myome",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                },
                                {
                                        "id": "1194_endo",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1194_endo",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                },
                                {
                                        "id": "1194_pcos",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1194_pcos",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1205",
                        "title": "Fieber ‚Äì H√∂chsttemperatur & Messmethode",
                        "condition": {
                                "field": "1005",
                                "value": "Fieber",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1205_tmax_c",
                                        "type": "text",
                                        "label": "H√∂chsttemperatur (¬∞C)",
                                        "required": false
                                },
                                {
                                        "id": "1205_methode",
                                        "type": "radio",
                                        "label": "rektal",
                                        "required": false
                                },
                                {
                                        "id": "1205_methode",
                                        "type": "radio",
                                        "label": "oral",
                                        "required": false
                                },
                                {
                                        "id": "1205_methode",
                                        "type": "radio",
                                        "label": "Geh√∂rgang",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1230",
                        "title": "Durchfall ‚Äì H√§ufigkeit und Dehydratation",
                        "condition": {
                                "field": "1030",
                                "value": "Durchfall",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1230_stuehle_24h",
                                        "type": "text",
                                        "label": "Anzahl ungeformter St√ºhle / 24 h",
                                        "required": false
                                },
                                {
                                        "id": "1230_nacht",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1230_nacht",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                },
                                {
                                        "id": "1230_dranginko",
                                        "type": "checkbox",
                                        "label": "Dranginkontinenz",
                                        "required": false
                                },
                                {
                                        "id": "1230_tenesmen",
                                        "type": "checkbox",
                                        "label": "Tenesmen",
                                        "required": false
                                },
                                {
                                        "id": "1230_durst",
                                        "type": "checkbox",
                                        "label": "starker Durst",
                                        "required": false
                                },
                                {
                                        "id": "1230_orthostat",
                                        "type": "checkbox",
                                        "label": "Schwindel beim Aufstehen",
                                        "required": false
                                },
                                {
                                        "id": "1230_oligurie",
                                        "type": "checkbox",
                                        "label": "reduzierte Urinmenge",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1231",
                        "title": "Durchfall ‚Äì Stuhlcharakter",
                        "condition": {
                                "field": "1030",
                                "value": "Durchfall",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "Blut",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "Schleim",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "Eiter",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "w√§ssrig",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "breiig",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "fettig/√∂lig",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "√ºbel riechend",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "‚Äûklebt‚Äú (Steatorrhoe)",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "hell",
                                        "required": false
                                },
                                {
                                        "id": "1231_char",
                                        "type": "checkbox",
                                        "label": "schwarz",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1232",
                        "title": "Durchfall ‚Äì Exposition/Risiko",
                        "condition": {
                                "field": "1030",
                                "value": "Durchfall",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1232_expo",
                                        "type": "checkbox",
                                        "label": "Reise letzte 4 Wochen",
                                        "required": false
                                },
                                {
                                        "id": "1232_expo",
                                        "type": "checkbox",
                                        "label": "Trinkwasser/Eisw√ºrfel",
                                        "required": false
                                },
                                {
                                        "id": "1232_expo",
                                        "type": "checkbox",
                                        "label": "Street-Food",
                                        "required": false
                                },
                                {
                                        "id": "1232_expo",
                                        "type": "checkbox",
                                        "label": "Gefl√ºgel",
                                        "required": false
                                },
                                {
                                        "id": "1232_expo",
                                        "type": "checkbox",
                                        "label": "Eier",
                                        "required": false
                                },
                                {
                                        "id": "1232_expo",
                                        "type": "checkbox",
                                        "label": "Meeresfr√ºchte",
                                        "required": false
                                },
                                {
                                        "id": "1232_expo",
                                        "type": "checkbox",
                                        "label": "Rohmilch",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1233",
                        "title": "Durchfall ‚Äì Umfeld & Kontakte",
                        "condition": {
                                "field": "1030",
                                "value": "Durchfall",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1233_umfeld",
                                        "type": "checkbox",
                                        "label": "Erkrankte im Umfeld",
                                        "required": false
                                },
                                {
                                        "id": "1233_umfeld",
                                        "type": "checkbox",
                                        "label": "Gemeinschaftsverpflegung",
                                        "required": false
                                },
                                {
                                        "id": "1233_umfeld",
                                        "type": "checkbox",
                                        "label": "Kita/Heim",
                                        "required": false
                                },
                                {
                                        "id": "1233_umfeld",
                                        "type": "checkbox",
                                        "label": "Tierkontakte (insb. Reptilien)",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1290",
                        "title": "Schwangerschaft ‚Äì Akute Beschwerden/Red Flags",
                        "fields": [
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "Vaginale Blutung",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "starke Unterbauchschmerzen/Wehen vor SSW 37",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "Fl√ºssigkeitsabgang (Verdacht Blasensprung)",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "Deutlich weniger/keine Kindsbewegungen ab SSW 24",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "Starke Kopfschmerzen",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "Sehst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "pl√∂tzliche √ñdeme",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "Symphysenschmerz",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "Sodbrennen",
                                        "required": false
                                },
                                {
                                        "id": "1290_flags",
                                        "type": "checkbox",
                                        "label": "H√§morrhoiden",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1305",
                        "title": "Fieber ‚Äì Begleitsymptome",
                        "condition": {
                                "field": "1005",
                                "value": "Fieber",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1305_begleit",
                                        "type": "checkbox",
                                        "label": "Nackensteifigkeit",
                                        "required": false
                                },
                                {
                                        "id": "1305_begleit",
                                        "type": "checkbox",
                                        "label": "Lichtempfindlichkeit",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1330",
                        "title": "Koliken ‚Äì Lokalisation und Ausstrahlung",
                        "condition": {
                                "field": "1030",
                                "value": "Koliken",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1330_lokal",
                                        "type": "checkbox",
                                        "label": "rechter Oberbauch",
                                        "required": false
                                },
                                {
                                        "id": "1330_lokal",
                                        "type": "checkbox",
                                        "label": "Epigastrium",
                                        "required": false
                                },
                                {
                                        "id": "1330_lokal",
                                        "type": "checkbox",
                                        "label": "Flanke",
                                        "required": false
                                },
                                {
                                        "id": "1330_lokal",
                                        "type": "checkbox",
                                        "label": "Mittelbauch",
                                        "required": false
                                },
                                {
                                        "id": "1330_lokal",
                                        "type": "checkbox",
                                        "label": "Unterbauch",
                                        "required": false
                                },
                                {
                                        "id": "1330_ausstrahl",
                                        "type": "checkbox",
                                        "label": "R√ºcken",
                                        "required": false
                                },
                                {
                                        "id": "1330_ausstrahl",
                                        "type": "checkbox",
                                        "label": "rechte Schulter",
                                        "required": false
                                },
                                {
                                        "id": "1330_ausstrahl",
                                        "type": "checkbox",
                                        "label": "Leiste",
                                        "required": false
                                },
                                {
                                        "id": "1330_ausstrahl",
                                        "type": "checkbox",
                                        "label": "Genitale",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1331",
                        "title": "Koliken ‚Äì Begleitsymptome",
                        "condition": {
                                "field": "1030",
                                "value": "Koliken",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1331_begleit",
                                        "type": "checkbox",
                                        "label": "Gelbe Bindeh√§ute",
                                        "required": false
                                },
                                {
                                        "id": "1331_begleit",
                                        "type": "checkbox",
                                        "label": "dunkler Urin",
                                        "required": false
                                },
                                {
                                        "id": "1331_begleit",
                                        "type": "checkbox",
                                        "label": "heller Stuhl",
                                        "required": false
                                },
                                {
                                        "id": "1331_begleit",
                                        "type": "checkbox",
                                        "label": "Hautjucken",
                                        "required": false
                                },
                                {
                                        "id": "1331_begleit",
                                        "type": "checkbox",
                                        "label": "Harndrang",
                                        "required": false
                                },
                                {
                                        "id": "1331_begleit",
                                        "type": "checkbox",
                                        "label": "verminderte Urinmenge",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1332",
                        "title": "Koliken ‚Äì Vorerkrankungen und Risiken",
                        "condition": {
                                "field": "1030",
                                "value": "Koliken",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1332_vor",
                                        "type": "checkbox",
                                        "label": "Gallensteine",
                                        "required": false
                                },
                                {
                                        "id": "1332_vor",
                                        "type": "checkbox",
                                        "label": "Nierensteine",
                                        "required": false
                                },
                                {
                                        "id": "1332_vor",
                                        "type": "checkbox",
                                        "label": "Bauchspeicheldr√ºseentz√ºndung",
                                        "required": false
                                },
                                {
                                        "id": "1332_vor",
                                        "type": "checkbox",
                                        "label": "Hernien",
                                        "required": false
                                },
                                {
                                        "id": "1332_vor",
                                        "type": "checkbox",
                                        "label": "Darm-OP",
                                        "required": false
                                },
                                {
                                        "id": "1332_vor",
                                        "type": "checkbox",
                                        "label": "Verwachsungen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1334",
                        "title": "Gyn√§kologische Zusatzfragen",
                        "condition": {
                                "field": "0002",
                                "value": "weiblich",
                                "operator": "=="
                        },
                        "fields": [
                                {
                                        "id": "1334_lrb",
                                        "type": "text",
                                        "label": "Letzte Regelblutung",
                                        "required": false
                                },
                                {
                                        "id": "1334_gyn",
                                        "type": "checkbox",
                                        "label": "vaginale Blutung",
                                        "required": false
                                },
                                {
                                        "id": "1334_gyn",
                                        "type": "checkbox",
                                        "label": "Ausfluss",
                                        "required": false
                                },
                                {
                                        "id": "1334_gyn",
                                        "type": "checkbox",
                                        "label": "Schwangerschaftstest positiv",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1390",
                        "title": "Schwangerschaft ‚Äì Vorgeschichte",
                        "fields": [
                                {
                                        "id": "1390_gravida",
                                        "type": "text",
                                        "label": "Schwangerschaften (Anzahl)",
                                        "required": false
                                },
                                {
                                        "id": "1390_abortus",
                                        "type": "text",
                                        "label": "Fehlgeburten (Anzahl)",
                                        "required": false
                                },
                                {
                                        "id": "1390_preterm",
                                        "type": "text",
                                        "label": "Fr√ºhgeburten (Anzahl)",
                                        "required": false
                                },
                                {
                                        "id": "1390_sectio",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1390_sectio",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                },
                                {
                                        "id": "1390_preeclampsia",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1390_preeclampsia",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                },
                                {
                                        "id": "1390_gdm",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1390_gdm",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                },
                                {
                                        "id": "1390_rh",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1390_rh",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1405",
                        "title": "Fieber ‚Äì Ausl√∂sende Ursachen / Exposition",
                        "condition": {
                                "field": "1005",
                                "value": "Fieber",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1405_expo",
                                        "type": "checkbox",
                                        "label": "Reise (letzte 4‚Äì6 Wochen)",
                                        "required": false
                                },
                                {
                                        "id": "1405_expo",
                                        "type": "checkbox",
                                        "label": "Tier-/Zeckenkontakt",
                                        "required": false
                                },
                                {
                                        "id": "1405_expo",
                                        "type": "checkbox",
                                        "label": "Insektenstiche",
                                        "required": false
                                },
                                {
                                        "id": "1405_expo",
                                        "type": "checkbox",
                                        "label": "Rohmilch",
                                        "required": false
                                },
                                {
                                        "id": "1405_expo",
                                        "type": "checkbox",
                                        "label": "Meeresfr√ºchte",
                                        "required": false
                                },
                                {
                                        "id": "1405_expo",
                                        "type": "checkbox",
                                        "label": "Sexuelle Kontakte",
                                        "required": false
                                },
                                {
                                        "id": "1405_expo",
                                        "type": "checkbox",
                                        "label": "i.v.-Drogen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1430",
                        "title": "Verstopfung ‚Äì Frequenz & letzte normale Entleerung",
                        "condition": {
                                "field": "1030",
                                "value": "Verstopfung",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1430_freq_woche",
                                        "type": "text",
                                        "label": "Stuhlfrequenz pro Woche",
                                        "required": false
                                },
                                {
                                        "id": "1430_letzte_normale_entleerung",
                                        "type": "text",
                                        "label": "Letzte normale Entleerung",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1431",
                        "title": "Verstopfung ‚Äì Stuhlbeschaffenheit & Symptome",
                        "condition": {
                                "field": "1030",
                                "value": "Verstopfung",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "harte Klumpen",
                                        "required": false
                                },
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "schmerzhafte Def√§kation",
                                        "required": false
                                },
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "d√ºnner ‚ÄûBleistiftstuhl‚Äú",
                                        "required": false
                                },
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "Blutauflagerung",
                                        "required": false
                                },
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "unvollst√§ndige Entleerung",
                                        "required": false
                                },
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "fehlende Windabg√§nge",
                                        "required": false
                                },
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "Bl√§hbauch",
                                        "required": false
                                },
                                {
                                        "id": "1431_sympt",
                                        "type": "checkbox",
                                        "label": "Harnverhalt",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1505",
                        "title": "Gewichtsverlust ‚Äì Appetit",
                        "condition": {
                                "field": "1005",
                                "value": "ungewollter Gewichtsverlust",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1505_appetit",
                                        "type": "radio",
                                        "label": "normal",
                                        "required": false
                                },
                                {
                                        "id": "1505_appetit",
                                        "type": "radio",
                                        "label": "vermindert",
                                        "required": false
                                },
                                {
                                        "id": "1505_appetit",
                                        "type": "radio",
                                        "label": "fr√ºhe S√§ttigung",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1605",
                        "title": "Gewichtsverlust ‚Äì Nahrungsaufnahme",
                        "fields": [
                                {
                                        "id": "1605_kcal_tag",
                                        "type": "text",
                                        "label": "Kalorienzufuhr / Tag",
                                        "required": false
                                },
                                {
                                        "id": "1605_mahlzeiten_tag",
                                        "type": "text",
                                        "label": "Mahlzeiten / Tag",
                                        "required": false
                                },
                                {
                                        "id": "1605_trinkmenge_l",
                                        "type": "text",
                                        "label": "Trinkmenge / Tag (Liter)",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1705",
                        "title": "Gewichtsverlust ‚Äì Symptome",
                        "fields": [
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "Heiserkeit >3 Wo",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "Kauprobleme",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "neu aufgetretene Hyperpigmentierung",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "orthostatische Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "rektale Blutung",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "Schluckst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "Schmerzhafte/tastbare Lymphknoten",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "Soor",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "TBC-Kontakt",
                                        "required": false
                                },
                                {
                                        "id": "1705_sympt",
                                        "type": "checkbox",
                                        "label": "vermehrtes Durstgef√ºhl",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1805",
                        "title": "starkes Ersch√∂pfungsgef√ºhl",
                        "condition": {
                                "field": "1005",
                                "value": "Kraftlosigkeit",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1805_erschoepfung",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1805_erschoepfung",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1815",
                        "title": "spontanes ungewolltes Einschlafen",
                        "condition": {
                                "field": "1005",
                                "value": "Kraftlosigkeit",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1815_einschlafen",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1815_einschlafen",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1825",
                        "title": "Aufstehen vom Stuhl ohne Armeinsatz m√∂glich",
                        "condition": {
                                "field": "1005",
                                "value": "Kraftlosigkeit",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1825_stuhl_ohne_arme",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "1825_stuhl_ohne_arme",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q1835",
                        "title": "Kraftlosigkeit ‚Äì St√ºrze",
                        "condition": {
                                "field": "1005",
                                "value": "Kraftlosigkeit",
                                "operator": "includes"
                        },
                        "fields": [
                                {
                                        "id": "1835_stuerze_4w",
                                        "type": "text",
                                        "label": "St√ºrze in den vergangenen 4 Wochen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2000",
                        "title": "Versicherungsstatus?",
                        "fields": [
                                {
                                        "id": "2000",
                                        "type": "radio",
                                        "label": "Privat-Selbstzahler",
                                        "required": true
                                },
                                {
                                        "id": "2000",
                                        "type": "radio",
                                        "label": "Gesetzlich",
                                        "required": true
                                }
                        ]
                },
                {
                        "id": "q2001",
                        "title": "Haben Sie bereits einen Termin bei uns?",
                        "fields": [
                                {
                                        "id": "2001",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "2001",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2002",
                        "title": "Termin (√ºber Arztdirekt Online) gebucht f√ºr:",
                        "fields": [
                                {
                                        "id": "2002_date",
                                        "type": "text",
                                        "label": "2002_date",
                                        "required": false
                                },
                                {
                                        "id": "2002_format",
                                        "type": "text",
                                        "label": "2002_format",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2003",
                        "title": "Waren Sie schon einmal bei uns?",
                        "fields": [
                                {
                                        "id": "2003",
                                        "type": "select",
                                        "label": "2003",
                                        "required": false
                                },
                                {
                                        "id": "2003_freitext",
                                        "type": "text",
                                        "label": "2003_freitext",
                                        "required": false
                                },
                                {
                                        "id": "2003",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "2003",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2004",
                        "title": "Welche Wochentage bevorzugen Sie?",
                        "fields": [
                                {
                                        "id": "2004",
                                        "type": "checkbox",
                                        "label": "Montag",
                                        "required": false
                                },
                                {
                                        "id": "2004",
                                        "type": "checkbox",
                                        "label": "Dienstag",
                                        "required": false
                                },
                                {
                                        "id": "2004",
                                        "type": "checkbox",
                                        "label": "Mittwoch",
                                        "required": false
                                },
                                {
                                        "id": "2004",
                                        "type": "checkbox",
                                        "label": "Donnerstag",
                                        "required": false
                                },
                                {
                                        "id": "2004",
                                        "type": "checkbox",
                                        "label": "Freitag",
                                        "required": false
                                },
                                {
                                        "id": "2004",
                                        "type": "checkbox",
                                        "label": "egal",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2005",
                        "title": "Waren Sie schon einmal bei uns?",
                        "fields": [
                                {
                                        "id": "2005",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": true
                                },
                                {
                                        "id": "2005",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": true
                                }
                        ]
                },
                {
                        "id": "q2006",
                        "title": "Weshalb kommen Sie zu uns?",
                        "fields": [
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Abkl√§rung oben genannter Beschwerden",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Kontrolluntersuchung",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Vorsorge/Pr√§vention",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Abkl√§rung auff√§lliger Befunde",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Abkl√§rung chron. Erkrankungen",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Tumorverdacht",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Neurologische Symptome",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Orthop√§dische Probleme",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Therapieanpassung/Medikamentenkontrolle",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Unfallfolgen (Arbeitsunfall)",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Begutachtung/Antr√§ge",
                                        "required": false
                                },
                                {
                                        "id": "2006",
                                        "type": "checkbox",
                                        "label": "Einholung einer Zweitmeinung",
                                        "required": false
                                },
                                {
                                        "id": "2006_freitext",
                                        "type": "text",
                                        "label": "2006_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2010",
                        "title": "Kontrolluntersuchung",
                        "fields": [
                                {
                                        "id": "2010",
                                        "type": "checkbox",
                                        "label": "Blutzucker/Diabeteskontrolle",
                                        "required": false
                                },
                                {
                                        "id": "2010",
                                        "type": "checkbox",
                                        "label": "Laborwerte allgemein",
                                        "required": false
                                },
                                {
                                        "id": "2010_freitext",
                                        "type": "text",
                                        "label": "2010_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2020",
                        "title": "Welche Vorsorge- oder Pr√§ventionsma√ünahmen w√ºnschen Sie",
                        "fields": [
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Aortenaneurysma-Screening (f√ºr M√§nner ab 65)",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Gef√§√üalter-Bestimmung (IgeL)",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Kontrolle periphere arterielle Verschlusskrankheit (pAVK)",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Schlaganfallrisiko-Check (IgeL)",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Thrombose-Risikoeinsch√§tzung",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Gesundheits-Check-up (IgeL)",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Impfstatus-Kontrolle",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Bluthochdruck-Screening",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Blutzucker-/Diabetes-Screening",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Lipidstoffwechsel-/Cholesterin-Screening",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Hautkrebs-Screening",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Darmkrebs-Screening",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Prostata-Vorsorge (PSA, Tastuntersuchung)",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Gyn√§kologische Vorsorge",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Osteoporose-/Knochendichte-Messung",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Lungengesundheit (z. B. COPD-/Raucher-Screening)",
                                        "required": false
                                },
                                {
                                        "id": "2020",
                                        "type": "checkbox",
                                        "label": "Lebensstil-Check (Bewegung, Ern√§hrung, Gewicht, Stress)",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2030",
                        "title": "Er√∂rterung auff√§lliger Befunde",
                        "fields": [
                                {
                                        "id": "2030",
                                        "type": "checkbox",
                                        "label": "Bildgebung (R√∂ntgen, CT, MRT, Ultraschall)",
                                        "required": false
                                },
                                {
                                        "id": "2030",
                                        "type": "checkbox",
                                        "label": "Laborauff√§lligkeiten",
                                        "required": false
                                },
                                {
                                        "id": "2030_freitext",
                                        "type": "text",
                                        "label": "2030_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2040",
                        "title": "Um welche chronische Erkrankung handelt es sich?",
                        "fields": [
                                {
                                        "id": "2040",
                                        "type": "checkbox",
                                        "label": "Herz-Kreislauf (Hypertonie, KHK, Herzrhythmus)",
                                        "required": false
                                },
                                {
                                        "id": "2040",
                                        "type": "checkbox",
                                        "label": "Gef√§√üerkrankung",
                                        "required": false
                                },
                                {
                                        "id": "2040",
                                        "type": "checkbox",
                                        "label": "Stoffwechsel (Diabetes, Schilddr√ºse)",
                                        "required": false
                                },
                                {
                                        "id": "2040",
                                        "type": "checkbox",
                                        "label": "Atemwege (Asthma, COPD)",
                                        "required": false
                                },
                                {
                                        "id": "2040_freitext",
                                        "type": "text",
                                        "label": "2040_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2041",
                        "title": "Herz-Kreislauferkrankung",
                        "fields": [
                                {
                                        "id": "2041",
                                        "type": "checkbox",
                                        "label": "Bluthochdruck",
                                        "required": false
                                },
                                {
                                        "id": "2041",
                                        "type": "checkbox",
                                        "label": "Angina pectoris",
                                        "required": false
                                },
                                {
                                        "id": "2041",
                                        "type": "checkbox",
                                        "label": "Herzrhythmusst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "2041_freitext",
                                        "type": "text",
                                        "label": "2041_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2042",
                        "title": "Gef√§√üerkrankung",
                        "fields": [
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "Aneurysma",
                                        "required": false
                                },
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "pAVK",
                                        "required": false
                                },
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "Krampfadern",
                                        "required": false
                                },
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "Lymph√∂dem",
                                        "required": false
                                },
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "Lip√∂dem",
                                        "required": false
                                },
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "Raynaud-Syndrom",
                                        "required": false
                                },
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "Thrombose",
                                        "required": false
                                },
                                {
                                        "id": "2042",
                                        "type": "checkbox",
                                        "label": "Vaskulitis",
                                        "required": false
                                },
                                {
                                        "id": "2042_freitext",
                                        "type": "text",
                                        "label": "2042_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2043",
                        "title": "Stoffwechselst√∂rung",
                        "fields": [
                                {
                                        "id": "2043",
                                        "type": "checkbox",
                                        "label": "Diabeteseinstellung",
                                        "required": false
                                },
                                {
                                        "id": "2043",
                                        "type": "checkbox",
                                        "label": "Fettstoffwechseleinstellung",
                                        "required": false
                                },
                                {
                                        "id": "2043",
                                        "type": "checkbox",
                                        "label": "√úberwachung/Kontrolle der Schilddr√ºsenfunktion",
                                        "required": false
                                },
                                {
                                        "id": "2043_freitext",
                                        "type": "text",
                                        "label": "2043_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2044",
                        "title": "Welche Asthma/COPD Probleme sind aufgetreten?",
                        "fields": [
                                {
                                        "id": "2044",
                                        "type": "checkbox",
                                        "label": "Verschlechterung der Atemfunktion",
                                        "required": false
                                },
                                {
                                        "id": "2044",
                                        "type": "checkbox",
                                        "label": "Inhalationstechnik",
                                        "required": false
                                },
                                {
                                        "id": "2044",
                                        "type": "checkbox",
                                        "label": "Nebenwirkungen",
                                        "required": false
                                },
                                {
                                        "id": "2044",
                                        "type": "checkbox",
                                        "label": "Rauchstopp-Intervention",
                                        "required": false
                                },
                                {
                                        "id": "2044_freitext",
                                        "type": "text",
                                        "label": "2044_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2050",
                        "title": "Tumorverdacht",
                        "fields": [
                                {
                                        "id": "2050",
                                        "type": "checkbox",
                                        "label": "Knoten/Schwellung",
                                        "required": false
                                },
                                {
                                        "id": "2050",
                                        "type": "checkbox",
                                        "label": "Blut im Stuhl",
                                        "required": false
                                },
                                {
                                        "id": "2050",
                                        "type": "checkbox",
                                        "label": "Gewichtsverlust",
                                        "required": false
                                },
                                {
                                        "id": "2050_freitext",
                                        "type": "text",
                                        "label": "2050_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2060",
                        "title": "Neurologische Symptome",
                        "fields": [
                                {
                                        "id": "2060",
                                        "type": "checkbox",
                                        "label": "Schwindel",
                                        "required": false
                                },
                                {
                                        "id": "2060",
                                        "type": "checkbox",
                                        "label": "L√§hmungen",
                                        "required": false
                                },
                                {
                                        "id": "2060",
                                        "type": "checkbox",
                                        "label": "Sensibilit√§tsst√∂rungen",
                                        "required": false
                                },
                                {
                                        "id": "2060",
                                        "type": "checkbox",
                                        "label": "Krampfanf√§lle",
                                        "required": false
                                },
                                {
                                        "id": "2060_freitext",
                                        "type": "text",
                                        "label": "2060_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2070",
                        "title": "Orthop√§dische Probleme",
                        "fields": [
                                {
                                        "id": "2070",
                                        "type": "checkbox",
                                        "label": "Arthrose",
                                        "required": false
                                },
                                {
                                        "id": "2070",
                                        "type": "checkbox",
                                        "label": "Bandscheibenbeschwerden",
                                        "required": false
                                },
                                {
                                        "id": "2070",
                                        "type": "checkbox",
                                        "label": "Fehlstellungen/Bewegungseinschr√§nkung",
                                        "required": false
                                },
                                {
                                        "id": "2070",
                                        "type": "checkbox",
                                        "label": "Deformit√§ten/Mi√übildungen",
                                        "required": false
                                },
                                {
                                        "id": "2070_freitext",
                                        "type": "text",
                                        "label": "2070_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2080",
                        "title": "Welchen Beruf bzw. welche T√§tigkeit √ºben Sie aus?",
                        "fields": [
                                {
                                        "id": "2080",
                                        "type": "text",
                                        "label": "2080",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2081",
                        "title": "Wer ist Ihr Arbeitgeber (Name, Anschrift)?",
                        "fields": [
                                {
                                        "id": "2081_text",
                                        "type": "textarea",
                                        "label": "2081_text",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2082",
                        "title": "Seit wann sind Sie bei diesem Arbeitgeber besch√§ftigt?",
                        "fields": [
                                {
                                        "id": "2082_date",
                                        "type": "text",
                                        "label": "2082_date",
                                        "required": false
                                },
                                {
                                        "id": "2082_format",
                                        "type": "text",
                                        "label": "2082_format",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2083",
                        "title": "Welche Berufsgenossenschaft ist f√ºr Sie zust√§ndig?",
                        "fields": [
                                {
                                        "id": "2083_select",
                                        "type": "select",
                                        "label": "2083_select",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2084",
                        "title": "An welchem Tag ist der Unfall passiert?",
                        "fields": [
                                {
                                        "id": "2084_date",
                                        "type": "text",
                                        "label": "2084_date",
                                        "required": false
                                },
                                {
                                        "id": "2084_format",
                                        "type": "text",
                                        "label": "2084_format",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2085",
                        "title": "Zu welcher Uhrzeit ist der Unfall passiert?",
                        "fields": [
                                {
                                        "id": "2085_time",
                                        "type": "text",
                                        "label": "2085_time",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2086",
                        "title": "Es handelt sich um:",
                        "fields": [
                                {
                                        "id": "2086",
                                        "type": "radio",
                                        "label": "Arbeitszeit",
                                        "required": false
                                },
                                {
                                        "id": "2086",
                                        "type": "radio",
                                        "label": "Wegeunfall",
                                        "required": false
                                },
                                {
                                        "id": "2086",
                                        "type": "radio",
                                        "label": "Pause",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2087",
                        "title": "Unfallort",
                        "fields": [
                                {
                                        "id": "2087",
                                        "type": "radio",
                                        "label": "Betriebsgel√§nde",
                                        "required": false
                                },
                                {
                                        "id": "2087",
                                        "type": "radio",
                                        "label": "Baustelle",
                                        "required": false
                                },
                                {
                                        "id": "2087",
                                        "type": "radio",
                                        "label": "Arbeitsweg",
                                        "required": false
                                },
                                {
                                        "id": "2087_freitext",
                                        "type": "text",
                                        "label": "2087_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2088",
                        "title": "Unfallhergang",
                        "fields": [
                                {
                                        "id": "2088_text",
                                        "type": "textarea",
                                        "label": "2088_text",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2089",
                        "title": "Unfallfolgen",
                        "fields": [
                                {
                                        "id": "2089_text",
                                        "type": "textarea",
                                        "label": "2089_text",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2090",
                        "title": "Wurde der Unfall im Betrieb gemeldet?",
                        "fields": [
                                {
                                        "id": "2090",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "2090",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2091",
                        "title": "Wurde eine √§rztliche Erstversorgung durchgef√ºhrt?",
                        "fields": [
                                {
                                        "id": "2091",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "2091",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2092",
                        "title": "Wer hat die √§rztliche Erstversorgung durchgef√ºhrt?",
                        "fields": [
                                {
                                        "id": "2092_text",
                                        "type": "text",
                                        "label": "2092_text",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q2100",
                        "title": "Gutachten/Reha- Kurantr√§ge",
                        "fields": [
                                {
                                        "id": "2100",
                                        "type": "checkbox",
                                        "label": "Freies Gutachten/Versicherungsgutachten",
                                        "required": false
                                },
                                {
                                        "id": "2100",
                                        "type": "checkbox",
                                        "label": "GdB Gutachten",
                                        "required": false
                                },
                                {
                                        "id": "2100",
                                        "type": "checkbox",
                                        "label": "Reha Antrag",
                                        "required": false
                                },
                                {
                                        "id": "2100_freitext",
                                        "type": "text",
                                        "label": "2100_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q3000",
                        "title": "Wie lautet Ihre PLZ?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "3000",
                                        "type": "text",
                                        "label": "3000",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q3001",
                        "title": "Wohnort",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "3001",
                                        "type": "text",
                                        "label": "3001",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q3002",
                        "title": "Wohnanschrift",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "3002",
                                        "type": "text",
                                        "label": "3002",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q3003",
                        "title": "E‚ÄëMail f√ºr Ihre Terminbest√§tigung",
                        "fields": [
                                {
                                        "id": "3003",
                                        "type": "text",
                                        "label": "3003",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q3004",
                        "title": "Mobilrufnummer f√ºr R√ºckfragen?",
                        "fields": [
                                {
                                        "id": "3004",
                                        "type": "text",
                                        "label": "3004",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q3005",
                        "title": "Geben Sie hier ‚Äì wenn bekannt ‚Äì Ihre Patienten-ID ein",
                        "fields": [
                                {
                                        "id": "3005",
                                        "type": "text",
                                        "label": "3005",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4000",
                        "title": "Wie gro√ü sind Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4000",
                                        "type": "text",
                                        "label": "4000",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4001",
                        "title": "Wie schwer sind Sie (in kg)?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4001",
                                        "type": "text",
                                        "label": "4001",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4002",
                        "title": "Haben Sie jemals geraucht?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4002",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "4002",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4003",
                        "title": "Durchschnittlich wie viele Zigaretten pro Tag?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4003",
                                        "type": "text",
                                        "label": "4003",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4004",
                        "title": "Wie viele Jahre haben Sie geraucht?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4004",
                                        "type": "text",
                                        "label": "4004",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4005",
                        "title": "Rauchen Sie immer noch?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4005",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "4005",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4006",
                        "title": "Wann (Jahr) haben Sie aufgeh√∂rt?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4006",
                                        "type": "text",
                                        "label": "4006",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4100",
                        "title": "Haben Sie eine der folgenden Impfungen erhalten?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "COVID-19",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "Diphtherie",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "FSME",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "Hepatitis B",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "Herpes Zoster (G√ºrtelrose)",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "Influenza (Grippe)",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "Masern, Mumps, R√∂teln (MMR)",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "Pneumokokken",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "RSV",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "Tetanus",
                                        "required": false
                                },
                                {
                                        "id": "4100",
                                        "type": "checkbox",
                                        "label": "keine der √ºblichen Impfungen erhalten",
                                        "required": false
                                },
                                {
                                        "id": "4100_freitext",
                                        "type": "text",
                                        "label": "4100_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4110",
                        "title": "Gibt es in Ihrer Familie folgende Erkrankungen?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4110",
                                        "type": "checkbox",
                                        "label": "Herzinfarkt/Schlaganfall",
                                        "required": false
                                },
                                {
                                        "id": "4110",
                                        "type": "checkbox",
                                        "label": "Bluthochdruck",
                                        "required": false
                                },
                                {
                                        "id": "4110",
                                        "type": "checkbox",
                                        "label": "Diabetes",
                                        "required": false
                                },
                                {
                                        "id": "4110",
                                        "type": "checkbox",
                                        "label": "Krebserkrankungen",
                                        "required": false
                                },
                                {
                                        "id": "4110",
                                        "type": "checkbox",
                                        "label": "Demenz/Alzheimer",
                                        "required": false
                                },
                                {
                                        "id": "4110",
                                        "type": "checkbox",
                                        "label": "keine",
                                        "required": false
                                },
                                {
                                        "id": "4110_freitext",
                                        "type": "text",
                                        "label": "4110_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4120",
                        "title": "Berufliche Situation",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4120",
                                        "type": "select",
                                        "label": "4120",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4121",
                        "title": "Stressbelastung",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4121",
                                        "type": "select",
                                        "label": "4121",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4122",
                        "title": "Schlafqualit√§t",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4122",
                                        "type": "select",
                                        "label": "4122",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4123",
                        "title": "Bewegung im Alltag",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4123",
                                        "type": "select",
                                        "label": "4123",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4130",
                        "title": "Alkoholkonsum",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4130",
                                        "type": "select",
                                        "label": "4130",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4131",
                        "title": "Drogen/Substanzen",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4131",
                                        "type": "select",
                                        "label": "4131",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q4140",
                        "title": "Haben Sie an folgenden Vorsorgeuntersuchungen teilgenommen?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Gesundheits-Check-up alle 3 Jahre ab 35",
                                        "required": false
                                },
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Krebsfr√ºherkennung Abstrich Geb√§rmutterhals j√§hrlich",
                                        "required": false
                                },
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Hautkrebs-Screening alle 2 Jahre ab 35 Jahren",
                                        "required": false
                                },
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Mammographie alle 2 Jahre ab 50",
                                        "required": false
                                },
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Prostata Tastuntersuchung ab 45 Jahren j√§hrlich",
                                        "required": false
                                },
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Darmkrebsvorsorge ab 55 Jahren",
                                        "required": false
                                },
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Bauchaortenaneurysma-Screening M√§nner √ºber 65",
                                        "required": false
                                },
                                {
                                        "id": "4140",
                                        "type": "checkbox",
                                        "label": "Hepatitis B / C Screening einmalig ab 35 Jahren m√∂glich",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q5000",
                        "title": "Leiden Sie an Diabetes?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "5000",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "5000",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q5001",
                        "title": "Welcher Typ?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "5001",
                                        "type": "select",
                                        "label": "5001",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q5002",
                        "title": "Medikament√∂se Diabetestherapie",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Metformin (Glucophage; Metformin AL; Siofor)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "SGLT2-Hemmer (Jardiance; Forxiga; Invokana; Steglatro)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "GLP-1-Rezeptor-Agonisten (Ozempic; Rybelsus; Victoza; Trulicity; Byetta)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "DPP-4-Hemmer (Januvia; Xelevia; Trajenta; Onglyza; Galvus)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Sulfonylharnstoffe (Amaryl; Gliben-HEXAL; Euglucon N)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Glinide (NovoNorm; Starlix)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Thiazolidindione (Actos)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Basalinsulin (Lantus; Toujeo; Levemir; Tresiba; Insulatard)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Bolusinsulin (NovoRapid; Humalog; Fiasp; Apidra)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Mischinsulin (NovoMix; Humalog Mix; Insuman Comb)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Insulinpumpe (Omnipod; Accu-Chek Insight; Medtronic MiniMed)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Sensorunterst√ºtzte Insulintherapie (Dexcom; FreeStyle Libre; Medtronic Guardian)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Kombinationstherapie oral (Janumet; Jentadueto; Segluromet; Xigduo)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Insulin + Tablette (z. B. Basalinsulin + Metformin oder GLP-1-Analogon)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Andere Antidiabetika (Setmelanotid; Imeglimin)",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Keine medikament√∂se Therapie",
                                        "required": false
                                },
                                {
                                        "id": "5002_freitext",
                                        "type": "text",
                                        "label": "5002_freitext",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Di√§t",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Forxiga",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Glibenclamid",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Insulin",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Januvia",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Jardiance",
                                        "required": false
                                },
                                {
                                        "id": "5002",
                                        "type": "checkbox",
                                        "label": "Metformin",
                                        "required": false
                                },
                                {
                                        "id": "5002_freitext",
                                        "type": "text",
                                        "label": "5002_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q5003",
                        "title": "Haben Sie eine der folgenden Komplikationen?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "5003",
                                        "type": "checkbox",
                                        "label": "Diabetisches Fu√üsyndrom",
                                        "required": false
                                },
                                {
                                        "id": "5003",
                                        "type": "checkbox",
                                        "label": "Retinopathie",
                                        "required": false
                                },
                                {
                                        "id": "5003",
                                        "type": "checkbox",
                                        "label": "Neuropathie",
                                        "required": false
                                },
                                {
                                        "id": "5003",
                                        "type": "checkbox",
                                        "label": "Nephropathie",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6000",
                        "title": "Haben Sie k√∂rperliche Beeintr√§chtigungen?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6000",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "6000",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6000_gdb",
                        "title": "Geben Sie den Grad Ihrer Behinderung (GdB) an und markieren Sie Merkzeichen",
                        "fields": [
                                {
                                        "id": "6000_gdb",
                                        "type": "text",
                                        "label": "6000_gdb",
                                        "required": false
                                },
                                {
                                        "id": "6000_merkzeichen",
                                        "type": "select",
                                        "label": "6000_merkzeichen",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6000_pflegegrad",
                        "title": "Welcher Pflegegrad liegt vor?",
                        "fields": [
                                {
                                        "id": "6000_pflegegrad",
                                        "type": "select",
                                        "label": "6000_pflegegrad",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6001",
                        "title": "Welche Beeintr√§chtigungen haben Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "K√ºnstlicher Darmausgang",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Am Rollator mobil",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Auf Rollstuhl angewiesen",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Gehbehinderung",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Oberschenkel-Amputiert",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Unterschenkel-Amputiert",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Hilfe beim An- und Auskleiden ben√∂tigt",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "(Teil)L√§hmung an den Extremit√§ten",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Schwerh√∂rigkeit/Ertaubung",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Sehkraftverlust",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Urininkontinenz",
                                        "required": false
                                },
                                {
                                        "id": "6001",
                                        "type": "checkbox",
                                        "label": "Stuhlinkontinenz",
                                        "required": false
                                },
                                {
                                        "id": "6001_freitext",
                                        "type": "text",
                                        "label": "6001_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6002",
                        "title": "Tragen Sie Implantate?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6002",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "6002",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6003",
                        "title": "Welche Implantate?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6003",
                                        "type": "checkbox",
                                        "label": "Blasensphinkter",
                                        "required": false
                                },
                                {
                                        "id": "6003",
                                        "type": "checkbox",
                                        "label": "Cochleaimplantat",
                                        "required": false
                                },
                                {
                                        "id": "6003",
                                        "type": "checkbox",
                                        "label": "Defibrillator",
                                        "required": false
                                },
                                {
                                        "id": "6003",
                                        "type": "checkbox",
                                        "label": "Gelenkendoprothese",
                                        "required": false
                                },
                                {
                                        "id": "6003",
                                        "type": "checkbox",
                                        "label": "Herzschrittmacher",
                                        "required": false
                                },
                                {
                                        "id": "6003",
                                        "type": "checkbox",
                                        "label": "K√ºnstliche Herzklappe",
                                        "required": false
                                },
                                {
                                        "id": "6003_freitext",
                                        "type": "text",
                                        "label": "6003_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6004",
                        "title": "Erhalten Sie blutverd√ºnnende Medikamente?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6004",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "6004",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6005",
                        "title": "Welche Blutverd√ºnner erhalten Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "ASS",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Brilique",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Clopidogrel",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Efient",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Eliquis",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Lixiana",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Marcumar",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Pradaxa",
                                        "required": false
                                },
                                {
                                        "id": "6005",
                                        "type": "checkbox",
                                        "label": "Xarelto",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6006",
                        "title": "Leiden Sie unter Allergien?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6006",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "6006",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q6007",
                        "title": "Ich leide unter folgenden Allergien/Intoleranzen:",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Antibiotika",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Latex",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "R√∂ntgenkontrastmittel",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Schmerzmedikamente",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Glutenunvertr√§glichkeit",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Lactoseintoleranz",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Pollen",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Milben",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Tierhaare",
                                        "required": false
                                },
                                {
                                        "id": "6007",
                                        "type": "checkbox",
                                        "label": "Nahrungsmittel (z. B. N√ºsse, Obst, Gluten, Milch)",
                                        "required": false
                                },
                                {
                                        "id": "6007_freitext",
                                        "type": "text",
                                        "label": "6007_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7000",
                        "title": "Haben Sie eine der folgenden Gesundheitsst√∂rungen?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Bluthochdruck",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Blutung/Gerinnungsst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Chronische Lungenerkrankung (Asthma/COPD)",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Dialyseabh√§ngigkeit",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Depression/Gem√ºtsst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Herzschw√§che/Herzrhythmusst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Leber/Magen-Darm-Erkrankungen",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "MRSA-Infektion in der Vergangenheit",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Nierenfunktionsst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Erkrankung des Nervensystems",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Rheuma",
                                        "required": false
                                },
                                {
                                        "id": "7000",
                                        "type": "checkbox",
                                        "label": "Schilddr√ºsenerkrankung",
                                        "required": false
                                },
                                {
                                        "id": "7000_freitext",
                                        "type": "text",
                                        "label": "7000_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "Husten",
                                        "required": false
                                },
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "pfeifende Atmung",
                                        "required": false
                                },
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "Luftnot",
                                        "required": false
                                },
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "Brustenge",
                                        "required": false
                                },
                                {
                                        "id": "7102_hustenart",
                                        "type": "select",
                                        "label": "2. Husten vorwiegend",
                                        "required": false,
                                        "options": [
                                                "trocken",
                                                "produktiv",
                                                "wechselnd"
                                        ]
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Fr√ºhling",
                                        "required": false
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Sommer",
                                        "required": false
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Herbst",
                                        "required": false
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Winter",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Anstrengung",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Pollen",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Hausstaub",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Tier",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Schimmel/Feuchte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "K√§lte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Reizstoffe",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Wetterwechsel",
                                        "required": false
                                },
                                {
                                        "id": "7102_freq_day",
                                        "type": "radio",
                                        "label": "‚â§2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_freq_day",
                                        "type": "radio",
                                        "label": ">2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_freq_day",
                                        "type": "radio",
                                        "label": "t√§glich",
                                        "required": false
                                },
                                {
                                        "id": "7102_night",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_night",
                                        "type": "radio",
                                        "label": "1‚Äì2√ó/Monat",
                                        "required": false
                                },
                                {
                                        "id": "7102_night",
                                        "type": "radio",
                                        "label": "‚â•1√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_saba_use",
                                        "type": "radio",
                                        "label": "‚â§2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_saba_use",
                                        "type": "radio",
                                        "label": ">2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_saba_use",
                                        "type": "radio",
                                        "label": "t√§glich",
                                        "required": false
                                },
                                {
                                        "id": "7102_activity",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_activity",
                                        "type": "radio",
                                        "label": "leicht",
                                        "required": false
                                },
                                {
                                        "id": "7102_activity",
                                        "type": "radio",
                                        "label": "deutlich",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_count",
                                        "type": "text",
                                        "label": "Anzahl",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_ocs",
                                        "type": "radio",
                                        "label": "OCS n√∂tig? ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_ocs",
                                        "type": "radio",
                                        "label": "OCS n√∂tig? nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_hosp",
                                        "type": "radio",
                                        "label": "Klinikaufnahme? ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_hosp",
                                        "type": "radio",
                                        "label": "Klinikaufnahme? nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_intub",
                                        "type": "radio",
                                        "label": "notwendige Intubation ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_intub",
                                        "type": "radio",
                                        "label": "notwendige Intubation nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_pneumothorax",
                                        "type": "radio",
                                        "label": "Fr√ºhere Pneumothorax: ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_pneumothorax",
                                        "type": "radio",
                                        "label": "Fr√ºhere Pneumothorax: nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Infekte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Anstrengung",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Allergene (Pollen/Tier/Staub)",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "K√§lte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Rauch/D√§mpfe",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Arbeit",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7001",
                        "title": "Welche Gerinnungsst√∂rung haben Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Antiphospholipidsyndrom",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Antithrombin-III-Mangel",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Faktor-V-Leiden-Mutation (APC-Resistenz)",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "H√§mophilie A",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Heparin-induzierte Thrombozytopenie",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Hyperhomocystein√§mie",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Protein-C-Mangel",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Protein-S-Mangel",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Von-Willebrand-Syndrom",
                                        "required": false
                                },
                                {
                                        "id": "7001_freitext",
                                        "type": "text",
                                        "label": "7001_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Antiphospholipidsyndrom",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Antithrombin-III-Mangel",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Faktor-V-Leiden-Mutation (APC-Resistenz)",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "H√§mophilie A",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Heparin-induzierte Thrombozytopenie",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Hyperhomocystein√§mie",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Protein-C-Mangel",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Protein-S-Mangel",
                                        "required": false
                                },
                                {
                                        "id": "7001",
                                        "type": "checkbox",
                                        "label": "Von-Willebrand-Syndrom",
                                        "required": false
                                },
                                {
                                        "id": "7001_freitext",
                                        "type": "text",
                                        "label": "7001_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7002",
                        "title": "Welche Lungenerkrankung haben Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Asthma bronchiale",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Chronisch obstruktive Lungenerkrankung (COPD)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Lungenemphysem",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Bronchiektasen",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Chronische Bronchitis (nicht obstruktiv)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Idiopathische pulmonale Fibrose (IPF)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Pneumokoniosen (z. B. Silikose, Asbestose)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Sarkoidose (Lunge)",
                                        "required": false
                                },
                                {
                                        "id": "7002_freitext",
                                        "type": "text",
                                        "label": "7002_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Asthma bronchiale",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Chronisch obstruktive Lungenerkrankung (COPD)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Lungenemphysem",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Bronchiektasen",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Chronische Bronchitis (nicht obstruktiv)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Idiopathische pulmonale Fibrose (IPF)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Pneumokoniosen (z. B. Silikose, Asbestose)",
                                        "required": false
                                },
                                {
                                        "id": "7002",
                                        "type": "checkbox",
                                        "label": "Sarkoidose (Lunge)",
                                        "required": false
                                },
                                {
                                        "id": "7002_freitext",
                                        "type": "text",
                                        "label": "7002_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7003",
                        "title": "Angaben zur Dialyseform",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "H√§modialyse",
                                        "required": false
                                },
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "Peritonealdialyse",
                                        "required": false
                                },
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "√úber funktionierenden AV-Shunt",
                                        "required": false
                                },
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "√úber Dialysekatheter",
                                        "required": false
                                },
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "H√§modialyse",
                                        "required": false
                                },
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "Peritonealdialyse",
                                        "required": false
                                },
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "√úber funktionierenden AV-Shunt",
                                        "required": false
                                },
                                {
                                        "id": "7003",
                                        "type": "checkbox",
                                        "label": "√úber Dialysekatheter",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7004",
                        "title": "Unter welcher Gem√ºtsst√∂rung leiden Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Major Depression (rezidivierende depressive St√∂rung)",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Dysthymie - anhaltende depressive St√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Schizoaffektive St√∂rung, depressive Form",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Saisonal abh√§ngige Depression (Winterdepression)",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Bipolare affektive St√∂rung (manisch-depressiv)",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Anpassungsst√∂rung mit depressiver Reaktion",
                                        "required": false
                                },
                                {
                                        "id": "7004_freitext",
                                        "type": "text",
                                        "label": "7004_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Major Depression (rezidivierende depressive St√∂rung)",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Dysthymie - anhaltende depressive St√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Schizoaffektive St√∂rung, depressive Form",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Saisonal abh√§ngige Depression (Winterdepression)",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Bipolare affektive St√∂rung (manisch-depressiv)",
                                        "required": false
                                },
                                {
                                        "id": "7004",
                                        "type": "checkbox",
                                        "label": "Anpassungsst√∂rung mit depressiver Reaktion",
                                        "required": false
                                },
                                {
                                        "id": "7004_freitext",
                                        "type": "text",
                                        "label": "7004_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7005",
                        "title": "Angaben zu Herzerkrankungen",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Herzklappenerkrankung",
                                        "required": false
                                },
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Kardiomyopathie",
                                        "required": false
                                },
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Offenes Foramen ovale",
                                        "required": false
                                },
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Vorhofflimmern",
                                        "required": false
                                },
                                {
                                        "id": "7005_freitext",
                                        "type": "text",
                                        "label": "7005_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Herzklappenerkrankung",
                                        "required": false
                                },
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Kardiomyopathie",
                                        "required": false
                                },
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Offenes Foramen ovale",
                                        "required": false
                                },
                                {
                                        "id": "7005",
                                        "type": "checkbox",
                                        "label": "Vorhofflimmern",
                                        "required": false
                                },
                                {
                                        "id": "7005_freitext",
                                        "type": "text",
                                        "label": "7005_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7006",
                        "title": "Angaben zu Magen-Darmerkrankungen",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "bili√§re Zirrhose",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "chron. Hepatitis",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Colitis ulcerosa",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Divertikelentz√ºndungen",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Fettleber",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "GERD - Gastrooesophagealer Reflux",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Gallensteinleiden",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Leberzirrhose",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Morbus Crohn",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Pankreatitis",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Pfortaderthrombose",
                                        "required": false
                                },
                                {
                                        "id": "7006_freitext",
                                        "type": "text",
                                        "label": "7006_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "bili√§re Zirrhose",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "chron. Hepatitis",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Colitis ulcerosa",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Divertikelentz√ºndungen",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Fettleber",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "GERD - Gastrooesophagealer Reflux",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Gallensteinleiden",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Leberzirrhose",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Morbus Crohn",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Pankreatitis",
                                        "required": false
                                },
                                {
                                        "id": "7006",
                                        "type": "checkbox",
                                        "label": "Pfortaderthrombose",
                                        "required": false
                                },
                                {
                                        "id": "7006_freitext",
                                        "type": "text",
                                        "label": "7006_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7007",
                        "title": "Angaben zu MRSA",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7007",
                                        "type": "checkbox",
                                        "label": "erfolgreich eradiziert",
                                        "required": false
                                },
                                {
                                        "id": "7007",
                                        "type": "checkbox",
                                        "label": "weiterhin vorhanden",
                                        "required": false
                                },
                                {
                                        "id": "7007",
                                        "type": "checkbox",
                                        "label": "erfolgreich eradiziert",
                                        "required": false
                                },
                                {
                                        "id": "7007",
                                        "type": "checkbox",
                                        "label": "weiterhin vorhanden",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7008",
                        "title": "Um welchen Nierenerkrankung handelt es sich?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Niereninsuffizienz (nicht dialysepflichtig)",
                                        "required": false
                                },
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Zystennieren",
                                        "required": false
                                },
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Nierenbeckenentz√ºndungen rezidivierend",
                                        "required": false
                                },
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Glomerulonephritis",
                                        "required": false
                                },
                                {
                                        "id": "7008_freitext",
                                        "type": "text",
                                        "label": "7008_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Niereninsuffizienz (nicht dialysepflichtig)",
                                        "required": false
                                },
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Zystennieren",
                                        "required": false
                                },
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Nierenbeckenentz√ºndungen rezidivierend",
                                        "required": false
                                },
                                {
                                        "id": "7008",
                                        "type": "checkbox",
                                        "label": "Glomerulonephritis",
                                        "required": false
                                },
                                {
                                        "id": "7008_freitext",
                                        "type": "text",
                                        "label": "7008_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7009",
                        "title": "Welche Nervenerkrankung haben Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Krampfleiden/Epilepsie",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Migraine",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Morbus Parkinson",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Multiple Sklerose",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Neuropathische Schmerzen",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Polyneuropathie",
                                        "required": false
                                },
                                {
                                        "id": "7009_freitext",
                                        "type": "text",
                                        "label": "7009_freitext",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Krampfleiden/Epilepsie",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Migraine",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Morbus Parkinson",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Multiple Sklerose",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Neuropathische Schmerzen",
                                        "required": false
                                },
                                {
                                        "id": "7009",
                                        "type": "checkbox",
                                        "label": "Polyneuropathie",
                                        "required": false
                                },
                                {
                                        "id": "7009_freitext",
                                        "type": "text",
                                        "label": "7009_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7010",
                        "title": "Welche Rheumerkrankung haben Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7010",
                                        "type": "checkbox",
                                        "label": "Rheumatoide Arthritis (chronische Polyarthritis)",
                                        "required": false
                                },
                                {
                                        "id": "7010",
                                        "type": "checkbox",
                                        "label": "Morbus Bechterew",
                                        "required": false
                                },
                                {
                                        "id": "7010",
                                        "type": "checkbox",
                                        "label": "Psoriasis-Arthritis",
                                        "required": false
                                },
                                {
                                        "id": "7010",
                                        "type": "checkbox",
                                        "label": "Systemischer Lupus erythematodes (SLE)",
                                        "required": false
                                },
                                {
                                        "id": "7010",
                                        "type": "checkbox",
                                        "label": "Gichtarthritis",
                                        "required": false
                                },
                                {
                                        "id": "7010_freitext",
                                        "type": "text",
                                        "label": "7010_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7011",
                        "title": "Unter welcher Schilddr√ºsenerkrankung leiden Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "7011",
                                        "type": "checkbox",
                                        "label": "Autonomie",
                                        "required": false
                                },
                                {
                                        "id": "7011",
                                        "type": "checkbox",
                                        "label": "Hashimoto",
                                        "required": false
                                },
                                {
                                        "id": "7011",
                                        "type": "checkbox",
                                        "label": "Morbus Basedow",
                                        "required": false
                                },
                                {
                                        "id": "7011",
                                        "type": "checkbox",
                                        "label": "Schilddr√ºsenvergr√∂√üerung",
                                        "required": false
                                },
                                {
                                        "id": "7011",
                                        "type": "checkbox",
                                        "label": "√úberfunktion",
                                        "required": false
                                },
                                {
                                        "id": "7011",
                                        "type": "checkbox",
                                        "label": "Unterfunktion",
                                        "required": false
                                },
                                {
                                        "id": "7011_freitext",
                                        "type": "text",
                                        "label": "7011_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q7102",
                        "title": "Asthma/COPD ‚Äì Verlauf und Kontrolle",
                        "fields": [
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "Husten",
                                        "required": false
                                },
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "pfeifende Atmung",
                                        "required": false
                                },
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "Luftnot",
                                        "required": false
                                },
                                {
                                        "id": "7102_leitsymptome",
                                        "type": "checkbox",
                                        "label": "Brustenge",
                                        "required": false
                                },
                                {
                                        "id": "7102_hustenart",
                                        "type": "select",
                                        "label": "2. Husten vorwiegend",
                                        "required": false,
                                        "options": [
                                                "trocken",
                                                "produktiv",
                                                "wechselnd"
                                        ]
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Fr√ºhling",
                                        "required": false
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Sommer",
                                        "required": false
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Herbst",
                                        "required": false
                                },
                                {
                                        "id": "7102_saison",
                                        "type": "checkbox",
                                        "label": "Winter",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Anstrengung",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Pollen",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Hausstaub",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Tier",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Schimmel/Feuchte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "K√§lte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Reizstoffe",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger_allergie",
                                        "type": "checkbox",
                                        "label": "Wetterwechsel",
                                        "required": false
                                },
                                {
                                        "id": "7102_freq_day",
                                        "type": "radio",
                                        "label": "‚â§2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_freq_day",
                                        "type": "radio",
                                        "label": ">2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_freq_day",
                                        "type": "radio",
                                        "label": "t√§glich",
                                        "required": false
                                },
                                {
                                        "id": "7102_night",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_night",
                                        "type": "radio",
                                        "label": "1‚Äì2√ó/Monat",
                                        "required": false
                                },
                                {
                                        "id": "7102_night",
                                        "type": "radio",
                                        "label": "‚â•1√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_saba_use",
                                        "type": "radio",
                                        "label": "‚â§2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_saba_use",
                                        "type": "radio",
                                        "label": ">2√ó/Woche",
                                        "required": false
                                },
                                {
                                        "id": "7102_saba_use",
                                        "type": "radio",
                                        "label": "t√§glich",
                                        "required": false
                                },
                                {
                                        "id": "7102_activity",
                                        "type": "radio",
                                        "label": "nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_activity",
                                        "type": "radio",
                                        "label": "leicht",
                                        "required": false
                                },
                                {
                                        "id": "7102_activity",
                                        "type": "radio",
                                        "label": "deutlich",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_count",
                                        "type": "text",
                                        "label": "Anzahl",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_ocs",
                                        "type": "radio",
                                        "label": "OCS n√∂tig? ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_ocs",
                                        "type": "radio",
                                        "label": "OCS n√∂tig? nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_hosp",
                                        "type": "radio",
                                        "label": "Klinikaufnahme? ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_hosp",
                                        "type": "radio",
                                        "label": "Klinikaufnahme? nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_intub",
                                        "type": "radio",
                                        "label": "notwendige Intubation ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_exac_intub",
                                        "type": "radio",
                                        "label": "notwendige Intubation nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_pneumothorax",
                                        "type": "radio",
                                        "label": "Fr√ºhere Pneumothorax: ja",
                                        "required": false
                                },
                                {
                                        "id": "7102_pneumothorax",
                                        "type": "radio",
                                        "label": "Fr√ºhere Pneumothorax: nein",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Infekte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Anstrengung",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Allergene (Pollen/Tier/Staub)",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "K√§lte",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Rauch/D√§mpfe",
                                        "required": false
                                },
                                {
                                        "id": "7102_trigger2",
                                        "type": "checkbox",
                                        "label": "Arbeit",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8000",
                        "title": "Gab es bei Ihnen bereits folgende Erkrankungen oder Eingriffe?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Aneurysma",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Arterielle Durchblutungsst√∂rung",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Beinvenenthrombose",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Gef√§√üeingriffe/Herzoperation(OP)",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Herzinfarkt",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Infektionskrankheiten",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Krebs",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Lungenarterienembolie",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Organtransplantation",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "Schlaganfall",
                                        "required": false
                                },
                                {
                                        "id": "8000",
                                        "type": "checkbox",
                                        "label": "keine",
                                        "required": false
                                },
                                {
                                        "id": "8000_freitext",
                                        "type": "text",
                                        "label": "8000_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8001",
                        "title": "Wo befand sich das Aneurysma?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Bauch",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Brustkorb",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Leiste",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Kniekehle",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Kopf",
                                        "required": false
                                },
                                {
                                        "id": "8001_freitext",
                                        "type": "text",
                                        "label": "8001_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Bauch",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Brustkorb",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Leiste",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Kniekehle",
                                        "required": false
                                },
                                {
                                        "id": "8001",
                                        "type": "checkbox",
                                        "label": "Kopf",
                                        "required": false
                                },
                                {
                                        "id": "8001_freitext",
                                        "type": "text",
                                        "label": "8001_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8002",
                        "title": "Wie wurde das Aneurysma behandelt?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8002",
                                        "type": "radio",
                                        "label": "Operation",
                                        "required": false
                                },
                                {
                                        "id": "8002",
                                        "type": "radio",
                                        "label": "Endoprothese",
                                        "required": false
                                },
                                {
                                        "id": "8002",
                                        "type": "radio",
                                        "label": "ohne Behandlung - Beobachtung",
                                        "required": false
                                },
                                {
                                        "id": "8002",
                                        "type": "radio",
                                        "label": "Operation",
                                        "required": false
                                },
                                {
                                        "id": "8002",
                                        "type": "radio",
                                        "label": "Endoprothese",
                                        "required": false
                                },
                                {
                                        "id": "8002",
                                        "type": "radio",
                                        "label": "ohne Behandlung - Beobachtung",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8003",
                        "title": "Welche Arterienerkrankung hatten Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Arterienverkalkung (Gef√§√ü-verengung/verschluss)",
                                        "required": false
                                },
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Dissektion",
                                        "required": false
                                },
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Schaufensterkrankheit",
                                        "required": false
                                },
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Embolie",
                                        "required": false
                                },
                                {
                                        "id": "8003_freitext",
                                        "type": "text",
                                        "label": "8003_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Arterienverkalkung (Gef√§√ü-verengung/verschluss)",
                                        "required": false
                                },
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Dissektion",
                                        "required": false
                                },
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Schaufensterkrankheit",
                                        "required": false
                                },
                                {
                                        "id": "8003",
                                        "type": "checkbox",
                                        "label": "Embolie",
                                        "required": false
                                },
                                {
                                        "id": "8003_freitext",
                                        "type": "text",
                                        "label": "8003_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8004",
                        "title": "Welche Behandlungen wurden durchgef√ºhrt?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Gef√§√üaussch√§lung (TEA)",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Bypassoperation",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Embolektomie",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Gef√§√üaufdehnung mit Ballon (PTA)",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Stent",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Y-Prothese",
                                        "required": false
                                },
                                {
                                        "id": "8004_freitext",
                                        "type": "text",
                                        "label": "8004_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Gef√§√üaussch√§lung (TEA)",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Bypassoperation",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Embolektomie",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Gef√§√üaufdehnung mit Ballon (PTA)",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Stent",
                                        "required": false
                                },
                                {
                                        "id": "8004",
                                        "type": "checkbox",
                                        "label": "Y-Prothese",
                                        "required": false
                                },
                                {
                                        "id": "8004_freitext",
                                        "type": "text",
                                        "label": "8004_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8005",
                        "title": "Wie oft hatten Sie eine Thrombose?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8005",
                                        "type": "text",
                                        "label": "8005",
                                        "required": false
                                },
                                {
                                        "id": "8005",
                                        "type": "text",
                                        "label": "8005",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8006",
                        "title": "Wann und wo (Bein/Arm) hatten Sie eine Thrombose?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8006",
                                        "type": "text",
                                        "label": "8006",
                                        "required": false
                                },
                                {
                                        "id": "8006",
                                        "type": "text",
                                        "label": "8006",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8007",
                        "title": "Welche Gef√§√ü- oder Herzoperationen wurden durchgef√ºhrt?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "Krampfaderoperation (Stripping/Laser)",
                                        "required": false
                                },
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "Operation an der Halsschlagader (TEA/Stent)",
                                        "required": false
                                },
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "ACVB (Herzbypass)",
                                        "required": false
                                },
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "Herzklappenersatz",
                                        "required": false
                                },
                                {
                                        "id": "8007_freitext",
                                        "type": "text",
                                        "label": "8007_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "Krampfaderoperation (Stripping/Laser)",
                                        "required": false
                                },
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "Operation an der Halsschlagader (TEA/Stent)",
                                        "required": false
                                },
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "ACVB (Herzbypass)",
                                        "required": false
                                },
                                {
                                        "id": "8007",
                                        "type": "checkbox",
                                        "label": "Herzklappenersatz",
                                        "required": false
                                },
                                {
                                        "id": "8007_freitext",
                                        "type": "text",
                                        "label": "8007_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8008",
                        "title": "Wann hatten Sie einen Herzinfarkt?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8008",
                                        "type": "text",
                                        "label": "8008",
                                        "required": false
                                },
                                {
                                        "id": "8008",
                                        "type": "text",
                                        "label": "8008",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8009",
                        "title": "Welche Behandlung wurde durchgef√ºhrt?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8009",
                                        "type": "checkbox",
                                        "label": "Stent",
                                        "required": false
                                },
                                {
                                        "id": "8009",
                                        "type": "checkbox",
                                        "label": "Bypassoperation",
                                        "required": false
                                },
                                {
                                        "id": "8009",
                                        "type": "checkbox",
                                        "label": "Lysetherapie",
                                        "required": false
                                },
                                {
                                        "id": "8009_freitext",
                                        "type": "text",
                                        "label": "8009_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8009",
                                        "type": "checkbox",
                                        "label": "Stent",
                                        "required": false
                                },
                                {
                                        "id": "8009",
                                        "type": "checkbox",
                                        "label": "Bypassoperation",
                                        "required": false
                                },
                                {
                                        "id": "8009",
                                        "type": "checkbox",
                                        "label": "Lysetherapie",
                                        "required": false
                                },
                                {
                                        "id": "8009_freitext",
                                        "type": "text",
                                        "label": "8009_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8010",
                        "title": "Welche Krebserkrankungen hatten Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Blutkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Brustkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Bronchialkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Darmkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Geb√§rmutterhalskrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Hautkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Lymphdr√ºsenkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Magenkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Ovarialkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Prostatakrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010_freitext",
                                        "type": "text",
                                        "label": "8010_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Blutkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Brustkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Bronchialkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Darmkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Geb√§rmutterhalskrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Hautkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Lymphdr√ºsenkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Magenkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Ovarialkrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010",
                                        "type": "checkbox",
                                        "label": "Prostatakrebs",
                                        "required": false
                                },
                                {
                                        "id": "8010_freitext",
                                        "type": "text",
                                        "label": "8010_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8011",
                        "title": "Welche Behandlung wurde durchgef√ºhrt?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Chemotherapie",
                                        "required": false
                                },
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Immuntherapie",
                                        "required": false
                                },
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Operation",
                                        "required": false
                                },
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Strahlentherapie",
                                        "required": false
                                },
                                {
                                        "id": "8011_freitext",
                                        "type": "text",
                                        "label": "8011_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Chemotherapie",
                                        "required": false
                                },
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Immuntherapie",
                                        "required": false
                                },
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Operation",
                                        "required": false
                                },
                                {
                                        "id": "8011",
                                        "type": "checkbox",
                                        "label": "Strahlentherapie",
                                        "required": false
                                },
                                {
                                        "id": "8011_freitext",
                                        "type": "text",
                                        "label": "8011_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8012",
                        "title": "Ist die Krebsbehandlung abgeschlossen?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8012",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "8012",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                },
                                {
                                        "id": "8012",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "8012",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8013",
                        "title": "Wann hatten Sie eine Lungenarterienembolie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8013",
                                        "type": "text",
                                        "label": "8013",
                                        "required": false
                                },
                                {
                                        "id": "8013",
                                        "type": "text",
                                        "label": "8013",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8014",
                        "title": "Was wurde transplantiert?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Herz",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Leber",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Lunge",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Niere",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Pankreas",
                                        "required": false
                                },
                                {
                                        "id": "8014_freitext",
                                        "type": "text",
                                        "label": "8014_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Herz",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Leber",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Lunge",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Niere",
                                        "required": false
                                },
                                {
                                        "id": "8014",
                                        "type": "checkbox",
                                        "label": "Pankreas",
                                        "required": false
                                },
                                {
                                        "id": "8014_freitext",
                                        "type": "text",
                                        "label": "8014_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8015",
                        "title": "Wann hatten Sie Ihren Schlaganfall?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8015",
                                        "type": "text",
                                        "label": "8015",
                                        "required": false
                                },
                                {
                                        "id": "8015",
                                        "type": "text",
                                        "label": "8015",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8016",
                        "title": "Welche Infektionskrankheiten hatten Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Borreliose",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Hepatitis B",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Hepatitis C",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "HIV-Infektion / AIDS",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Malaria",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Tuberkulose",
                                        "required": false
                                },
                                {
                                        "id": "8016_freitext",
                                        "type": "text",
                                        "label": "8016_freitext",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Borreliose",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Hepatitis B",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Hepatitis C",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "HIV-Infektion / AIDS",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Malaria",
                                        "required": false
                                },
                                {
                                        "id": "8016",
                                        "type": "checkbox",
                                        "label": "Tuberkulose",
                                        "required": false
                                },
                                {
                                        "id": "8016_freitext",
                                        "type": "text",
                                        "label": "8016_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8501",
                        "title": "Mammographie-Screening (Frauen ‚â• 50 Jahre)",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8501",
                                        "type": "radio",
                                        "label": "Teilnahme in den letzten 2 Jahren",
                                        "required": false
                                },
                                {
                                        "id": "8501",
                                        "type": "radio",
                                        "label": "keine Teilnahme in den letzten 2 Jahren",
                                        "required": false
                                },
                                {
                                        "id": "8501_freitext",
                                        "type": "text",
                                        "label": "8501_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8502",
                        "title": "Prostata-Tastuntersuchung (M√§nner ‚â• 45 Jahre)",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8502",
                                        "type": "radio",
                                        "label": "in den letzten 12 Monaten erfolgt",
                                        "required": false
                                },
                                {
                                        "id": "8502",
                                        "type": "radio",
                                        "label": "> 12 Monate oder noch nie",
                                        "required": false
                                },
                                {
                                        "id": "8502_freitext",
                                        "type": "text",
                                        "label": "8502_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8503",
                        "title": "Bauchaortenaneurysma-Screening (M√§nner ‚â• 65 Jahre, einmalig)",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8503",
                                        "type": "radio",
                                        "label": "bereits durchgef√ºhrt (einmalig)",
                                        "required": false
                                },
                                {
                                        "id": "8503",
                                        "type": "radio",
                                        "label": "noch nicht durchgef√ºhrt",
                                        "required": false
                                },
                                {
                                        "id": "8503_freitext",
                                        "type": "text",
                                        "label": "8503_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8504",
                        "title": "Menopausen-Status (Frauen ‚â• 40 Jahre, optional)",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8504",
                                        "type": "radio",
                                        "label": "pr√§menopausal",
                                        "required": false
                                },
                                {
                                        "id": "8504",
                                        "type": "radio",
                                        "label": "perimenopausal",
                                        "required": false
                                },
                                {
                                        "id": "8504",
                                        "type": "radio",
                                        "label": "postmenopausal",
                                        "required": false
                                },
                                {
                                        "id": "8504",
                                        "type": "radio",
                                        "label": "nicht angeben",
                                        "required": false
                                },
                                {
                                        "id": "8504_freitext",
                                        "type": "text",
                                        "label": "8504_freitext",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8800",
                        "title": "Nehmen Sie die Antibabypille?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8800",
                                        "type": "radio",
                                        "label": "Ja",
                                        "required": false
                                },
                                {
                                        "id": "8800",
                                        "type": "radio",
                                        "label": "Nein",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q8900",
                        "title": "üíä Welche Medikamente erhalten Sie?",
                        "condition": {
                                "field": "2005",
                                "operator": "==",
                                "value": "Nein"
                        },
                        "fields": [
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Keine Medikamente",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Antihypertensiva (ACE-Hemmer; AT1-Blocker; Betablocker; Calciumantagonisten; Diuretika)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Lipidsenker (Statine; Ezetimib)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Antikoagulanzien (DOAK; Marcumar)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Thrombozytenaggregationshemmer (ASS; Clopidogrel)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Antidiabetika (Metformin; Insulin; SGLT2-Hemmer; GLP-1-Analoga)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Schilddr√ºsenpr√§parate (Levothyroxin)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Kortikosteroide (systemisch; inhalativ)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Osteoporosemittel (Bisphosphonate; Denosumab)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Inhalative Glukokortikoide",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Beta-2-Sympathomimetika (langwirksam)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Anticholinergika (LAMA)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Leukotrienantagonisten (Lukaste)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Protonenpumpenhemmer (Pantoprazol; Omeprazol)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Analgetika (NSAR; Paracetamol; Metamizol)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Opioide (chronische Schmerztherapie)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Antidepressiva (SSRI; SNRI; trizyklisch)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Antipsychotika",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Antiepileptika",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Sedativa / Hypnotika",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Antidementiva",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Prostatamedikamente (Alphablocker; 5-Alpha-Reduktasehemmer)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Hormonpr√§parate (√ñstrogene; Gestagene; Testosteron; Schilddr√ºsenhormone)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Immunsuppressiva / Immunmodulatoren (Methotrexat; Biologika)",
                                        "required": false
                                },
                                {
                                        "id": "8900",
                                        "type": "checkbox",
                                        "label": "Vitamine / Mineralstoffe (Vitamin D; Calcium; B12)",
                                        "required": false
                                },
                                {
                                        "id": "8900_gesamt",
                                        "type": "text",
                                        "label": "8900_gesamt",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q9000",
                        "title": "Kontaktdaten vor Versand pr√ºfen",
                        "fields": [
                                {
                                        "id": "confirm_email",
                                        "type": "checkbox",
                                        "label": "Ich best√§tige, dass ich die Daten √ºbermitteln m√∂chte.",
                                        "required": false
                                },
                                {
                                        "id": "9001",
                                        "type": "text",
                                        "label": "eMail-Adresse",
                                        "required": true
                                },
                                {
                                        "id": "9002",
                                        "type": "text",
                                        "label": "mobile R√ºckrufnummer",
                                        "required": false
                                },
                                {
                                        "id": "9001_gesamt",
                                        "type": "text",
                                        "label": "9001_gesamt",
                                        "required": false
                                },
                                {
                                        "id": "9002_gesamt",
                                        "type": "text",
                                        "label": "9002_gesamt",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q9001",
                        "title": "q9001",
                        "fields": [
                                {
                                        "id": "9001",
                                        "type": "text",
                                        "label": "eMail-Adresse",
                                        "required": true
                                },
                                {
                                        "id": "9002",
                                        "type": "text",
                                        "label": "mobile R√ºckrufnummer",
                                        "required": false
                                }
                        ]
                },
                {
                        "id": "q9900",
                        "title": "Wie zufrieden sind Sie mit diesem Fragebogen?",
                        "fields": [
                                {
                                        "id": "9900",
                                        "type": "radio",
                                        "label": "9900",
                                        "required": false
                                },
                                {
                                        "id": "9900",
                                        "type": "radio",
                                        "label": "9900",
                                        "required": false
                                },
                                {
                                        "id": "9900",
                                        "type": "radio",
                                        "label": "9900",
                                        "required": false
                                },
                                {
                                        "id": "9900",
                                        "type": "radio",
                                        "label": "9900",
                                        "required": false
                                },
                                {
                                        "id": "9900",
                                        "type": "radio",
                                        "label": "9900",
                                        "required": false
                                },
                                {
                                        "id": "9900_freitext",
                                        "type": "text",
                                        "label": "9900_freitext",
                                        "required": false
                                }
                        ]
                }
        ]
};</script>

    <script>
        // =================================================================
        // APP STATE
        // =================================================================
        const AppState = {
            currentStep: 0,
            answers: {},
            language: 'en',  // Changed to English as default
            isDarkMode: false,
            privacyAccepted: false
        };

        // =================================================================
        // HILFSFUNKTIONEN
        // =================================================================
        function T(key) {
            if (!window.APP_DATA?.translations) return key;
            const trans = window.APP_DATA.translations[AppState.language];
            return trans?.[key] || key;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' };
            return String(text).replace(/[&<>"']/g, m => map[m]);
        }

        function validateEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function validatePhone(phone) {
            return /^[\d\s\+\-\(\)]*$/.test(phone);
        }

        // ====================================================================
        // SECURITY: ENHANCED XSS PREVENTION
        // ====================================================================
        const SecurityUtils = {
            // Sanitize HTML more thoroughly
            sanitizeHTML(html) {
                if (!html) return '';
                const div = document.createElement('div');
                div.textContent = html;
                return div.innerHTML;
            },

            // Validate and sanitize URLs
            sanitizeURL(url) {
                if (!url) return '';
                try {
                    const parsed = new URL(url);
                    // Only allow http and https protocols
                    if (!['http:', 'https:'].includes(parsed.protocol)) {
                        console.warn('[Security] Blocked potentially dangerous URL protocol:', parsed.protocol);
                        return '';
                    }
                    return parsed.href;
                } catch (e) {
                    console.warn('[Security] Invalid URL:', url);
                    return '';
                }
            },

            // Check for dangerous patterns
            containsDangerousPatterns(text) {
                if (!text) return false;
                const dangerousPatterns = [
                    /<script[^>]*>.*?<\/script>/gi,
                    /javascript:/gi,
                    /on\w+\s*=/gi, // Event handlers
                    /<iframe/gi,
                    /<object/gi,
                    /<embed/gi
                ];
                return dangerousPatterns.some(pattern => pattern.test(text));
            },

            // Safe text content setter
            setTextContent(element, text) {
                if (element && text !== undefined && text !== null) {
                    element.textContent = String(text);
                }
            }
        };

        // ====================================================================
        // SECURITY: SIMPLE RATE LIMITING
        // ====================================================================
        class SimpleRateLimiter {
            constructor() {
                this.actions = new Map();
                this.limits = {
                    save: { max: 10, window: 60000 }, // 10 saves per minute
                    navigation: { max: 30, window: 60000 }, // 30 navigations per minute
                    formSubmit: { max: 5, window: 60000 } // 5 submits per minute
                };
            }

            isAllowed(actionType) {
                const now = Date.now();
                const limit = this.limits[actionType];
                
                if (!limit) return true; // No limit configured

                if (!this.actions.has(actionType)) {
                    this.actions.set(actionType, []);
                }

                const timestamps = this.actions.get(actionType);
                
                // Clean old timestamps
                const validTimestamps = timestamps.filter(t => now - t < limit.window);
                
                // Check if limit exceeded
                if (validTimestamps.length >= limit.max) {
                    console.warn(`[RateLimit] Action '${actionType}' rate limit exceeded`);
                    return false;
                }

                // Add current timestamp
                validTimestamps.push(now);
                this.actions.set(actionType, validTimestamps);
                
                return true;
            }

            reset(actionType) {
                if (actionType) {
                    this.actions.delete(actionType);
                } else {
                    this.actions.clear();
                }
            }
        }

        // Initialize rate limiter
        window.rateLimiter = new SimpleRateLimiter();

        // ====================================================================
        // STORAGE: SECURE LOCAL STORAGE WRAPPER
        // ====================================================================
        const SecureStorage = {
            // Check if localStorage is available
            isAvailable() {
                try {
                    const test = '__storage_test__';
                    localStorage.setItem(test, test);
                    localStorage.removeItem(test);
                    return true;
                } catch (e) {
                    return false;
                }
            },

            // Set item with error handling
            setItem(key, value) {
                if (!this.isAvailable()) {
                    console.warn('[Storage] localStorage not available');
                    return false;
                }
                
                try {
                    if (typeof value === 'object') {
                        value = JSON.stringify(value);
                    }
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        console.error('[Storage] Quota exceeded. Consider clearing old data.');
                    } else {
                        console.error('[Storage] Error saving to localStorage:', e);
                    }
                    return false;
                }
            },

            // Get item with error handling
            getItem(key, defaultValue = null) {
                if (!this.isAvailable()) {
                    return defaultValue;
                }
                
                try {
                    const value = localStorage.getItem(key);
                    if (value === null) return defaultValue;
                    
                    // Try to parse as JSON
                    try {
                        return JSON.parse(value);
                    } catch (e) {
                        return value;
                    }
                } catch (e) {
                    console.error('[Storage] Error reading from localStorage:', e);
                    return defaultValue;
                }
            },

            // Remove item
            removeItem(key) {
                if (!this.isAvailable()) return false;
                
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (e) {
                    console.error('[Storage] Error removing from localStorage:', e);
                    return false;
                }
            },

            // Clear all
            clear() {
                if (!this.isAvailable()) return false;
                
                try {
                    localStorage.clear();
                    return true;
                } catch (e) {
                    console.error('[Storage] Error clearing localStorage:', e);
                    return false;
                }
            }
        };

        /**
         * Validate a field and show feedback
         * @param {string} fieldId - The field ID to validate
         * @param {object} field - The field definition from APP_DATA
         * @returns {boolean} - True if valid, false otherwise
         */
        function validateField(fieldId, field) {
            const value = AppState.answers[fieldId];
            const feedbackElement = document.getElementById(`feedback_${fieldId}`);
            
            if (!feedbackElement) return true;
            
            // Check required fields
            if (field.required) {
                if (!value || value === '' || (Array.isArray(value) && value.length === 0)) {
                    feedbackElement.innerHTML = '‚ö†Ô∏è Dieses Feld ist erforderlich';
                    feedbackElement.className = 'validation-feedback error';
                    return false;
                }
            }
            
            // Check number field ranges
            if (field.type === 'number' && value) {
                const num = parseFloat(value);
                if (field.min !== undefined && num < field.min) {
                    feedbackElement.innerHTML = `‚ö†Ô∏è Wert muss mindestens ${field.min} sein`;
                    feedbackElement.className = 'validation-feedback error';
                    return false;
                }
                if (field.max !== undefined && num > field.max) {
                    feedbackElement.innerHTML = `‚ö†Ô∏è Wert darf maximal ${field.max} sein`;
                    feedbackElement.className = 'validation-feedback error';
                    return false;
                }
            }
            
            // All validations passed
            if (value) {
                feedbackElement.innerHTML = '‚úì G√ºltig';
                feedbackElement.className = 'validation-feedback success';
            } else {
                feedbackElement.innerHTML = '';
                feedbackElement.className = 'validation-feedback';
            }
            return true;
        }

        /**
         * Clear validation feedback when user starts typing
         * @param {string} fieldId - The field ID
         */
        function clearValidationFeedback(fieldId) {
            const feedbackElement = document.getElementById(`feedback_${fieldId}`);
            if (feedbackElement && feedbackElement.classList.contains('error')) {
                feedbackElement.innerHTML = '';
                feedbackElement.className = 'validation-feedback';
            }
        }

        // =================================================================
        // APP OBJEKT
        // =================================================================
        const App = {
            async init() {
                console.log('üè• Anamnese App v2.0 initialisiert');
                
                if (!window.APP_DATA?.sections) {
                    document.getElementById('question-area').innerHTML = 
                        '<p style="color: var(--danger);">‚ùå Fehler: Daten nicht geladen.</p>';
                    return;
                }
                
                // Setup encryption key before anything else
                await setupEncryptionKey();

                this.loadFromStorage();
                
                // Try to restore auto-saved data
                const restored = restoreAutoSave();
                if (restored) {
                    // Data was restored, re-render
                    this.renderStep(AppState.currentStep);
                    this.updateProgress();
                }
                
                this.populateLanguageSelect();
                
                // Set RTL for Arabic, Farsi, and Urdu on initial load
                if (AppState.language === 'ar' || AppState.language === 'fa' || AppState.language === 'ur') {
                    document.body.setAttribute('dir', 'rtl');
                    document.documentElement.setAttribute('lang', AppState.language);
                } else {
                    document.body.setAttribute('dir', 'ltr');
                    document.documentElement.setAttribute('lang', AppState.language);
                }
                
                this.updateUITexts();  // Apply translations on initial load
                document.body.classList.toggle('dark', AppState.isDarkMode);
                this.updateThemeButton();

                if (AppState.privacyAccepted) {
                    document.getElementById('privacy-modal').classList.add('hidden');
                    document.getElementById('app-container').classList.remove('hidden');
                    this.renderStep(AppState.currentStep);
                } else {
                    // Also update texts in privacy modal
                    this.updateUITexts();
                }
            },

            // ----- PRIVACY -----
            acceptPrivacy() {
                AppState.privacyAccepted = true;
                this.saveToStorage();
                document.getElementById('privacy-modal').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                this.renderStep(0);
            },

            // ----- LANGUAGE -----
            populateLanguageSelect() {
                const select = document.getElementById('language-select');
                if (!window.APP_DATA?.language_names) return;
                
                select.innerHTML = '';
                for (const [code, name] of Object.entries(window.APP_DATA.language_names)) {
                    const opt = document.createElement('option');
                    opt.value = code;
                    opt.textContent = name;
                    if (code === AppState.language) opt.selected = true;
                    select.appendChild(opt);
                }
            },

            changeLanguage(lang) {
                AppState.language = lang;
                
                // Set RTL for Arabic, Farsi, and Urdu
                if (lang === 'ar' || lang === 'fa' || lang === 'ur') {
                    document.body.setAttribute('dir', 'rtl');
                    document.documentElement.setAttribute('lang', lang);
                } else {
                    document.body.setAttribute('dir', 'ltr');
                    document.documentElement.setAttribute('lang', lang);
                }
                
                this.saveToStorage();
                this.renderStep(AppState.currentStep);
                this.updateUITexts();
            },

            updateUITexts() {
                // Update all elements with data-translate attribute
                document.querySelectorAll('[data-translate]').forEach(el => {
                    const key = el.getAttribute('data-translate');
                    const translation = T(key);
                    if (translation && translation !== key) {
                        el.textContent = translation;
                    }
                });
            },

            // ----- THEME -----
            toggleTheme() {
                AppState.isDarkMode = !AppState.isDarkMode;
                document.body.classList.toggle('dark', AppState.isDarkMode);
                this.updateThemeButton();
                this.saveToStorage();
            },

            updateThemeButton() {
                const btn = document.getElementById('theme-toggle');
                btn.textContent = AppState.isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            },

            // ----- STORAGE -----
            saveToStorage() {
                try {
                    localStorage.setItem('anamnese_state', JSON.stringify({
                        answers: AppState.answers,
                        language: AppState.language,
                        isDarkMode: AppState.isDarkMode,
                        currentStep: AppState.currentStep,
                        privacyAccepted: AppState.privacyAccepted
                    }));
                } catch (e) { console.error('Storage error:', e); }
            },

            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('anamnese_state');
                    if (saved) {
                        const data = JSON.parse(saved);
                        Object.assign(AppState, data);
                    }
                } catch (e) { console.error('Storage error:', e); }
            },

            // ----- RENDER -----
            renderStep(index) {
                const sections = window.APP_DATA.sections;
                if (!sections || index >= sections.length) return;

                AppState.currentStep = index;
                const section = sections[index];
                
                // Check if section has a condition and if it's met using the enhanced checkCondition function
                if (section.condition) {
                    // checkCondition is a required function defined in the same script tag
                    if (typeof checkCondition !== 'function') {
                        console.error('[App] checkCondition function is not available. Conditional logic will not work properly.');
                        // Don't skip sections if the function is missing - this ensures visibility
                    } else {
                        const conditionMet = checkCondition(section);
                        
                        // If condition not met, skip to next section
                        if (!conditionMet) {
                            // Delete answers from this hidden section
                            if (section.fields) {
                                section.fields.forEach(field => {
                                    delete AppState.answers[field.id];
                                });
                            }
                            
                            // Auto-advance or go back depending on navigation direction
                            if (index < sections.length - 1) {
                                this.renderStep(index + 1);
                            } else {
                                this.renderStep(index - 1);
                            }
                            return;
                        }
                    }
                }
                
                const qa = document.getElementById('question-area');
                
                // Title
                const titleKey = `title_${section.id}`;
                const title = T(titleKey) !== titleKey ? T(titleKey) : section.title;
                
                let html = `<h2>${escapeHtml(title)}</h2>`;

                // Fields
                if (section.fields) {
                    section.fields.forEach(field => {
                        html += this.renderField(field);
                    });
                }

                qa.innerHTML = html;
                this.updateProgress();
                this.updateNavButtons();
                this.attachFieldListeners();
                this.saveToStorage();
            },

            renderField(field) {
                const labelKey = `label_${field.id}`;
                const required = field.required ? '<span class="required-star">*</span>' : '';
                const currentValue = AppState.answers[field.id] || '';
                const fieldId = `field_${field.id}`;

                let html = `<div class="form-group" data-field-id="${field.id}">`;
                
                // For checkbox/radio fields without options array, render as individual option
                // Use field.label directly instead of translation to get the specific option text
                if ((field.type === 'checkbox' || field.type === 'radio') && !field.options) {
                    const checkedValues = Array.isArray(currentValue) ? currentValue : (currentValue ? [currentValue] : []);
                    const checked = field.type === 'checkbox' 
                        ? (checkedValues.includes(field.label) ? 'checked' : '')
                        : (currentValue === field.label ? 'checked' : '');
                    const selected = checked ? 'selected' : '';
                    
                    html += `<label class="option-item ${selected}">`;
                    html += `<input type="${field.type}" name="${field.id}" value="${escapeHtml(field.label)}" ${checked} data-field-id="${field.id}">`;
                    html += `<span>${escapeHtml(field.label)}</span>`;
                    html += `</label>`;
                    html += `</div>`;
                    return html;
                }
                
                // For other field types, use translation or fallback to field.label
                const label = T(labelKey) !== labelKey ? T(labelKey) : field.label;
                html += `<label class="question-label">${escapeHtml(label)}${required}</label>`;

                switch (field.type) {
                    case 'text':
                    case 'email':
                    case 'tel':
                    case 'date':
                    case 'number':
                        html += `<div class="input-wrapper">`;
                        html += `<input type="${field.type}" id="${fieldId}" value="${escapeHtml(currentValue)}" 
                                 data-field-id="${field.id}" ${field.required ? 'required' : ''}
                                 ${field.min !== undefined ? `min="${field.min}"` : ''}
                                 ${field.max !== undefined ? `max="${field.max}"` : ''}>`;
                        html += `</div>`;
                        html += `<div class="validation-feedback" id="feedback_${field.id}"></div>`;
                        break;

                    case 'textarea':
                        html += `<div class="input-wrapper">`;
                        html += `<textarea id="${fieldId}" rows="3" data-field-id="${field.id}" 
                                 ${field.required ? 'required' : ''}>${escapeHtml(currentValue)}</textarea>`;
                        html += `</div>`;
                        html += `<div class="validation-feedback" id="feedback_${field.id}"></div>`;
                        break;

                    case 'select':
                        html += `<select id="${fieldId}" data-field-id="${field.id}" ${field.required ? 'required' : ''}>`;
                        
                        // Special handling for birthdate fields (0003_tag, 0003_monat, 0003_jahr)
                        if (field.id === '0003_tag') {
                            html += `<option value="">${T('0003_tag')}</option>`;
                            for (let i = 1; i <= 31; i++) {
                                const selected = currentValue === String(i) ? 'selected' : '';
                                html += `<option value="${i}" ${selected}>${i}</option>`;
                            }
                        } else if (field.id === '0003_monat') {
                            html += `<option value="">${T('0003_monat')}</option>`;
                            // Use numeric month values (1-12) for universal internationalization
                            for (let i = 1; i <= 12; i++) {
                                const selected = currentValue === String(i) ? 'selected' : '';
                                html += `<option value="${i}" ${selected}>${i}</option>`;
                            }
                        } else if (field.id === '0003_jahr') {
                            html += `<option value="">${T('0003_jahr')}</option>`;
                            const currentYear = new Date().getFullYear();
                            for (let i = 0; i < 100; i++) {
                                const year = currentYear - i;
                                const selected = currentValue === String(year) ? 'selected' : '';
                                html += `<option value="${year}" ${selected}>${year}</option>`;
                            }
                        } else {
                            // Standard select with options
                            html += `<option value="">${T('please_select')}</option>`;
                            if (field.options) {
                                field.options.forEach((opt, i) => {
                                    const optKey = `opt_${field.id}_${i}`;
                                    const optLabel = T(optKey) !== optKey ? T(optKey) : opt;
                                    const selected = currentValue === opt ? 'selected' : '';
                                    html += `<option value="${escapeHtml(opt)}" ${selected}>${escapeHtml(optLabel)}</option>`;
                                });
                            }
                        }
                        html += `</select>`;
                        html += `<div class="validation-feedback" id="feedback_${field.id}"></div>`;
                        break;

                    case 'radio':
                        html += `<div class="options-list">`;
                        if (field.options) {
                            field.options.forEach((opt, i) => {
                                const optKey = `opt_${field.id}_${i}`;
                                const optLabel = T(optKey) !== optKey ? T(optKey) : opt;
                                const checked = currentValue === opt ? 'checked' : '';
                                const selected = currentValue === opt ? 'selected' : '';
                                html += `<label class="option-item ${selected}">`;
                                html += `<input type="radio" name="${field.id}" value="${escapeHtml(opt)}" ${checked} data-field-id="${field.id}">`;
                                html += `<span>${escapeHtml(optLabel)}</span>`;
                                html += `</label>`;
                            });
                        }
                        html += `</div>`;
                        html += `<div class="validation-feedback" id="feedback_${field.id}"></div>`;
                        break;

                    case 'checkbox':
                        html += `<div class="options-list">`;
                        const checkedValues = Array.isArray(currentValue) ? currentValue : [];
                        if (field.options) {
                            field.options.forEach((opt, i) => {
                                const optKey = `opt_${field.id}_${i}`;
                                const optLabel = T(optKey) !== optKey ? T(optKey) : opt;
                                const checked = checkedValues.includes(opt) ? 'checked' : '';
                                const selected = checkedValues.includes(opt) ? 'selected' : '';
                                html += `<label class="option-item ${selected}">`;
                                html += `<input type="checkbox" name="${field.id}" value="${escapeHtml(opt)}" ${checked} data-field-id="${field.id}">`;
                                html += `<span>${escapeHtml(optLabel)}</span>`;
                                html += `</label>`;
                            });
                        }
                        html += `</div>`;
                        html += `<div class="validation-feedback" id="feedback_${field.id}"></div>`;
                        break;
                }

                html += `</div>`;
                return html;
            },

            attachFieldListeners() {
                const qa = document.getElementById('question-area');
                
                // Input event - clear errors and save
                qa.addEventListener('input', (e) => {
                    const fieldId = e.target.dataset.fieldId;
                    if (fieldId) {
                        // Clear validation feedback when user starts typing
                        clearValidationFeedback(fieldId);
                        this.saveFieldValue(fieldId, e.target);
                    }
                });

                // Change event - save and validate for selects, radio, checkbox
                qa.addEventListener('change', (e) => {
                    const fieldId = e.target.dataset.fieldId;
                    if (fieldId) {
                        this.saveFieldValue(fieldId, e.target);
                        
                        // Validate after change for select, radio, checkbox
                        const section = window.APP_DATA.sections[AppState.currentStep];
                        const field = section?.fields?.find(f => f.id === fieldId);
                        if (field) {
                            validateField(fieldId, field);
                        }
                        
                        // Update selected state for options
                        const parent = e.target.closest('.option-item');
                        if (parent) {
                            if (e.target.type === 'radio') {
                                parent.parentElement.querySelectorAll('.option-item').forEach(el => el.classList.remove('selected'));
                            }
                            parent.classList.toggle('selected', e.target.checked);
                        }
                        
                        // Dynamic day adjustment for DOB fields to handle leap years
                        if (fieldId === '0003_monat' || fieldId === '0003_jahr') {
                            const daySelect = document.querySelector('[data-field-id="0003_tag"]');
                            const monthSelect = document.querySelector('[data-field-id="0003_monat"]');
                            const yearSelect = document.querySelector('[data-field-id="0003_jahr"]');
                            
                            if (daySelect && monthSelect && yearSelect) {
                                const month = parseInt(monthSelect.value);
                                const year = parseInt(yearSelect.value);
                                const currentDay = parseInt(daySelect.value);
                                
                                if (month && year) {
                                    // Calculate days in month
                                    let daysInMonth = 31;
                                    if ([4, 6, 9, 11].includes(month)) {
                                        daysInMonth = 30;
                                    } else if (month === 2) {
                                        // Leap year check
                                        const isLeap = (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
                                        daysInMonth = isLeap ? 29 : 28;
                                    }
                                    
                                    // Rebuild day options
                                    const placeholder = daySelect.querySelector('option[value=""]');
                                    daySelect.innerHTML = '';
                                    if (placeholder) {
                                        daySelect.appendChild(placeholder.cloneNode(true));
                                    }
                                    
                                    for (let i = 1; i <= daysInMonth; i++) {
                                        const opt = document.createElement('option');
                                        opt.value = String(i);
                                        opt.textContent = String(i);
                                        if (i === currentDay && currentDay <= daysInMonth) {
                                            opt.selected = true;
                                        }
                                        daySelect.appendChild(opt);
                                    }
                                    
                                    // If current day is now invalid, clear it
                                    if (currentDay > daysInMonth) {
                                        daySelect.value = '';
                                        this.saveFieldValue('0003_tag', daySelect);
                                    }
                                }
                            }
                        }
                    }
                });
                
                // Blur event - validate text/number/textarea fields
                qa.addEventListener('blur', (e) => {
                    const fieldId = e.target.dataset.fieldId;
                    if (fieldId && ['text', 'number', 'textarea', 'email', 'tel', 'date'].includes(e.target.type)) {
                        const section = window.APP_DATA.sections[AppState.currentStep];
                        const field = section?.fields?.find(f => f.id === fieldId);
                        if (field) {
                            validateField(fieldId, field);
                        }
                    }
                }, true);
            },

            saveFieldValue(fieldId, element) {
                const type = element.type;
                
                if (type === 'checkbox') {
                    const checkboxes = document.querySelectorAll(`input[name="${fieldId}"]:checked`);
                    const values = Array.from(checkboxes).map(cb => cb.value);
                    AppState.answers[fieldId] = values.map(sanitizeInput);
                } else if (type === 'radio') {
                    const checked = document.querySelector(`input[name="${fieldId}"]:checked`);
                    AppState.answers[fieldId] = checked ? sanitizeInput(checked.value) : '';
                } else {
                    AppState.answers[fieldId] = sanitizeInput(element.value);
                }
                
                // Aggregate DOB fields into ISO format YYYY-MM-DD
                if (fieldId === '0003_tag' || fieldId === '0003_monat' || fieldId === '0003_jahr') {
                    aggregateDOBToISO(AppState.answers);
                }
                
                // Schedule auto-save after changes
                scheduleAutoSave();
                this.saveToStorage();
                this.updateNavButtons();
                this.updateJsonBox();
            },
            
            async updateJsonBox() {
                const jsonBox = document.getElementById('json-answer-box');
                if (!jsonBox) return;
                
                const data = {
                    export_date: new Date().toISOString(),
                    version: window.APP_DATA.version,
                    language: AppState.language,
                    answers: AppState.answers
                };
                
                const jsonString = JSON.stringify(data, null, 2);
                
                // Use Web Crypto API for encryption
                if (typeof encryptData === 'function') {
                    try {
                        jsonBox.value = await encryptData(jsonString);
                    } catch (e) {
                        console.error("Encryption failed in App.updateJsonBox:", e);
                        jsonBox.value = "[Encryption Error]";
                    }
                } else {
                    jsonBox.value = jsonString;
                }
            },

            validateField(fieldId, element) {
                const type = element.type;
                const value = element.value;
                const errorEl = document.getElementById(`error_${fieldId}`);
                
                if (!errorEl) return true;

                let isValid = true;
                let errorMsg = '';

                if (type === 'email' && value) {
                    if (!validateEmail(value)) {
                        isValid = false;
                        errorMsg = T('invalid_email');
                    }
                } else if (type === 'tel' && value) {
                    if (!validatePhone(value)) {
                        isValid = false;
                        errorMsg = T('invalid_phone');
                    }
                }

                element.classList.toggle('invalid', !isValid);
                errorEl.textContent = errorMsg;
                errorEl.classList.toggle('visible', !isValid);
                
                return isValid;
            },

            isCurrentStepValid() {
                const section = window.APP_DATA.sections[AppState.currentStep];
                if (!section?.fields) return true;

                let allValid = true;
                for (const field of section.fields) {
                    // Validate each field and get result
                    const isFieldValid = validateField(field.id, field);
                    if (!isFieldValid) {
                        allValid = false;
                    }
                }
                return allValid;
            },

            // ----- NAVIGATION -----
            updateProgress() {
                const progressBar = document.getElementById('progress-fill');
                const progressText = document.getElementById('progress-text');
                const progressContainer = progressBar?.parentElement;
                
                if (!progressBar || !progressText) return;
                
                let visibleSections = 0;
                let totalQuestions = 0;
                let answeredQuestions = 0;
                
                // Check if checkCondition function is available
                const hasCheckCondition = typeof checkCondition === 'function';
                if (!hasCheckCondition) {
                    console.warn('[App] checkCondition function not available. Progress calculation may be inaccurate.');
                }
                
                window.APP_DATA.sections.forEach((section, idx) => {
                    // Check if section should be visible based on conditions
                    let sectionVisible = true;
                    if (section.condition) {
                        if (hasCheckCondition) {
                            sectionVisible = checkCondition(section);
                        } else {
                            // If checkCondition is not available, assume section is visible
                            // This is safer than hiding sections incorrectly
                            sectionVisible = true;
                        }
                    }
                    
                    if (sectionVisible) {
                        visibleSections++;
                        if (section.fields) {
                            section.fields.forEach(field => {
                                // Count all visible questions
                                totalQuestions++;
                                // Count answered questions up to current section
                                if (idx < AppState.currentStep || (idx === AppState.currentStep && AppState.answers[field.id] !== undefined && AppState.answers[field.id] !== '')) {
                                    answeredQuestions++;
                                }
                            });
                        }
                    }
                });
                
                const progressPercent = totalQuestions > 0 ? (answeredQuestions / totalQuestions * 100) : 0;
                
                // Smooth transition
                progressBar.style.transition = 'width 0.3s ease, background-color 0.3s ease';
                progressBar.style.width = progressPercent + '%';
                
                // Update ARIA attributes
                progressContainer?.setAttribute('aria-valuenow', Math.round(progressPercent));
                progressContainer?.setAttribute('aria-valuetext', `${Math.round(progressPercent)} Prozent abgeschlossen`);
                
                // Enhanced text with percentage and counts
                const progressMessage = `Sektion ${AppState.currentStep + 1} ‚Ä¢ ${answeredQuestions} von ${totalQuestions} Fragen beantwortet (${Math.round(progressPercent)}%)`;
                progressText.textContent = progressMessage;
                
                // Color coding based on progress
                let progressColor;
                let progressLabel;
                if (progressPercent < 33) {
                    progressColor = '#ef4444'; // red
                    progressLabel = 'Begonnen';
                } else if (progressPercent < 66) {
                    progressColor = '#f59e0b'; // orange
                    progressLabel = 'In Bearbeitung';
                } else if (progressPercent < 100) {
                    progressColor = '#10b981'; // green
                    progressLabel = 'Fast fertig';
                } else {
                    progressColor = '#10b981'; // green
                    progressLabel = 'Vollst√§ndig';
                }
                
                progressBar.style.backgroundColor = progressColor;
                
                // Announce to screen readers (throttled to avoid spam)
                if (window.liveRegionAnnouncer && !this._lastProgressAnnouncement) {
                    this._lastProgressAnnouncement = 0;
                }
                
                const now = Date.now();
                if (now - (this._lastProgressAnnouncement || 0) > 5000) {
                    window.liveRegionAnnouncer?.announce(
                        `Fortschritt: ${Math.round(progressPercent)}%. ${progressLabel}`,
                        'polite'
                    );
                    this._lastProgressAnnouncement = now;
                }
            },

            updateNavButtons() {
                const total = window.APP_DATA.sections.length;
                const isLast = AppState.currentStep >= total - 1;
                
                document.getElementById('back-btn').disabled = AppState.currentStep === 0;
                document.getElementById('next-btn').classList.toggle('hidden', isLast);
                document.getElementById('next-btn').disabled = !this.isCurrentStepValid();
                document.getElementById('submit-btn').classList.toggle('hidden', !isLast);
            },

            nextStep() {
                if (!this.isCurrentStepValid()) {
                    alert(T('required_fields') || 'Bitte f√ºllen Sie alle Pflichtfelder aus.');
                    return;
                }

                // Intelligentes Springen: Finde den n√§chsten sichtbaren Schritt
                let nextIndex = AppState.currentStep + 1;
                const maxSteps = window.APP_DATA.sections.length;
                
                // Versuche bis zu 50 Schritte vorw√§rts (um unendliche Schleifen zu vermeiden)
                let attempts = 0;
                while (nextIndex < maxSteps && attempts < 50) {
                    const nextSection = window.APP_DATA.sections[nextIndex];
                    
                    // Wenn keine Bedingung vorhanden ist, zeige diese Sektion
                    if (!nextSection.condition) {
                        this.renderStep(nextIndex);
                        return;
                    }
                    
                    // Pr√ºfe ob die Bedingung erf√ºllt ist
                    if (typeof checkCondition === 'function' && checkCondition(nextSection)) {
                        this.renderStep(nextIndex);
                        return;
                    }
                    
                    // Bedingung nicht erf√ºllt, weiter zum n√§chsten
                    nextIndex++;
                    attempts++;
                }
                
                // Wenn kein g√ºltiger n√§chster Schritt gefunden wurde, zeige Summary
                if (nextIndex >= maxSteps) {
                    this.showSummary();
                }
            },

            prevStep() {
                // Intelligentes Zur√ºckspringen: Finde den vorherigen sichtbaren Schritt
                let prevIndex = AppState.currentStep - 1;
                
                // Versuche bis zu 50 Schritte r√ºckw√§rts
                let attempts = 0;
                while (prevIndex >= 0 && attempts < 50) {
                    const prevSection = window.APP_DATA.sections[prevIndex];
                    
                    // Wenn keine Bedingung vorhanden ist, zeige diese Sektion
                    if (!prevSection.condition) {
                        this.renderStep(prevIndex);
                        return;
                    }
                    
                    // Pr√ºfe ob die Bedingung erf√ºllt ist
                    if (typeof checkCondition === 'function' && checkCondition(prevSection)) {
                        this.renderStep(prevIndex);
                        return;
                    }
                    
                    // Bedingung nicht erf√ºllt, weiter zur√ºck
                    prevIndex--;
                    attempts++;
                }
                
                // Wenn am Anfang angekommen, nichts tun
            },

            goToStep(index) {
                document.getElementById('summary-box').classList.add('hidden');
                this.renderStep(index);
            },
            
            jumpToQuestion(questionId) {
                // Find which section contains this question
                const sectionIndex = window.APP_DATA.sections.findIndex(section => {
                    const fields = section.fields || [];
                    return fields.some(f => f.id === questionId);
                });
                
                if (sectionIndex !== -1) {
                    this.goToStep(sectionIndex);
                }
            },

            // ----- SUMMARY -----
            showSummary() {
                const box = document.getElementById('summary-box');
                const content = document.getElementById('summary-content');
                
                let html = '';
                window.APP_DATA.sections.forEach((section, sectionIndex) => {
                    const fields = section.fields || section.questions || [];
                    if (!fields.length) return;
                    
                    fields.forEach(field => {
                        const val = AppState.answers[field.id];
                        if (val && (Array.isArray(val) ? val.length > 0 : val.toString().trim())) {
                            const displayVal = Array.isArray(val) ? val.join(', ') : val;
                            html += `<div class="summary-item" onclick="App.goToStep(${sectionIndex})">`;
                            html += `<div class="summary-label">${escapeHtml(field.label)}</div>`;
                            html += `<div class="summary-value">${escapeHtml(displayVal)}</div>`;
                            html += `</div>`;
                        }
                    });
                });

                // Red Flag Check
                if (this.checkRedFlags()) {
                    html = `<div class="disclaimer danger" style="margin-bottom: 1rem;">${T('red_flag_warning')}</div>` + html;
                }

                content.innerHTML = html || '<p>Keine Angaben vorhanden.</p>';
                box.classList.remove('hidden');
            },

            checkRedFlags() {
                const redFlagFields = window.APP_DATA.red_flag_fields || [];
                return redFlagFields.some(fieldId => {
                    const val = AppState.answers[fieldId];
                    return val === 'Ja' || val === 'Yes';
                });
            },

            // ----- EXPORT / IMPORT -----
            exportJSON(full = true) {
                const data = {
                    export_date: new Date().toISOString(),
                    version: window.APP_DATA.version,
                    language: AppState.language,
                    answers: full ? AppState.answers : this.anonymizeAnswers(),
                    red_flags_detected: this.checkRedFlags()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `anamnese_${full ? 'full' : 'anon'}_${new Date().toISOString().slice(0,10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                // Record billable event (usage metering)
                if (window.UsageMetering) {
                    window.UsageMetering.recordEvent('json_export', {
                        encrypted: false,
                        fileSize: blob.size,
                        language: AppState.language,
                        appVersion: window.APP_DATA?.version || '8.0.0'
                    });
                }
            },

            anonymizeAnswers() {
                const anon = { ...AppState.answers };
                // Remove identifying fields
                delete anon.lastname;
                delete anon.firstname;
                delete anon.email;
                delete anon.phone;
                // Birthdate often kept to year only in anonymized
                if (anon.birthdate) {
                    anon.birthdate = anon.birthdate.split('-')[0]; // Year only
                }
                return anon;
            },

            saveToFile() {
                this.exportJSON(true);
            },
            
            loadFromFile(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.answers) {
                            AppState.answers = data.answers;
                            if (data.language) AppState.language = data.language;
                            this.saveToStorage();
                            this.renderStep(0);
                            alert("Data loaded successfully!");
                        }
                    } catch (err) {
                        alert("Error loading file: " + err.message);
                    }
                };
                reader.readAsText(file);
                event.target.value = ''; // Reset input
            },
            
            resetAll() {
                if(confirm("Wollen Sie wirklich alle Eingaben l√∂schen?")) {
                    AppState.answers = {};
                    AppState.currentStep = 0;
                    this.saveToStorage();
                    this.renderStep(0);
                }
            },
            
            // Delegate to global functions for export operations
            exportJsonFile(encrypted = true) {
                if (typeof exportJsonFile === 'function') {
                    exportJsonFile(encrypted);
                } else {
                    console.error('exportJsonFile function not found');
                }
            },
            
            exportNFC() {
                if (typeof exportNFC === 'function') {
                    exportNFC();
                } else {
                    console.error('exportNFC function not found');
                }
            },
            
            sendEmailWithDocuments() {
                if (typeof sendEmailWithDocuments === 'function') {
                    sendEmailWithDocuments();
                } else {
                    console.error('sendEmailWithDocuments function not found');
                }
            },
            
            // ----- GDPR-COMPLIANT DOCUMENT UPLOAD METHODS -----
            async showDocumentUploadDialog() {
                if (typeof showDocumentUploadDialogGDPR === 'function') {
                    // Zeige Lade-Indikator w√§hrend des Uploads
                    if (typeof showSaveIndicator === 'function') {
                        showSaveIndicator('saving');
                    }
                    
                    try {
                        const result = await showDocumentUploadDialogGDPR();
                        if (result.success) {
                            // Erfolgs-Indikator anzeigen
                            if (typeof showSaveIndicator === 'function') {
                                showSaveIndicator('saved');
                            }
                            alert(`‚úì ${result.processedCount} Dokument(e) erfolgreich hochgeladen und verarbeitet.`);
                        } else if (result.message) {
                            // Fehler-Indikator anzeigen
                            if (typeof showSaveIndicator === 'function') {
                                showSaveIndicator('error');
                            }
                            alert(result.message);
                        }
                    } catch (error) {
                        console.error('Fehler beim Dokumenten-Upload:', error);
                        if (typeof showSaveIndicator === 'function') {
                            showSaveIndicator('error');
                        }
                        alert('‚ùå Fehler beim Hochladen der Dokumente: ' + error.message);
                    }
                } else {
                    console.error('showDocumentUploadDialogGDPR function not found - check ocr-gdpr-module.js');
                    if (typeof showSaveIndicator === 'function') {
                        showSaveIndicator('error');
                    }
                    alert('OCR-Modul nicht geladen. Bitte Seite neu laden.');
                }
            },
            
            showUploadedDocuments() {
                if (typeof showUploadedDocumentsGDPR === 'function') {
                    showUploadedDocumentsGDPR();
                } else {
                    console.error('showUploadedDocumentsGDPR function not found');
                }
            },
            
            clearUploadedDocuments() {
                if (typeof deleteAllDocumentsGDPR === 'function') {
                    if (confirm('M√∂chten Sie wirklich ALLE hochgeladenen Dokumente l√∂schen? (Art. 17 DSGVO - Recht auf Vergessenwerden)\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) {
                        deleteAllDocumentsGDPR();
                    }
                } else {
                    console.error('deleteAllDocumentsGDPR function not found');
                }
            },
            
            showAuditReport() {
                if (typeof showAuditReportGDPR === 'function') {
                    showAuditReportGDPR();
                } else {
                    console.error('showAuditReportGDPR function not found');
                }
            }
        };

        // Start
        window.addEventListener('DOMContentLoaded', () => App.init());

        // ====================================================================
        // PWA SERVICE WORKER REGISTRATION
        // ====================================================================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('[PWA] Service Worker registered:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[PWA] New version available! Reload to update.');
                                    // Could show a notification to user here
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('[PWA] Service Worker registration failed:', error);
                    });
            });
        }

        // ====================================================================
        // ACCESSIBILITY: SKIP LINK FUNCTIONALITY
        // ====================================================================
        document.addEventListener('DOMContentLoaded', () => {
            // Focus management for skip links
            const skipLinks = document.querySelectorAll('.skip-link');
            skipLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href').substring(1);
                    const target = document.getElementById(targetId);
                    if (target) {
                        target.setAttribute('tabindex', '-1');
                        target.focus();
                        target.addEventListener('blur', () => {
                            target.removeAttribute('tabindex');
                        }, { once: true });
                    }
                });
            });
        });

        // ====================================================================
        // ACCESSIBILITY: LIVE REGION ANNOUNCER
        // ====================================================================
        class LiveRegionAnnouncer {
            constructor() {
                this.politeRegion = this.createRegion('polite');
                this.assertiveRegion = this.createRegion('assertive');
                this.queue = [];
                this.isProcessing = false;
            }

            createRegion(level) {
                let region = document.getElementById(`live-region-${level}`);
                if (!region) {
                    region = document.createElement('div');
                    region.id = `live-region-${level}`;
                    region.setAttribute('role', level === 'assertive' ? 'alert' : 'status');
                    region.setAttribute('aria-live', level);
                    region.setAttribute('aria-atomic', 'true');
                    region.className = 'sr-only';
                    region.style.cssText = 'position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;';
                    document.body.appendChild(region);
                }
                return region;
            }

            announce(message, priority = 'polite') {
                if (!message) return;
                
                const region = priority === 'assertive' ? this.assertiveRegion : this.politeRegion;
                
                // Clear and announce
                region.textContent = '';
                setTimeout(() => {
                    region.textContent = message;
                }, 100);

                // Auto-clear after 5 seconds
                setTimeout(() => {
                    region.textContent = '';
                }, 5000);
            }
        }

        // Initialize live region announcer
        window.liveRegionAnnouncer = new LiveRegionAnnouncer();

        // ====================================================================
        // KEYBOARD NAVIGATION ENHANCEMENTS
        // ====================================================================
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + S: Save
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (typeof App !== 'undefined' && App.saveToLocalStorage) {
                    App.saveToLocalStorage();
                    window.liveRegionAnnouncer?.announce('Daten gespeichert', 'polite');
                }
            }

            // Ctrl/Cmd + Right Arrow: Next section
            if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowRight') {
                e.preventDefault();
                if (typeof App !== 'undefined' && App.nextStep) {
                    App.nextStep();
                }
            }

            // Ctrl/Cmd + Left Arrow: Previous section
            if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowLeft') {
                e.preventDefault();
                if (typeof App !== 'undefined' && App.prevStep) {
                    App.prevStep();
                }
            }

            // Escape: Close modals
            if (e.key === 'Escape') {
                // Close repo analysis modal
                const repoModal = document.getElementById('repo-analysis-modal');
                if (repoModal && repoModal.style.display !== 'none') {
                    RepoAnalysis.close();
                    window.liveRegionAnnouncer?.announce('Modal geschlossen', 'polite');
                    return;
                }
                
                // Close summary modal
                const summaryDiv = document.getElementById('summary-modal');
                if (summaryDiv && summaryDiv.style.display !== 'none') {
                    summaryDiv.style.display = 'none';
                    window.liveRegionAnnouncer?.announce('Modal geschlossen', 'polite');
                    return;
                }
                
                // Close shortcuts modal
                const shortcutsModal = document.getElementById('shortcuts-modal');
                if (shortcutsModal && shortcutsModal.style.display !== 'none') {
                    shortcutsModal.style.display = 'none';
                    window.liveRegionAnnouncer?.announce('Modal geschlossen', 'polite');
                }
            }
        });

        // ====================================================================
        // MOBILE: TOUCH OPTIMIZATION
        // ====================================================================
        if ('ontouchstart' in window) {
            // Add touch class to body for CSS hooks
            document.body.classList.add('touch-device');

            // Improve tap responsiveness
            document.addEventListener('touchstart', function() {}, { passive: true });
        }

        // ====================================================================
        // ONLINE/OFFLINE STATUS
        // ====================================================================
        window.addEventListener('online', () => {
            console.log('[Network] Online');
            window.liveRegionAnnouncer?.announce('Verbindung wiederhergestellt', 'polite');
            document.body.classList.remove('offline');
        });

        window.addEventListener('offline', () => {
            console.log('[Network] Offline');
            window.liveRegionAnnouncer?.announce('Keine Internetverbindung', 'assertive');
            document.body.classList.add('offline');
        });

        // ====================================================================
        // PERFORMANCE: LAZY LOAD IMAGES
        // ====================================================================
        if ('IntersectionObserver' in window) {
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                            observer.unobserve(img);
                        }
                    }
                });
            }, {
                rootMargin: '50px'
            });

            // Observe all images with data-src
            document.addEventListener('DOMContentLoaded', () => {
                document.querySelectorAll('img[data-src]').forEach(img => {
                    imageObserver.observe(img);
                });
            });
        }

        console.log('[App] Enhanced features loaded: PWA, Accessibility, Mobile Optimization');

        // ====================================================================
        // TRANSLATIONS MODULE (INLINE)
        // ====================================================================
        // Multi-language support for 10+ languages
        // All translations are embedded for offline use
// Translations for 10 languages
const translations = {
    de: {
        title: "Medizinische Anamnese",
        langLabel: "Sprache / Language:",
        sectionPersonal: "Pers√∂nliche Daten",
        sectionMedical: "Medizinische Vorgeschichte",
        sectionLifestyle: "Lebensstil",
        sectionAdditional: "Zus√§tzliche Informationen",
        labelFirstName: "Vorname:",
        labelLastName: "Nachname:",
        labelDateOfBirth: "Geburtsdatum:",
        labelGender: "Geschlecht:",
        labelAddress: "Adresse:",
        labelPhone: "Telefon:",
        labelEmail: "E-Mail:",
        labelCurrentComplaints: "Aktuelle Beschwerden:",
        labelPastIllnesses: "Fr√ºhere Erkrankungen:",
        labelSurgeries: "Operationen:",
        labelMedications: "Aktuelle Medikamente:",
        labelAllergies: "Allergien:",
        labelFamilyHistory: "Familienanamnese:",
        labelSmoking: "Rauchen:",
        labelAlcohol: "Alkoholkonsum:",
        labelExercise: "K√∂rperliche Aktivit√§t:",
        labelAdditionalNotes: "Weitere Anmerkungen:",
        labelPrivacyConsent: "Ich best√§tige, dass meine Daten verschl√ºsselt und nur lokal gespeichert werden. Ich verstehe, dass keine Daten an externe Server √ºbertragen werden.",
        optionSelect: "Bitte w√§hlen",
        optionMale: "M√§nnlich",
        optionFemale: "Weiblich",
        optionOther: "Divers",
        optionNever: "Nie",
        optionFormer: "Ehemals",
        optionCurrent: "Aktuell",
        optionAlcoholNever: "Nie",
        optionOccasional: "Gelegentlich",
        optionRegular: "Regelm√§√üig",
        btnSave: "Verschl√ºsselt Speichern",
        btnLoad: "Gespeicherte Daten Laden",
        btnExport: "Als JSON Exportieren",
        btnGdtExport: "GDT-Export (DSGVO)",
        btnClear: "Formular Leeren",
        footerText: "Datenschutzkonforme lokale Anamnese - Alle Daten bleiben auf Ihrem Ger√§t",
        modalTitle: "Verschl√ºsselung",
        modalText: "Bitte geben Sie ein Passwort ein, um Ihre Daten zu verschl√ºsseln:",
        modalConfirm: "Best√§tigen",
        modalCancel: "Abbrechen",
        voiceStatusText: "Spracherkennung aktiv...",
        alertSaved: "Daten erfolgreich verschl√ºsselt und gespeichert!",
        alertLoaded: "Daten erfolgreich geladen!",
        alertExported: "JSON-Datei wurde heruntergeladen!",
        alertCleared: "Formular wurde geleert!",
        alertPassword: "Bitte geben Sie ein Passwort ein!",
        alertError: "Fehler beim Laden der Daten. Falsches Passwort?",
        alertNoData: "Keine gespeicherten Daten gefunden!",
        // GDT Export translations
        consentTitle: "Einwilligung zur Datenverarbeitung",
        consentIntro: "Gem√§√ü Art. 6 und Art. 9 DSGVO ben√∂tigen wir Ihre ausdr√ºckliche Einwilligung f√ºr die folgenden Datenverarbeitungen:"
    },
    en: {
        title: "Medical History",
        langLabel: "Language:",
        sectionPersonal: "Personal Information",
        sectionMedical: "Medical History",
        sectionLifestyle: "Lifestyle",
        sectionAdditional: "Additional Information",
        labelFirstName: "First Name:",
        labelLastName: "Last Name:",
        labelDateOfBirth: "Date of Birth:",
        labelGender: "Gender:",
        labelAddress: "Address:",
        labelPhone: "Phone:",
        labelEmail: "Email:",
        labelCurrentComplaints: "Current Complaints:",
        labelPastIllnesses: "Past Illnesses:",
        labelSurgeries: "Surgeries:",
        labelMedications: "Current Medications:",
        labelAllergies: "Allergies:",
        labelFamilyHistory: "Family History:",
        labelSmoking: "Smoking:",
        labelAlcohol: "Alcohol Consumption:",
        labelExercise: "Physical Activity:",
        labelAdditionalNotes: "Additional Notes:",
        labelPrivacyConsent: "I confirm that my data is encrypted and stored only locally. I understand that no data is transmitted to external servers.",
        optionSelect: "Please select",
        optionMale: "Male",
        optionFemale: "Female",
        optionOther: "Other",
        optionNever: "Never",
        optionFormer: "Former",
        optionCurrent: "Current",
        optionAlcoholNever: "Never",
        optionOccasional: "Occasional",
        optionRegular: "Regular",
        btnSave: "Save Encrypted",
        btnLoad: "Load Saved Data",
        btnExport: "Export as JSON",
        btnGdtExport: "GDT-Export (GDPR)",
        btnClear: "Clear Form",
        footerText: "Privacy-compliant local medical history - All data remains on your device",
        modalTitle: "Encryption",
        modalText: "Please enter a password to encrypt your data:",
        modalConfirm: "Confirm",
        modalCancel: "Cancel",
        voiceStatusText: "Voice recognition active...",
        alertSaved: "Data successfully encrypted and saved!",
        alertLoaded: "Data successfully loaded!",
        alertExported: "JSON file has been downloaded!",
        alertCleared: "Form has been cleared!",
        alertPassword: "Please enter a password!",
        alertError: "Error loading data. Wrong password?",
        alertNoData: "No saved data found!",
        // GDT Export translations
        consentTitle: "Consent to Data Processing",
        consentIntro: "According to Art. 6 and Art. 9 GDPR, we require your explicit consent for the following data processing:"
    },
    fr: {
        title: "Ant√©c√©dents M√©dicaux",
        langLabel: "Langue:",
        sectionPersonal: "Informations Personnelles",
        sectionMedical: "Ant√©c√©dents M√©dicaux",
        sectionLifestyle: "Mode de Vie",
        sectionAdditional: "Informations Suppl√©mentaires",
        labelFirstName: "Pr√©nom:",
        labelLastName: "Nom:",
        labelDateOfBirth: "Date de Naissance:",
        labelGender: "Genre:",
        labelAddress: "Adresse:",
        labelPhone: "T√©l√©phone:",
        labelEmail: "Email:",
        labelCurrentComplaints: "Plaintes Actuelles:",
        labelPastIllnesses: "Maladies Ant√©rieures:",
        labelSurgeries: "Chirurgies:",
        labelMedications: "M√©dicaments Actuels:",
        labelAllergies: "Allergies:",
        labelFamilyHistory: "Ant√©c√©dents Familiaux:",
        labelSmoking: "Tabagisme:",
        labelAlcohol: "Consommation d'Alcool:",
        labelExercise: "Activit√© Physique:",
        labelAdditionalNotes: "Notes Suppl√©mentaires:",
        labelPrivacyConsent: "Je confirme que mes donn√©es sont crypt√©es et stock√©es uniquement localement. Je comprends qu'aucune donn√©e n'est transmise √† des serveurs externes.",
        optionSelect: "Veuillez s√©lectionner",
        optionMale: "Homme",
        optionFemale: "Femme",
        optionOther: "Autre",
        optionNever: "Jamais",
        optionFormer: "Ancien",
        optionCurrent: "Actuel",
        optionAlcoholNever: "Jamais",
        optionOccasional: "Occasionnel",
        optionRegular: "R√©gulier",
        btnSave: "Enregistrer Crypt√©",
        btnLoad: "Charger les Donn√©es",
        btnExport: "Exporter en JSON",
        btnClear: "Effacer le Formulaire",
        footerText: "Ant√©c√©dents m√©dicaux locaux conformes √† la confidentialit√© - Toutes les donn√©es restent sur votre appareil",
        modalTitle: "Cryptage",
        modalText: "Veuillez entrer un mot de passe pour crypter vos donn√©es:",
        modalConfirm: "Confirmer",
        modalCancel: "Annuler",
        voiceStatusText: "Reconnaissance vocale active...",
        alertSaved: "Donn√©es crypt√©es et enregistr√©es avec succ√®s!",
        alertLoaded: "Donn√©es charg√©es avec succ√®s!",
        alertExported: "Le fichier JSON a √©t√© t√©l√©charg√©!",
        alertCleared: "Le formulaire a √©t√© effac√©!",
        alertPassword: "Veuillez entrer un mot de passe!",
        alertError: "Erreur lors du chargement des donn√©es. Mauvais mot de passe?",
        alertNoData: "Aucune donn√©e enregistr√©e trouv√©e!"
    },
    es: {
        title: "Historia M√©dica",
        langLabel: "Idioma:",
        sectionPersonal: "Informaci√≥n Personal",
        sectionMedical: "Historia M√©dica",
        sectionLifestyle: "Estilo de Vida",
        sectionAdditional: "Informaci√≥n Adicional",
        labelFirstName: "Nombre:",
        labelLastName: "Apellido:",
        labelDateOfBirth: "Fecha de Nacimiento:",
        labelGender: "G√©nero:",
        labelAddress: "Direcci√≥n:",
        labelPhone: "Tel√©fono:",
        labelEmail: "Correo Electr√≥nico:",
        labelCurrentComplaints: "Quejas Actuales:",
        labelPastIllnesses: "Enfermedades Anteriores:",
        labelSurgeries: "Cirug√≠as:",
        labelMedications: "Medicamentos Actuales:",
        labelAllergies: "Alergias:",
        labelFamilyHistory: "Historia Familiar:",
        labelSmoking: "Fumar:",
        labelAlcohol: "Consumo de Alcohol:",
        labelExercise: "Actividad F√≠sica:",
        labelAdditionalNotes: "Notas Adicionales:",
        labelPrivacyConsent: "Confirmo que mis datos est√°n encriptados y almacenados solo localmente. Entiendo que no se transmiten datos a servidores externos.",
        optionSelect: "Por favor seleccione",
        optionMale: "Masculino",
        optionFemale: "Femenino",
        optionOther: "Otro",
        optionNever: "Nunca",
        optionFormer: "Anterior",
        optionCurrent: "Actual",
        optionAlcoholNever: "Nunca",
        optionOccasional: "Ocasional",
        optionRegular: "Regular",
        btnSave: "Guardar Encriptado",
        btnLoad: "Cargar Datos Guardados",
        btnExport: "Exportar como JSON",
        btnClear: "Limpiar Formulario",
        footerText: "Historia m√©dica local conforme a la privacidad - Todos los datos permanecen en su dispositivo",
        modalTitle: "Encriptaci√≥n",
        modalText: "Por favor ingrese una contrase√±a para encriptar sus datos:",
        modalConfirm: "Confirmar",
        modalCancel: "Cancelar",
        voiceStatusText: "Reconocimiento de voz activo...",
        alertSaved: "¬°Datos encriptados y guardados con √©xito!",
        alertLoaded: "¬°Datos cargados con √©xito!",
        alertExported: "¬°El archivo JSON ha sido descargado!",
        alertCleared: "¬°El formulario ha sido limpiado!",
        alertPassword: "¬°Por favor ingrese una contrase√±a!",
        alertError: "Error al cargar los datos. ¬øContrase√±a incorrecta?",
        alertNoData: "¬°No se encontraron datos guardados!"
    },
    it: {
        title: "Storia Medica",
        langLabel: "Lingua:",
        sectionPersonal: "Informazioni Personali",
        sectionMedical: "Storia Medica",
        sectionLifestyle: "Stile di Vita",
        sectionAdditional: "Informazioni Aggiuntive",
        labelFirstName: "Nome:",
        labelLastName: "Cognome:",
        labelDateOfBirth: "Data di Nascita:",
        labelGender: "Genere:",
        labelAddress: "Indirizzo:",
        labelPhone: "Telefono:",
        labelEmail: "Email:",
        labelCurrentComplaints: "Reclami Attuali:",
        labelPastIllnesses: "Malattie Precedenti:",
        labelSurgeries: "Interventi Chirurgici:",
        labelMedications: "Farmaci Attuali:",
        labelAllergies: "Allergie:",
        labelFamilyHistory: "Storia Familiare:",
        labelSmoking: "Fumo:",
        labelAlcohol: "Consumo di Alcol:",
        labelExercise: "Attivit√† Fisica:",
        labelAdditionalNotes: "Note Aggiuntive:",
        labelPrivacyConsent: "Confermo che i miei dati sono crittografati e memorizzati solo localmente. Capisco che nessun dato viene trasmesso a server esterni.",
        optionSelect: "Per favore seleziona",
        optionMale: "Maschio",
        optionFemale: "Femmina",
        optionOther: "Altro",
        optionNever: "Mai",
        optionFormer: "Precedente",
        optionCurrent: "Attuale",
        optionAlcoholNever: "Mai",
        optionOccasional: "Occasionale",
        optionRegular: "Regolare",
        btnSave: "Salva Crittografato",
        btnLoad: "Carica Dati Salvati",
        btnExport: "Esporta come JSON",
        btnClear: "Cancella Modulo",
        footerText: "Storia medica locale conforme alla privacy - Tutti i dati rimangono sul tuo dispositivo",
        modalTitle: "Crittografia",
        modalText: "Per favore inserisci una password per crittografare i tuoi dati:",
        modalConfirm: "Conferma",
        modalCancel: "Annulla",
        voiceStatusText: "Riconoscimento vocale attivo...",
        alertSaved: "Dati crittografati e salvati con successo!",
        alertLoaded: "Dati caricati con successo!",
        alertExported: "Il file JSON √® stato scaricato!",
        alertCleared: "Il modulo √® stato cancellato!",
        alertPassword: "Per favore inserisci una password!",
        alertError: "Errore nel caricamento dei dati. Password errata?",
        alertNoData: "Nessun dato salvato trovato!"
    },
    pt: {
        title: "Hist√≥ria M√©dica",
        langLabel: "Idioma:",
        sectionPersonal: "Informa√ß√µes Pessoais",
        sectionMedical: "Hist√≥ria M√©dica",
        sectionLifestyle: "Estilo de Vida",
        sectionAdditional: "Informa√ß√µes Adicionais",
        labelFirstName: "Primeiro Nome:",
        labelLastName: "Sobrenome:",
        labelDateOfBirth: "Data de Nascimento:",
        labelGender: "G√™nero:",
        labelAddress: "Endere√ßo:",
        labelPhone: "Telefone:",
        labelEmail: "Email:",
        labelCurrentComplaints: "Queixas Atuais:",
        labelPastIllnesses: "Doen√ßas Anteriores:",
        labelSurgeries: "Cirurgias:",
        labelMedications: "Medicamentos Atuais:",
        labelAllergies: "Alergias:",
        labelFamilyHistory: "Hist√≥ria Familiar:",
        labelSmoking: "Fumar:",
        labelAlcohol: "Consumo de √Ålcool:",
        labelExercise: "Atividade F√≠sica:",
        labelAdditionalNotes: "Notas Adicionais:",
        labelPrivacyConsent: "Confirmo que meus dados est√£o criptografados e armazenados apenas localmente. Entendo que nenhum dado √© transmitido para servidores externos.",
        optionSelect: "Por favor selecione",
        optionMale: "Masculino",
        optionFemale: "Feminino",
        optionOther: "Outro",
        optionNever: "Nunca",
        optionFormer: "Anterior",
        optionCurrent: "Atual",
        optionAlcoholNever: "Nunca",
        optionOccasional: "Ocasional",
        optionRegular: "Regular",
        btnSave: "Salvar Criptografado",
        btnLoad: "Carregar Dados Salvos",
        btnExport: "Exportar como JSON",
        btnClear: "Limpar Formul√°rio",
        footerText: "Hist√≥ria m√©dica local em conformidade com privacidade - Todos os dados permanecem no seu dispositivo",
        modalTitle: "Criptografia",
        modalText: "Por favor, insira uma senha para criptografar seus dados:",
        modalConfirm: "Confirmar",
        modalCancel: "Cancelar",
        voiceStatusText: "Reconhecimento de voz ativo...",
        alertSaved: "Dados criptografados e salvos com sucesso!",
        alertLoaded: "Dados carregados com sucesso!",
        alertExported: "O arquivo JSON foi baixado!",
        alertCleared: "O formul√°rio foi limpo!",
        alertPassword: "Por favor, insira uma senha!",
        alertError: "Erro ao carregar os dados. Senha incorreta?",
        alertNoData: "Nenhum dado salvo encontrado!"
    },
    nl: {
        title: "Medische Geschiedenis",
        langLabel: "Taal:",
        sectionPersonal: "Persoonlijke Informatie",
        sectionMedical: "Medische Geschiedenis",
        sectionLifestyle: "Levensstijl",
        sectionAdditional: "Aanvullende Informatie",
        labelFirstName: "Voornaam:",
        labelLastName: "Achternaam:",
        labelDateOfBirth: "Geboortedatum:",
        labelGender: "Geslacht:",
        labelAddress: "Adres:",
        labelPhone: "Telefoon:",
        labelEmail: "Email:",
        labelCurrentComplaints: "Huidige Klachten:",
        labelPastIllnesses: "Eerdere Ziekten:",
        labelSurgeries: "Operaties:",
        labelMedications: "Huidige Medicijnen:",
        labelAllergies: "Allergie√´n:",
        labelFamilyHistory: "Familiegeschiedenis:",
        labelSmoking: "Roken:",
        labelAlcohol: "Alcoholgebruik:",
        labelExercise: "Lichaamsbeweging:",
        labelAdditionalNotes: "Aanvullende Opmerkingen:",
        labelPrivacyConsent: "Ik bevestig dat mijn gegevens versleuteld en alleen lokaal opgeslagen worden. Ik begrijp dat er geen gegevens naar externe servers worden verzonden.",
        optionSelect: "Selecteer alstublieft",
        optionMale: "Mannelijk",
        optionFemale: "Vrouwelijk",
        optionOther: "Anders",
        optionNever: "Nooit",
        optionFormer: "Voormalig",
        optionCurrent: "Huidig",
        optionAlcoholNever: "Nooit",
        optionOccasional: "Af en toe",
        optionRegular: "Regelmatig",
        btnSave: "Versleuteld Opslaan",
        btnLoad: "Opgeslagen Gegevens Laden",
        btnExport: "Exporteren als JSON",
        btnClear: "Formulier Wissen",
        footerText: "Privacy-conforme lokale medische geschiedenis - Alle gegevens blijven op uw apparaat",
        modalTitle: "Versleuteling",
        modalText: "Voer een wachtwoord in om uw gegevens te versleutelen:",
        modalConfirm: "Bevestigen",
        modalCancel: "Annuleren",
        voiceStatusText: "Spraakherkenning actief...",
        alertSaved: "Gegevens succesvol versleuteld en opgeslagen!",
        alertLoaded: "Gegevens succesvol geladen!",
        alertExported: "JSON-bestand is gedownload!",
        alertCleared: "Formulier is gewist!",
        alertPassword: "Voer alstublieft een wachtwoord in!",
        alertError: "Fout bij het laden van gegevens. Verkeerd wachtwoord?",
        alertNoData: "Geen opgeslagen gegevens gevonden!"
    },
    pl: {
        title: "Historia Medyczna",
        langLabel: "Jƒôzyk:",
        sectionPersonal: "Dane Osobowe",
        sectionMedical: "Historia Medyczna",
        sectionLifestyle: "Styl ≈ªycia",
        sectionAdditional: "Dodatkowe Informacje",
        labelFirstName: "Imiƒô:",
        labelLastName: "Nazwisko:",
        labelDateOfBirth: "Data Urodzenia:",
        labelGender: "P≈Çeƒá:",
        labelAddress: "Adres:",
        labelPhone: "Telefon:",
        labelEmail: "Email:",
        labelCurrentComplaints: "Obecne Dolegliwo≈õci:",
        labelPastIllnesses: "Przebyte Choroby:",
        labelSurgeries: "Operacje:",
        labelMedications: "Aktualne Leki:",
        labelAllergies: "Alergie:",
        labelFamilyHistory: "Historia Rodzinna:",
        labelSmoking: "Palenie:",
        labelAlcohol: "Spo≈ºycie Alkoholu:",
        labelExercise: "Aktywno≈õƒá Fizyczna:",
        labelAdditionalNotes: "Dodatkowe Uwagi:",
        labelPrivacyConsent: "Potwierdzam, ≈ºe moje dane sƒÖ szyfrowane i przechowywane tylko lokalnie. Rozumiem, ≈ºe ≈ºadne dane nie sƒÖ przesy≈Çane na zewnƒôtrzne serwery.",
        optionSelect: "Proszƒô wybraƒá",
        optionMale: "Mƒô≈ºczyzna",
        optionFemale: "Kobieta",
        optionOther: "Inne",
        optionNever: "Nigdy",
        optionFormer: "Dawniej",
        optionCurrent: "Obecnie",
        optionAlcoholNever: "Nigdy",
        optionOccasional: "Okazjonalnie",
        optionRegular: "Regularnie",
        btnSave: "Zapisz Zaszyfrowane",
        btnLoad: "Wczytaj Zapisane Dane",
        btnExport: "Eksportuj jako JSON",
        btnClear: "Wyczy≈õƒá Formularz",
        footerText: "Zgodna z prywatno≈õciƒÖ lokalna historia medyczna - Wszystkie dane pozostajƒÖ na Twoim urzƒÖdzeniu",
        modalTitle: "Szyfrowanie",
        modalText: "Proszƒô wprowadziƒá has≈Ço, aby zaszyfrowaƒá dane:",
        modalConfirm: "Potwierd≈∫",
        modalCancel: "Anuluj",
        voiceStatusText: "Rozpoznawanie mowy aktywne...",
        alertSaved: "Dane zosta≈Çy zaszyfrowane i zapisane pomy≈õlnie!",
        alertLoaded: "Dane zosta≈Çy wczytane pomy≈õlnie!",
        alertExported: "Plik JSON zosta≈Ç pobrany!",
        alertCleared: "Formularz zosta≈Ç wyczyszczony!",
        alertPassword: "Proszƒô wprowadziƒá has≈Ço!",
        alertError: "B≈ÇƒÖd podczas wczytywania danych. Nieprawid≈Çowe has≈Ço?",
        alertNoData: "Nie znaleziono zapisanych danych!"
    },
    tr: {
        title: "Tƒ±bbi Ge√ßmi≈ü",
        langLabel: "Dil:",
        sectionPersonal: "Ki≈üisel Bilgiler",
        sectionMedical: "Tƒ±bbi Ge√ßmi≈ü",
        sectionLifestyle: "Ya≈üam Tarzƒ±",
        sectionAdditional: "Ek Bilgiler",
        labelFirstName: "Ad:",
        labelLastName: "Soyad:",
        labelDateOfBirth: "Doƒüum Tarihi:",
        labelGender: "Cinsiyet:",
        labelAddress: "Adres:",
        labelPhone: "Telefon:",
        labelEmail: "E-posta:",
        labelCurrentComplaints: "Mevcut ≈ûikayetler:",
        labelPastIllnesses: "Ge√ßmi≈ü Hastalƒ±klar:",
        labelSurgeries: "Ameliyatlar:",
        labelMedications: "Mevcut ƒ∞la√ßlar:",
        labelAllergies: "Alerjiler:",
        labelFamilyHistory: "Aile Ge√ßmi≈üi:",
        labelSmoking: "Sigara:",
        labelAlcohol: "Alkol T√ºketimi:",
        labelExercise: "Fiziksel Aktivite:",
        labelAdditionalNotes: "Ek Notlar:",
        labelPrivacyConsent: "Verilerimin ≈üifrelendiƒüini ve yalnƒ±zca yerel olarak saklandƒ±ƒüƒ±nƒ± onaylƒ±yorum. Harici sunuculara veri aktarƒ±lmadƒ±ƒüƒ±nƒ± anlƒ±yorum.",
        optionSelect: "L√ºtfen se√ßin",
        optionMale: "Erkek",
        optionFemale: "Kadƒ±n",
        optionOther: "Diƒüer",
        optionNever: "Hi√ßbir zaman",
        optionFormer: "Eskiden",
        optionCurrent: "≈ûu anda",
        optionAlcoholNever: "Hi√ßbir zaman",
        optionOccasional: "Ara sƒ±ra",
        optionRegular: "D√ºzenli",
        btnSave: "≈ûifreli Kaydet",
        btnLoad: "Kayƒ±tlƒ± Verileri Y√ºkle",
        btnExport: "JSON Olarak Dƒ±≈üa Aktar",
        btnClear: "Formu Temizle",
        footerText: "Gizlilik uyumlu yerel tƒ±bbi ge√ßmi≈ü - T√ºm veriler cihazƒ±nƒ±zda kalƒ±r",
        modalTitle: "≈ûifreleme",
        modalText: "Verilerinizi ≈üifrelemek i√ßin l√ºtfen bir parola girin:",
        modalConfirm: "Onayla",
        modalCancel: "ƒ∞ptal",
        voiceStatusText: "Ses tanƒ±ma aktif...",
        alertSaved: "Veriler ba≈üarƒ±yla ≈üifrelendi ve kaydedildi!",
        alertLoaded: "Veriler ba≈üarƒ±yla y√ºklendi!",
        alertExported: "JSON dosyasƒ± indirildi!",
        alertCleared: "Form temizlendi!",
        alertPassword: "L√ºtfen bir parola girin!",
        alertError: "Veri y√ºklenirken hata olu≈ütu. Yanlƒ±≈ü parola?",
        alertNoData: "Kayƒ±tlƒ± veri bulunamadƒ±!"
    },
    ar: {
        title: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ÿ®Ÿä",
        langLabel: "ÿßŸÑŸÑÿ∫ÿ©:",
        sectionPersonal: "ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©",
        sectionMedical: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ∑ÿ®Ÿä",
        sectionLifestyle: "ŸÜŸÖÿ∑ ÿßŸÑÿ≠Ÿäÿßÿ©",
        sectionAdditional: "ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©",
        labelFirstName: "ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ£ŸàŸÑ:",
        labelLastName: "ÿßÿ≥ŸÖ ÿßŸÑÿπÿßÿ¶ŸÑÿ©:",
        labelDateOfBirth: "ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸäŸÑÿßÿØ:",
        labelGender: "ÿßŸÑÿ¨ŸÜÿ≥:",
        labelAddress: "ÿßŸÑÿπŸÜŸàÿßŸÜ:",
        labelPhone: "ÿßŸÑŸáÿßÿ™ŸÅ:",
        labelEmail: "ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä:",
        labelCurrentComplaints: "ÿßŸÑÿ¥ŸÉÿßŸàŸâ ÿßŸÑÿ≠ÿßŸÑŸäÿ©:",
        labelPastIllnesses: "ÿßŸÑÿ£ŸÖÿ±ÿßÿ∂ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©:",
        labelSurgeries: "ÿßŸÑÿπŸÖŸÑŸäÿßÿ™ ÿßŸÑÿ¨ÿ±ÿßÿ≠Ÿäÿ©:",
        labelMedications: "ÿßŸÑÿ£ÿØŸàŸäÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©:",
        labelAllergies: "ÿßŸÑÿ≠ÿ≥ÿßÿ≥Ÿäÿ©:",
        labelFamilyHistory: "ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿπÿßÿ¶ŸÑŸä:",
        labelSmoking: "ÿßŸÑÿ™ÿØÿÆŸäŸÜ:",
        labelAlcohol: "ÿßÿ≥ÿ™ŸáŸÑÿßŸÉ ÿßŸÑŸÉÿ≠ŸàŸÑ:",
        labelExercise: "ÿßŸÑŸÜÿ¥ÿßÿ∑ ÿßŸÑÿ®ÿØŸÜŸä:",
        labelAdditionalNotes: "ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©:",
        labelPrivacyConsent: "ÿ£ÿ§ŸÉÿØ ÿ£ŸÜ ÿ®ŸäÿßŸÜÿßÿ™Ÿä ŸÖÿ¥ŸÅÿ±ÿ© ŸàŸÖÿÆÿ≤ŸÜÿ© ŸÖÿ≠ŸÑŸäŸãÿß ŸÅŸÇÿ∑. ÿ£ŸÅŸáŸÖ ÿ£ŸÜŸá ŸÑÿß Ÿäÿ™ŸÖ ŸÜŸÇŸÑ ÿ£Ÿä ÿ®ŸäÿßŸÜÿßÿ™ ÿ•ŸÑŸâ ÿÆŸàÿßÿØŸÖ ÿÆÿßÿ±ÿ¨Ÿäÿ©.",
        optionSelect: "Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±",
        optionMale: "ÿ∞ŸÉÿ±",
        optionFemale: "ÿ£ŸÜÿ´Ÿâ",
        optionOther: "ÿ¢ÿÆÿ±",
        optionNever: "ÿ£ÿ®ÿØÿßŸã",
        optionFormer: "ÿ≥ÿßÿ®ŸÇÿßŸã",
        optionCurrent: "ÿ≠ÿßŸÑŸäÿßŸã",
        optionAlcoholNever: "ÿ£ÿ®ÿØÿßŸã",
        optionOccasional: "ÿ£ÿ≠ŸäÿßŸÜÿßŸã",
        optionRegular: "ÿ®ÿßŸÜÿ™ÿ∏ÿßŸÖ",
        btnSave: "ÿ≠ŸÅÿ∏ ŸÖÿ¥ŸÅÿ±",
        btnLoad: "ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©",
        btnExport: "ÿ™ÿµÿØŸäÿ± ŸÉŸÄ JSON",
        btnClear: "ŸÖÿ≥ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨",
        footerText: "ÿ™ÿßÿ±ŸäÿÆ ÿ∑ÿ®Ÿä ŸÖÿ≠ŸÑŸä ŸÖÿ™ŸàÿßŸÅŸÇ ŸÖÿπ ÿßŸÑÿÆÿµŸàÿµŸäÿ© - ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ™ÿ®ŸÇŸâ ÿπŸÑŸâ ÿ¨Ÿáÿßÿ≤ŸÉ",
        modalTitle: "ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±",
        modalText: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ŸÑÿ™ÿ¥ŸÅŸäÿ± ÿ®ŸäÿßŸÜÿßÿ™ŸÉ:",
        modalConfirm: "ÿ™ÿ£ŸÉŸäÿØ",
        modalCancel: "ÿ•ŸÑÿ∫ÿßÿ°",
        voiceStatusText: "ÿßŸÑÿ™ÿπÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿµŸàÿ™ ŸÜÿ¥ÿ∑...",
        alertSaved: "ÿ™ŸÖ ÿ™ÿ¥ŸÅŸäÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ Ÿàÿ≠ŸÅÿ∏Ÿáÿß ÿ®ŸÜÿ¨ÿßÿ≠!",
        alertLoaded: "ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠!",
        alertExported: "ÿ™ŸÖ ÿ™ŸÜÿ≤ŸäŸÑ ŸÖŸÑŸÅ JSON!",
        alertCleared: "ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨!",
        alertPassword: "Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ±!",
        alertError: "ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. ŸÉŸÑŸÖÿ© ŸÖÿ±Ÿàÿ± ÿÆÿßÿ∑ÿ¶ÿ©ÿü",
        alertNoData: "ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ŸÅŸàÿ∏ÿ©!"
    }
};

function changeLanguage() {
    const lang = document.getElementById('language').value;
    const t = translations[lang];
    
    // Update HTML lang attribute
    document.documentElement.lang = lang;
    
    // Update all text elements
    document.getElementById('title').textContent = t.title;
    document.getElementById('lang-label').textContent = t.langLabel;
    
    // Sections
    document.getElementById('section-personal').textContent = t.sectionPersonal;
    document.getElementById('section-medical').textContent = t.sectionMedical;
    document.getElementById('section-lifestyle').textContent = t.sectionLifestyle;
    document.getElementById('section-additional').textContent = t.sectionAdditional;
    
    // Labels
    document.getElementById('label-firstName').textContent = t.labelFirstName;
    document.getElementById('label-lastName').textContent = t.labelLastName;
    document.getElementById('label-dateOfBirth').textContent = t.labelDateOfBirth;
    document.getElementById('label-gender').textContent = t.labelGender;
    document.getElementById('label-address').textContent = t.labelAddress;
    document.getElementById('label-phone').textContent = t.labelPhone;
    document.getElementById('label-email').textContent = t.labelEmail;
    document.getElementById('label-currentComplaints').textContent = t.labelCurrentComplaints;
    document.getElementById('label-pastIllnesses').textContent = t.labelPastIllnesses;
    document.getElementById('label-surgeries').textContent = t.labelSurgeries;
    document.getElementById('label-medications').textContent = t.labelMedications;
    document.getElementById('label-allergies').textContent = t.labelAllergies;
    document.getElementById('label-familyHistory').textContent = t.labelFamilyHistory;
    document.getElementById('label-smoking').textContent = t.labelSmoking;
    document.getElementById('label-alcohol').textContent = t.labelAlcohol;
    document.getElementById('label-exercise').textContent = t.labelExercise;
    document.getElementById('label-additionalNotes').textContent = t.labelAdditionalNotes;
    document.getElementById('label-privacyConsent').textContent = t.labelPrivacyConsent;
    
    // Options
    document.getElementById('option-select').textContent = t.optionSelect;
    document.getElementById('option-male').textContent = t.optionMale;
    document.getElementById('option-female').textContent = t.optionFemale;
    document.getElementById('option-other').textContent = t.optionOther;
    document.getElementById('option-never').textContent = t.optionNever;
    document.getElementById('option-former').textContent = t.optionFormer;
    document.getElementById('option-current').textContent = t.optionCurrent;
    document.getElementById('option-alcohol-never').textContent = t.optionAlcoholNever;
    document.getElementById('option-occasional').textContent = t.optionOccasional;
    document.getElementById('option-regular').textContent = t.optionRegular;
    
    // Buttons
    document.getElementById('btn-save').textContent = t.btnSave;
    document.getElementById('btn-load').textContent = t.btnLoad;
    document.getElementById('btn-export').textContent = t.btnExport;
    document.getElementById('btn-gdt-export').textContent = t.btnGdtExport;
    document.getElementById('btn-clear').textContent = t.btnClear;
    
    // Footer
    document.getElementById('footer-text').textContent = t.footerText;
    
    // Modal
    document.getElementById('modal-title').textContent = t.modalTitle;
    document.getElementById('modal-text').textContent = t.modalText;
    document.getElementById('modal-confirm').textContent = t.modalConfirm;
    document.getElementById('modal-cancel').textContent = t.modalCancel;
    
    // Voice status
    document.getElementById('voiceStatusText').textContent = t.voiceStatusText;
    
    // Store current language
    currentLanguage = lang;
}

// Current language variable
let currentLanguage = 'de';

        // ====================================================================
        // ENCRYPTION MODULE (INLINE)
        // ====================================================================
        // AES-256-GCM encryption using Web Crypto API
        // All encryption happens locally in the browser
// AES-256 Encryption using Web Crypto API
// All encryption happens locally in the browser

let currentAction = null;

// Derive key from password using PBKDF2
async function deriveKey(password, salt) {
    const encoder = new TextEncoder();
    const passwordKey = await crypto.subtle.importKey(
        'raw',
        encoder.encode(password),
        'PBKDF2',
        false,
        ['deriveBits', 'deriveKey']
    );

    return crypto.subtle.deriveKey(
        {
            name: 'PBKDF2',
            salt: salt,
            iterations: 100000,
            hash: 'SHA-256'
        },
        passwordKey,
        { name: 'AES-GCM', length: 256 },
        false,
        ['encrypt', 'decrypt']
    );
}

// Encrypt data with AES-256-GCM
async function encryptData(data, password) {
    const encoder = new TextEncoder();
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const iv = crypto.getRandomValues(new Uint8Array(12));
    
    const key = await deriveKey(password, salt);
    
    const encryptedData = await crypto.subtle.encrypt(
        {
            name: 'AES-GCM',
            iv: iv
        },
        key,
        encoder.encode(data)
    );

    // Combine salt, iv, and encrypted data
    const result = new Uint8Array(salt.length + iv.length + encryptedData.byteLength);
    result.set(salt, 0);
    result.set(iv, salt.length);
    result.set(new Uint8Array(encryptedData), salt.length + iv.length);

    // Convert to base64 for storage
    return btoa(String.fromCharCode.apply(null, result));
}

// Decrypt data with AES-256-GCM
async function decryptData(encryptedBase64, password) {
    const decoder = new TextDecoder();
    
    // Decode from base64
    const encryptedArray = new Uint8Array(
        atob(encryptedBase64).split('').map(c => c.charCodeAt(0))
    );

    // Extract salt, iv, and encrypted data
    const salt = encryptedArray.slice(0, 16);
    const iv = encryptedArray.slice(16, 28);
    const data = encryptedArray.slice(28);

    const key = await deriveKey(password, salt);

    try {
        const decryptedData = await crypto.subtle.decrypt(
            {
                name: 'AES-GCM',
                iv: iv
            },
            key,
            data
        );

        return decoder.decode(decryptedData);
    } catch (e) {
        throw new Error('Decryption failed - incorrect password');
    }
}

// Show password modal
function showPasswordModal(action) {
    currentAction = action;
    document.getElementById('passwordModal').style.display = 'block';
    document.getElementById('encryptionPassword').value = '';
    document.getElementById('encryptionPassword').focus();
}

// Close password modal
function closePasswordModal() {
    document.getElementById('passwordModal').style.display = 'none';
    currentAction = null;
}

// Confirm password and execute action
async function confirmPassword() {
    const password = document.getElementById('encryptionPassword').value;
    
    if (!password) {
        alert(translations[currentLanguage].alertPassword);
        return;
    }

    closePasswordModal();

    if (currentAction === 'save') {
        await performSave(password);
    } else if (currentAction === 'load') {
        await performLoad(password);
    }
}

// Get form data
function getFormData() {
    const form = document.getElementById('anamneseForm');
    const formData = new FormData(form);
    const data = {};
    
    for (let [key, value] of formData.entries()) {
        if (key === 'privacyConsent') {
            data[key] = form.elements[key].checked;
        } else {
            data[key] = value;
        }
    }
    
    // Add timestamp and language
    data.timestamp = new Date().toISOString();
    data.language = currentLanguage;
    
    return data;
}

// Set form data
function setFormData(data) {
    const form = document.getElementById('anamneseForm');
    
    for (let key in data) {
        if (key === 'timestamp' || key === 'language') continue;
        
        const element = form.elements[key];
        if (element) {
            if (element.type === 'checkbox') {
                element.checked = data[key];
            } else {
                element.value = data[key] || '';
            }
        }
    }
    
    // Set language if available
    if (data.language) {
        document.getElementById('language').value = data.language;
        changeLanguage();
    }
}

// Perform save with encryption
async function performSave(password) {
    try {
        const formData = getFormData();
        const jsonData = JSON.stringify(formData);
        
        const encryptedData = await encryptData(jsonData, password);
        
        // Save to localStorage
        localStorage.setItem('anamneseData', encryptedData);
        
        alert(translations[currentLanguage].alertSaved);
    } catch (error) {
        console.error('Save error:', error);
        alert('Error saving data: ' + error.message);
    }
}

// Perform load with decryption
async function performLoad(password) {
    try {
        const encryptedData = localStorage.getItem('anamneseData');
        
        if (!encryptedData) {
            alert(translations[currentLanguage].alertNoData);
            return;
        }
        
        const jsonData = await decryptData(encryptedData, password);
        const formData = JSON.parse(jsonData);
        
        setFormData(formData);
        
        alert(translations[currentLanguage].alertLoaded);
    } catch (error) {
        console.error('Load error:', error);
        alert(translations[currentLanguage].alertError);
    }
}

// Save encrypted (called from button)
function saveEncrypted() {
    showPasswordModal('save');
}

// Load encrypted (called from button)
function loadEncrypted() {
    showPasswordModal('load');
}

// Export as JSON (unencrypted)
function exportJSON() {
    const formData = getFormData();
    const jsonData = JSON.stringify(formData, null, 2);
    
    const blob = new Blob([jsonData], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `anamnese_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert(translations[currentLanguage].alertExported);
}

// Clear form
function clearForm() {
    if (confirm('Are you sure you want to clear all form data?')) {
        document.getElementById('anamneseForm').reset();
        alert(translations[currentLanguage].alertCleared);
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('passwordModal');
    if (event.target === modal) {
        closePasswordModal();
    }
}

// Handle Enter key in password field
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('encryptionPassword');
    if (passwordInput) {
        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                confirmPassword();
            }
        });
    }
});

        // ====================================================================
        // LICENSING & USAGE METERING MODULE (INLINE)
        // ====================================================================
        // Offline-first licensing system with usage-based billing
        // ‚úì Patient data NEVER transmitted (100% offline)
        // ‚úì Only anonymized metadata sent (license ID, event type, timestamp)
        // ‚úì Signed usage receipts for tamper-proof billing
        // ‚úì EU-only backend integration (GDPR compliant)
        // ====================================================================

// Licensing Configuration
const LicensingConfig = {
    apiBaseUrl: 'https://api.anamnese-a.eu', // EU-only backend (configure for production)
    offlineGracePeriod: 30 * 24 * 60 * 60 * 1000, // 30 days in milliseconds
    usageReceiptBatchSize: 50, // Max events per receipt
    usageReceiptRetentionLimit: 100, // Max receipts to keep in localStorage
    autoSyncInterval: 24 * 60 * 60 * 1000, // Daily sync (24 hours)
    enabled: false, // Set to true when backend is ready
    stripe: {
        publishableKey: 'pk_test_XXXXXXXXXXXXXXXXXXXXXXXX', // Replace with actual Stripe publishable key
        customerPortalUrl: 'https://billing.stripe.com/p/login/test_XXXXXXXX', // Replace with actual Customer Portal URL
        priceId: 'price_XXXXXXXXXXXXXXXXXXXXXXXX' // Replace with actual metered price ID
    }
};

// License Manager - Handles activation, validation, and offline mode
const LicenseManager = {
    license: null,
    offlineToken: null,
    
    /**
     * Initialize license from localStorage
     */
    init() {
        try {
            const stored = localStorage.getItem('anamnese_license');
            if (stored) {
                this.license = JSON.parse(stored);
            }
            
            const token = localStorage.getItem('anamnese_offline_token');
            if (token) {
                this.offlineToken = token;
            }
            
            // Check if validation needed
            this.checkValidation();
        } catch (error) {
            console.error('License initialization error:', error);
        }
    },
    
    /**
     * Activate a license token
     */
    async activateLicense(token) {
        if (!LicensingConfig.enabled) {
            console.log('Licensing not enabled, skipping activation');
            return { success: true, mode: 'demo' };
        }
        
        try {
            // Validate token format
            if (!this.isValidTokenFormat(token)) {
                return { 
                    success: false, 
                    error: 'Invalid token format. Expected: LIC-XXXXX-XXXXX-XXXXX-XXXXX' 
                };
            }
            
            // Call activation API
            const response = await fetch(`${LicensingConfig.apiBaseUrl}/api/license/activate`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    token: token,
                    deviceId: this.getDeviceFingerprint(),
                    appVersion: window.APP_DATA?.version || '8.0.0',
                    locale: navigator.language || 'de-DE'
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Store license data
                this.license = result.licenseData;
                this.offlineToken = result.offlineValidationToken;
                
                localStorage.setItem('anamnese_license', JSON.stringify(this.license));
                localStorage.setItem('anamnese_offline_token', this.offlineToken);
                localStorage.setItem('anamnese_license_last_validated', Date.now().toString());
                
                return { success: true, license: this.license };
            } else {
                return { success: false, error: result.message || 'Activation failed' };
            }
        } catch (error) {
            console.error('License activation error:', error);
            return { 
                success: false, 
                error: 'Network error. Please check your internet connection.' 
            };
        }
    },
    
    /**
     * Validate token format
     */
    isValidTokenFormat(token) {
        // Format: LIC-XXXXX-XXXXX-XXXXX-XXXXX
        // Total length: 29 characters (LIC- + 4 segments of 5 chars + 3 hyphens)
        return /^LIC-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}-[A-Z0-9]{5}$/.test(token);
    },
    
    /**
     * Get anonymized device fingerprint
     */
    getDeviceFingerprint() {
        // Create anonymous device identifier (no personal data)
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        ctx.textBaseline = 'top';
        ctx.font = '14px Arial';
        ctx.fillText('fingerprint', 2, 2);
        
        const fingerprint = [
            navigator.userAgent,
            screen.width + 'x' + screen.height,
            new Date().getTimezoneOffset(),
            navigator.language,
            canvas.toDataURL()
        ].join('|');
        
        // Hash the fingerprint for anonymization
        return this.simpleHash(fingerprint).substring(0, 32);
    },
    
    /**
     * Simple hash function (for client-side fingerprinting)
     */
    simpleHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash; // Convert to 32-bit integer
        }
        return Math.abs(hash).toString(36);
    },
    
    /**
     * Check if license validation is needed
     */
    async checkValidation() {
        if (!this.license || !LicensingConfig.enabled) return;
        
        const lastValidated = parseInt(localStorage.getItem('anamnese_license_last_validated') || '0');
        const timeSinceValidation = Date.now() - lastValidated;
        
        // Validate if more than 30 days since last check
        if (timeSinceValidation > LicensingConfig.offlineGracePeriod) {
            await this.validateLicense();
        }
    },
    
    /**
     * Validate license with server
     */
    async validateLicense() {
        if (!this.license || !LicensingConfig.enabled) return { success: true, mode: 'offline' };
        
        try {
            const response = await fetch(`${LicensingConfig.apiBaseUrl}/api/license/validate`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${this.license.token}`
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                // Update license data
                this.license.status = result.status;
                this.offlineToken = result.offlineValidationToken;
                
                localStorage.setItem('anamnese_license', JSON.stringify(this.license));
                localStorage.setItem('anamnese_offline_token', this.offlineToken);
                localStorage.setItem('anamnese_license_last_validated', Date.now().toString());
                
                return { success: true, status: result.status };
            } else {
                return { success: false, error: result.message };
            }
        } catch (error) {
            console.warn('License validation failed (offline mode):', error);
            // Allow offline usage within grace period
            return { success: true, mode: 'offline' };
        }
    },
    
    /**
     * Check if licensed feature is available
     */
    hasFeature(featureName) {
        if (!LicensingConfig.enabled) return true; // All features enabled if licensing disabled
        if (!this.license) return false;
        return this.license.features && this.license.features[featureName] === true;
    },
    
    /**
     * Get license status
     */
    getStatus() {
        if (!LicensingConfig.enabled) {
            return { active: true, mode: 'demo', message: 'Demo mode - licensing not enabled' };
        }
        
        if (!this.license) {
            return { active: false, mode: 'unlicensed', message: 'No license activated' };
        }
        
        return {
            active: this.license.status === 'active',
            mode: this.license.status,
            message: this.license.status === 'active' ? 'License active' : 'License inactive'
        };
    }
};

// Usage Metering - Tracks billable events (exports)
const UsageMetering = {
    receipts: [],
    currentReceipt: null,
    syncIntervalId: null, // Store interval ID for cleanup
    
    /**
     * Initialize usage metering
     */
    init() {
        try {
            const stored = localStorage.getItem('anamnese_usage_receipts');
            if (stored) {
                this.receipts = JSON.parse(stored);
            }
            
            // Create new receipt for current session
            this.startNewReceipt();
            
            // Set up auto-sync (store interval ID for cleanup)
            if (LicensingConfig.enabled) {
                this.syncIntervalId = setInterval(() => this.syncReceipts(), LicensingConfig.autoSyncInterval);
            }
        } catch (error) {
            console.error('Usage metering initialization error:', error);
        }
    },
    
    /**
     * Cleanup - clear auto-sync interval
     */
    cleanup() {
        if (this.syncIntervalId) {
            clearInterval(this.syncIntervalId);
            this.syncIntervalId = null;
        }
    },
    
    /**
     * Start a new usage receipt
     */
    startNewReceipt() {
        this.currentReceipt = {
            receiptId: this.generateReceiptId(),
            licenseId: LicenseManager.license?.token || 'UNLICENSED',
            clinicId: LicenseManager.license?.clinicId || 'UNKNOWN',
            generatedAt: new Date().toISOString(),
            events: []
        };
    },
    
    /**
     * Generate receipt ID
     */
    generateReceiptId() {
        const date = new Date().toISOString().split('T')[0].replace(/-/g, '');
        const random = Math.random().toString(36).substring(2, 8).toUpperCase();
        return `RECEIPT-${date}-${random}`;
    },
    
    /**
     * Record a billable event
     */
    recordEvent(eventType, metadata = {}) {
        if (!LicensingConfig.enabled) {
            console.log('Usage metering not enabled, skipping event:', eventType);
            return;
        }
        
        const event = {
            eventId: this.generateEventId(),
            eventType: eventType,
            timestamp: new Date().toISOString(),
            metadata: this.sanitizeMetadata(metadata)
        };
        
        this.currentReceipt.events.push(event);
        
        // If batch size reached, finalize and start new receipt
        if (this.currentReceipt.events.length >= LicensingConfig.usageReceiptBatchSize) {
            this.finalizeReceipt();
            this.startNewReceipt();
        }
        
        // Save to localStorage
        this.saveReceipts();
        
        console.log('Billable event recorded:', eventType);
    },
    
    /**
     * Generate event ID
     */
    generateEventId() {
        const timestamp = Date.now();
        const random = Math.random().toString(36).substring(2, 6).toUpperCase();
        return `EVT-${timestamp}-${random}`;
    },
    
    /**
     * Sanitize metadata (remove any patient data)
     */
    sanitizeMetadata(metadata) {
        // Only allow non-PHI technical metadata
        const allowed = {
            exportFormat: metadata.exportFormat,
            fieldCount: metadata.fieldCount,
            language: metadata.language,
            appVersion: metadata.appVersion,
            encrypted: metadata.encrypted,
            fileSize: metadata.fileSize
        };
        
        // Filter out undefined values
        return Object.fromEntries(
            Object.entries(allowed).filter(([_, v]) => v !== undefined)
        );
    },
    
    /**
     * Finalize current receipt (add signature)
     */
    finalizeReceipt() {
        if (this.currentReceipt.events.length === 0) return;
        
        // Update timestamp
        this.currentReceipt.generatedAt = new Date().toISOString();
        
        // Generate signature
        this.currentReceipt.signature = this.generateSignature(this.currentReceipt);
        
        // Add to receipts array
        this.receipts.push(this.currentReceipt);
        
        // Keep only last N receipts (configured limit)
        if (this.receipts.length > LicensingConfig.usageReceiptRetentionLimit) {
            this.receipts = this.receipts.slice(-LicensingConfig.usageReceiptRetentionLimit);
        }
    },
    
    /**
     * Generate HMAC signature for receipt
     * NOTE: This is a simplified client-side hash. In production, the server
     * will verify using proper HMAC-SHA256 with the license secret key.
     */
    async generateSignature(receipt) {
        // Simple client-side hash (server verifies with proper HMAC)
        const payload = JSON.stringify({
            receiptId: receipt.receiptId,
            licenseId: receipt.licenseId,
            events: receipt.events.map(e => ({
                eventId: e.eventId,
                eventType: e.eventType,
                timestamp: e.timestamp
            }))
        });
        
        // Simple hash for client (server validates with HMAC-SHA256)
        return 'SHA256-' + LicenseManager.simpleHash(payload);
    },
    
    /**
     * Save receipts to localStorage
     */
    saveReceipts() {
        try {
            localStorage.setItem('anamnese_usage_receipts', JSON.stringify(this.receipts));
        } catch (error) {
            console.error('Failed to save usage receipts:', error);
        }
    },
    
    /**
     * Sync receipts with server
     */
    async syncReceipts() {
        if (!LicensingConfig.enabled || this.receipts.length === 0) return;
        
        // Finalize current receipt before sync
        if (this.currentReceipt.events.length > 0) {
            this.finalizeReceipt();
            this.startNewReceipt();
        }
        
        try {
            for (const receipt of this.receipts) {
                if (!receipt.submitted) {
                    const result = await this.submitReceipt(receipt);
                    if (result.success) {
                        receipt.submitted = true;
                        receipt.submittedAt = new Date().toISOString();
                    }
                }
            }
            
            // Remove successfully submitted receipts older than 30 days
            const cutoff = Date.now() - (30 * 24 * 60 * 60 * 1000);
            this.receipts = this.receipts.filter(r => {
                if (r.submitted) {
                    const submittedTime = new Date(r.submittedAt).getTime();
                    return submittedTime > cutoff;
                }
                return true; // Keep unsubmitted receipts
            });
            
            this.saveReceipts();
            console.log('Usage receipts synced successfully');
        } catch (error) {
            console.error('Failed to sync usage receipts:', error);
        }
    },
    
    /**
     * Submit a single receipt to server
     */
    async submitReceipt(receipt) {
        try {
            const response = await fetch(`${LicensingConfig.apiBaseUrl}/api/usage/submit`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${LicenseManager.license?.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(receipt)
            });
            
            const result = await response.json();
            return result;
        } catch (error) {
            console.error('Failed to submit receipt:', error);
            return { success: false, error: error.message };
        }
    },
    
    /**
     * Get usage summary
     */
    getSummary() {
        const totalEvents = this.receipts.reduce((sum, r) => sum + r.events.length, 0);
        const currentEvents = this.currentReceipt.events.length;
        
        return {
            totalReceipts: this.receipts.length,
            totalEvents: totalEvents + currentEvents,
            pendingSync: this.receipts.filter(r => !r.submitted).length,
            currentSessionEvents: currentEvents
        };
    }
};

// UI Helper Functions
const LicensingUI = {
    /**
     * Show license activation dialog
     */
    showActivationDialog() {
        const html = `
            <div class="modal" id="licenseActivationModal" style="display: block; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7);">
                <div class="modal-content" style="background-color: #fefefe; margin: 10% auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <h2 style="margin-top: 0;">üîë Lizenz Aktivieren</h2>
                    <p>Bitte geben Sie Ihren Lizenzschl√ºssel ein, um Anamnese-A zu aktivieren.</p>
                    <p style="font-size: 0.9em; color: #666;">
                        <strong>Wichtig:</strong> Ihre Patientendaten bleiben 100% lokal auf diesem Ger√§t. 
                        Nur anonymisierte Nutzungsmetadaten werden f√ºr die Abrechnung √ºbermittelt.
                    </p>
                    <input type="text" id="licenseTokenInput" placeholder="LIC-XXXXX-XXXXX-XXXXX-XXXXX" 
                           style="width: 100%; padding: 12px; margin: 15px 0; border: 2px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 14px;">
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button onclick="LicensingUI.activateLicense()" style="flex: 1; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            Aktivieren
                        </button>
                        <button onclick="LicensingUI.closeActivationDialog()" style="flex: 1; padding: 12px; background: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            Abbrechen
                        </button>
                    </div>
                    <div id="licenseActivationStatus" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', html);
    },
    
    /**
     * Activate license from dialog
     */
    async activateLicense() {
        const input = document.getElementById('licenseTokenInput');
        const status = document.getElementById('licenseActivationStatus');
        const token = input.value.trim();
        
        if (!token) {
            status.style.display = 'block';
            status.style.background = '#fee';
            status.style.color = '#c00';
            status.textContent = 'Bitte geben Sie einen Lizenzschl√ºssel ein.';
            return;
        }
        
        status.style.display = 'block';
        status.style.background = '#ffc';
        status.style.color = '#660';
        status.textContent = 'Aktiviere Lizenz...';
        
        const result = await LicenseManager.activateLicense(token);
        
        if (result.success) {
            status.style.background = '#efe';
            status.style.color = '#060';
            status.textContent = '‚úÖ Lizenz erfolgreich aktiviert!';
            setTimeout(() => this.closeActivationDialog(), 2000);
        } else {
            status.style.background = '#fee';
            status.style.color = '#c00';
            status.textContent = '‚ùå Aktivierung fehlgeschlagen: ' + result.error;
        }
    },
    
    /**
     * Close activation dialog
     */
    closeActivationDialog() {
        const modal = document.getElementById('licenseActivationModal');
        if (modal) modal.remove();
    },
    
    /**
     * Show license info banner
     */
    showLicenseInfo() {
        const status = LicenseManager.getStatus();
        const summary = UsageMetering.getSummary();
        
        let message = '';
        let color = '#667eea';
        
        if (!LicensingConfig.enabled) {
            message = 'üéâ Demo-Modus - Alle Features verf√ºgbar';
            color = '#22c55e';
        } else if (status.active) {
            message = `‚úÖ Lizenz aktiv | ${summary.totalEvents} Exporte diesen Monat | üí≥ Klick f√ºr Abrechnung`;
            color = '#22c55e';
        } else {
            message = '‚ö†Ô∏è Keine Lizenz - Bitte aktivieren Sie Ihre Lizenz';
            color = '#ef4444';
        }
        
        const banner = document.createElement('div');
        banner.id = 'licenseBanner';
        banner.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: ${color};
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 9999;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.2s;
        `;
        banner.textContent = message;
        banner.onmouseover = () => {
            banner.style.transform = 'scale(1.05)';
        };
        banner.onmouseout = () => {
            banner.style.transform = 'scale(1)';
        };
        banner.onclick = () => {
            if (!status.active && LicensingConfig.enabled) {
                this.showActivationDialog();
            } else if (status.active) {
                // Show billing dialog when license is active
                if (window.BillingUI) {
                    window.BillingUI.showBillingDialog();
                }
            }
        };
        
        // Remove old banner if exists
        const oldBanner = document.getElementById('licenseBanner');
        if (oldBanner) oldBanner.remove();
        
        document.body.appendChild(banner);
    }
};

// Initialize licensing on page load
document.addEventListener('DOMContentLoaded', () => {
    LicenseManager.init();
    UsageMetering.init();
    
    // Show license info after a delay
    setTimeout(() => LicensingUI.showLicenseInfo(), 2000);
});

// Export functions for use in other modules
window.LicenseManager = LicenseManager;
window.UsageMetering = UsageMetering;
window.LicensingUI = LicensingUI;

        // ====================================================================
        // STRIPE INTEGRATION MODULE (INLINE)
        // ====================================================================
        // Stripe payment processing for usage-based billing
        // ‚úì EU-only Stripe instance (GDPR compliant)
        // ‚úì Customer Portal integration
        // ‚úì Metered billing API
        // ‚úì Secure payment method management
        // ====================================================================

// Stripe Manager - Handles payment processing and subscription management
const StripeManager = {
    stripe: null,
    
    /**
     * Initialize Stripe.js
     */
    init() {
        if (typeof Stripe === 'undefined') {
            console.warn('Stripe.js not loaded. Payment features disabled.');
            return false;
        }
        
        if (!LicensingConfig.stripe.publishableKey) {
            console.warn('Stripe publishable key not configured.');
            return false;
        }
        
        try {
            this.stripe = Stripe(LicensingConfig.stripe.publishableKey);
            console.log('Stripe initialized successfully');
            return true;
        } catch (error) {
            console.error('Failed to initialize Stripe:', error);
            return false;
        }
    },
    
    /**
     * Open Stripe Customer Portal for billing management
     */
    async openCustomerPortal() {
        if (!LicenseManager.license) {
            alert('Bitte aktivieren Sie zuerst Ihre Lizenz.');
            return;
        }
        
        try {
            // Request Customer Portal session from backend
            const response = await fetch(`${LicensingConfig.apiBaseUrl}/api/stripe/create-portal-session`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${LicenseManager.license.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    licenseId: LicenseManager.license.token,
                    returnUrl: window.location.href
                })
            });
            
            const result = await response.json();
            
            if (result.success && result.url) {
                // Redirect to Customer Portal
                window.location.href = result.url;
            } else {
                throw new Error(result.message || 'Failed to create portal session');
            }
        } catch (error) {
            console.error('Failed to open Customer Portal:', error);
            alert('Fehler beim √ñffnen des Abrechnungsportals: ' + error.message);
        }
    },
    
    /**
     * Create a checkout session for initial subscription
     */
    async createCheckoutSession() {
        if (!this.stripe) {
            alert('Stripe ist nicht initialisiert.');
            return;
        }
        
        if (!LicenseManager.license) {
            alert('Bitte aktivieren Sie zuerst Ihre Lizenz.');
            return;
        }
        
        try {
            // Request checkout session from backend
            const response = await fetch(`${LicensingConfig.apiBaseUrl}/api/stripe/create-checkout-session`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${LicenseManager.license.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    licenseId: LicenseManager.license.token,
                    priceId: LicensingConfig.stripe.priceId,
                    successUrl: window.location.href + '?checkout=success',
                    cancelUrl: window.location.href + '?checkout=cancel'
                })
            });
            
            const result = await response.json();
            
            if (result.success && result.sessionId) {
                // Redirect to Stripe Checkout
                const { error } = await this.stripe.redirectToCheckout({
                    sessionId: result.sessionId
                });
                
                if (error) {
                    throw error;
                }
            } else {
                throw new Error(result.message || 'Failed to create checkout session');
            }
        } catch (error) {
            console.error('Failed to create checkout session:', error);
            alert('Fehler beim Erstellen der Checkout-Sitzung: ' + error.message);
        }
    },
    
    /**
     * Get current subscription details
     */
    async getSubscriptionDetails() {
        if (!LicenseManager.license) {
            return null;
        }
        
        try {
            const response = await fetch(`${LicensingConfig.apiBaseUrl}/api/stripe/subscription`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${LicenseManager.license.token}`
                }
            });
            
            const result = await response.json();
            
            if (result.success) {
                return result.subscription;
            }
            
            return null;
        } catch (error) {
            console.error('Failed to get subscription details:', error);
            return null;
        }
    },
    
    /**
     * Format currency for display
     */
    formatCurrency(amount, currency = 'EUR') {
        return new Intl.NumberFormat('de-DE', {
            style: 'currency',
            currency: currency
        }).format(amount / 100); // Stripe amounts are in cents
    }
};

// Billing UI - User interface for billing management
const BillingUI = {
    /**
     * Show billing management dialog
     */
    async showBillingDialog() {
        const subscription = await StripeManager.getSubscriptionDetails();
        const usage = UsageMetering.getSummary();
        
        const html = `
            <div class="modal" id="billingModal" style="display: block; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); overflow-y: auto;">
                <div class="modal-content" style="background-color: #fefefe; margin: 5% auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 600px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">üí≥ Abrechnung & Zahlung</h2>
                        <button onclick="BillingUI.closeBillingDialog()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                    </div>
                    
                    <!-- License Status -->
                    <div style="padding: 15px; background: ${LicenseManager.license ? '#e8f5e9' : '#fff3e0'}; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid ${LicenseManager.license ? '#4caf50' : '#ff9800'};">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">üìã Lizenzstatus</h3>
                        ${LicenseManager.license ? `
                            <p style="margin: 5px 0;"><strong>Lizenz-ID:</strong> ${LicenseManager.license.token}</p>
                            <p style="margin: 5px 0;"><strong>Status:</strong> <span style="color: #4caf50;">‚úÖ Aktiv</span></p>
                            <p style="margin: 5px 0;"><strong>Praxis:</strong> ${LicenseManager.license.clinicName || 'N/A'}</p>
                        ` : `
                            <p style="margin: 5px 0; color: #f57c00;"><strong>‚ö†Ô∏è Keine Lizenz aktiviert</strong></p>
                            <button onclick="LicensingUI.showActivationDialog()" style="margin-top: 10px; padding: 8px 16px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                Lizenz aktivieren
                            </button>
                        `}
                    </div>
                    
                    <!-- Usage Summary -->
                    <div style="padding: 15px; background: #e3f2fd; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                        <h3 style="margin: 0 0 10px 0; font-size: 16px;">üìä Nutzungs√ºbersicht</h3>
                        <p style="margin: 5px 0;"><strong>Exporte diesen Monat:</strong> ${usage.totalEvents}</p>
                        <p style="margin: 5px 0;"><strong>Gesch√§tzte Kosten:</strong> ${StripeManager.formatCurrency(usage.totalEvents * 50)}</p>
                        <p style="margin: 5px 0; font-size: 0.9em; color: #666;">
                            Preis pro Export: ‚Ç¨0.50
                        </p>
                    </div>
                    
                    <!-- Subscription Info -->
                    ${subscription ? `
                        <div style="padding: 15px; background: #f3e5f5; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #9c27b0;">
                            <h3 style="margin: 0 0 10px 0; font-size: 16px;">üíé Abonnement</h3>
                            <p style="margin: 5px 0;"><strong>Status:</strong> ${subscription.status}</p>
                            <p style="margin: 5px 0;"><strong>N√§chste Rechnung:</strong> ${new Date(subscription.current_period_end * 1000).toLocaleDateString('de-DE')}</p>
                            ${subscription.cancel_at_period_end ? `
                                <p style="margin: 5px 0; color: #f57c00;"><strong>‚ö†Ô∏è K√ºndigung geplant</strong></p>
                            ` : ''}
                        </div>
                    ` : `
                        <div style="padding: 15px; background: #fff3e0; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ff9800;">
                            <h3 style="margin: 0 0 10px 0; font-size: 16px;">üíé Abonnement</h3>
                            <p style="margin: 5px 0;">Kein aktives Abonnement</p>
                            ${LicenseManager.license ? `
                                <button onclick="StripeManager.createCheckoutSession()" style="margin-top: 10px; padding: 8px 16px; background: #9c27b0; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    Abonnement starten
                                </button>
                            ` : ''}
                        </div>
                    `}
                    
                    <!-- Action Buttons -->
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        ${LicenseManager.license && subscription ? `
                            <button onclick="StripeManager.openCustomerPortal()" style="flex: 1; padding: 12px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: 500;">
                                üîí Abrechnungsportal √∂ffnen
                            </button>
                        ` : ''}
                        <button onclick="BillingUI.closeBillingDialog()" style="flex: 1; padding: 12px; background: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            Schlie√üen
                        </button>
                    </div>
                    
                    <!-- Info Text -->
                    <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 8px; font-size: 0.9em; color: #666;">
                        <h4 style="margin: 0 0 10px 0; font-size: 14px;">‚ÑπÔ∏è Wichtige Hinweise</h4>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                            <li>Ihre Patientendaten bleiben 100% lokal auf diesem Ger√§t</li>
                            <li>Nur anonymisierte Nutzungsmetadaten werden f√ºr die Abrechnung √ºbermittelt</li>
                            <li>Zahlungsabwicklung erfolgt sicher √ºber Stripe (EU-Instanz)</li>
                            <li>Im Abrechnungsportal k√∂nnen Sie Rechnungen einsehen und Zahlungsmethoden verwalten</li>
                        </ul>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', html);
    },
    
    /**
     * Close billing dialog
     */
    closeBillingDialog() {
        const modal = document.getElementById('billingModal');
        if (modal) modal.remove();
    },
    
    /**
     * Show usage history
     */
    showUsageHistory() {
        const receipts = UsageMetering.receipts.slice(-10).reverse(); // Last 10 receipts
        
        let historyHtml = '<h3 style="margin-top: 20px;">Nutzungsverlauf (letzte 10 Belege)</h3>';
        historyHtml += '<div style="max-height: 300px; overflow-y: auto;">';
        
        if (receipts.length === 0) {
            historyHtml += '<p style="color: #666;">Keine Nutzungsbelege vorhanden</p>';
        } else {
            receipts.forEach(receipt => {
                const date = new Date(receipt.generatedAt).toLocaleDateString('de-DE');
                const status = receipt.submitted ? '‚úÖ √úbermittelt' : '‚è≥ Ausstehend';
                historyHtml += `
                    <div style="padding: 10px; margin: 10px 0; background: #f9f9f9; border-radius: 5px; border-left: 3px solid ${receipt.submitted ? '#4caf50' : '#ff9800'};">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>${receipt.receiptId}</strong>
                            <span style="color: #666;">${date}</span>
                        </div>
                        <div style="margin-top: 5px; font-size: 0.9em;">
                            <span>Exporte: ${receipt.events.length}</span> | 
                            <span>Status: ${status}</span>
                        </div>
                    </div>
                `;
            });
        }
        
        historyHtml += '</div>';
        
        return historyHtml;
    }
};

// Initialize Stripe on page load
document.addEventListener('DOMContentLoaded', () => {
    StripeManager.init();
    
    // Check for checkout result in URL
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('checkout') === 'success') {
        setTimeout(() => {
            alert('‚úÖ Zahlung erfolgreich! Ihr Abonnement ist jetzt aktiv.');
            // Remove query parameter
            window.history.replaceState({}, document.title, window.location.pathname);
        }, 1000);
    } else if (urlParams.get('checkout') === 'cancel') {
        setTimeout(() => {
            alert('‚ùå Zahlung abgebrochen. Sie k√∂nnen jederzeit erneut versuchen.');
            // Remove query parameter
            window.history.replaceState({}, document.title, window.location.pathname);
        }, 1000);
    }
});

// Export functions for use in other modules
window.StripeManager = StripeManager;
window.BillingUI = BillingUI;

        // ====================================================================
        // ENHANCED OFFLINE FEATURES MODULE (INLINE)
        // ====================================================================
        // Advanced offline functionality improvements
        // ‚úì 100% local processing (no cloud/server)
        // ‚úì GDPR compliant (data never leaves device)
        // ‚úì Enhanced backup, search, and auto-completion
        // ====================================================================

// Enhanced Backup Manager - Comprehensive local backup system
const EnhancedBackupManager = {
    dbName: 'AnamneseBackups',
    version: 1,
    db: null,
    
    /**
     * Initialize IndexedDB for backup storage
     */
    async init() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.version);
            
            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                resolve();
            };
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                
                // Create backup store
                if (!db.objectStoreNames.contains('backups')) {
                    const backupStore = db.createObjectStore('backups', { keyPath: 'id', autoIncrement: true });
                    backupStore.createIndex('timestamp', 'timestamp', { unique: false });
                    backupStore.createIndex('type', 'type', { unique: false });
                }
                
                // Create version history store
                if (!db.objectStoreNames.contains('versions')) {
                    const versionStore = db.createObjectStore('versions', { keyPath: 'id', autoIncrement: true });
                    versionStore.createIndex('formId', 'formId', { unique: false });
                    versionStore.createIndex('timestamp', 'timestamp', { unique: false });
                }
            };
        });
    },
    
    /**
     * Create encrypted backup
     */
    async createBackup(data, password = null, format = 'json') {
        try {
            await this.init();
            
            const backup = {
                timestamp: new Date().toISOString(),
                type: format,
                data: data,
                encrypted: !!password,
                version: window.APP_DATA?.version || '8.0.0',
                size: JSON.stringify(data).length
            };
            
            // Encrypt if password provided
            if (password && typeof encryptData === 'function') {
                backup.data = await encryptData(JSON.stringify(data), password);
            }
            
            // Store in IndexedDB
            const transaction = this.db.transaction(['backups'], 'readwrite');
            const store = transaction.objectStore('backups');
            const request = store.add(backup);
            
            return new Promise((resolve, reject) => {
                request.onsuccess = () => resolve({ success: true, id: request.result });
                request.onerror = () => reject(request.error);
            });
        } catch (error) {
            console.error('Backup creation failed:', error);
            return { success: false, error: error.message };
        }
    },
    
    /**
     * List all backups
     */
    async listBackups() {
        try {
            await this.init();
            
            const transaction = this.db.transaction(['backups'], 'readonly');
            const store = transaction.objectStore('backups');
            const request = store.getAll();
            
            return new Promise((resolve, reject) => {
                request.onsuccess = () => {
                    const backups = request.result.map(b => ({
                        id: b.id,
                        timestamp: b.timestamp,
                        type: b.type,
                        encrypted: b.encrypted,
                        size: b.size,
                        version: b.version
                    }));
                    resolve(backups);
                };
                request.onerror = () => reject(request.error);
            });
        } catch (error) {
            console.error('List backups failed:', error);
            return [];
        }
    },
    
    /**
     * Restore from backup
     */
    async restoreBackup(backupId, password = null) {
        try {
            await this.init();
            
            const transaction = this.db.transaction(['backups'], 'readonly');
            const store = transaction.objectStore('backups');
            const request = store.get(backupId);
            
            return new Promise(async (resolve, reject) => {
                request.onsuccess = async () => {
                    const backup = request.result;
                    if (!backup) {
                        reject(new Error('Backup not found'));
                        return;
                    }
                    
                    let data = backup.data;
                    
                    // Decrypt if needed
                    if (backup.encrypted) {
                        if (!password) {
                            reject(new Error('Password required for encrypted backup'));
                            return;
                        }
                        if (typeof decryptData === 'function') {
                            data = await decryptData(data, password);
                            data = JSON.parse(data);
                        }
                    }
                    
                    resolve({ success: true, data: data });
                };
                request.onerror = () => reject(request.error);
            });
        } catch (error) {
            console.error('Restore backup failed:', error);
            return { success: false, error: error.message };
        }
    },
    
    /**
     * Delete old backups (keep last N)
     */
    async cleanupOldBackups(keepCount = 10) {
        try {
            await this.init();
            
            const backups = await this.listBackups();
            if (backups.length <= keepCount) return;
            
            // Sort by timestamp, oldest first
            const sorted = backups.sort((a, b) => 
                new Date(a.timestamp) - new Date(b.timestamp)
            );
            
            const toDelete = sorted.slice(0, sorted.length - keepCount);
            
            const transaction = this.db.transaction(['backups'], 'readwrite');
            const store = transaction.objectStore('backups');
            
            for (const backup of toDelete) {
                store.delete(backup.id);
            }
            
            return { success: true, deleted: toDelete.length };
        } catch (error) {
            console.error('Cleanup failed:', error);
            return { success: false, error: error.message };
        }
    },
    
    /**
     * Export backup to file
     */
    async exportBackupToFile(backupId, filename = null) {
        try {
            const result = await this.restoreBackup(backupId);
            if (!result.success) return result;
            
            const backup = result.data;
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            
            const fname = filename || `anamnese_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            // Download file
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fname;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            return { success: true, filename: fname };
        } catch (error) {
            console.error('Export failed:', error);
            return { success: false, error: error.message };
        }
    }
};

// Offline Search Manager - Full-text search across saved forms
const OfflineSearchManager = {
    dbName: 'AnamneseSearch',
    version: 1,
    db: null,
    searchIndex: new Map(),
    
    /**
     * Initialize search database
     */
    async init() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.version);
            
            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                this.buildSearchIndex();
                resolve();
            };
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                
                if (!db.objectStoreNames.contains('forms')) {
                    const formStore = db.createObjectStore('forms', { keyPath: 'id', autoIncrement: true });
                    formStore.createIndex('timestamp', 'timestamp', { unique: false });
                    formStore.createIndex('patientId', 'patientId', { unique: false });
                    formStore.createIndex('status', 'status', { unique: false });
                }
            };
        });
    },
    
    /**
     * Add form to search index
     */
    async indexForm(formData) {
        try {
            await this.init();
            
            const searchableForm = {
                id: formData.id || Date.now(),
                timestamp: new Date().toISOString(),
                patientId: this.hashPatientId(formData), // Pseudonymized
                status: formData.status || 'complete',
                searchText: this.extractSearchText(formData),
                metadata: {
                    hasRedFlags: this.checkRedFlags(formData),
                    completeness: this.calculateCompleteness(formData),
                    fieldCount: Object.keys(formData).length
                }
            };
            
            const transaction = this.db.transaction(['forms'], 'readwrite');
            const store = transaction.objectStore('forms');
            const request = store.add(searchableForm);
            
            return new Promise((resolve, reject) => {
                request.onsuccess = () => {
                    this.searchIndex.set(searchableForm.id, searchableForm);
                    resolve({ success: true, id: request.result });
                };
                request.onerror = () => reject(request.error);
            });
        } catch (error) {
            console.error('Index form failed:', error);
            return { success: false, error: error.message };
        }
    },
    
    /**
     * Search forms with full-text search
     */
    async search(query, filters = {}) {
        try {
            await this.init();
            
            if (this.searchIndex.size === 0) {
                await this.buildSearchIndex();
            }
            
            const queryLower = query.toLowerCase();
            const results = [];
            
            for (const [id, form] of this.searchIndex) {
                // Full-text search
                if (form.searchText.includes(queryLower)) {
                    // Apply filters
                    if (filters.status && form.status !== filters.status) continue;
                    if (filters.hasRedFlags !== undefined && form.metadata.hasRedFlags !== filters.hasRedFlags) continue;
                    if (filters.dateFrom && new Date(form.timestamp) < new Date(filters.dateFrom)) continue;
                    if (filters.dateTo && new Date(form.timestamp) > new Date(filters.dateTo)) continue;
                    
                    results.push({
                        id: form.id,
                        timestamp: form.timestamp,
                        status: form.status,
                        metadata: form.metadata,
                        relevance: this.calculateRelevance(queryLower, form.searchText)
                    });
                }
            }
            
            // Sort by relevance
            results.sort((a, b) => b.relevance - a.relevance);
            
            return results;
        } catch (error) {
            console.error('Search failed:', error);
            return [];
        }
    },
    
    /**
     * Build search index from IndexedDB
     */
    async buildSearchIndex() {
        try {
            const transaction = this.db.transaction(['forms'], 'readonly');
            const store = transaction.objectStore('forms');
            const request = store.getAll();
            
            return new Promise((resolve, reject) => {
                request.onsuccess = () => {
                    this.searchIndex.clear();
                    for (const form of request.result) {
                        this.searchIndex.set(form.id, form);
                    }
                    resolve();
                };
                request.onerror = () => reject(request.error);
            });
        } catch (error) {
            console.error('Build index failed:', error);
        }
    },
    
    /**
     * Extract searchable text from form data
     */
    extractSearchText(formData) {
        const texts = [];
        for (const [key, value] of Object.entries(formData)) {
            if (typeof value === 'string' && value.length > 0) {
                texts.push(value.toLowerCase());
            }
        }
        return texts.join(' ');
    },
    
    /**
     * Create pseudonymized patient ID hash
     */
    hashPatientId(formData) {
        const identifiers = [
            formData.lastname || '',
            formData.firstname || '',
            formData.birthdate || ''
        ].join('|');
        
        // Simple hash (for demo, use better hash in production)
        let hash = 0;
        for (let i = 0; i < identifiers.length; i++) {
            hash = ((hash << 5) - hash) + identifiers.charCodeAt(i);
            hash = hash & hash;
        }
        return Math.abs(hash).toString(36);
    },
    
    /**
     * Check for red flags in form
     */
    checkRedFlags(formData) {
        // Check for common red flags (basic implementation)
        const redFlagKeywords = ['chest pain', 'difficulty breathing', 'unconscious', 'severe'];
        const text = this.extractSearchText(formData);
        return redFlagKeywords.some(keyword => text.includes(keyword));
    },
    
    /**
     * Calculate form completeness percentage
     */
    calculateCompleteness(formData) {
        const requiredFields = ['firstname', 'lastname', 'birthdate'];
        const filled = requiredFields.filter(field => formData[field] && formData[field].length > 0).length;
        return Math.round((filled / requiredFields.length) * 100);
    },
    
    /**
     * Calculate search relevance score
     */
    calculateRelevance(query, text) {
        const occurrences = (text.match(new RegExp(query, 'g')) || []).length;
        const position = text.indexOf(query);
        const positionScore = position === 0 ? 2 : (position < 100 ? 1 : 0);
        return occurrences * 10 + positionScore;
    }
};

// Smart Auto-Completion Manager - Intelligent form suggestions
const SmartAutoCompleteManager = {
    dbName: 'AnamneseAutoComplete',
    version: 1,
    db: null,
    suggestions: new Map(),
    
    /**
     * Initialize auto-completion database
     */
    async init() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(this.dbName, this.version);
            
            request.onerror = () => reject(request.error);
            request.onsuccess = () => {
                this.db = request.result;
                this.loadSuggestions();
                resolve();
            };
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                
                if (!db.objectStoreNames.contains('suggestions')) {
                    const suggestionStore = db.createObjectStore('suggestions', { keyPath: 'field' });
                    suggestionStore.createIndex('frequency', 'frequency', { unique: false });
                }
                
                // Medical terms dictionary
                if (!db.objectStoreNames.contains('medical_terms')) {
                    const termsStore = db.createObjectStore('medical_terms', { keyPath: 'term' });
                    termsStore.createIndex('category', 'category', { unique: false });
                }
            };
        });
    },
    
    /**
     * Learn from user input
     */
    async learnFromInput(fieldName, value) {
        try {
            await this.init();
            
            if (!value || value.length < 2) return;
            
            const transaction = this.db.transaction(['suggestions'], 'readwrite');
            const store = transaction.objectStore('suggestions');
            const request = store.get(fieldName);
            
            request.onsuccess = () => {
                const existing = request.result || { field: fieldName, values: {}, frequency: {} };
                
                // Increment frequency
                existing.frequency[value] = (existing.frequency[value] || 0) + 1;
                
                // Keep top 10 suggestions
                const sorted = Object.entries(existing.frequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 10);
                
                existing.frequency = Object.fromEntries(sorted);
                existing.values = sorted.map(([v]) => v);
                
                store.put(existing);
                
                // Update memory cache
                this.suggestions.set(fieldName, existing.values);
            };
        } catch (error) {
            console.error('Learn from input failed:', error);
        }
    },
    
    /**
     * Get suggestions for field
     */
    async getSuggestions(fieldName, partialValue = '') {
        try {
            await this.init();
            
            // Check memory cache first
            if (this.suggestions.has(fieldName)) {
                const cached = this.suggestions.get(fieldName);
                if (!partialValue) return cached;
                
                // Filter by partial value
                return cached.filter(suggestion => 
                    suggestion.toLowerCase().includes(partialValue.toLowerCase())
                );
            }
            
            // Load from database
            const transaction = this.db.transaction(['suggestions'], 'readonly');
            const store = transaction.objectStore('suggestions');
            const request = store.get(fieldName);
            
            return new Promise((resolve) => {
                request.onsuccess = () => {
                    const result = request.result;
                    if (!result) {
                        resolve([]);
                        return;
                    }
                    
                    // Cache in memory
                    this.suggestions.set(fieldName, result.values);
                    
                    // Filter by partial value
                    if (partialValue) {
                        const filtered = result.values.filter(suggestion =>
                            suggestion.toLowerCase().includes(partialValue.toLowerCase())
                        );
                        resolve(filtered);
                    } else {
                        resolve(result.values);
                    }
                };
                request.onerror = () => resolve([]);
            });
        } catch (error) {
            console.error('Get suggestions failed:', error);
            return [];
        }
    },
    
    /**
     * Load all suggestions into memory
     */
    async loadSuggestions() {
        try {
            const transaction = this.db.transaction(['suggestions'], 'readonly');
            const store = transaction.objectStore('suggestions');
            const request = store.getAll();
            
            request.onsuccess = () => {
                for (const item of request.result) {
                    this.suggestions.set(item.field, item.values);
                }
            };
        } catch (error) {
            console.error('Load suggestions failed:', error);
        }
    },
    
    /**
     * Add medical term to dictionary
     */
    async addMedicalTerm(term, category = 'general') {
        try {
            await this.init();
            
            const transaction = this.db.transaction(['medical_terms'], 'readwrite');
            const store = transaction.objectStore('medical_terms');
            
            store.put({
                term: term.toLowerCase(),
                category: category,
                addedAt: new Date().toISOString()
            });
            
            return { success: true };
        } catch (error) {
            console.error('Add medical term failed:', error);
            return { success: false, error: error.message };
        }
    },
    
    /**
     * Search medical terms
     */
    async searchMedicalTerms(query) {
        try {
            await this.init();
            
            const transaction = this.db.transaction(['medical_terms'], 'readonly');
            const store = transaction.objectStore('medical_terms');
            const request = store.getAll();
            
            return new Promise((resolve) => {
                request.onsuccess = () => {
                    const queryLower = query.toLowerCase();
                    const results = request.result.filter(item =>
                        item.term.includes(queryLower)
                    );
                    resolve(results.slice(0, 10));
                };
                request.onerror = () => resolve([]);
            });
        } catch (error) {
            console.error('Search medical terms failed:', error);
            return [];
        }
    }
};

// Enhanced Offline Features UI
const EnhancedOfflineFeaturesUI = {
    /**
     * Show backup management dialog
     */
    async showBackupDialog() {
        const backups = await EnhancedBackupManager.listBackups();
        
        let backupListHtml = '';
        if (backups.length === 0) {
            backupListHtml = '<p style="color: #666; text-align: center; padding: 20px;">Keine Backups vorhanden</p>';
        } else {
            backupListHtml = '<div style="max-height: 300px; overflow-y: auto;">';
            for (const backup of backups.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))) {
                const date = new Date(backup.timestamp).toLocaleString('de-DE');
                const sizeKB = (backup.size / 1024).toFixed(2);
                backupListHtml += `
                    <div style="padding: 12px; margin: 8px 0; background: #f9f9f9; border-radius: 5px; border-left: 3px solid #667eea;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${date}</strong>
                                <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                                    ${sizeKB} KB | ${backup.encrypted ? 'üîí Verschl√ºsselt' : 'üìÑ Unverschl√ºsselt'}
                                </div>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button onclick="EnhancedOfflineFeaturesUI.restoreBackup(${backup.id})" 
                                        style="padding: 6px 12px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                                    Wiederherstellen
                                </button>
                                <button onclick="EnhancedBackupManager.exportBackupToFile(${backup.id})" 
                                        style="padding: 6px 12px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
                                    Export
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            backupListHtml += '</div>';
        }
        
        const html = `
            <div class="modal" id="backupModal" style="display: block; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); overflow-y: auto;">
                <div class="modal-content" style="background-color: #fefefe; margin: 5% auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 700px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">üíæ Lokale Backups</h2>
                        <button onclick="EnhancedOfflineFeaturesUI.closeBackupDialog()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                    </div>
                    
                    <div style="padding: 15px; background: #e3f2fd; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                        <h3 style="margin: 0 0 10px 0; font-size: 14px;">‚ÑπÔ∏è Datenschutz-Garantie</h3>
                        <p style="margin: 0; font-size: 0.9em;">
                            Alle Backups werden ausschlie√ülich lokal auf diesem Ger√§t gespeichert (IndexedDB).
                            Keine Daten werden in die Cloud oder auf externe Server √ºbertragen.
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <button onclick="EnhancedOfflineFeaturesUI.createNewBackup()" 
                                style="flex: 1; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            ‚úÖ Neues Backup erstellen
                        </button>
                        <button onclick="EnhancedOfflineFeaturesUI.createEncryptedBackup()" 
                                style="flex: 1; padding: 12px; background: #ff9800; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            üîí Verschl√ºsseltes Backup
                        </button>
                    </div>
                    
                    <h3 style="margin: 20px 0 10px 0;">Gespeicherte Backups (${backups.length})</h3>
                    ${backupListHtml}
                    
                    <div style="margin-top: 20px; padding: 15px; background: #fff3e0; border-radius: 8px; font-size: 0.9em;">
                        <strong>üí° Tipp:</strong> Erstellen Sie regelm√§√üig verschl√ºsselte Backups und exportieren Sie diese als Datei f√ºr zus√§tzliche Sicherheit.
                    </div>
                    
                    <button onclick="EnhancedOfflineFeaturesUI.closeBackupDialog()" style="margin-top: 20px; width: 100%; padding: 12px; background: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                        Schlie√üen
                    </button>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', html);
    },
    
    /**
     * Close backup dialog
     */
    closeBackupDialog() {
        const modal = document.getElementById('backupModal');
        if (modal) modal.remove();
    },
    
    /**
     * Create new backup
     */
    async createNewBackup() {
        try {
            // Get current form data
            const formData = AppState?.answers || {};
            
            if (Object.keys(formData).length === 0) {
                alert('Keine Daten zum Sichern vorhanden.');
                return;
            }
            
            const result = await EnhancedBackupManager.createBackup(formData, null, 'json');
            
            if (result.success) {
                alert('‚úÖ Backup erfolgreich erstellt!');
                this.closeBackupDialog();
                this.showBackupDialog(); // Refresh list
            } else {
                alert('‚ùå Backup fehlgeschlagen: ' + result.error);
            }
        } catch (error) {
            alert('‚ùå Fehler: ' + error.message);
        }
    },
    
    /**
     * Create encrypted backup
     */
    async createEncryptedBackup() {
        const password = prompt('Passwort f√ºr verschl√ºsseltes Backup eingeben:');
        if (!password) return;
        
        const passwordConfirm = prompt('Passwort best√§tigen:');
        if (password !== passwordConfirm) {
            alert('‚ùå Passw√∂rter stimmen nicht √ºberein!');
            return;
        }
        
        try {
            const formData = AppState?.answers || {};
            
            if (Object.keys(formData).length === 0) {
                alert('Keine Daten zum Sichern vorhanden.');
                return;
            }
            
            const result = await EnhancedBackupManager.createBackup(formData, password, 'json');
            
            if (result.success) {
                alert('‚úÖ Verschl√ºsseltes Backup erfolgreich erstellt!');
                this.closeBackupDialog();
                this.showBackupDialog();
            } else {
                alert('‚ùå Backup fehlgeschlagen: ' + result.error);
            }
        } catch (error) {
            alert('‚ùå Fehler: ' + error.message);
        }
    },
    
    /**
     * Restore backup
     */
    async restoreBackup(backupId) {
        if (!confirm('M√∂chten Sie dieses Backup wirklich wiederherstellen? Aktuelle Daten werden √ºberschrieben.')) {
            return;
        }
        
        try {
            const result = await EnhancedBackupManager.restoreBackup(backupId);
            
            if (!result.success) {
                // Check if password needed
                if (result.error.includes('Password required')) {
                    const password = prompt('Passwort eingeben:');
                    if (!password) return;
                    
                    const retryResult = await EnhancedBackupManager.restoreBackup(backupId, password);
                    if (!retryResult.success) {
                        alert('‚ùå Wiederherstellung fehlgeschlagen: ' + retryResult.error);
                        return;
                    }
                    
                    // Success with password
                    if (AppState) {
                        AppState.answers = retryResult.data;
                        AppState.saveToStorage();
                    }
                    alert('‚úÖ Backup erfolgreich wiederhergestellt!');
                    this.closeBackupDialog();
                    return;
                }
                
                alert('‚ùå Wiederherstellung fehlgeschlagen: ' + result.error);
                return;
            }
            
            // Update AppState
            if (AppState) {
                AppState.answers = result.data;
                AppState.saveToStorage();
            }
            
            alert('‚úÖ Backup erfolgreich wiederhergestellt!');
            this.closeBackupDialog();
            window.location.reload(); // Reload to show restored data
        } catch (error) {
            alert('‚ùå Fehler: ' + error.message);
        }
    },
    
    /**
     * Show search dialog
     */
    showSearchDialog() {
        const html = `
            <div class="modal" id="searchModal" style="display: block; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); overflow-y: auto;">
                <div class="modal-content" style="background-color: #fefefe; margin: 5% auto; padding: 30px; border-radius: 10px; width: 90%; max-width: 700px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">üîç Offline-Suche</h2>
                        <button onclick="EnhancedOfflineFeaturesUI.closeSearchDialog()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">&times;</button>
                    </div>
                    
                    <div style="padding: 15px; background: #e3f2fd; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196f3;">
                        <h3 style="margin: 0 0 10px 0; font-size: 14px;">‚ÑπÔ∏è Datenschutz-Garantie</h3>
                        <p style="margin: 0; font-size: 0.9em;">
                            Die Suche erfolgt ausschlie√ülich in lokalen Daten. Keine Suchbegriffe werden an externe Server gesendet.
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <input type="text" id="searchQueryInput" placeholder="Suchbegriff eingeben..." 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;">
                    </div>
                    
                    <div style="margin-bottom: 20px; display: flex; gap: 10px;">
                        <button onclick="EnhancedOfflineFeaturesUI.performSearch()" 
                                style="flex: 1; padding: 12px; background: #2196f3; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            üîç Suchen
                        </button>
                        <button onclick="document.getElementById('searchQueryInput').value = ''; document.getElementById('searchResults').innerHTML = '';" 
                                style="padding: 12px 20px; background: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                            L√∂schen
                        </button>
                    </div>
                    
                    <div id="searchResults" style="margin-top: 20px;"></div>
                    
                    <button onclick="EnhancedOfflineFeaturesUI.closeSearchDialog()" style="margin-top: 20px; width: 100%; padding: 12px; background: #ccc; color: #333; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">
                        Schlie√üen
                    </button>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', html);
        
        // Focus search input
        setTimeout(() => {
            document.getElementById('searchQueryInput')?.focus();
        }, 100);
        
        // Add Enter key listener
        document.getElementById('searchQueryInput')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.performSearch();
            }
        });
    },
    
    /**
     * Close search dialog
     */
    closeSearchDialog() {
        const modal = document.getElementById('searchModal');
        if (modal) modal.remove();
    },
    
    /**
     * Perform search
     */
    async performSearch() {
        const query = document.getElementById('searchQueryInput')?.value;
        if (!query || query.length < 2) {
            alert('Bitte geben Sie mindestens 2 Zeichen ein.');
            return;
        }
        
        const resultsDiv = document.getElementById('searchResults');
        resultsDiv.innerHTML = '<p style="text-align: center; color: #666;">Suche l√§uft...</p>';
        
        try {
            const results = await OfflineSearchManager.search(query);
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p style="text-align: center; color: #666;">Keine Ergebnisse gefunden.</p>';
                return;
            }
            
            let html = `<h3 style="margin: 10px 0;">Gefunden: ${results.length} Ergebnisse</h3>`;
            html += '<div style="max-height: 400px; overflow-y: auto;">';
            
            for (const result of results) {
                const date = new Date(result.timestamp).toLocaleString('de-DE');
                html += `
                    <div style="padding: 12px; margin: 8px 0; background: #f9f9f9; border-radius: 5px; border-left: 3px solid #4caf50;">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <strong>${date}</strong>
                                <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                                    ${result.metadata.hasRedFlags ? 'üö© Red Flags' : '‚úÖ OK'} | 
                                    Vollst√§ndigkeit: ${result.metadata.completeness}% |
                                    Relevanz: ${result.relevance}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        } catch (error) {
            resultsDiv.innerHTML = `<p style="color: #f44336;">Fehler: ${error.message}</p>`;
        }
    }
};

// Initialize enhanced offline features
document.addEventListener('DOMContentLoaded', () => {
    EnhancedBackupManager.init();
    OfflineSearchManager.init();
    SmartAutoCompleteManager.init();
});

// Export functions for use in other modules
window.EnhancedBackupManager = EnhancedBackupManager;
window.OfflineSearchManager = OfflineSearchManager;
window.SmartAutoCompleteManager = SmartAutoCompleteManager;
window.EnhancedOfflineFeaturesUI = EnhancedOfflineFeaturesUI;

        // ====================================================================
        // GDT EXPORT MODULE (INLINE)
        // ====================================================================
        // GDT 3.0/3.1 compliant export for practice management systems
        // Supports Medatixx, CGM, and Quincy - fully local/offline
// GDT Export Module - GDT 3.0/3.1 Compliant Export
// Implements secure, GDPR-compliant export for Medatixx, CGM, and Quincy systems
// All exports are local-only (no cloud transfer)

// GDT Format Constants
const GDT_CONSTANTS = {
    FIELD_LENGTH_SIZE: 3,        // LLL - 3 digits for field length
    FIELD_ID_SIZE: 4,            // FKKK - 4 digits for field identifier
    CRLF_SIZE: 2,                // CR+LF line ending size
    FIELD_HEADER_SIZE: 7         // LLL + FKKK
};

// GDT Field Identifiers (Feldkennungen) according to GDT 3.1 specification
const GDT_FIELDS = {
    // Header and Control Fields
    SATZLAENGE: '8000',          // Record length
    SATZART: '8100',             // Record type
    SATZIDENTIFIKATION: '8315',  // Record identification
    
    // Patient Identification (with pseudonymization option)
    PATIENT_NR: '3000',          // Patient number (can be pseudonymized)
    PATIENT_NAME: '3101',        // Patient surname
    PATIENT_VORNAME: '3102',     // Patient first name
    PATIENT_GEBURTSDATUM: '3103',// Patient date of birth
    PATIENT_GESCHLECHT: '3110',  // Patient gender (1=male, 2=female)
    PATIENT_TITEL: '3104',       // Patient title (Dr., Prof., etc.)
    KRANKENKASSE: '3105',        // Health insurance company
    VERSICHERTENNR: '3108',      // Insurance number
    VERSICHERTENSTATUS: '3109',  // Insurance status (1=member, 3=family, 5=pensioner)
    
    // Address Data
    PATIENT_STRASSE: '3107',     // Street
    PATIENT_PLZ: '3112',         // Postal code
    PATIENT_ORT: '3106',         // City
    PATIENT_TELEFON: '3622',     // Phone number
    PATIENT_EMAIL: '3626',       // Email address
    PATIENT_LAND: '3114',        // Country code
    
    // Medical Data
    ANAMNESE: '6200',            // Medical history text
    DIAGNOSE: '6205',            // Diagnosis
    DIAGNOSE_ICD10: '6001',      // ICD-10 diagnosis code
    MEDIKATION: '6210',          // Current medication
    ALLERGIEN: '6220',           // Allergies
    BEFUND: '6300',              // Medical findings
    LABOR_WERT: '8410',          // Laboratory value
    LABOR_KENNUNG: '8411',       // Laboratory identifier
    VORBEFUND: '6220',           // Previous findings
    
    // Timestamps
    ERSTELLUNGSDATUM: '8418',    // Creation date (YYYYMMDD)
    ERSTELLUNGSZEIT: '8419',     // Creation time (HHMMSS)
    
    // System and Practice Information
    PRAXIS_ID: '0201',           // Practice identification
    BSNR: '0203',                // Practice BSNR (Betriebsst√§ttennummer)
    LANR: '0212',                // Physician LANR (Lebenslange Arztnummer)
    ARZT_NAME: '0211',           // Physician name
    SOFTWARE_ID: '0102',         // Software identification
    
    // End of record
    ENDE_KENNZEICHEN: '8205'     // End marker
};

// Validation functions for GDT fields
const GDT_VALIDATORS = {
    // Validate date format (DDMMYYYY)
    validateDate: function(dateStr) {
        if (!dateStr || dateStr.length !== 8) return false;
        const day = parseInt(dateStr.substring(0, 2));
        const month = parseInt(dateStr.substring(2, 4));
        const year = parseInt(dateStr.substring(4, 8));
        
        if (month < 1 || month > 12) return false;
        if (day < 1 || day > 31) return false;
        if (year < 1900 || year > 2100) return false;
        
        // Validate actual date
        const date = new Date(year, month - 1, day);
        return date.getFullYear() === year && 
               date.getMonth() === month - 1 && 
               date.getDate() === day;
    },
    
    // Validate LANR (9 digits with check digit)
    validateLANR: function(lanr) {
        if (!lanr || lanr.length !== 9) return false;
        if (!/^\d{9}$/.test(lanr)) return false;
        
        // Calculate check digit (Modulo 11 method)
        const digits = lanr.split('').map(d => parseInt(d));
        let sum = 0;
        for (let i = 0; i < 8; i++) {
            sum += digits[i] * (i + 2);
        }
        const checkDigit = sum % 11;
        return checkDigit === digits[8];
    },
    
    // Validate BSNR (9 digits)
    validateBSNR: function(bsnr) {
        return bsnr && /^\d{9}$/.test(bsnr);
    },
    
    // Validate postal code (5 digits for Germany)
    validatePLZ: function(plz) {
        return plz && /^\d{5}$/.test(plz);
    },
    
    // Validate insurance number (10 characters)
    validateVersichertenNr: function(nr) {
        return nr && /^[A-Z]\d{9}$/.test(nr);
    },
    
    // Validate ICD-10 code
    validateICD10: function(code) {
        return code && /^[A-Z]\d{2}(\.\d{1,2})?$/.test(code);
    },
    
    // Validate gender code (1=male, 2=female, 3=unknown, 4=diverse)
    validateGender: function(gender) {
        return ['1', '2', '3', '4'].includes(gender);
    },
    
    // Validate insurance status
    validateVersichertenStatus: function(status) {
        return ['1', '3', '5'].includes(status); // 1=member, 3=family, 5=pensioner
    }
};

// GDT Record Types (Satzarten)
const GDT_RECORD_TYPES = {
    STAMMDATEN: '6301',          // Master data (patient information)
    ANAMNESE_DATEN: '6302',      // Anamnesis data
    BEFUND_DATEN: '6310',        // Findings data
    DOKUMENTATION: '6311'        // Documentation
};

// Configuration object for GDT export
const gdtExportConfig = {
    exportDirectory: null,       // Will be set via File System Access API
    pseudonymizeData: true,      // Default: pseudonymize sensitive data
    includeFullName: false,      // Default: don't include full name
    includeAddress: false,       // Default: don't include address
    includeContactData: false,   // Default: don't include contact data
    includeInsuranceData: false, // Default: don't include insurance data
    includeMedicalCodes: false,  // Default: don't include ICD-10 codes
    practiceId: '',              // To be configured by practice
    bsnr: '',                    // Practice BSNR (Betriebsst√§ttennummer)
    lanr: '',                    // Physician LANR (Lebenslange Arztnummer)
    softwareId: 'Anamnese-A-v1.0', // Software identification
    consentGiven: false,         // Patient consent for export
    auditLogging: true,          // Enable audit logging
    validateBeforeExport: true   // Validate data before export
};

// Pseudonymization function - creates consistent pseudonym from patient ID
// Uses Web Crypto API SHA-256 for secure hashing
async function pseudonymizePatientIdAsync(patientData) {
    const input = `${patientData.firstName}-${patientData.lastName}-${patientData.dateOfBirth}`;
    const encoder = new TextEncoder();
    const data = encoder.encode(input);
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    // Take first 10 digits from hex hash for 10-digit patient ID
    return hashHex.substring(0, 10).toUpperCase();
}

// Synchronous version - WARNING: Uses basic hashing, not cryptographically secure
// This is ONLY for UI synchronous contexts and testing. Production exports should use async version.
// For production, modify exportGDT to be async and use pseudonymizePatientIdAsync
function pseudonymizePatientId(patientData) {
    // WARNING: This is a fallback for synchronous contexts only
    // Prefer pseudonymizePatientIdAsync for production use
    console.warn('Using synchronous pseudonymization. Consider using pseudonymizePatientIdAsync for better security.');
    
    const input = `${patientData.firstName}-${patientData.lastName}-${patientData.dateOfBirth}`;
    let hash = 0;
    for (let i = 0; i < input.length; i++) {
        const char = input.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Convert to 32-bit integer
    }
    return Math.abs(hash).toString().padStart(10, '0');
}

// Format GDT field according to specification
// Format: LLLFKKK<data>
// LLL = length (3 digits), FKKK = field identifier (4 digits), <data> = field content
function formatGDTField(fieldId, content) {
    const contentStr = String(content || '');
    const length = (3 + 4 + contentStr.length).toString().padStart(3, '0');
    return `${length}${fieldId}${contentStr}`;
}

// Format date to GDT format (DDMMYYYY)
function formatGDTDate(dateString) {
    if (!dateString) return '';
    const date = new Date(dateString);
    const day = date.getDate().toString().padStart(2, '0');
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const year = date.getFullYear();
    return `${day}${month}${year}`;
}

// Format date to GDT timestamp format (YYYYMMDD)
function formatGDTTimestamp(date = new Date()) {
    const year = date.getFullYear();
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const day = date.getDate().toString().padStart(2, '0');
    return `${year}${month}${day}`;
}

// Format time to GDT format (HHMMSS)
function formatGDTTime(date = new Date()) {
    const hours = date.getHours().toString().padStart(2, '0');
    const minutes = date.getMinutes().toString().padStart(2, '0');
    const seconds = date.getSeconds().toString().padStart(2, '0');
    return `${hours}${minutes}${seconds}`;
}

// Validate form data before GDT export
function validateFormData(formData) {
    const errors = [];
    
    // Validate date of birth
    if (formData.dateOfBirth) {
        const gdtDate = formatGDTDate(formData.dateOfBirth);
        if (!GDT_VALIDATORS.validateDate(gdtDate)) {
            errors.push('Ung√ºltiges Geburtsdatum');
        }
    }
    
    // Validate LANR if provided
    if (gdtExportConfig.lanr && !GDT_VALIDATORS.validateLANR(gdtExportConfig.lanr)) {
        errors.push('Ung√ºltige LANR (Lebenslange Arztnummer)');
    }
    
    // Validate BSNR if provided
    if (gdtExportConfig.bsnr && !GDT_VALIDATORS.validateBSNR(gdtExportConfig.bsnr)) {
        errors.push('Ung√ºltige BSNR (Betriebsst√§ttennummer)');
    }
    
    // Validate postal code if provided
    if (formData.postalCode && !GDT_VALIDATORS.validatePLZ(formData.postalCode)) {
        errors.push('Ung√ºltige Postleitzahl (muss 5 Ziffern sein)');
    }
    
    // Validate insurance number if provided
    if (formData.insuranceNumber && !GDT_VALIDATORS.validateVersichertenNr(formData.insuranceNumber)) {
        errors.push('Ung√ºltige Versichertennummer (Format: Buchstabe + 9 Ziffern)');
    }
    
    // Validate ICD-10 codes if provided
    if (formData.icd10Codes) {
        const codes = formData.icd10Codes.split(',').map(c => c.trim());
        codes.forEach(code => {
            if (code && !GDT_VALIDATORS.validateICD10(code)) {
                errors.push(`Ung√ºltiger ICD-10 Code: ${code}`);
            }
        });
    }
    
    return {
        isValid: errors.length === 0,
        errors: errors
    };
}

// Generate GDT file content from form data
async function generateGDTContent(formData, recordType = GDT_RECORD_TYPES.STAMMDATEN) {
    const lines = [];
    const now = new Date();
    
    // Header: Record type
    lines.push(formatGDTField(GDT_FIELDS.SATZART, recordType));
    
    // Software identification
    lines.push(formatGDTField(GDT_FIELDS.SOFTWARE_ID, gdtExportConfig.softwareId));
    
    // Practice ID (if configured)
    if (gdtExportConfig.practiceId) {
        lines.push(formatGDTField(GDT_FIELDS.PRAXIS_ID, gdtExportConfig.practiceId));
    }
    
    // Patient identification - use secure async pseudonymization
    let patientId;
    if (gdtExportConfig.pseudonymizeData) {
        patientId = await pseudonymizePatientIdAsync(formData);
        lines.push(formatGDTField(GDT_FIELDS.PATIENT_NR, patientId));
    } else {
        // Use actual patient number if available (requires explicit consent)
        patientId = formData.patientNumber || await pseudonymizePatientIdAsync(formData);
        lines.push(formatGDTField(GDT_FIELDS.PATIENT_NR, patientId));
    }
    
    // Name data (only if consent given and configured)
    if (gdtExportConfig.includeFullName && gdtExportConfig.consentGiven) {
        lines.push(formatGDTField(GDT_FIELDS.PATIENT_NAME, formData.lastName || ''));
        lines.push(formatGDTField(GDT_FIELDS.PATIENT_VORNAME, formData.firstName || ''));
    }
    
    // Date of birth
    if (formData.dateOfBirth) {
        lines.push(formatGDTField(GDT_FIELDS.PATIENT_GEBURTSDATUM, formatGDTDate(formData.dateOfBirth)));
    }
    
    // Gender (1=male, 2=female, 3=unknown, 4=diverse)
    if (formData.gender) {
        let genderCode = '3'; // default unknown
        const genderLower = formData.gender.toLowerCase();
        if (genderLower === 'male' || genderLower === 'm√§nnlich') genderCode = '1';
        else if (genderLower === 'female' || genderLower === 'weiblich') genderCode = '2';
        else if (genderLower === 'diverse' || genderLower === 'divers') genderCode = '4';
        
        if (GDT_VALIDATORS.validateGender(genderCode)) {
            lines.push(formatGDTField(GDT_FIELDS.PATIENT_GESCHLECHT, genderCode));
        }
    }
    
    // Insurance data (only if consent given and configured)
    if (gdtExportConfig.includeInsuranceData && gdtExportConfig.consentGiven) {
        if (formData.insuranceCompany) {
            lines.push(formatGDTField(GDT_FIELDS.KRANKENKASSE, formData.insuranceCompany));
        }
        if (formData.insuranceNumber) {
            lines.push(formatGDTField(GDT_FIELDS.VERSICHERTENNR, formData.insuranceNumber));
        }
        if (formData.insuranceStatus && GDT_VALIDATORS.validateVersichertenStatus(formData.insuranceStatus)) {
            lines.push(formatGDTField(GDT_FIELDS.VERSICHERTENSTATUS, formData.insuranceStatus));
        }
    }
    
    // Title (if provided)
    if (formData.title) {
        lines.push(formatGDTField(GDT_FIELDS.PATIENT_TITEL, formData.title));
    }
    
    // Address data (only if consent given and configured)
    if (gdtExportConfig.includeAddress && gdtExportConfig.consentGiven) {
        if (formData.street) {
            lines.push(formatGDTField(GDT_FIELDS.PATIENT_STRASSE, formData.street));
        }
        if (formData.postalCode) {
            lines.push(formatGDTField(GDT_FIELDS.PATIENT_PLZ, formData.postalCode));
        }
        if (formData.city) {
            lines.push(formatGDTField(GDT_FIELDS.PATIENT_ORT, formData.city));
        }
        if (formData.country) {
            lines.push(formatGDTField(GDT_FIELDS.PATIENT_LAND, formData.country));
        }
    }
    
    // Contact data (only if consent given and configured)
    if (gdtExportConfig.includeContactData && gdtExportConfig.consentGiven) {
        if (formData.phone) {
            lines.push(formatGDTField(GDT_FIELDS.PATIENT_TELEFON, formData.phone));
        }
        if (formData.email) {
            lines.push(formatGDTField(GDT_FIELDS.PATIENT_EMAIL, formData.email));
        }
    }
    
    // Practice information
    if (gdtExportConfig.bsnr) {
        lines.push(formatGDTField(GDT_FIELDS.BSNR, gdtExportConfig.bsnr));
    }
    if (gdtExportConfig.lanr) {
        lines.push(formatGDTField(GDT_FIELDS.LANR, gdtExportConfig.lanr));
    }
    
    // Medical data
    if (formData.currentComplaints) {
        lines.push(formatGDTField(GDT_FIELDS.ANAMNESE, formData.currentComplaints));
    }
    if (formData.pastIllnesses) {
        lines.push(formatGDTField(GDT_FIELDS.BEFUND, formData.pastIllnesses));
    }
    if (formData.currentMedications) {
        lines.push(formatGDTField(GDT_FIELDS.MEDIKATION, formData.currentMedications));
    }
    if (formData.allergies) {
        lines.push(formatGDTField(GDT_FIELDS.ALLERGIEN, formData.allergies));
    }
    
    // ICD-10 diagnosis codes (if configured and available)
    if (gdtExportConfig.includeMedicalCodes && formData.icd10Codes) {
        const codes = formData.icd10Codes.split(',').map(c => c.trim());
        codes.forEach(code => {
            if (code && GDT_VALIDATORS.validateICD10(code)) {
                lines.push(formatGDTField(GDT_FIELDS.DIAGNOSE_ICD10, code));
            }
        });
    }
    
    // Timestamps
    lines.push(formatGDTField(GDT_FIELDS.ERSTELLUNGSDATUM, formatGDTTimestamp(now)));
    lines.push(formatGDTField(GDT_FIELDS.ERSTELLUNGSZEIT, formatGDTTime(now)));
    
    // Calculate total record length
    // Sum all line lengths + CRLF for each line
    const contentLength = lines.reduce((sum, line) => sum + line.length + GDT_CONSTANTS.CRLF_SIZE, 0);
    
    // Create length field - note that the length includes itself
    // The length field format is: LLL (3) + FKKK (4) + content
    const lengthValue = contentLength + GDT_CONSTANTS.FIELD_HEADER_SIZE + GDT_CONSTANTS.CRLF_SIZE;
    const lengthField = formatGDTField(GDT_FIELDS.SATZLAENGE, lengthValue.toString());
    
    // Insert length at beginning
    lines.unshift(lengthField);
    
    // Join with CRLF (Windows line ending as per GDT spec)
    return lines.join('\r\n') + '\r\n';
}

// Generate filename according to GDT convention
async function generateGDTFilename(patientData) {
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T')[0];
    let patientId;
    
    if (gdtExportConfig.pseudonymizeData) {
        patientId = await pseudonymizePatientIdAsync(patientData);
    } else {
        patientId = patientData.patientNumber || 'UNKNOWN';
    }
    
    return `GDT_${patientId}_${timestamp}.gdt`;
}

// Export GDT file (local only)
async function exportGDT(formData, consent = null) {
    // Check if consent is provided
    if (consent && consent.synchronization) {
        gdtExportConfig.consentGiven = true;
    }
    
    try {
        // Validate form data before export (if enabled)
        if (gdtExportConfig.validateBeforeExport) {
            const validation = validateFormData(formData);
            if (!validation.isValid) {
                const errorMsg = 'Validierungsfehler:\n' + validation.errors.join('\n');
                console.error('GDT Export Validation Failed:', validation.errors);
                return { 
                    success: false, 
                    message: errorMsg,
                    validationErrors: validation.errors
                };
            }
        }
        
        // Generate GDT content - now using secure async pseudonymization
        const gdtContent = await generateGDTContent(formData);
        const filename = await generateGDTFilename(formData);
        
        // Log export action (GDPR audit requirement)
        if (gdtExportConfig.auditLogging) {
            await logGDTExport(formData, filename, consent);
        }
        
        // Use File System Access API for local directory selection
        // Fallback to simple download if not supported
        if ('showSaveFilePicker' in window) {
            try {
                const handle = await window.showSaveFilePicker({
                    suggestedName: filename,
                    types: [{
                        description: 'GDT Dateien',
                        accept: { 'text/plain': ['.gdt'] }
                    }]
                });
                
                const writable = await handle.createWritable();
                await writable.write(gdtContent);
                await writable.close();
                
                // Record billable event (usage metering)
                if (window.UsageMetering) {
                    window.UsageMetering.recordEvent('gdt_export', {
                        exportFormat: 'GDT 3.1',
                        fieldCount: Object.keys(formData).length,
                        language: AppState?.language || 'de',
                        appVersion: window.APP_DATA?.version || '8.0.0'
                    });
                }
                
                return { success: true, filename, message: 'GDT-Datei erfolgreich exportiert' };
            } catch (err) {
                if (err.name === 'AbortError') {
                    return { success: false, message: 'Export abgebrochen' };
                }
                throw err;
            }
        } else {
            // Fallback: Download as file
            const blob = new Blob([gdtContent], { type: 'text/plain;charset=iso-8859-1' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Record billable event (usage metering)
            if (window.UsageMetering) {
                window.UsageMetering.recordEvent('gdt_export', {
                    exportFormat: 'GDT 3.1',
                    fieldCount: Object.keys(formData).length,
                    language: AppState?.language || 'de',
                    appVersion: window.APP_DATA?.version || '8.0.0'
                });
            }
            
            return { success: true, filename, message: 'GDT-Datei heruntergeladen' };
        }
    } catch (error) {
        console.error('GDT Export Error:', error);
        logGDTError(error);
        return { success: false, message: `Export fehlgeschlagen: ${error.message}` };
    }
}

// Audit logging function (GDPR Art. 30, 32)
async function logGDTExport(formData, filename, consent) {
    const auditEntry = {
        timestamp: new Date().toISOString(),
        action: 'GDT_EXPORT',
        filename: filename,
        patientId: gdtExportConfig.pseudonymizeData 
            ? await pseudonymizePatientIdAsync(formData) 
            : (formData.patientNumber || 'N/A'),
        pseudonymized: gdtExportConfig.pseudonymizeData,
        consentGiven: gdtExportConfig.consentGiven,
        consentDetails: consent || null,
        exportConfig: {
            includeFullName: gdtExportConfig.includeFullName,
            includeAddress: gdtExportConfig.includeAddress,
            includeContactData: gdtExportConfig.includeContactData
        },
        userAgent: navigator.userAgent,
        language: navigator.language
    };
    
    // Store audit log in localStorage (in production, use secure backend)
    const auditLog = JSON.parse(localStorage.getItem('gdtAuditLog') || '[]');
    auditLog.push(auditEntry);
    
    // Keep only last 1000 entries
    if (auditLog.length > 1000) {
        auditLog.shift();
    }
    
    localStorage.setItem('gdtAuditLog', JSON.stringify(auditLog));
    
    console.log('GDT Export logged:', auditEntry);
}

// Log GDT export errors
function logGDTError(error) {
    const errorEntry = {
        timestamp: new Date().toISOString(),
        action: 'GDT_EXPORT_ERROR',
        error: error.message,
        stack: error.stack
    };
    
    const errorLog = JSON.parse(localStorage.getItem('gdtErrorLog') || '[]');
    errorLog.push(errorEntry);
    
    // Keep only last 100 errors
    if (errorLog.length > 100) {
        errorLog.shift();
    }
    
    localStorage.setItem('gdtErrorLog', JSON.stringify(errorLog));
}

// Get audit log for review
function getAuditLog(limit = 100) {
    const auditLog = JSON.parse(localStorage.getItem('gdtAuditLog') || '[]');
    return auditLog.slice(-limit);
}

// Export audit log as JSON file (for DSB review)
function exportAuditLog() {
    const auditLog = getAuditLog(1000);
    const blob = new Blob([JSON.stringify(auditLog, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `gdt_audit_log_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Clear audit log (requires confirmation)
function clearAuditLog() {
    if (confirm('M√∂chten Sie das Audit-Log wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) {
        localStorage.removeItem('gdtAuditLog');
        localStorage.removeItem('gdtErrorLog');
        return true;
    }
    return false;
}

// Update export configuration
function updateGDTConfig(config) {
    Object.assign(gdtExportConfig, config);
    
    // Save configuration to localStorage
    localStorage.setItem('gdtExportConfig', JSON.stringify(gdtExportConfig));
    
    console.log('GDT Export Configuration updated:', gdtExportConfig);
}

// Load saved configuration
function loadGDTConfig() {
    const savedConfig = localStorage.getItem('gdtExportConfig');
    if (savedConfig) {
        try {
            Object.assign(gdtExportConfig, JSON.parse(savedConfig));
            console.log('GDT Export Configuration loaded:', gdtExportConfig);
        } catch (e) {
            console.error('Error loading GDT configuration:', e);
        }
    }
}

// Initialize on page load
if (typeof document !== 'undefined') {
    document.addEventListener('DOMContentLoaded', function() {
        loadGDTConfig();
    });
}

        // ====================================================================
        // VOSK INTEGRATION MODULE (INLINE)
        // ====================================================================
        // Local speech recognition using Vosk
        // German 50MB model - fully offline
// VOSK Speech Recognition Integration
// Local speech recognition using VOSK model

let recognizer = null;
let audioContext = null;
let mediaStream = null;
let processor = null;
let currentInputField = null;
let voskWorker = null;

// Initialize VOSK recognizer
async function initVoskRecognizer() {
    try {
        // Check if VOSK model is available
        const modelPath = 'model/vosk-model-small-de-0.15';
        
        // Create Web Worker for VOSK processing
        if (!voskWorker) {
            voskWorker = new Worker('vosk-worker.js');
            
            voskWorker.onmessage = function(event) {
                handleRecognitionResult(event.data);
            };
            
            voskWorker.onerror = function(error) {
                console.error('VOSK Worker error:', error);
                showVoskError();
            };
            
            // Initialize worker with model path
            voskWorker.postMessage({ 
                action: 'init', 
                modelPath: modelPath 
            });
        }
        
        return true;
    } catch (error) {
        console.error('VOSK initialization error:', error);
        return false;
    }
}

// Handle recognition results
function handleRecognitionResult(data) {
    if (data.type === 'result' && data.text && currentInputField) {
        const field = document.getElementById(currentInputField);
        if (field) {
            // Append or set the recognized text
            if (field.value) {
                field.value += ' ' + data.text;
            } else {
                field.value = data.text;
            }
        }
    } else if (data.type === 'partial' && data.text) {
        // Show partial results in status
        updateVoiceStatus(data.text);
    }
}

// Start voice recognition for a specific field
async function startVoiceRecognition(fieldId) {
    currentInputField = fieldId;
    
    // Show voice status
    const voiceStatus = document.getElementById('voiceStatus');
    voiceStatus.style.display = 'block';
    updateVoiceStatus(translations[currentLanguage].voiceStatusText);
    
    try {
        // Request microphone access
        mediaStream = await navigator.mediaDevices.getUserMedia({ 
            audio: {
                echoCancellation: true,
                noiseSuppression: true,
                autoGainControl: true
            } 
        });
        
        // Create audio context
        audioContext = new (window.AudioContext || window.webkitAudioContext)({
            sampleRate: 16000
        });
        
        const source = audioContext.createMediaStreamSource(mediaStream);
        
        // Create script processor for audio data
        processor = audioContext.createScriptProcessor(4096, 1, 1);
        
        processor.onaudioprocess = function(e) {
            if (voskWorker && recognizer) {
                const inputData = e.inputBuffer.getChannelData(0);
                // Convert Float32Array to Int16Array for VOSK
                const pcm16 = new Int16Array(inputData.length);
                for (let i = 0; i < inputData.length; i++) {
                    pcm16[i] = Math.max(-32768, Math.min(32767, inputData[i] * 32768));
                }
                voskWorker.postMessage({
                    action: 'process',
                    audio: pcm16
                }, [pcm16.buffer]);
            }
        };
        
        source.connect(processor);
        processor.connect(audioContext.destination);
        
        // Initialize recognizer if not already done
        if (!recognizer) {
            recognizer = await initVoskRecognizer();
        }
        
        // Add click listener to stop recording
        voiceStatus.onclick = stopVoiceRecognition;
        voiceStatus.style.cursor = 'pointer';
        updateVoiceStatus('üé§ ' + translations[currentLanguage].voiceStatusText + ' (Click to stop)');
        
    } catch (error) {
        console.error('Voice recognition error:', error);
        showVoskError();
        stopVoiceRecognition();
    }
}

// Stop voice recognition
function stopVoiceRecognition() {
    if (processor) {
        processor.disconnect();
        processor = null;
    }
    
    if (audioContext) {
        audioContext.close();
        audioContext = null;
    }
    
    if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
        mediaStream = null;
    }
    
    if (voskWorker) {
        voskWorker.postMessage({ action: 'stop' });
    }
    
    const voiceStatus = document.getElementById('voiceStatus');
    voiceStatus.style.display = 'none';
    voiceStatus.onclick = null;
    voiceStatus.style.cursor = 'default';
    
    currentInputField = null;
}

// Update voice status text
function updateVoiceStatus(text) {
    const statusText = document.getElementById('voiceStatusText');
    if (statusText) {
        statusText.textContent = text;
    }
}

// Show VOSK error and fallback to browser's speech recognition
function showVoskError() {
    console.warn('VOSK not available, attempting fallback to browser speech recognition');
    
    // Try browser's native speech recognition as fallback
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        useBrowserSpeechRecognition();
    } else {
        alert('Speech recognition is not available. Please type manually or check that the VOSK model is in the model/ folder.');
        stopVoiceRecognition();
    }
}

// Fallback to browser's speech recognition
function useBrowserSpeechRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (!SpeechRecognition) {
        return;
    }
    
    const recognition = new SpeechRecognition();
    recognition.lang = currentLanguage === 'de' ? 'de-DE' : 
                       currentLanguage === 'en' ? 'en-US' :
                       currentLanguage === 'fr' ? 'fr-FR' :
                       currentLanguage === 'es' ? 'es-ES' :
                       currentLanguage === 'it' ? 'it-IT' :
                       currentLanguage === 'pt' ? 'pt-PT' :
                       currentLanguage === 'nl' ? 'nl-NL' :
                       currentLanguage === 'pl' ? 'pl-PL' :
                       currentLanguage === 'tr' ? 'tr-TR' :
                       currentLanguage === 'ar' ? 'ar-SA' : 'de-DE';
    
    recognition.continuous = true;
    recognition.interimResults = true;
    
    recognition.onresult = function(event) {
        let finalTranscript = '';
        let interimTranscript = '';
        
        for (let i = event.resultIndex; i < event.results.length; i++) {
            const transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
                finalTranscript += transcript + ' ';
            } else {
                interimTranscript += transcript;
            }
        }
        
        if (finalTranscript && currentInputField) {
            const field = document.getElementById(currentInputField);
            if (field) {
                if (field.value) {
                    field.value += ' ' + finalTranscript.trim();
                } else {
                    field.value = finalTranscript.trim();
                }
            }
        }
        
        if (interimTranscript) {
            updateVoiceStatus('üé§ ' + interimTranscript);
        }
    };
    
    recognition.onerror = function(event) {
        console.error('Browser speech recognition error:', event.error);
        stopVoiceRecognition();
    };
    
    recognition.onend = function() {
        stopVoiceRecognition();
    };
    
    recognition.start();
    
    // Store recognition instance for stopping
    window.currentRecognition = recognition;
    
    // Override stop function
    const originalStop = stopVoiceRecognition;
    window.stopVoiceRecognition = function() {
        if (window.currentRecognition) {
            window.currentRecognition.stop();
            window.currentRecognition = null;
        }
        originalStop();
    };
}

// Auto-initialize when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Pre-initialize VOSK in background (non-blocking)
    setTimeout(function() {
        initVoskRecognizer().catch(err => {
            console.log('VOSK pre-initialization failed, will use fallback if needed:', err);
        });
    }, 1000);
});

        // ====================================================================
        // VOSK WORKER MODULE (INLINE)
        // ====================================================================
        // Web Worker for Vosk speech recognition processing
        // Handles recognition in separate thread for better performance
// VOSK Web Worker for speech recognition processing
// This worker handles the actual speech recognition in a separate thread

let model = null;
let recognizer = null;
let modelLoaded = false;

// Handle messages from main thread
self.onmessage = async function(event) {
    const { action, modelPath, audio } = event.data;
    
    switch (action) {
        case 'init':
            await initializeModel(modelPath);
            break;
        case 'process':
            if (modelLoaded && audio) {
                processAudio(audio);
            }
            break;
        case 'stop':
            cleanup();
            break;
    }
};

// Initialize VOSK model
async function initializeModel(modelPath) {
    try {
        // In a real implementation, this would load the VOSK model
        // For now, we'll simulate the initialization
        // The actual VOSK implementation requires the vosk.js library
        
        // Check if model files exist
        const modelFile = modelPath + '/am/final.mdl';
        
        // Simulate model loading
        // In production, you would use: 
        // importScripts('vosk.js');
        // model = await Vosk.createModel(modelPath);
        // recognizer = new model.KaldiRecognizer(16000);
        
        modelLoaded = true;
        
        self.postMessage({
            type: 'ready',
            message: 'VOSK model loaded successfully'
        });
        
    } catch (error) {
        console.error('Model initialization error:', error);
        self.postMessage({
            type: 'error',
            message: 'Failed to load VOSK model: ' + error.message
        });
    }
}

// Process audio data
function processAudio(audioData) {
    try {
        // In a real implementation with VOSK:
        // const result = recognizer.acceptWaveform(audioData);
        // if (result) {
        //     const resultObj = JSON.parse(recognizer.result());
        //     if (resultObj.text) {
        //         self.postMessage({
        //             type: 'result',
        //             text: resultObj.text
        //         });
        //     }
        // } else {
        //     const partialObj = JSON.parse(recognizer.partialResult());
        //     if (partialObj.partial) {
        //         self.postMessage({
        //             type: 'partial',
        //             text: partialObj.partial
        //         });
        //     }
        // }
        
        // For this demo, we'll indicate that VOSK processing would happen here
        // The actual implementation requires the VOSK WASM/JS library
        
    } catch (error) {
        console.error('Audio processing error:', error);
        self.postMessage({
            type: 'error',
            message: 'Audio processing failed'
        });
    }
}

// Cleanup resources
function cleanup() {
    if (recognizer) {
        // recognizer.free();
        recognizer = null;
    }
    if (model) {
        // model.free();
        model = null;
    }
    modelLoaded = false;
}

        // ====================================================================
        // AI PLAUSIBILITY CHECK MODULE (INLINE)
        // ====================================================================
        // Rule-based medical data validation
        // No external AI services - fully local
// AI-Plausibilit√§tspr√ºfung (AI Plausibility Check)
// Privacy-Compliant Local Rule-Based Validation System
// DSGVO/GDPR Art. 5, 25, 32 - Privacy by Design
//
// WICHTIG: Dieses Modul arbeitet vollst√§ndig lokal/offline
// - KEINE externen API-Aufrufe (OpenAI, Google, etc. verboten)
// - KEINE √úbertragung von Patientendaten an Dritte
// - Alle Verarbeitungen erfolgen im Browser des Benutzers
// - Trainingsdaten werden lokal pseudonymisiert

// ============================================================================
// KONFIGURATION
// ============================================================================

const AI_PLAUSIBILITY_CONFIG = {
    // System-Status
    enabled: true,
    offlineOnly: true,  // Erzwingt Offline-Modus
    
    // Logging und Audit
    auditLogging: true,
    detailedLogging: false,
    
    // Pr√ºfungsebenen
    checkLevels: {
        basic: true,        // Basis-Plausibilit√§tspr√ºfungen
        medical: true,      // Medizinische Logik-Pr√ºfungen
        statistical: true   // Statistische Anomalie-Erkennung
    },
    
    // Schwellenwerte
    thresholds: {
        minAge: 0,
        maxAge: 120,
        minWeight: 0.5,     // kg
        maxWeight: 500,     // kg
        minHeight: 30,      // cm
        maxHeight: 250      // cm
    }
};

// ============================================================================
// AUDIT LOGGING F√úR AI-ZUGRIFFE
// ============================================================================

const aiAuditLog = {
    entries: [],
    maxEntries: 10000
};

/**
 * Protokolliert jeden AI-Modellzugriff f√ºr DSGVO-Compliance
 * @param {string} action - Durchgef√ºhrte Aktion
 * @param {object} details - Details zur Pr√ºfung (pseudonymisiert)
 */
function logAIAccess(action, details = {}) {
    if (!AI_PLAUSIBILITY_CONFIG.auditLogging) return;
    
    const entry = {
        id: generateAuditId(),
        timestamp: new Date().toISOString(),
        action: action,
        module: 'AI-Plausibility-Check',
        details: sanitizeForLogging(details),
        result: details.result || 'unknown',
        processingType: 'local-only',
        dataTransfer: 'none'
    };
    
    aiAuditLog.entries.push(entry);
    
    // Begrenzung der Log-Gr√∂√üe (DSGVO Art. 5 - Speicherbegrenzung)
    // Verwende slice statt shift f√ºr bessere Performance
    if (aiAuditLog.entries.length > aiAuditLog.maxEntries) {
        aiAuditLog.entries = aiAuditLog.entries.slice(-aiAuditLog.maxEntries);
    }
    
    // Speichere Log lokal
    try {
        localStorage.setItem('ai_audit_log', JSON.stringify({
            entries: aiAuditLog.entries.slice(-1000), // Letzte 1000 Eintr√§ge
            lastUpdate: new Date().toISOString()
        }));
    } catch (e) {
        console.warn('AI Audit Log konnte nicht gespeichert werden:', e);
    }
    
    if (AI_PLAUSIBILITY_CONFIG.detailedLogging) {
        console.log('[AI-Audit]', entry);
    }
}

/**
 * Bereinigt Daten f√ºr Logging (Pseudonymisierung)
 */
function sanitizeForLogging(data) {
    const sanitized = {...data};
    
    // Entferne oder pseudonymisiere pers√∂nliche Identifikatoren
    const sensitiveFields = ['firstName', 'lastName', 'email', 'phone', 'address'];
    sensitiveFields.forEach(field => {
        if (sanitized[field]) {
            sanitized[field] = '***PSEUDONYMIZED***';
        }
    });
    
    return sanitized;
}

/**
 * Generiert eindeutige Audit-ID
 */
function generateAuditId() {
    return `AI-AUDIT-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;
}

/**
 * Exportiert AI Audit-Log (f√ºr DSB/Aufsichtsbeh√∂rde)
 */
function exportAIAuditLog() {
    const logData = {
        exportDate: new Date().toISOString(),
        system: 'Anamnese-AI-Plausibility-Check',
        version: '1.0.0',
        compliance: 'DSGVO Art. 30, 32',
        totalEntries: aiAuditLog.entries.length,
        entries: aiAuditLog.entries
    };
    
    const blob = new Blob([JSON.stringify(logData, null, 2)], {
        type: 'application/json'
    });
    
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `AI-Audit-Log-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    logAIAccess('audit_log_exported', {
        result: 'success',
        entriesExported: aiAuditLog.entries.length
    });
}

// ============================================================================
// PLAUSIBILIT√ÑTSPR√úFUNG - REGEL-BASIERTES SYSTEM
// ============================================================================

/**
 * Hauptfunktion zur Plausibilit√§tspr√ºfung
 * @param {object} formData - Anamnese-Formulardaten
 * @returns {object} Pr√ºfergebnis mit Warnungen und Empfehlungen
 */
function performPlausibilityCheck(formData) {
    logAIAccess('plausibility_check_started', {
        dataFields: Object.keys(formData).length
    });
    
    const results = {
        timestamp: new Date().toISOString(),
        overallStatus: 'valid',
        warnings: [],
        errors: [],
        recommendations: [],
        checksPerformed: []
    };
    
    // F√ºhre verschiedene Pr√ºfungsebenen durch
    if (AI_PLAUSIBILITY_CONFIG.checkLevels.basic) {
        performBasicChecks(formData, results);
    }
    
    if (AI_PLAUSIBILITY_CONFIG.checkLevels.medical) {
        performMedicalLogicChecks(formData, results);
    }
    
    if (AI_PLAUSIBILITY_CONFIG.checkLevels.statistical) {
        performStatisticalChecks(formData, results);
    }
    
    // Bestimme Gesamtstatus
    if (results.errors.length > 0) {
        results.overallStatus = 'invalid';
    } else if (results.warnings.length > 0) {
        results.overallStatus = 'warning';
    }
    
    logAIAccess('plausibility_check_completed', {
        result: results.overallStatus,
        warnings: results.warnings.length,
        errors: results.errors.length,
        recommendations: results.recommendations.length
    });
    
    return results;
}

// ============================================================================
// BASIS-PLAUSIBILIT√ÑTSPR√úFUNGEN
// ============================================================================

/**
 * F√ºhrt grundlegende Plausibilit√§tspr√ºfungen durch
 */
function performBasicChecks(formData, results) {
    results.checksPerformed.push('basic_validation');
    
    // Altersbereichspr√ºfung
    if (formData.dateOfBirth) {
        const age = calculateAge(formData.dateOfBirth);
        if (age < AI_PLAUSIBILITY_CONFIG.thresholds.minAge || 
            age > AI_PLAUSIBILITY_CONFIG.thresholds.maxAge) {
            results.errors.push({
                field: 'dateOfBirth',
                type: 'age_out_of_range',
                message: `Alter (${age}) liegt au√üerhalb des plausiblen Bereichs (${AI_PLAUSIBILITY_CONFIG.thresholds.minAge}-${AI_PLAUSIBILITY_CONFIG.thresholds.maxAge})`,
                severity: 'high'
            });
        }
        
        // Besondere Altersgruppen
        if (age < 18) {
            results.recommendations.push({
                type: 'minor_patient',
                message: 'Patient ist minderj√§hrig - Einwilligung der Erziehungsberechtigten erforderlich'
            });
        }
    }
    
    // Geschlechts-spezifische Pr√ºfungen
    if (formData.gender) {
        checkGenderSpecificConditions(formData, results);
    }
    
    // Numerische Werte pr√ºfen
    checkNumericRanges(formData, results);
}

/**
 * Berechnet Alter aus Geburtsdatum
 */
function calculateAge(dateOfBirth) {
    const today = new Date();
    const birthDate = new Date(dateOfBirth);
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    return age;
}

/**
 * Pr√ºft geschlechtsspezifische Bedingungen
 */
function checkGenderSpecificConditions(formData, results) {
    const gender = formData.gender;
    const age = formData.dateOfBirth ? calculateAge(formData.dateOfBirth) : null;
    
    // Schwangerschafts-bezogene Pr√ºfungen
    if (formData.pregnant === 'yes' || formData.pregnancy) {
        if (gender === 'male' || gender === 'm√§nnlich' || gender === '1') {
            results.errors.push({
                field: 'pregnant',
                type: 'gender_mismatch',
                message: 'Schwangerschaft bei m√§nnlichem Geschlecht ist nicht plausibel',
                severity: 'high'
            });
        }
        
        if (age !== null && (age < 10 || age > 55)) {
            results.warnings.push({
                field: 'pregnant',
                type: 'age_pregnancy_mismatch',
                message: `Schwangerschaft im Alter von ${age} Jahren ist ungew√∂hnlich`,
                severity: 'medium'
            });
        }
    }
}

/**
 * Pr√ºft numerische Wertebereiche
 */
function checkNumericRanges(formData, results) {
    // Gewicht
    if (formData.weight) {
        const weight = parseFloat(formData.weight);
        if (!isNaN(weight)) {
            if (weight < AI_PLAUSIBILITY_CONFIG.thresholds.minWeight || 
                weight > AI_PLAUSIBILITY_CONFIG.thresholds.maxWeight) {
                results.warnings.push({
                    field: 'weight',
                    type: 'value_out_of_range',
                    message: `Gewicht (${weight} kg) liegt au√üerhalb des √ºblichen Bereichs`,
                    severity: 'medium'
                });
            }
        }
    }
    
    // Gr√∂√üe
    if (formData.height) {
        const height = parseFloat(formData.height);
        if (!isNaN(height)) {
            if (height < AI_PLAUSIBILITY_CONFIG.thresholds.minHeight || 
                height > AI_PLAUSIBILITY_CONFIG.thresholds.maxHeight) {
                results.warnings.push({
                    field: 'height',
                    type: 'value_out_of_range',
                    message: `Gr√∂√üe (${height} cm) liegt au√üerhalb des √ºblichen Bereichs`,
                    severity: 'medium'
                });
            }
        }
    }
    
    // BMI-Berechnung und Plausibilit√§t
    if (formData.weight && formData.height) {
        checkBMIPlausibility(formData, results);
    }
}

/**
 * Pr√ºft BMI-Plausibilit√§t
 */
function checkBMIPlausibility(formData, results) {
    const weight = parseFloat(formData.weight);
    const height = parseFloat(formData.height) / 100; // cm zu m
    
    if (!isNaN(weight) && !isNaN(height) && height > 0) {
        const bmi = weight / (height * height);
        
        if (bmi < 12 || bmi > 60) {
            results.warnings.push({
                field: 'bmi',
                type: 'bmi_extreme',
                message: `BMI (${bmi.toFixed(1)}) liegt in einem extremen Bereich - bitte Eingaben √ºberpr√ºfen`,
                severity: 'high'
            });
        } else if (bmi < 16 || bmi > 40) {
            results.recommendations.push({
                type: 'bmi_attention',
                message: `BMI (${bmi.toFixed(1)}) erfordert besondere medizinische Aufmerksamkeit`
            });
        }
    }
}

// ============================================================================
// MEDIZINISCHE LOGIK-PR√úFUNGEN
// ============================================================================

/**
 * F√ºhrt medizinische Logik-Pr√ºfungen durch
 */
function performMedicalLogicChecks(formData, results) {
    results.checksPerformed.push('medical_logic');
    
    // Medikations-Allergie-Konflikt
    checkMedicationAllergyConflicts(formData, results);
    
    // Diagnose-Alter-Konsistenz
    checkDiagnosisAgeConsistency(formData, results);
    
    // Medikations-Interaktionen (Basic)
    checkBasicMedicationInteractions(formData, results);
}

/**
 * Pr√ºft Konflikte zwischen Medikation und Allergien
 */
function checkMedicationAllergyConflicts(formData, results) {
    const medications = extractMedications(formData.currentMedications || '');
    const allergies = extractAllergies(formData.allergies || '');
    
    // Bekannte Wirkstoffgruppen
    const drugGroups = {
        'penicillin': ['amoxicillin', 'ampicillin', 'penicillin'],
        'aspirin': ['aspirin', 'asa', 'acetylsalicyls√§ure'],
        'ibuprofen': ['ibuprofen', 'nurofen'],
        'paracetamol': ['paracetamol', 'acetaminophen']
    };
    
    // Pr√ºfe auf Konflikte
    allergies.forEach(allergy => {
        const allergyLower = allergy.toLowerCase();
        
        Object.keys(drugGroups).forEach(group => {
            if (allergyLower.includes(group)) {
                medications.forEach(med => {
                    const medLower = med.toLowerCase();
                    if (drugGroups[group].some(drug => medLower.includes(drug))) {
                        results.errors.push({
                            field: 'medications',
                            type: 'medication_allergy_conflict',
                            message: `M√∂glicher Konflikt: Medikation "${med}" bei bekannter Allergie gegen "${allergy}"`,
                            severity: 'critical'
                        });
                    }
                });
            }
        });
    });
}

/**
 * Extrahiert Medikamente aus Freitext
 */
function extractMedications(text) {
    if (!text) return [];
    return text.split(/[,;\n]/).map(m => m.trim()).filter(m => m.length > 0);
}

/**
 * Extrahiert Allergien aus Freitext
 */
function extractAllergies(text) {
    if (!text) return [];
    return text.split(/[,;\n]/).map(a => a.trim()).filter(a => a.length > 0);
}

/**
 * Pr√ºft Konsistenz zwischen Diagnosen und Alter
 */
function checkDiagnosisAgeConsistency(formData, results) {
    if (!formData.dateOfBirth || !formData.pastIllnesses) return;
    
    const age = calculateAge(formData.dateOfBirth);
    const illnesses = formData.pastIllnesses.toLowerCase();
    
    // Alters-ungew√∂hnliche Erkrankungen
    if (age < 30 && illnesses.includes('arthrose')) {
        results.warnings.push({
            field: 'pastIllnesses',
            type: 'age_diagnosis_unusual',
            message: 'Arthrose in jungem Alter ist ungew√∂hnlich - bitte best√§tigen',
            severity: 'medium'
        });
    }
    
    if (age < 18 && (illnesses.includes('herzinfarkt') || illnesses.includes('schlaganfall'))) {
        results.warnings.push({
            field: 'pastIllnesses',
            type: 'age_diagnosis_rare',
            message: 'Kardiovaskul√§re Erkrankungen in diesem Alter sind sehr selten - bitte √ºberpr√ºfen',
            severity: 'high'
        });
    }
}

/**
 * Pr√ºft grundlegende Medikamenten-Interaktionen
 */
function checkBasicMedicationInteractions(formData, results) {
    const medications = extractMedications(formData.currentMedications || '');
    const medLower = medications.map(m => m.toLowerCase());
    
    // Bekannte Interaktionen
    const interactions = [
        {
            drugs: ['marcumar', 'warfarin'],
            conflicts: ['aspirin', 'ibuprofen', 'diclofenac'],
            message: 'Blutgerinnungshemmer mit NSAIDs: Erh√∂htes Blutungsrisiko'
        },
        {
            drugs: ['simvastatin', 'atorvastatin'],
            conflicts: ['clarithromycin', 'erythromycin'],
            message: 'Statine mit Makrolid-Antibiotika: Erh√∂htes Myopathie-Risiko'
        }
    ];
    
    interactions.forEach(interaction => {
        const hasDrug = interaction.drugs.some(drug => 
            medLower.some(med => med.includes(drug))
        );
        const hasConflict = interaction.conflicts.some(conflict => 
            medLower.some(med => med.includes(conflict))
        );
        
        if (hasDrug && hasConflict) {
            results.warnings.push({
                field: 'medications',
                type: 'medication_interaction',
                message: interaction.message,
                severity: 'high'
            });
        }
    });
}

// ============================================================================
// STATISTISCHE ANOMALIE-ERKENNUNG
// ============================================================================

/**
 * F√ºhrt statistische Anomalie-Pr√ºfungen durch
 */
function performStatisticalChecks(formData, results) {
    results.checksPerformed.push('statistical_analysis');
    
    // Ungew√∂hnliche Kombinationen
    checkUnusualCombinations(formData, results);
    
    // Vollst√§ndigkeits-Check
    checkDataCompleteness(formData, results);
}

/**
 * Pr√ºft auf ungew√∂hnliche Datenkombinationen
 */
function checkUnusualCombinations(formData, results) {
    // Beispiel: Viele Medikamente aber keine Vorerkrankungen
    const medCount = extractMedications(formData.currentMedications || '').length;
    const hasIllnesses = formData.pastIllnesses && formData.pastIllnesses.trim().length > 0;
    
    if (medCount >= 3 && !hasIllnesses) {
        results.recommendations.push({
            type: 'data_consistency',
            message: 'Mehrere Medikamente ohne dokumentierte Vorerkrankungen - bitte Angaben vervollst√§ndigen'
        });
    }
    
    // Allergien ohne Details
    if (formData.hasAllergies === 'yes' && (!formData.allergies || formData.allergies.trim().length === 0)) {
        results.warnings.push({
            field: 'allergies',
            type: 'incomplete_data',
            message: 'Allergien angegeben, aber keine Details erfasst',
            severity: 'medium'
        });
    }
}

/**
 * Pr√ºft Datenvollst√§ndigkeit
 */
function checkDataCompleteness(formData, results) {
    const essentialFields = ['firstName', 'lastName', 'dateOfBirth', 'gender'];
    const missingFields = essentialFields.filter(field => !formData[field] || formData[field].trim() === '');
    
    if (missingFields.length > 0) {
        results.warnings.push({
            field: 'general',
            type: 'incomplete_essential_data',
            message: `Wesentliche Felder fehlen: ${missingFields.join(', ')}`,
            severity: 'medium'
        });
    }
}

// ============================================================================
// DATENSCHUTZ-FUNKTIONEN
// ============================================================================

/**
 * L√∂scht alle AI-bezogenen Daten (DSGVO Art. 17 - Recht auf L√∂schung)
 */
function deleteAllAIData() {
    return new Promise((resolve, reject) => {
        try {
            // L√∂sche Audit-Logs
            localStorage.removeItem('ai_audit_log');
            aiAuditLog.entries = [];
            
            // L√∂sche Konfigurationen
            localStorage.removeItem('ai_plausibility_config');
            
            // L√∂sche gecachte Pr√ºfergebnisse
            localStorage.removeItem('ai_cached_results');
            
            logAIAccess('all_ai_data_deleted', {
                result: 'success',
                timestamp: new Date().toISOString()
            });
            
            resolve({
                success: true,
                message: 'Alle AI-bezogenen Daten wurden gel√∂scht',
                deletedItems: ['audit_log', 'config', 'cached_results']
            });
        } catch (error) {
            reject({
                success: false,
                message: 'Fehler beim L√∂schen der AI-Daten',
                error: error.message
            });
        }
    });
}

/**
 * Pseudonymisiert Trainingsdaten (DSGVO Art. 32)
 */
async function pseudonymizeTrainingData(data) {
    const pseudonymized = {...data};
    
    // Hash-Funktion f√ºr konsistente Pseudonymisierung
    const hashString = async (str) => {
        const encoder = new TextEncoder();
        const data = encoder.encode(str);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    };
    
    // Pseudonymisiere pers√∂nliche Identifikatoren
    const fieldsToHash = ['firstName', 'lastName', 'email', 'phone', 'address'];
    
    // Verwende Promise.all f√ºr parallele async-Operationen
    await Promise.all(
        fieldsToHash.map(async field => {
            if (pseudonymized[field]) {
                pseudonymized[field] = await hashString(pseudonymized[field]);
            }
        })
    );
    
    return pseudonymized;
}

/**
 * √úberpr√ºft, ob externe API-Aufrufe blockiert sind
 * Hinweis: Dies ist eine zus√§tzliche Sicherheitsschicht. 
 * Die prim√§re Sicherheit kommt durch das Design (keine externen Calls im Code).
 */
function verifyNoExternalAPICalls() {
    // Verhindere externe Aufrufe zu bekannten AI-Diensten
    const blockedDomains = [
        'openai.com',
        'api.openai.com',
        'anthropic.com',
        'googleapis.com',
        'azure.com',
        'amazonaws.com'
    ];
    
    // Override fetch f√ºr Sicherheit (nur f√ºr AI-spezifische Domains)
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        const url = args[0];
        if (typeof url === 'string') {
            const isBlocked = blockedDomains.some(domain => url.includes(domain));
            if (isBlocked) {
                logAIAccess('blocked_external_api_call', {
                    url: url,
                    result: 'blocked',
                    reason: 'DSGVO-Compliance: Externe AI-Dienste verboten'
                });
                // Gebe rejected Promise zur√ºck statt zu werfen
                return Promise.reject(new Error('DSGVO-Versto√ü: Externe AI-API-Aufrufe sind nicht erlaubt'));
            }
        }
        return originalFetch.apply(this, args);
    };
    
    console.log('[AI-Plausibility] Externe API-Aufrufe zu AI-Diensten werden blockiert (DSGVO-Compliance)');
}

// ============================================================================
// INITIALISIERUNG
// ============================================================================

// Lade gespeicherten Audit-Log
try {
    const savedLog = localStorage.getItem('ai_audit_log');
    if (savedLog) {
        const parsed = JSON.parse(savedLog);
        aiAuditLog.entries = parsed.entries || [];
    }
} catch (e) {
    console.warn('Konnte AI Audit Log nicht laden:', e);
}

// Blockiere externe API-Aufrufe
verifyNoExternalAPICalls();

// Initialisierungs-Log
logAIAccess('module_initialized', {
    result: 'success',
    version: '1.0.0',
    mode: 'offline-only',
    compliance: 'DSGVO Art. 5, 25, 32'
});

// ============================================================================
// EXPORT
// ============================================================================

// Funktionen f√ºr externe Verwendung verf√ºgbar machen
if (typeof window !== 'undefined') {
    window.AIPlausibilityCheck = {
        performPlausibilityCheck,
        exportAIAuditLog,
        deleteAllAIData,
        config: AI_PLAUSIBILITY_CONFIG,
        version: '1.0.0'
    };
}



        // ====================================================================
        // GDT IMPORT MODULE (INLINE)
        // ====================================================================
        // Import patient data from GDT files
        // Supports bidirectional data exchange with practice systems
/**
 * GDT Import Module
 * Provides GDT file import and parsing functionality
 * Supports bidirectional synchronization with PVS systems
 * GDPR-compliant with consent checks
 */

class GDTImporter {
    constructor() {
        this.importHistory = [];
        this.currentImport = null;
    }

    /**
     * Parse GDT file content
     * @param {string} content - GDT file content
     * @returns {Object} Parsed patient data
     */
    parseGDTFile(content) {
        const lines = content.split(/\r?\n/);
        const patient = {
            fields: {},
            rawFields: []
        };

        for (const line of lines) {
            if (line.length < 7) continue; // Minimum GDT line length

            // Parse: LLL + FKKK + content
            const length = line.substring(0, 3);
            const fieldId = line.substring(3, 7);
            const fieldContent = line.substring(7);

            patient.rawFields.push({ fieldId, content: fieldContent });

            // Map to readable fields
            this.mapGDTField(patient, fieldId, fieldContent);
        }

        return patient;
    }

    /**
     * Map GDT field to patient object
     * @param {Object} patient - Patient object
     * @param {string} fieldId - GDT field identifier
     * @param {string} content - Field content
     */
    mapGDTField(patient, fieldId, content) {
        const fieldMap = {
            '3000': 'patientId',
            '3101': 'lastName',
            '3102': 'firstName',
            '3103': 'birthDate',
            '3104': 'title',
            '3105': 'insuranceCompany',
            '3106': 'gender',
            '3107': 'street',
            '3108': 'insuranceNumber',
            '3109': 'insuranceStatus',
            '3112': 'postalCode',
            '3113': 'city',
            '3114': 'country',
            '3115': 'phone',
            '6001': 'icd10Code',
            '0203': 'bsnr',
            '0212': 'lanr',
            '8402': 'senderType',
            '8403': 'receiverType'
        };

        const fieldName = fieldMap[fieldId];
        if (fieldName) {
            patient.fields[fieldName] = content.trim();
        }
    }

    /**
     * Validate imported data
     * @param {Object} patient - Parsed patient data
     * @returns {Object} Validation result
     */
    validateImport(patient) {
        const errors = [];
        const warnings = [];

        // Required fields check
        if (!patient.fields.patientId) {
            errors.push('Patienten-ID fehlt');
        }
        if (!patient.fields.lastName) {
            errors.push('Nachname fehlt');
        }
        if (!patient.fields.birthDate) {
            errors.push('Geburtsdatum fehlt');
        }

        // Validate birth date format
        if (patient.fields.birthDate) {
            if (!this.validateDateFormat(patient.fields.birthDate)) {
                errors.push('Ung√ºltiges Datumsformat');
            }
        }

        // Validate postal code
        if (patient.fields.postalCode) {
            if (!/^\d{5}$/.test(patient.fields.postalCode)) {
                warnings.push('PLZ sollte 5 Ziffern haben');
            }
        }

        // Validate BSNR
        if (patient.fields.bsnr) {
            if (!/^\d{9}$/.test(patient.fields.bsnr)) {
                warnings.push('BSNR sollte 9 Ziffern haben');
            }
        }

        // Validate LANR
        if (patient.fields.lanr) {
            if (typeof validateLANR === 'function') {
                if (!validateLANR(patient.fields.lanr)) {
                    warnings.push('LANR-Pr√ºfziffer ung√ºltig');
                }
            }
        }

        // Validate ICD-10
        if (patient.fields.icd10Code) {
            if (!/^[A-Z]\d{2}(\.\d{1,2})?$/.test(patient.fields.icd10Code)) {
                warnings.push('ICD-10 Code Format m√∂glicherweise ung√ºltig');
            }
        }

        return {
            valid: errors.length === 0,
            errors,
            warnings
        };
    }

    /**
     * Validate date format (TTMMJJJJ)
     * @param {string} dateStr - Date string
     * @returns {boolean}
     */
    validateDateFormat(dateStr) {
        if (!/^\d{8}$/.test(dateStr)) return false;

        const day = parseInt(dateStr.substring(0, 2));
        const month = parseInt(dateStr.substring(2, 4));
        const year = parseInt(dateStr.substring(4, 8));

        if (month < 1 || month > 12) return false;
        if (day < 1 || day > 31) return false;
        if (year < 1900 || year > new Date().getFullYear()) return false;

        return true;
    }

    /**
     * Compare imported data with existing patient
     * @param {Object} importedPatient - Imported patient data
     * @param {Object} existingPatient - Existing patient data
     * @returns {Object} Comparison result
     */
    comparePatients(importedPatient, existingPatient) {
        const differences = {};
        const allFields = new Set([
            ...Object.keys(importedPatient.fields),
            ...Object.keys(existingPatient)
        ]);

        for (const field of allFields) {
            const importedValue = importedPatient.fields[field];
            const existingValue = existingPatient[field];

            if (importedValue !== existingValue) {
                differences[field] = {
                    existing: existingValue || '',
                    imported: importedValue || '',
                    conflict: !!(existingValue && importedValue)
                };
            }
        }

        return differences;
    }

    /**
     * Import GDT file
     * @param {File} file - GDT file
     * @returns {Promise<Object>} Import result
     */
    async importFile(file) {
        try {
            const content = await this.readFile(file);
            const patient = this.parseGDTFile(content);
            const validation = this.validateImport(patient);

            this.currentImport = {
                file: file.name,
                timestamp: new Date().toISOString(),
                patient,
                validation
            };

            return {
                success: validation.valid,
                patient,
                validation,
                filename: file.name
            };
        } catch (error) {
            return {
                success: false,
                error: error.message,
                filename: file.name
            };
        }
    }

    /**
     * Read file content
     * @param {File} file - File object
     * @returns {Promise<string>}
     */
    readFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = (e) => reject(new Error('Datei konnte nicht gelesen werden'));
            // Try ISO-8859-1 encoding (GDT standard)
            reader.readAsText(file, 'ISO-8859-1');
        });
    }

    /**
     * Batch import multiple files
     * @param {FileList} files - List of files
     * @param {Function} progressCallback - Progress callback
     * @returns {Promise<Array>} Import results
     */
    async batchImport(files, progressCallback) {
        const results = [];
        let processed = 0;

        for (const file of files) {
            const result = await this.importFile(file);
            results.push(result);
            
            processed++;
            if (progressCallback) {
                progressCallback({
                    total: files.length,
                    processed,
                    current: file.name
                });
            }
        }

        return results;
    }

    /**
     * Apply import (update or create patient)
     * @param {Object} importData - Import data with selected fields
     * @param {string} mode - 'update', 'create', or 'merge'
     * @returns {Object} Result
     */
    applyImport(importData, mode = 'update') {
        // Check consent
        if (!this.checkImportConsent(importData.patient)) {
            throw new Error('Keine Einwilligung f√ºr Import vorhanden');
        }

        const result = {
            mode,
            patientId: importData.patient.fields.patientId,
            fieldsUpdated: 0,
            timestamp: new Date().toISOString()
        };

        // Apply based on mode
        if (mode === 'create') {
            // Create new patient (implementation depends on app structure)
            result.action = 'created';
            result.fieldsUpdated = Object.keys(importData.patient.fields).length;
        } else if (mode === 'update' || mode === 'merge') {
            // Update existing patient
            result.action = 'updated';
            result.fieldsUpdated = Object.keys(importData.selectedFields || importData.patient.fields).length;
        }

        // Log import
        this.logImport(result);
        this.importHistory.push(result);

        return result;
    }

    /**
     * Check import consent
     * @param {Object} patient - Patient data
     * @returns {boolean}
     */
    checkImportConsent(patient) {
        const consentKey = `gdt_consent_${patient.fields.patientId}`;
        const consent = localStorage.getItem(consentKey);
        
        if (!consent) return false;
        
        try {
            const consentData = JSON.parse(consent);
            return consentData.dataExport && consentData.timestamp;
        } catch (e) {
            return false;
        }
    }

    /**
     * Log import to audit
     * @param {Object} importResult - Import result
     */
    logImport(importResult) {
        if (typeof logGDTExport !== 'function') return;

        logGDTExport({
            action: 'gdt_import',
            timestamp: importResult.timestamp,
            patientId: importResult.patientId,
            mode: importResult.mode,
            fieldsUpdated: importResult.fieldsUpdated
        });
    }

    /**
     * Get import history
     * @returns {Array}
     */
    getImportHistory() {
        return this.importHistory;
    }

    /**
     * Get current import
     * @returns {Object|null}
     */
    getCurrentImport() {
        return this.currentImport;
    }

    /**
     * Clear current import
     */
    clearCurrentImport() {
        this.currentImport = null;
    }
}

// Create global instance
const gdtImporter = new GDTImporter();

        // ====================================================================
        // GDT EXPORT TEMPLATES MODULE (INLINE)
        // ====================================================================
        // Template definitions for different GDT versions
        // Support for GDT 3.0 and 3.1 formats
// GDT Export Templates Module
// Pre-configured export profiles for different PVS systems and use cases

// Export template structure
const GDT_EXPORT_TEMPLATES = {
    // Medatixx optimized profile
    medatixx_standard: {
        name: 'Medatixx Standard',
        description: 'Optimiert f√ºr Medatixx Praxisverwaltungssysteme',
        config: {
            pseudonymizeData: false,
            includeFullName: true,
            includeAddress: true,
            includeContactData: true,
            includeInsuranceData: true,
            includeMedicalCodes: true,
            validateBeforeExport: true
        },
        requiredFields: ['bsnr', 'lanr'],
        pvs: 'medatixx'
    },
    
    // CGM optimized profile
    cgm_standard: {
        name: 'CGM Standard',
        description: 'Optimiert f√ºr CGM Praxisverwaltungssysteme',
        config: {
            pseudonymizeData: false,
            includeFullName: true,
            includeAddress: true,
            includeContactData: true,
            includeInsuranceData: true,
            includeMedicalCodes: true,
            validateBeforeExport: true
        },
        requiredFields: ['bsnr', 'lanr'],
        pvs: 'cgm'
    },
    
    // Quincy optimized profile
    quincy_standard: {
        name: 'Quincy Standard',
        description: 'Optimiert f√ºr Quincy Praxisverwaltungssysteme',
        config: {
            pseudonymizeData: false,
            includeFullName: true,
            includeAddress: true,
            includeContactData: true,
            includeInsuranceData: true,
            includeMedicalCodes: false, // Quincy handles ICD-10 separately
            validateBeforeExport: true
        },
        requiredFields: ['bsnr', 'lanr'],
        pvs: 'quincy'
    },
    
    // Privacy-focused profile (maximum pseudonymization)
    privacy_maximum: {
        name: 'Datenschutz Maximal',
        description: 'Maximale Pseudonymisierung, minimale Daten√ºbertragung',
        config: {
            pseudonymizeData: true,
            includeFullName: false,
            includeAddress: false,
            includeContactData: false,
            includeInsuranceData: false,
            includeMedicalCodes: false,
            validateBeforeExport: true
        },
        requiredFields: [],
        pvs: 'generic'
    },
    
    // Research/Statistics profile
    research_anonymous: {
        name: 'Forschung/Statistik',
        description: 'Anonymisiert f√ºr Forschung und statistische Auswertung',
        config: {
            pseudonymizeData: true,
            includeFullName: false,
            includeAddress: false,
            includeContactData: false,
            includeInsuranceData: false,
            includeMedicalCodes: true, // ICD-10 relevant for research
            validateBeforeExport: true
        },
        requiredFields: [],
        pvs: 'generic'
    },
    
    // Complete profile (all data)
    complete_export: {
        name: 'Vollst√§ndiger Export',
        description: 'Alle verf√ºgbaren Daten (erfordert umfassende Einwilligung)',
        config: {
            pseudonymizeData: false,
            includeFullName: true,
            includeAddress: true,
            includeContactData: true,
            includeInsuranceData: true,
            includeMedicalCodes: true,
            validateBeforeExport: true
        },
        requiredFields: ['bsnr', 'lanr'],
        pvs: 'generic'
    },
    
    // Basic profile (minimal data)
    basic_export: {
        name: 'Basis Export',
        description: 'Nur grundlegende Patientendaten und Anamnese',
        config: {
            pseudonymizeData: true,
            includeFullName: true,
            includeAddress: false,
            includeContactData: false,
            includeInsuranceData: false,
            includeMedicalCodes: false,
            validateBeforeExport: true
        },
        requiredFields: [],
        pvs: 'generic'
    },
    
    // Emergency transfer profile
    emergency_transfer: {
        name: 'Notfall-√úbermittlung',
        description: 'F√ºr dringende Patienten√ºbergabe an andere Praxis',
        config: {
            pseudonymizeData: false,
            includeFullName: true,
            includeAddress: true,
            includeContactData: true,
            includeInsuranceData: true,
            includeMedicalCodes: true,
            validateBeforeExport: false // Speed over validation in emergency
        },
        requiredFields: [],
        pvs: 'generic'
    }
};

// Load template into current configuration
function loadGDTTemplate(templateId) {
    const template = GDT_EXPORT_TEMPLATES[templateId];
    
    if (!template) {
        console.error('Template not found:', templateId);
        return {
            success: false,
            message: `Vorlage "${templateId}" nicht gefunden`
        };
    }
    
    // Check if required fields are configured
    const missingFields = [];
    template.requiredFields.forEach(field => {
        if (!gdtExportConfig[field]) {
            missingFields.push(field);
        }
    });
    
    if (missingFields.length > 0) {
        const fieldNames = {
            'bsnr': 'BSNR (Betriebsst√§ttennummer)',
            'lanr': 'LANR (Lebenslange Arztnummer)',
            'practiceId': 'Praxis-ID'
        };
        const missingFieldNames = missingFields.map(f => fieldNames[f] || f).join(', ');
        
        console.warn('Missing required fields for template:', missingFields);
        return {
            success: false,
            message: `Fehlende Pflichtfelder f√ºr diese Vorlage: ${missingFieldNames}`,
            missingFields: missingFields
        };
    }
    
    // Apply template configuration
    updateGDTConfig(template.config);
    
    console.log('Template loaded:', template.name);
    return {
        success: true,
        message: `Vorlage "${template.name}" wurde geladen`,
        template: template
    };
}

// Get list of available templates
function getAvailableTemplates() {
    return Object.keys(GDT_EXPORT_TEMPLATES).map(key => ({
        id: key,
        name: GDT_EXPORT_TEMPLATES[key].name,
        description: GDT_EXPORT_TEMPLATES[key].description,
        pvs: GDT_EXPORT_TEMPLATES[key].pvs,
        requiredFields: GDT_EXPORT_TEMPLATES[key].requiredFields
    }));
}

// Get template by ID
function getTemplateById(templateId) {
    return GDT_EXPORT_TEMPLATES[templateId] || null;
}

// Get templates for specific PVS
function getTemplatesForPVS(pvs) {
    return Object.keys(GDT_EXPORT_TEMPLATES)
        .filter(key => GDT_EXPORT_TEMPLATES[key].pvs === pvs || GDT_EXPORT_TEMPLATES[key].pvs === 'generic')
        .map(key => ({
            id: key,
            name: GDT_EXPORT_TEMPLATES[key].name,
            description: GDT_EXPORT_TEMPLATES[key].description
        }));
}

// Save current configuration as custom template
function saveCustomTemplate(name, description) {
    const customTemplateId = `custom_${Date.now()}`;
    
    const customTemplate = {
        name: name,
        description: description,
        config: {
            pseudonymizeData: gdtExportConfig.pseudonymizeData,
            includeFullName: gdtExportConfig.includeFullName,
            includeAddress: gdtExportConfig.includeAddress,
            includeContactData: gdtExportConfig.includeContactData,
            includeInsuranceData: gdtExportConfig.includeInsuranceData,
            includeMedicalCodes: gdtExportConfig.includeMedicalCodes,
            validateBeforeExport: gdtExportConfig.validateBeforeExport
        },
        requiredFields: [],
        pvs: 'custom',
        createdAt: new Date().toISOString()
    };
    
    // Save to localStorage
    const customTemplates = JSON.parse(localStorage.getItem('gdtCustomTemplates') || '{}');
    customTemplates[customTemplateId] = customTemplate;
    localStorage.setItem('gdtCustomTemplates', JSON.stringify(customTemplates));
    
    console.log('Custom template saved:', name);
    return {
        success: true,
        message: `Eigene Vorlage "${name}" wurde gespeichert`,
        templateId: customTemplateId
    };
}

// Load custom templates from localStorage
function getCustomTemplates() {
    const customTemplates = JSON.parse(localStorage.getItem('gdtCustomTemplates') || '{}');
    return Object.keys(customTemplates).map(key => ({
        id: key,
        name: customTemplates[key].name,
        description: customTemplates[key].description,
        pvs: 'custom',
        createdAt: customTemplates[key].createdAt
    }));
}

// Delete custom template
function deleteCustomTemplate(templateId) {
    if (!templateId.startsWith('custom_')) {
        return {
            success: false,
            message: 'Nur eigene Vorlagen k√∂nnen gel√∂scht werden'
        };
    }
    
    const customTemplates = JSON.parse(localStorage.getItem('gdtCustomTemplates') || '{}');
    delete customTemplates[templateId];
    localStorage.setItem('gdtCustomTemplates', JSON.stringify(customTemplates));
    
    return {
        success: true,
        message: 'Vorlage wurde gel√∂scht'
    };
}

// Load custom template (including from localStorage)
function loadCustomTemplate(templateId) {
    if (templateId.startsWith('custom_')) {
        const customTemplates = JSON.parse(localStorage.getItem('gdtCustomTemplates') || '{}');
        const template = customTemplates[templateId];
        
        if (!template) {
            return {
                success: false,
                message: 'Eigene Vorlage nicht gefunden'
            };
        }
        
        updateGDTConfig(template.config);
        return {
            success: true,
            message: `Eigene Vorlage "${template.name}" wurde geladen`,
            template: template
        };
    }
    
    return loadGDTTemplate(templateId);
}

// Export template to JSON file
function exportTemplate(templateId) {
    const template = getTemplateById(templateId) || 
                     JSON.parse(localStorage.getItem('gdtCustomTemplates') || '{}')[templateId];
    
    if (!template) {
        return {
            success: false,
            message: 'Vorlage nicht gefunden'
        };
    }
    
    const templateData = {
        id: templateId,
        ...template,
        exportedAt: new Date().toISOString(),
        version: '1.0'
    };
    
    const blob = new Blob([JSON.stringify(templateData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `gdt_template_${templateId}_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    return {
        success: true,
        message: 'Vorlage wurde exportiert'
    };
}

// Import template from JSON file
async function importTemplate(fileContent) {
    try {
        const templateData = JSON.parse(fileContent);
        
        // Validate template structure
        if (!templateData.name || !templateData.config) {
            return {
                success: false,
                message: 'Ung√ºltige Vorlagen-Datei'
            };
        }
        
        // Save as custom template
        const result = saveCustomTemplate(templateData.name, templateData.description);
        
        return {
            success: true,
            message: `Vorlage "${templateData.name}" wurde importiert`,
            templateId: result.templateId
        };
    } catch (error) {
        console.error('Error importing template:', error);
        return {
            success: false,
            message: 'Fehler beim Importieren der Vorlage'
        };
    }
}

        // ====================================================================
        // GDT EXPORT UI MODULE (INLINE)
        // ====================================================================
        // User interface for GDT export configuration
        // Export preview and configuration options
// GDT Export UI Integration
// Provides user interface for GDT export with GDPR compliance

// Show GDT export configuration and consent dialog
async function showGDTExportDialog() {
    // Get form data first to check if there's data to export
    const formData = getFormData();
    
    if (!formData.firstName && !formData.lastName) {
        alert('Bitte f√ºllen Sie zun√§chst das Formular aus, bevor Sie einen Export durchf√ºhren.');
        return;
    }
    
    // Create modal
    const modal = document.createElement('div');
    modal.id = 'gdtExportModal';
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '700px';
    content.style.maxHeight = '90vh';
    content.style.overflowY = 'auto';
    
    content.innerHTML = `
        <h2>GDT-Export Konfiguration</h2>
        <p style="color: #666; margin-bottom: 20px;">
            Konfigurieren Sie den DSGVO-konformen Export f√ºr Ihr Praxisverwaltungssystem (Medatixx, CGM, Quincy).
        </p>
        
        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0;">
            <strong>‚ö†Ô∏è WICHTIG:</strong> Dieser Export muss vor Produktiveinsatz durch einen 
            Datenschutzbeauftragten gepr√ºft werden!
        </div>
        
        <!-- Template Selection -->
        <div style="margin: 20px 0; padding: 15px; background: #e8f5e9; border-left: 4px solid #4CAF50; border-radius: 4px;">
            <h3 style="font-size: 16px; margin-top: 0;">Export-Vorlagen</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 10px;">
                W√§hlen Sie eine vorkonfigurierte Vorlage f√ºr Ihr PVS oder Ihren Anwendungsfall:
            </p>
            <select id="gdtTemplateSelect" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 10px;">
                <option value="">-- Keine Vorlage / Manuelle Konfiguration --</option>
                <optgroup label="PVS-Systeme">
                    <option value="medatixx_standard">Medatixx Standard</option>
                    <option value="cgm_standard">CGM Standard</option>
                    <option value="quincy_standard">Quincy Standard</option>
                </optgroup>
                <optgroup label="Anwendungsf√§lle">
                    <option value="complete_export">Vollst√§ndiger Export</option>
                    <option value="basic_export">Basis Export</option>
                    <option value="privacy_maximum">Datenschutz Maximal</option>
                    <option value="research_anonymous">Forschung/Statistik</option>
                    <option value="emergency_transfer">Notfall-√úbermittlung</option>
                </optgroup>
            </select>
            <button id="gdtLoadTemplate" class="btn" style="background: #4CAF50; color: white; font-size: 13px;">
                Vorlage laden
            </button>
            <button id="gdtSaveTemplate" class="btn" style="background: #2196F3; color: white; font-size: 13px;">
                Aktuelle Einstellungen speichern
            </button>
        </div>
        
        <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
        
        <!-- Basic Configuration -->
        <div style="margin: 20px 0;">
            <h3 style="font-size: 16px; margin-bottom: 10px;">Grundeinstellungen</h3>
            
            <div style="margin: 10px 0;">
                <label style="display: block; margin-bottom: 5px;">
                    <strong>Praxis-ID:</strong> (f√ºr GDT-Export)
                </label>
                <input type="text" id="gdtPracticeId" placeholder="z.B. PRAXIS-12345" 
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                    value="${gdtExportConfig.practiceId || ''}">
                <small style="color: #666;">Identifikation Ihrer Praxis im PVS</small>
            </div>
            
            <div style="margin: 15px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gdtPseudonymize" ${gdtExportConfig.pseudonymizeData ? 'checked' : ''}
                        style="margin-right: 10px;">
                    <span>
                        <strong>Patientennummer pseudonymisieren</strong> (empfohlen)
                        <br><small style="color: #666;">Hash-basierte Pseudonymisierung f√ºr maximalen Datenschutz</small>
                    </span>
                </label>
            </div>
        </div>
        
        <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
        
        <!-- Data Selection -->
        <div style="margin: 20px 0;">
            <h3 style="font-size: 16px; margin-bottom: 10px;">Datenauswahl (erfordert Einwilligung)</h3>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                Die folgenden Daten werden nur exportiert, wenn Sie explizit eingewilligt haben:
            </p>
            
            <div style="margin: 10px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gdtIncludeFullName" ${gdtExportConfig.includeFullName ? 'checked' : ''}
                        style="margin-right: 10px;">
                    <span>Vollst√§ndiger Name (Vor- und Nachname)</span>
                </label>
            </div>
            
            <div style="margin: 10px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gdtIncludeAddress" ${gdtExportConfig.includeAddress ? 'checked' : ''}
                        style="margin-right: 10px;">
                    <span>Adressdaten (Stra√üe, PLZ, Ort, Land)</span>
                </label>
            </div>
            
            <div style="margin: 10px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gdtIncludeContact" ${gdtExportConfig.includeContactData ? 'checked' : ''}
                        style="margin-right: 10px;">
                    <span>Kontaktdaten (Telefon, E-Mail)</span>
                </label>
            </div>
            
            <div style="margin: 10px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gdtIncludeInsurance" ${gdtExportConfig.includeInsuranceData ? 'checked' : ''}
                        style="margin-right: 10px;">
                    <span>Versicherungsdaten (Krankenkasse, Versichertennummer)</span>
                </label>
            </div>
            
            <div style="margin: 10px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gdtIncludeMedicalCodes" ${gdtExportConfig.includeMedicalCodes ? 'checked' : ''}
                        style="margin-right: 10px;">
                    <span>Medizinische Codes (ICD-10 Diagnose-Codes)</span>
                </label>
            </div>
        </div>
        
        <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
        
        <!-- Advanced Settings -->
        <div style="margin: 20px 0;">
            <h3 style="font-size: 16px; margin-bottom: 10px;">Erweiterte Einstellungen</h3>
            
            <div style="margin: 10px 0;">
                <label style="display: block; margin-bottom: 5px;">
                    <strong>BSNR (Betriebsst√§ttennummer):</strong>
                </label>
                <input type="text" id="gdtBsnr" placeholder="z.B. 123456789 (9 Ziffern)" 
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                    value="${gdtExportConfig.bsnr || ''}" maxlength="9">
                <small style="color: #666;">9-stellige Nummer der Betriebsst√§tte</small>
            </div>
            
            <div style="margin: 10px 0;">
                <label style="display: block; margin-bottom: 5px;">
                    <strong>LANR (Lebenslange Arztnummer):</strong>
                </label>
                <input type="text" id="gdtLanr" placeholder="z.B. 123456789 (9 Ziffern)" 
                    style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                    value="${gdtExportConfig.lanr || ''}" maxlength="9">
                <small style="color: #666;">9-stellige Arztnummer mit Pr√ºfziffer</small>
            </div>
            
            <div style="margin: 15px 0;">
                <label style="display: flex; align-items: center; cursor: pointer;">
                    <input type="checkbox" id="gdtValidateBeforeExport" ${gdtExportConfig.validateBeforeExport ? 'checked' : ''}
                        style="margin-right: 10px;">
                    <span>
                        <strong>Daten vor Export validieren</strong>
                        <br><small style="color: #666;">Pr√ºft Format und Plausibilit√§t der Daten</small>
                    </span>
                </label>
            </div>
        </div>
        
        <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
        
        <!-- Licensing Information -->
        <div style="margin: 20px 0; padding: 15px; background: #e8f4f8; border-radius: 4px; border-left: 4px solid #667eea;">
            <h3 style="font-size: 14px; margin-top: 0;">üîë Lizenz & Nutzungsbasierte Abrechnung</h3>
            <div id="licenseStatus" style="font-size: 13px;">
                <p style="margin: 5px 0;">
                    <strong>Status:</strong> <span id="licenseStatusText">Wird geladen...</span>
                </p>
                <p style="margin: 5px 0; color: #666;">
                    <strong>Wichtig:</strong> Ihre Patientendaten bleiben 100% lokal auf diesem Ger√§t.
                    Nur anonymisierte Nutzungsmetadaten (Anzahl Exporte, Zeitstempel) werden f√ºr die Abrechnung √ºbermittelt.
                </p>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button onclick="window.LicensingUI?.showActivationDialog()" 
                        style="flex: 1; padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    üîë Lizenz aktivieren
                </button>
                <button onclick="window.BillingUI?.showBillingDialog()" 
                        style="flex: 1; padding: 8px 16px; background: #9c27b0; color: white; border: none; border-radius: 4px; cursor: pointer;">
                    üí≥ Abrechnung verwalten
                </button>
            </div>
        </div>
        
        <hr style="border: none; border-top: 1px solid #ddd; margin: 20px 0;">
        
        <!-- Legal Information -->
        <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 4px;">
            <h3 style="font-size: 14px; margin-top: 0;">Rechtliche Hinweise (DSGVO)</h3>
            <ul style="font-size: 13px; margin: 10px 0; padding-left: 20px;">
                <li>Alle Daten werden ausschlie√ülich lokal gespeichert</li>
                <li>Kein Cloud-Transfer oder externe √úbertragung</li>
                <li>Export erfolgt im GDT 3.0/3.1 Format</li>
                <li>Einwilligung ist jederzeit widerrufbar</li>
                <li>Vollst√§ndiges Audit-Logging nach Art. 30, 32 DSGVO</li>
            </ul>
        </div>
        
        <!-- Action Buttons -->
        <div style="display: flex; justify-content: space-between; margin-top: 20px; gap: 10px;">
            <button id="gdtExportCancel" class="btn" style="background: #757575; flex: 1;">
                Abbrechen
            </button>
            <button id="gdtShowConsent" class="btn" style="background: #2196F3; flex: 2;">
                Weiter zur Einwilligung
            </button>
        </div>
        
        <div style="margin-top: 15px; text-align: center;">
            <button id="gdtBatchExport" class="btn" style="background: #FF9800; font-size: 12px;">
                üì¶ Batch-Export
            </button>
            <button id="gdtImportFile" class="btn" style="background: #009688; font-size: 12px;">
                üì• Import
            </button>
            <button id="gdtEncryptExport" class="btn" style="background: #9C27B0; color: white; font-size: 12px;">
                üîí Verschl√ºsselter Export
            </button>
            <button id="gdtDecryptFile" class="btn" style="background: #673AB7; color: white; font-size: 12px;">
                üîì Entschl√ºsseln
            </button>
            <button id="gdtViewAuditLog" class="btn" style="background: #607D8B; font-size: 12px;">
                üìã Audit-Log
            </button>
            <button id="gdtShowDocs" class="btn" style="background: #607D8B; font-size: 12px;">
                üìÑ DSGVO-Doku
            </button>
            <button id="gdtShowFeatures" class="btn" style="background: #607D8B; font-size: 12px;">
                üîç Browser-Check
            </button>
            <button id="gdtShowPerformance" class="btn" style="background: #607D8B; font-size: 12px;">
                ‚ö° Performance
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Update license status in the dialog
    if (window.LicenseManager && window.UsageMetering) {
        const status = window.LicenseManager.getStatus();
        const summary = window.UsageMetering.getSummary();
        const statusText = document.getElementById('licenseStatusText');
        
        if (statusText) {
            if (!LicensingConfig.enabled) {
                statusText.innerHTML = 'üéâ <strong>Demo-Modus</strong> - Alle Features verf√ºgbar (Lizenzierung noch nicht aktiv)';
                statusText.style.color = '#22c55e';
            } else if (status.active) {
                statusText.innerHTML = `‚úÖ <strong>Aktiv</strong> - ${summary.totalEvents} Exporte diesen Monat (√† ‚Ç¨0.50)`;
                statusText.style.color = '#22c55e';
            } else {
                statusText.innerHTML = '‚ö†Ô∏è <strong>Keine Lizenz</strong> - Bitte aktivieren Sie eine Lizenz';
                statusText.style.color = '#ef4444';
            }
        }
    }
    
    // Handle cancel
    document.getElementById('gdtExportCancel').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    // Handle template loading
    document.getElementById('gdtLoadTemplate').addEventListener('click', () => {
        const templateId = document.getElementById('gdtTemplateSelect').value;
        if (!templateId) {
            alert('Bitte w√§hlen Sie eine Vorlage aus.');
            return;
        }
        
        const result = loadGDTTemplate(templateId);
        if (result.success) {
            // Reload dialog to show updated values
            document.body.removeChild(modal);
            showGDTExportDialog();
            alert(result.message);
        } else {
            alert(result.message);
        }
    });
    
    // Handle template saving
    document.getElementById('gdtSaveTemplate').addEventListener('click', () => {
        const name = prompt('Name der Vorlage:');
        if (!name) return;
        
        const description = prompt('Beschreibung (optional):') || '';
        const result = saveCustomTemplate(name, description);
        
        if (result.success) {
            alert(result.message);
        } else {
            alert(result.message);
        }
    });
    
    // Handle continue to consent
    document.getElementById('gdtShowConsent').addEventListener('click', async () => {
        // Update configuration
        const config = {
            practiceId: document.getElementById('gdtPracticeId').value,
            pseudonymizeData: document.getElementById('gdtPseudonymize').checked,
            includeFullName: document.getElementById('gdtIncludeFullName').checked,
            includeAddress: document.getElementById('gdtIncludeAddress').checked,
            includeContactData: document.getElementById('gdtIncludeContact').checked,
            includeInsuranceData: document.getElementById('gdtIncludeInsurance').checked,
            includeMedicalCodes: document.getElementById('gdtIncludeMedicalCodes').checked,
            bsnr: document.getElementById('gdtBsnr').value,
            lanr: document.getElementById('gdtLanr').value,
            validateBeforeExport: document.getElementById('gdtValidateBeforeExport').checked
        };
        
        updateGDTConfig(config);
        
        // Close config dialog
        document.body.removeChild(modal);
        
        // Show consent dialog
        await showGDTConsentAndExport(formData);
    });
    
    // Handle audit log view
    document.getElementById('gdtViewAuditLog').addEventListener('click', () => {
        // Use enhanced audit viewer if available, fallback to basic
        if (typeof showEnhancedAuditLogViewer !== 'undefined') {
            showEnhancedAuditLogViewer();
        } else {
            showAuditLogViewer();
        }
    });
    
    // Handle documentation
    document.getElementById('gdtShowDocs').addEventListener('click', () => {
        showGDPRDocumentation();
    });
    
    // Handle feature detection
    document.getElementById('gdtShowFeatures').addEventListener('click', () => {
        if (typeof showFeatureDetectionDialog !== 'undefined') {
            showFeatureDetectionDialog();
        } else {
            alert('Feature-Detection nicht verf√ºgbar');
        }
    });
    
    // Handle performance dashboard
    document.getElementById('gdtShowPerformance').addEventListener('click', () => {
        if (typeof showPerformanceDashboard !== 'undefined') {
            showPerformanceDashboard();
        } else {
            alert('Performance-Dashboard nicht verf√ºgbar');
        }
    });
    
    // Handle batch export
    document.getElementById('gdtBatchExport').addEventListener('click', () => {
        if (typeof showBatchExportDialog !== 'undefined') {
            showBatchExportDialog();
        } else {
            alert('Batch-Export nicht verf√ºgbar');
        }
    });
    
    // Handle import
    document.getElementById('gdtImportFile').addEventListener('click', () => {
        if (typeof showGDTImportDialog !== 'undefined') {
            showGDTImportDialog();
        } else {
            alert('Import-Funktion nicht verf√ºgbar');
        }
    });
    
    // Handle encrypted export
    document.getElementById('gdtEncryptExport').addEventListener('click', async () => {
        if (typeof window.GDTEncryptedExport === 'undefined') {
            alert('Verschl√ºsselungs-Funktion nicht verf√ºgbar');
            return;
        }
        
        try {
            // First generate GDT content
            const gdtContent = await generateGDTContent(formData);
            const filename = generateGDTFilename(formData);
            
            // Show encryption dialog
            window.GDTEncryptedExport.showEncryptionDialog(gdtContent, filename);
        } catch (error) {
            console.error('Encrypted export error:', error);
            alert('Fehler beim verschl√ºsselten Export: ' + error.message);
        }
    });
    
    // Handle decryption
    document.getElementById('gdtDecryptFile').addEventListener('click', () => {
        if (typeof window.GDTEncryptedExport === 'undefined') {
            alert('Entschl√ºsselungs-Funktion nicht verf√ºgbar');
            return;
        }
        
        window.GDTEncryptedExport.showDecryptionDialog();
    });
}

// Show consent dialog and perform export
async function showGDTConsentAndExport(formData) {
    try {
        // Generate patient ID for consent using secure async pseudonymization
        const patientId = await pseudonymizePatientIdAsync(formData);
        
        // Determine which consent types are needed
        const consentTypes = [
            CONSENT_TYPES.DATA_EXPORT,
            CONSENT_TYPES.MEDICAL_HISTORY
        ];
        
        if (gdtExportConfig.includeFullName) {
            consentTypes.push(CONSENT_TYPES.FULL_NAME);
        }
        if (gdtExportConfig.includeAddress) {
            consentTypes.push(CONSENT_TYPES.ADDRESS);
        }
        if (gdtExportConfig.includeContactData) {
            consentTypes.push(CONSENT_TYPES.CONTACT_DATA);
        }
        if (gdtExportConfig.includeInsuranceData) {
            consentTypes.push(CONSENT_TYPES.INSURANCE_DATA);
        }
        if (gdtExportConfig.includeMedicalCodes) {
            consentTypes.push(CONSENT_TYPES.MEDICAL_CODES);
        }
        
        // Request consent
        const consent = await requestConsent(patientId, consentTypes);
        
        // Check if all required consents were granted
        const allGranted = consentTypes.every(type => consent.consents[type]);
        
        if (!allGranted) {
            alert('Nicht alle erforderlichen Einwilligungen wurden erteilt. Export wurde abgebrochen.');
            return;
        }
        
        // Perform export
        const result = await exportGDT(formData, consent);
        
        if (result.success) {
            showExportSuccessDialog(result);
        } else {
            alert(`Export fehlgeschlagen: ${result.message}`);
        }
        
    } catch (error) {
        console.error('GDT Export error:', error);
        alert(`Export abgebrochen: ${error.message}`);
    }
}

// Show export success dialog
function showExportSuccessDialog(result) {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '500px';
    
    content.innerHTML = `
        <h2 style="color: #4CAF50;">‚úì Export erfolgreich</h2>
        <p>Die GDT-Datei wurde erfolgreich exportiert:</p>
        <div style="background: #f5f5f5; padding: 10px; margin: 15px 0; border-radius: 4px; font-family: monospace;">
            ${result.filename}
        </div>
        <p style="font-size: 13px; color: #666;">
            Der Export wurde im Audit-Log protokolliert und kann jederzeit nachvollzogen werden.
        </p>
        <div style="margin-top: 20px; text-align: center;">
            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                Schlie√üen
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
}

// Show audit log viewer
function showAuditLogViewer() {
    const auditLog = getAuditLog(50);
    
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '800px';
    content.style.maxHeight = '90vh';
    content.style.overflowY = 'auto';
    
    let logEntries = '';
    if (auditLog.length === 0) {
        logEntries = '<p style="text-align: center; color: #666;">Keine Audit-Log Eintr√§ge vorhanden</p>';
    } else {
        logEntries = auditLog.reverse().map(entry => `
            <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <strong>${entry.action}</strong>
                    <span style="color: #666; font-size: 12px;">${new Date(entry.timestamp).toLocaleString('de-DE')}</span>
                </div>
                ${entry.filename ? `<div style="font-size: 13px;"><strong>Datei:</strong> ${entry.filename}</div>` : ''}
                <div style="font-size: 13px;"><strong>Patient-ID:</strong> ${entry.patientId}</div>
                ${entry.pseudonymized !== undefined ? `<div style="font-size: 13px;"><strong>Pseudonymisiert:</strong> ${entry.pseudonymized ? 'Ja' : 'Nein'}</div>` : ''}
                ${entry.consentGiven !== undefined ? `<div style="font-size: 13px;"><strong>Einwilligung:</strong> ${entry.consentGiven ? 'Erteilt' : 'Nicht erteilt'}</div>` : ''}
            </div>
        `).join('');
    }
    
    content.innerHTML = `
        <h2>Audit-Log (letzte 50 Eintr√§ge)</h2>
        <p style="color: #666; font-size: 13px;">
            Alle GDT-Exporte werden gem√§√ü Art. 30, 32 DSGVO protokolliert.
        </p>
        <div style="margin: 20px 0;">
            ${logEntries}
        </div>
        <div style="display: flex; justify-content: space-between; margin-top: 20px; gap: 10px;">
            <button class="btn" style="background: #607D8B;" onclick="exportAuditLog()">
                üì• Log exportieren
            </button>
            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                Schlie√üen
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
}

// Show GDPR documentation dialog
function showGDPRDocumentation() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '700px';
    content.style.maxHeight = '90vh';
    content.style.overflowY = 'auto';
    
    content.innerHTML = `
        <h2>DSGVO-Dokumentation</h2>
        
        <div style="margin: 20px 0;">
            <h3 style="font-size: 16px;">Verf√ºgbare Dokumente</h3>
            <p style="color: #666; font-size: 13px;">
                Diese Dokumente unterst√ºtzen Sie bei der DSGVO-Konformit√§t:
            </p>
            
            <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px;">
                <h4 style="margin-top: 0;">Verarbeitungsverzeichnis (Art. 30 DSGVO)</h4>
                <p style="font-size: 13px; color: #666;">
                    Dokumentation aller Datenverarbeitungen, Zwecke, Kategorien und Schutzma√ünahmen.
                </p>
                <button class="btn" style="background: #2196F3; font-size: 13px;" onclick="exportProcessingRecord()">
                    üìÑ Verarbeitungsverzeichnis exportieren
                </button>
            </div>
            
            <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px;">
                <h4 style="margin-top: 0;">DSFA - Datenschutz-Folgenabsch√§tzung (Art. 35 DSGVO)</h4>
                <p style="font-size: 13px; color: #666;">
                    Bewertung der Risiken und Schutzma√ünahmen f√ºr den GDT-Export.
                </p>
                <button class="btn" style="background: #2196F3; font-size: 13px;" onclick="exportDPIATemplate()">
                    üìÑ DSFA-Vorlage exportieren
                </button>
            </div>
            
            <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px;">
                <h4 style="margin-top: 0;">Audit-Log</h4>
                <p style="font-size: 13px; color: #666;">
                    Protokoll aller GDT-Exporte f√ºr Nachweispflichten gem√§√ü Art. 30, 32 DSGVO.
                </p>
                <button class="btn" style="background: #2196F3; font-size: 13px;" onclick="exportAuditLog()">
                    üìÑ Audit-Log exportieren
                </button>
            </div>
            
            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 20px 0;">
                <strong>‚ö†Ô∏è Wichtig:</strong> Die vollst√§ndige Dokumentation finden Sie in 
                <code>GDPR_EXPORT_DOCUMENTATION.md</code>. Bitte konsultieren Sie vor Produktiveinsatz 
                einen Datenschutzbeauftragten!
            </div>
            
            <h3 style="font-size: 16px; margin-top: 30px;">Checkliste vor Go-Live</h3>
            <ul style="font-size: 13px;">
                <li>‚òê DSGVO-Konformit√§t durch unabh√§ngigen DSB pr√ºfen</li>
                <li>‚òê Verarbeitungsverzeichnis erstellen und aktualisieren</li>
                <li>‚òê DSFA durchf√ºhren und dokumentieren</li>
                <li>‚òê Feldmapping mit DSB abstimmen</li>
                <li>‚òê Log-L√∂sung mit DSB abstimmen</li>
                <li>‚òê Personal schulen</li>
                <li>‚òê Einwilligungsvorlagen rechtlich pr√ºfen</li>
                <li>‚òê Technische und organisatorische Ma√ünahmen dokumentieren</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                Schlie√üen
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
}

// Add CSS for info button
if (typeof document !== 'undefined') {
    document.addEventListener('DOMContentLoaded', function() {
        // Add btn-info style if not exists
        const style = document.createElement('style');
        style.textContent = `
            .btn-info {
                background: #2196F3;
                color: white;
            }
            .btn-info:hover {
                background: #1976D2;
            }
        `;
        document.head.appendChild(style);
    });
}

// Batch Export Dialog
function showBatchExportDialog() {
    // Sample patient data - in real app, this would come from your data store
    const samplePatients = [
        { id: 'P001', firstName: 'Max', lastName: 'Mustermann', birthDate: '15051980' },
        { id: 'P002', firstName: 'Maria', lastName: 'Musterfrau', birthDate: '20031985' },
        { id: 'P003', firstName: 'Hans', lastName: 'Schmidt', birthDate: '10121975' }
    ];
    
    gdtBatchExport.initialize(samplePatients);
    
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '800px';
    
    const stats = gdtBatchExport.getStatistics();
    
    content.innerHTML = `
        <h2>üì¶ Batch-Export</h2>
        <p style="color: #666;">Export mehrerer Patienten gleichzeitig (nur mit Einwilligung)</p>
        
        <div style="background: #e3f2fd; padding: 15px; margin: 15px 0; border-radius: 4px;">
            <strong>Statistik:</strong><br>
            Gesamt: ${stats.totalPatients} | 
            Mit Einwilligung: ${stats.patientsWithConsent} | 
            Ausgew√§hlt: <span id="selectedCount">${stats.selectedPatients}</span>
        </div>
        
        <div style="margin: 15px 0;">
            <button id="selectAll" class="btn" style="background: #4CAF50; font-size: 13px;">
                ‚úì Alle ausw√§hlen
            </button>
            <button id="selectNone" class="btn" style="background: #f44336; font-size: 13px;">
                ‚úó Keine ausw√§hlen
            </button>
        </div>
        
        <div style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; margin: 15px 0;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f5f5f5; position: sticky; top: 0;">
                    <tr>
                        <th style="padding: 10px; text-align: left;">Auswahl</th>
                        <th style="padding: 10px; text-align: left;">Name</th>
                        <th style="padding: 10px; text-align: left;">Geburtsdatum</th>
                        <th style="padding: 10px; text-align: left;">Einwilligung</th>
                    </tr>
                </thead>
                <tbody id="patientList">
                </tbody>
            </table>
        </div>
        
        <div style="margin: 15px 0;">
            <label style="display: block; margin-bottom: 10px;">
                <strong>Export-Modus:</strong>
            </label>
            <select id="exportMode" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                <option value="separate">Separate Dateien (eine pro Patient)</option>
                <option value="combined">Kombinierte Datei (alle Patienten)</option>
            </select>
        </div>
        
        <div id="progressContainer" style="display: none; margin: 15px 0;">
            <div style="background: #f5f5f5; height: 30px; border-radius: 4px; overflow: hidden;">
                <div id="progressBar" style="background: #4CAF50; height: 100%; width: 0%; transition: width 0.3s;"></div>
            </div>
            <p id="progressText" style="text-align: center; margin-top: 5px;">0 / 0</p>
        </div>
        
        <div style="margin-top: 20px; text-align: right;">
            <button id="cancelBatch" class="btn" style="background: #ccc;">Abbrechen</button>
            <button id="startBatchExport" class="btn" style="background: #FF9800; color: white;">
                Export starten
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Render patient list
    function renderPatientList() {
        const tbody = document.getElementById('patientList');
        tbody.innerHTML = '';
        
        gdtBatchExport.patients.forEach(patient => {
            const tr = document.createElement('tr');
            tr.style.background = patient.selected ? '#e8f5e9' : 'white';
            tr.innerHTML = `
                <td style="padding: 10px;">
                    <input type="checkbox" 
                        ${patient.selected ? 'checked' : ''}
                        ${!patient.hasConsent ? 'disabled' : ''}
                        data-patient-id="${patient.id}">
                </td>
                <td style="padding: 10px;">${patient.lastName}, ${patient.firstName}</td>
                <td style="padding: 10px;">${patient.birthDate}</td>
                <td style="padding: 10px;">
                    ${patient.hasConsent ? 
                        '<span style="color: green;">‚úì Vorhanden</span>' : 
                        '<span style="color: red;">‚úó Keine Einwilligung</span>'}
                </td>
            `;
            tbody.appendChild(tr);
        });
        
        // Update selected count
        document.getElementById('selectedCount').textContent = gdtBatchExport.getSelectedPatients().length;
    }
    
    renderPatientList();
    
    // Event listeners
    document.getElementById('selectAll').addEventListener('click', () => {
        gdtBatchExport.selectAll();
        renderPatientList();
    });
    
    document.getElementById('selectNone').addEventListener('click', () => {
        gdtBatchExport.selectNone();
        renderPatientList();
    });
    
    document.getElementById('patientList').addEventListener('change', (e) => {
        if (e.target.type === 'checkbox') {
            gdtBatchExport.toggleSelection(e.target.dataset.patientId);
            renderPatientList();
        }
    });
    
    document.getElementById('cancelBatch').addEventListener('click', () => {
        if (gdtBatchExport.exportProgress.total > 0) {
            gdtBatchExport.cancelExport();
        }
        document.body.removeChild(modal);
    });
    
    document.getElementById('startBatchExport').addEventListener('click', async () => {
        const mode = document.getElementById('exportMode').value;
        const selected = gdtBatchExport.getSelectedPatients();
        
        if (selected.length === 0) {
            alert('Bitte w√§hlen Sie mindestens einen Patienten aus.');
            return;
        }
        
        document.getElementById('progressContainer').style.display = 'block';
        document.getElementById('startBatchExport').disabled = true;
        
        try {
            const results = await gdtBatchExport.executeBatchExport(mode, (progress) => {
                const percent = (progress.completed / progress.total) * 100;
                document.getElementById('progressBar').style.width = percent + '%';
                document.getElementById('progressText').textContent = 
                    `${progress.completed} / ${progress.total} (${progress.failed} fehlgeschlagen)`;
            });
            
            alert(`Batch-Export abgeschlossen!\n\nErfolgreich: ${results.successful.length}\nFehlgeschlagen: ${results.failed.length}`);
            document.body.removeChild(modal);
        } catch (error) {
            alert('Fehler beim Batch-Export: ' + error.message);
            document.getElementById('startBatchExport').disabled = false;
        }
    });
}

// GDT Import Dialog
function showGDTImportDialog() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '800px';
    
    content.innerHTML = `
        <h2>üì• GDT-Import</h2>
        <p style="color: #666;">Importieren Sie GDT-Dateien von Ihrem Praxisverwaltungssystem</p>
        
        <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0;">
            <strong>Hinweis:</strong> Import erfordert Patienteneinwilligung f√ºr Datenverarbeitung.
        </div>
        
        <div style="margin: 20px 0; padding: 20px; border: 2px dashed #ddd; border-radius: 4px; text-align: center;">
            <input type="file" id="gdtFileInput" accept=".gdt" multiple style="display: none;">
            <button id="selectFileBtn" class="btn" style="background: #009688; color: white; font-size: 16px;">
                üìÅ GDT-Datei ausw√§hlen
            </button>
            <p style="color: #666; margin-top: 10px; font-size: 13px;">
                Unterst√ºtzt: .gdt Dateien (GDT 3.0/3.1)
            </p>
        </div>
        
        <div id="importPreview" style="display: none; margin: 20px 0;">
            <h3 style="font-size: 16px; margin-bottom: 10px;">Import-Vorschau</h3>
            <div id="previewContent" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; padding: 15px; border-radius: 4px; background: #f9f9f9;">
            </div>
            
            <div style="margin: 15px 0;">
                <label style="display: block; margin-bottom: 5px;"><strong>Import-Modus:</strong></label>
                <select id="importMode" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="update">Bestehenden Patienten aktualisieren</option>
                    <option value="create">Neuen Patienten anlegen</option>
                    <option value="review">Nur pr√ºfen (keine √Ñnderungen)</option>
                </select>
            </div>
            
            <div style="margin-top: 20px; text-align: right;">
                <button id="cancelImport" class="btn" style="background: #ccc;">Abbrechen</button>
                <button id="executeImport" class="btn" style="background: #009688; color: white;">
                    Import ausf√ºhren
                </button>
            </div>
        </div>
        
        <div id="importResults" style="display: none; margin: 20px 0;">
            <h3 style="font-size: 16px; margin-bottom: 10px;">Import-Ergebnisse</h3>
            <div id="resultsContent" style="padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
            </div>
        </div>
        
        <div style="margin-top: 20px; text-align: right;">
            <button id="closeImport" class="btn" style="background: #ccc;">Schlie√üen</button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // File selection
    document.getElementById('selectFileBtn').addEventListener('click', () => {
        document.getElementById('gdtFileInput').click();
    });
    
    document.getElementById('gdtFileInput').addEventListener('change', async (e) => {
        const files = e.target.files;
        if (files.length === 0) return;
        
        try {
            const result = await gdtImporter.importFile(files[0]);
            
            if (result.success) {
                showImportPreview(result);
            } else {
                alert('Import-Fehler: ' + result.error);
            }
        } catch (error) {
            alert('Fehler beim Lesen der Datei: ' + error.message);
        }
    });
    
    function showImportPreview(result) {
        document.getElementById('importPreview').style.display = 'block';
        
        const previewContent = document.getElementById('previewContent');
        let html = '<table style="width: 100%; border-collapse: collapse;">';
        
        for (const [field, value] of Object.entries(result.patient.fields)) {
            html += `
                <tr>
                    <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">${field}</td>
                    <td style="padding: 8px; border-bottom: 1px solid #eee;">${value}</td>
                </tr>
            `;
        }
        
        html += '</table>';
        
        if (result.validation.warnings.length > 0) {
            html += '<div style="background: #fff3cd; padding: 10px; margin-top: 10px; border-radius: 4px;">';
            html += '<strong>Warnungen:</strong><ul style="margin: 5px 0;">';
            result.validation.warnings.forEach(w => {
                html += `<li>${w}</li>`;
            });
            html += '</ul></div>';
        }
        
        previewContent.innerHTML = html;
    }
    
    document.getElementById('cancelImport').addEventListener('click', () => {
        document.getElementById('importPreview').style.display = 'none';
        gdtImporter.clearCurrentImport();
    });
    
    document.getElementById('executeImport').addEventListener('click', () => {
        const mode = document.getElementById('importMode').value;
        const currentImport = gdtImporter.getCurrentImport();
        
        if (!currentImport) {
            alert('Keine Import-Daten vorhanden');
            return;
        }
        
        try {
            const result = gdtImporter.applyImport(currentImport, mode);
            
            document.getElementById('importResults').style.display = 'block';
            document.getElementById('resultsContent').innerHTML = `
                <div style="background: #e8f5e9; padding: 15px; border-radius: 4px;">
                    <strong>‚úì Import erfolgreich!</strong><br>
                    Aktion: ${result.action}<br>
                    Felder aktualisiert: ${result.fieldsUpdated}<br>
                    Patient-ID: ${result.patientId}
                </div>
            `;
            
            document.getElementById('importPreview').style.display = 'none';
        } catch (error) {
            alert('Import-Fehler: ' + error.message);
        }
    });
    
    document.getElementById('closeImport').addEventListener('click', () => {
        document.body.removeChild(modal);
    });
}


        // ====================================================================
        // GDT ENCRYPTED EXPORT MODULE (INLINE)
        // ====================================================================
        // GDT export with AES-256 encryption
        // Combines GDT format with encryption for secure transfer
/**
 * GDT Encrypted Export Module
 * Provides additional file encryption for GDT exports
 * Use cases: Network drive transport, email transfer, external backups
 * 
 * GDPR Compliance: Art. 32 DSGVO - Encryption as security measure
 */

class GDTEncryptedExport {
    constructor() {
        this.encryptionAlgorithm = 'AES-GCM';
        this.keyLength = 256;
        this.ivLength = 12;
        this.saltLength = 16;
        this.iterations = 100000;
    }

    /**
     * Generate encryption key from password using PBKDF2
     */
    async deriveKey(password, salt) {
        const encoder = new TextEncoder();
        const passwordKey = await window.crypto.subtle.importKey(
            'raw',
            encoder.encode(password),
            'PBKDF2',
            false,
            ['deriveBits', 'deriveKey']
        );

        return await window.crypto.subtle.deriveKey(
            {
                name: 'PBKDF2',
                salt: salt,
                iterations: this.iterations,
                hash: 'SHA-256'
            },
            passwordKey,
            { name: this.encryptionAlgorithm, length: this.keyLength },
            false,
            ['encrypt', 'decrypt']
        );
    }

    /**
     * Encrypt GDT file content
     */
    async encryptGDTFile(gdtContent, password) {
        try {
            // Generate random salt and IV
            const salt = window.crypto.getRandomValues(new Uint8Array(this.saltLength));
            const iv = window.crypto.getRandomValues(new Uint8Array(this.ivLength));

            // Derive encryption key
            const key = await this.deriveKey(password, salt);

            // Convert content to bytes
            const encoder = new TextEncoder();
            const data = encoder.encode(gdtContent);

            // Encrypt
            const encryptedData = await window.crypto.subtle.encrypt(
                {
                    name: this.encryptionAlgorithm,
                    iv: iv
                },
                key,
                data
            );

            // Combine salt + iv + encrypted data
            const encryptedArray = new Uint8Array(encryptedData);
            const combined = new Uint8Array(salt.length + iv.length + encryptedArray.length);
            combined.set(salt, 0);
            combined.set(iv, salt.length);
            combined.set(encryptedArray, salt.length + iv.length);

            // Convert to base64 for storage
            const base64 = btoa(String.fromCharCode.apply(null, combined));

            return {
                success: true,
                encrypted: base64,
                algorithm: `${this.encryptionAlgorithm}-${this.keyLength}`,
                metadata: {
                    encrypted: true,
                    algorithm: this.encryptionAlgorithm,
                    keyLength: this.keyLength,
                    timestamp: new Date().toISOString()
                }
            };
        } catch (error) {
            console.error('Encryption error:', error);
            return {
                success: false,
                error: error.message
            };
        }
    }

    /**
     * Decrypt GDT file content
     */
    async decryptGDTFile(encryptedBase64, password) {
        try {
            // Convert from base64
            const combined = Uint8Array.from(atob(encryptedBase64), c => c.charCodeAt(0));

            // Extract salt, iv, and encrypted data
            const salt = combined.slice(0, this.saltLength);
            const iv = combined.slice(this.saltLength, this.saltLength + this.ivLength);
            const encryptedData = combined.slice(this.saltLength + this.ivLength);

            // Derive decryption key
            const key = await this.deriveKey(password, salt);

            // Decrypt
            const decryptedData = await window.crypto.subtle.decrypt(
                {
                    name: this.encryptionAlgorithm,
                    iv: iv
                },
                key,
                encryptedData
            );

            // Convert to string
            const decoder = new TextDecoder();
            const gdtContent = decoder.decode(decryptedData);

            return {
                success: true,
                decrypted: gdtContent
            };
        } catch (error) {
            console.error('Decryption error:', error);
            return {
                success: false,
                error: 'Falsches Passwort oder besch√§digte Datei'
            };
        }
    }

    /**
     * Generate secure random password
     */
    generateSecurePassword(length = 16) {
        const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
        const array = new Uint8Array(length);
        window.crypto.getRandomValues(array);
        let password = '';
        for (let i = 0; i < length; i++) {
            password += charset[array[i] % charset.length];
        }
        return password;
    }

    /**
     * Validate password strength
     */
    validatePasswordStrength(password) {
        const minLength = 12;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(password);

        const issues = [];
        let strength = 'weak';

        if (password.length < minLength) {
            issues.push(`Mindestens ${minLength} Zeichen erforderlich`);
        }
        if (!hasUpperCase) {
            issues.push('Mindestens ein Gro√übuchstabe erforderlich');
        }
        if (!hasLowerCase) {
            issues.push('Mindestens ein Kleinbuchstabe erforderlich');
        }
        if (!hasNumbers) {
            issues.push('Mindestens eine Zahl erforderlich');
        }
        if (!hasSpecialChar) {
            issues.push('Mindestens ein Sonderzeichen erforderlich');
        }

        if (issues.length === 0) {
            strength = password.length >= 16 ? 'strong' : 'medium';
        }

        return {
            valid: issues.length === 0,
            strength: strength,
            issues: issues
        };
    }

    /**
     * Create encrypted export file with metadata
     */
    async createEncryptedExportFile(gdtContent, filename, password) {
        const result = await this.encryptGDTFile(gdtContent, password);
        
        if (!result.success) {
            return result;
        }

        const exportData = {
            version: '1.0',
            type: 'encrypted-gdt-export',
            metadata: result.metadata,
            filename: filename,
            data: result.encrypted
        };

        return {
            success: true,
            content: JSON.stringify(exportData, null, 2),
            filename: filename.replace('.gdt', '.egdt')
        };
    }

    /**
     * Show encryption dialog
     */
    showEncryptionDialog(gdtContent, originalFilename) {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        `;

        const dialog = document.createElement('div');
        dialog.style.cssText = `
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        `;

        dialog.innerHTML = `
            <h2 style="margin-top: 0; color: #2c3e50;">üîí GDT-Datei verschl√ºsseln</h2>
            
            <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db;">
                <strong>‚ÑπÔ∏è Verschl√ºsselung</strong><br>
                Die GDT-Datei wird mit AES-256-GCM verschl√ºsselt.<br>
                Anwendungsf√§lle: Netzlaufwerk-Transfer, E-Mail-Versand, externe Backups.
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">
                    Verschl√ºsselungs-Passwort:
                </label>
                <div style="display: flex; gap: 10px;">
                    <input type="password" id="encryptPassword" 
                           style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;"
                           placeholder="Mindestens 12 Zeichen">
                    <button id="togglePassword" 
                            style="padding: 10px 15px; background: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üëÅÔ∏è
                    </button>
                    <button id="generatePassword" 
                            style="padding: 10px 15px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üé≤
                    </button>
                </div>
                <div id="passwordStrength" style="margin-top: 8px; font-size: 13px;"></div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">
                    Passwort best√§tigen:
                </label>
                <input type="password" id="confirmPassword" 
                       style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;"
                       placeholder="Passwort wiederholen">
            </div>

            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                <strong>‚ö†Ô∏è Wichtig:</strong><br>
                ‚Ä¢ Passwort sicher aufbewahren<br>
                ‚Ä¢ Bei Verlust ist Entschl√ºsselung unm√∂glich<br>
                ‚Ä¢ Passwort nicht in E-Mail senden<br>
                ‚Ä¢ Separate, sichere √úbermittlung erforderlich
            </div>

            <div id="errorMessage" style="color: #e74c3c; margin-bottom: 15px; display: none;"></div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="cancelEncryption" 
                        style="padding: 12px 24px; background: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    Abbrechen
                </button>
                <button id="confirmEncryption" 
                        style="padding: 12px 24px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    üîí Verschl√ºsseln und Speichern
                </button>
            </div>
        `;

        modal.appendChild(dialog);
        document.body.appendChild(modal);

        const passwordInput = dialog.querySelector('#encryptPassword');
        const confirmInput = dialog.querySelector('#confirmPassword');
        const strengthDiv = dialog.querySelector('#passwordStrength');
        const errorDiv = dialog.querySelector('#errorMessage');
        const toggleBtn = dialog.querySelector('#togglePassword');
        const generateBtn = dialog.querySelector('#generatePassword');

        // Password strength indicator
        passwordInput.addEventListener('input', () => {
            const validation = this.validatePasswordStrength(passwordInput.value);
            const colors = { weak: '#e74c3c', medium: '#f39c12', strong: '#27ae60' };
            strengthDiv.innerHTML = `
                <span style="color: ${colors[validation.strength]};">
                    St√§rke: ${validation.strength === 'weak' ? 'üî¥ Schwach' : 
                              validation.strength === 'medium' ? 'üü° Mittel' : 'üü¢ Stark'}
                </span>
                ${validation.issues.length > 0 ? '<br>' + validation.issues.join('<br>') : ''}
            `;
        });

        // Toggle password visibility
        toggleBtn.addEventListener('click', () => {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            confirmInput.type = type;
            toggleBtn.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
        });

        // Generate secure password
        generateBtn.addEventListener('click', () => {
            const password = this.generateSecurePassword(16);
            passwordInput.value = password;
            confirmInput.value = password;
            passwordInput.dispatchEvent(new Event('input'));
            
            // Show generated password
            alert(`Generiertes Passwort:\n\n${password}\n\n‚ö†Ô∏è Bitte sicher aufbewahren!`);
        });

        // Cancel
        dialog.querySelector('#cancelEncryption').addEventListener('click', () => {
            document.body.removeChild(modal);
        });

        // Confirm encryption
        dialog.querySelector('#confirmEncryption').addEventListener('click', async () => {
            const password = passwordInput.value;
            const confirm = confirmInput.value;

            // Validate
            errorDiv.style.display = 'none';

            if (!password) {
                errorDiv.textContent = '‚ùå Bitte Passwort eingeben';
                errorDiv.style.display = 'block';
                return;
            }

            const validation = this.validatePasswordStrength(password);
            if (!validation.valid) {
                errorDiv.textContent = '‚ùå Passwort erf√ºllt nicht die Anforderungen';
                errorDiv.style.display = 'block';
                return;
            }

            if (password !== confirm) {
                errorDiv.textContent = '‚ùå Passw√∂rter stimmen nicht √ºberein';
                errorDiv.style.display = 'block';
                return;
            }

            // Show progress
            dialog.querySelector('#confirmEncryption').textContent = '‚è≥ Verschl√ºssele...';
            dialog.querySelector('#confirmEncryption').disabled = true;

            try {
                // Create encrypted file
                const result = await this.createEncryptedExportFile(
                    gdtContent,
                    originalFilename,
                    password
                );

                if (!result.success) {
                    throw new Error(result.error);
                }

                // Save encrypted file
                const blob = new Blob([result.content], { type: 'application/json' });
                const handle = await window.showSaveFilePicker({
                    suggestedName: result.filename,
                    types: [{
                        description: 'Verschl√ºsselte GDT-Datei',
                        accept: { 'application/json': ['.egdt'] }
                    }]
                });

                const writable = await handle.createWritable();
                await writable.write(blob);
                await writable.close();

                // Log to audit
                if (window.GDPRCompliance) {
                    window.GDPRCompliance.logAuditEntry('gdt_encrypted_export', {
                        filename: result.filename,
                        algorithm: 'AES-256-GCM',
                        success: true
                    });
                }

                document.body.removeChild(modal);
                alert('‚úÖ Verschl√ºsselte GDT-Datei erfolgreich gespeichert!\n\n' +
                      '‚ö†Ô∏è Passwort sicher aufbewahren und getrennt √ºbermitteln.');

            } catch (error) {
                console.error('Encryption error:', error);
                errorDiv.textContent = `‚ùå Fehler: ${error.message}`;
                errorDiv.style.display = 'block';
                dialog.querySelector('#confirmEncryption').textContent = 'üîí Verschl√ºsseln und Speichern';
                dialog.querySelector('#confirmEncryption').disabled = false;
            }
        });
    }

    /**
     * Show decryption dialog
     */
    showDecryptionDialog() {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        `;

        const dialog = document.createElement('div');
        dialog.style.cssText = `
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        `;

        dialog.innerHTML = `
            <h2 style="margin-top: 0; color: #2c3e50;">üîì Verschl√ºsselte GDT-Datei entschl√ºsseln</h2>
            
            <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #3498db;">
                <strong>‚ÑπÔ∏è Entschl√ºsselung</strong><br>
                W√§hlen Sie eine verschl√ºsselte .egdt Datei und geben Sie das Passwort ein.
            </div>

            <div style="margin-bottom: 20px;">
                <button id="selectEncryptedFile" 
                        style="padding: 12px 24px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%;">
                    üìÅ Verschl√ºsselte Datei ausw√§hlen
                </button>
                <div id="selectedFile" style="margin-top: 10px; font-size: 13px; color: #7f8c8d;"></div>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; font-weight: bold;">
                    Entschl√ºsselungs-Passwort:
                </label>
                <input type="password" id="decryptPassword" 
                       style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;"
                       placeholder="Passwort eingeben">
            </div>

            <div id="errorMessage" style="color: #e74c3c; margin-bottom: 15px; display: none;"></div>

            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button id="cancelDecryption" 
                        style="padding: 12px 24px; background: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                    Abbrechen
                </button>
                <button id="confirmDecryption" 
                        style="padding: 12px 24px; background: #27ae60; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;"
                        disabled>
                    üîì Entschl√ºsseln
                </button>
            </div>
        `;

        modal.appendChild(dialog);
        document.body.appendChild(modal);

        let selectedFileContent = null;
        let selectedFileName = null;

        const errorDiv = dialog.querySelector('#errorMessage');
        const confirmBtn = dialog.querySelector('#confirmDecryption');
        const selectedFileDiv = dialog.querySelector('#selectedFile');

        // File selection
        dialog.querySelector('#selectEncryptedFile').addEventListener('click', async () => {
            try {
                const [handle] = await window.showOpenFilePicker({
                    types: [{
                        description: 'Verschl√ºsselte GDT-Datei',
                        accept: { 'application/json': ['.egdt'] }
                    }]
                });

                const file = await handle.getFile();
                selectedFileContent = await file.text();
                selectedFileName = file.name;
                selectedFileDiv.textContent = `‚úì Ausgew√§hlt: ${file.name}`;
                confirmBtn.disabled = false;

            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.error('File selection error:', error);
                }
            }
        });

        // Cancel
        dialog.querySelector('#cancelDecryption').addEventListener('click', () => {
            document.body.removeChild(modal);
        });

        // Confirm decryption
        dialog.querySelector('#confirmDecryption').addEventListener('click', async () => {
            const password = dialog.querySelector('#decryptPassword').value;

            errorDiv.style.display = 'none';

            if (!selectedFileContent) {
                errorDiv.textContent = '‚ùå Bitte Datei ausw√§hlen';
                errorDiv.style.display = 'block';
                return;
            }

            if (!password) {
                errorDiv.textContent = '‚ùå Bitte Passwort eingeben';
                errorDiv.style.display = 'block';
                return;
            }

            confirmBtn.textContent = '‚è≥ Entschl√ºssele...';
            confirmBtn.disabled = true;

            try {
                // Parse encrypted file
                const fileData = JSON.parse(selectedFileContent);
                
                if (fileData.type !== 'encrypted-gdt-export') {
                    throw new Error('Ung√ºltiges Dateiformat');
                }

                // Decrypt
                const result = await this.decryptGDTFile(fileData.data, password);

                if (!result.success) {
                    throw new Error(result.error);
                }

                // Save decrypted file
                const blob = new Blob([result.decrypted], { type: 'text/plain' });
                const originalName = fileData.filename || selectedFileName.replace('.egdt', '.gdt');
                
                const handle = await window.showSaveFilePicker({
                    suggestedName: originalName,
                    types: [{
                        description: 'GDT-Datei',
                        accept: { 'text/plain': ['.gdt'] }
                    }]
                });

                const writable = await handle.createWritable();
                await writable.write(blob);
                await writable.close();

                // Log to audit
                if (window.GDPRCompliance) {
                    window.GDPRCompliance.logAuditEntry('gdt_decrypted_import', {
                        filename: originalName,
                        success: true
                    });
                }

                document.body.removeChild(modal);
                alert('‚úÖ GDT-Datei erfolgreich entschl√ºsselt und gespeichert!');

            } catch (error) {
                console.error('Decryption error:', error);
                errorDiv.textContent = `‚ùå ${error.message}`;
                errorDiv.style.display = 'block';
                confirmBtn.textContent = 'üîì Entschl√ºsseln';
                confirmBtn.disabled = false;
            }
        });
    }
}

// Initialize global instance
window.GDTEncryptedExport = new GDTEncryptedExport();

        // ====================================================================
        // GDPR COMPLIANCE MODULE (INLINE)
        // ====================================================================
        // GDPR/DSGVO compliance utilities
        // Art. 13, 17, 30, 32 implementation
// GDPR Compliance Module (DSGVO-Konformit√§t)
// Implements consent management, audit logging, and data protection measures
// According to GDPR Art. 30, 32, 35 (DSGVO Art. 30, 32, 35)

// Consent categories according to GDPR
const CONSENT_TYPES = {
    DATA_EXPORT: 'data_export',
    PATIENT_SYNC: 'patient_sync',
    FULL_NAME: 'full_name',
    ADDRESS: 'address',
    CONTACT_DATA: 'contact_data',
    MEDICAL_HISTORY: 'medical_history',
    INSURANCE_DATA: 'insurance_data',
    MEDICAL_CODES: 'medical_codes'
};

// Consent storage
const consentRecords = {
    records: []
};

// Legal basis according to GDPR Art. 6
const LEGAL_BASIS = {
    CONSENT: 'Art. 6(1)(a) GDPR - Consent',
    CONTRACT: 'Art. 6(1)(b) GDPR - Contract',
    LEGAL_OBLIGATION: 'Art. 6(1)(c) GDPR - Legal obligation',
    VITAL_INTERESTS: 'Art. 6(1)(d) GDPR - Vital interests',
    PUBLIC_INTEREST: 'Art. 6(1)(e) GDPR - Public interest',
    LEGITIMATE_INTERESTS: 'Art. 6(1)(f) GDPR - Legitimate interests'
};

// Data categories for processing record (Verarbeitungsverzeichnis)
const DATA_CATEGORIES = {
    PERSONAL: 'Personenbezogene Daten (Name, Adresse, Kontaktdaten)',
    HEALTH: 'Gesundheitsdaten (Anamnese, Diagnosen, Medikation)',
    SPECIAL: 'Besondere Kategorien (Art. 9 DSGVO - Gesundheitsdaten)'
};

// Processing purposes
const PROCESSING_PURPOSES = {
    MEDICAL_CARE: 'Medizinische Versorgung und Behandlung',
    DOCUMENTATION: 'Medizinische Dokumentation',
    SYSTEM_INTEGRATION: 'Integration mit Praxisverwaltungssystem',
    QUALITY_ASSURANCE: 'Qualit√§tssicherung'
};

// Data recipients
const DATA_RECIPIENTS = {
    PRACTICE: 'Arztpraxis (intern)',
    PVS: 'Praxisverwaltungssystem (Medatixx, CGM, Quincy)',
    NONE: 'Keine externen Empf√§nger'
};

// Consent object structure
function createConsentRecord(patientId, consentType, granted = false, details = {}) {
    return {
        id: generateConsentId(),
        patientId: patientId,
        consentType: consentType,
        granted: granted,
        timestamp: new Date().toISOString(),
        details: details,
        legalBasis: LEGAL_BASIS.CONSENT,
        withdrawable: true,
        version: '1.0',
        language: document.getElementById('language')?.value || 'de'
    };
}

// Generate unique consent ID
function generateConsentId() {
    return `CONSENT-${Date.now()}-${Math.random().toString(36).substring(2, 11)}`;
}

// Request consent from patient
function requestConsent(patientId, consentTypes = []) {
    return new Promise((resolve, reject) => {
        // Show consent dialog
        showConsentDialog(patientId, consentTypes, (consentData) => {
            if (consentData.granted) {
                // Store consent records
                consentTypes.forEach(type => {
                    const record = createConsentRecord(
                        patientId,
                        type,
                        consentData.consents[type] || false,
                        consentData.details
                    );
                    storeConsentRecord(record);
                });
                
                resolve(consentData);
            } else {
                reject(new Error('Einwilligung nicht erteilt'));
            }
        });
    });
}

// Show consent dialog UI
function showConsentDialog(patientId, consentTypes, callback) {
    const modal = document.createElement('div');
    modal.id = 'gdprConsentModal';
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '600px';
    content.style.padding = '20px';
    
    const translations = getCurrentTranslations();
    
    content.innerHTML = `
        <h2>${translations.consentTitle || 'Einwilligung zur Datenverarbeitung'}</h2>
        <p style="color: #666; margin-bottom: 20px;">
            ${translations.consentIntro || 'Gem√§√ü Art. 6 und Art. 9 DSGVO ben√∂tigen wir Ihre ausdr√ºckliche Einwilligung f√ºr die folgenden Datenverarbeitungen:'}
        </p>
        
        <div id="consentCheckboxes" style="margin: 20px 0;">
            ${generateConsentCheckboxes(consentTypes, translations)}
        </div>
        
        <div style="margin: 20px 0; padding: 15px; background: #f5f5f5; border-left: 4px solid #2196F3;">
            <h3 style="margin-top: 0; font-size: 14px;">Ihre Rechte:</h3>
            <ul style="font-size: 13px; margin: 10px 0; padding-left: 20px;">
                <li>Widerrufsrecht (Art. 7 DSGVO)</li>
                <li>Auskunftsrecht (Art. 15 DSGVO)</li>
                <li>Berichtigungsrecht (Art. 16 DSGVO)</li>
                <li>L√∂schungsrecht (Art. 17 DSGVO)</li>
                <li>Einschr√§nkung der Verarbeitung (Art. 18 DSGVO)</li>
                <li>Daten√ºbertragbarkeit (Art. 20 DSGVO)</li>
                <li>Widerspruchsrecht (Art. 21 DSGVO)</li>
                <li>Beschwerderecht bei Aufsichtsbeh√∂rde (Art. 77 DSGVO)</li>
            </ul>
        </div>
        
        <div style="margin: 15px 0;">
            <label style="display: flex; align-items: start; font-size: 13px;">
                <input type="checkbox" id="confirmUnderstanding" style="margin-right: 10px; margin-top: 3px;">
                <span>Ich best√§tige, dass ich die Informationen zur Datenverarbeitung gelesen und verstanden habe.</span>
            </label>
        </div>
        
        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
            <button id="consentCancel" class="btn" style="background: #757575;">Abbrechen</button>
            <button id="consentAccept" class="btn" style="background: #4CAF50;" disabled>Einwilligung erteilen</button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Enable accept button only when understanding is confirmed
    const confirmCheckbox = document.getElementById('confirmUnderstanding');
    const acceptButton = document.getElementById('consentAccept');
    
    confirmCheckbox.addEventListener('change', () => {
        acceptButton.disabled = !confirmCheckbox.checked;
    });
    
    // Handle cancel
    document.getElementById('consentCancel').addEventListener('click', () => {
        document.body.removeChild(modal);
        callback({ granted: false });
    });
    
    // Handle accept
    document.getElementById('consentAccept').addEventListener('click', () => {
        const consents = {};
        consentTypes.forEach(type => {
            const checkbox = document.getElementById(`consent_${type}`);
            consents[type] = checkbox ? checkbox.checked : false;
        });
        
        document.body.removeChild(modal);
        callback({
            granted: true,
            consents: consents,
            details: {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                language: document.getElementById('language')?.value || 'de'
            }
        });
    });
}

// Generate consent checkbox HTML
function generateConsentCheckboxes(consentTypes, translations) {
    const checkboxes = [];
    
    consentTypes.forEach(type => {
        const label = getConsentLabel(type, translations);
        const description = getConsentDescription(type, translations);
        
        checkboxes.push(`
            <div style="margin: 15px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
                <label style="display: flex; align-items: start; cursor: pointer;">
                    <input type="checkbox" id="consent_${type}" style="margin-right: 10px; margin-top: 3px;">
                    <div>
                        <strong>${label}</strong>
                        <p style="margin: 5px 0 0 0; font-size: 13px; color: #666;">${description}</p>
                    </div>
                </label>
            </div>
        `);
    });
    
    return checkboxes.join('');
}

// Get consent label for type
function getConsentLabel(type, translations) {
    const labels = {
        [CONSENT_TYPES.DATA_EXPORT]: 'Export in Praxisverwaltungssystem',
        [CONSENT_TYPES.PATIENT_SYNC]: 'Patientendaten-Synchronisierung',
        [CONSENT_TYPES.FULL_NAME]: 'Verwendung von Name und Vorname',
        [CONSENT_TYPES.ADDRESS]: 'Verwendung von Adressdaten',
        [CONSENT_TYPES.CONTACT_DATA]: 'Verwendung von Kontaktdaten',
        [CONSENT_TYPES.MEDICAL_HISTORY]: 'Export medizinischer Anamnese-Daten',
        [CONSENT_TYPES.INSURANCE_DATA]: 'Verwendung von Versicherungsdaten',
        [CONSENT_TYPES.MEDICAL_CODES]: 'Export von ICD-10 Diagnose-Codes'
    };
    return labels[type] || type;
}

// Get consent description
function getConsentDescription(type, translations) {
    const descriptions = {
        [CONSENT_TYPES.DATA_EXPORT]: 'Export Ihrer Daten im GDT-Format zur √úbernahme in das Praxisverwaltungssystem (Medatixx, CGM, Quincy). Alle Daten verbleiben lokal.',
        [CONSENT_TYPES.PATIENT_SYNC]: 'Verkn√ºpfung Ihrer Anamnese-Daten mit Ihrer Patientenakte im Praxisverwaltungssystem.',
        [CONSENT_TYPES.FULL_NAME]: 'Ihr vollst√§ndiger Name wird in der exportierten Datei gespeichert. Alternativ: Pseudonymisierung.',
        [CONSENT_TYPES.ADDRESS]: 'Ihre Adressdaten (Stra√üe, PLZ, Ort, Land) werden exportiert.',
        [CONSENT_TYPES.CONTACT_DATA]: 'Ihre Kontaktdaten (Telefon, E-Mail) werden exportiert.',
        [CONSENT_TYPES.MEDICAL_HISTORY]: 'Ihre medizinischen Daten (Anamnese, Medikation, Allergien) werden exportiert.',
        [CONSENT_TYPES.INSURANCE_DATA]: 'Ihre Versicherungsdaten (Krankenkasse, Versichertennummer, Status) werden exportiert.',
        [CONSENT_TYPES.MEDICAL_CODES]: 'ICD-10 Diagnose-Codes werden im Export enthalten.'
    };
    return descriptions[type] || '';
}

// Store consent record
function storeConsentRecord(record) {
    const records = JSON.parse(localStorage.getItem('gdprConsentRecords') || '[]');
    records.push(record);
    localStorage.setItem('gdprConsentRecords', JSON.stringify(records));
    
    // Log consent action
    logConsentAction(record);
}

// Get consent records for patient
function getConsentRecords(patientId) {
    const records = JSON.parse(localStorage.getItem('gdprConsentRecords') || '[]');
    return records.filter(r => r.patientId === patientId);
}

// Check if consent is given for specific type
function hasConsent(patientId, consentType) {
    const records = getConsentRecords(patientId);
    const latestConsent = records
        .filter(r => r.consentType === consentType)
        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
    
    return latestConsent && latestConsent.granted;
}

// Withdraw consent
function withdrawConsent(patientId, consentType) {
    const record = createConsentRecord(patientId, consentType, false, {
        action: 'WITHDRAWAL',
        timestamp: new Date().toISOString()
    });
    
    storeConsentRecord(record);
    logConsentAction(record);
    
    return record;
}

// Log consent action
function logConsentAction(record) {
    const auditEntry = {
        timestamp: new Date().toISOString(),
        action: record.granted ? 'CONSENT_GRANTED' : 'CONSENT_WITHDRAWN',
        consentId: record.id,
        patientId: record.patientId,
        consentType: record.consentType,
        legalBasis: record.legalBasis
    };
    
    const auditLog = JSON.parse(localStorage.getItem('gdprAuditLog') || '[]');
    auditLog.push(auditEntry);
    localStorage.setItem('gdprAuditLog', JSON.stringify(auditLog));
}

// Generate processing record (Verarbeitungsverzeichnis Art. 30 DSGVO)
function generateProcessingRecord() {
    return {
        controller: {
            name: 'Arztpraxis [Name einzutragen]',
            address: '[Adresse einzutragen]',
            contact: '[Kontakt einzutragen]',
            dpo: '[Datenschutzbeauftragter einzutragen]'
        },
        purposes: [
            {
                purpose: PROCESSING_PURPOSES.MEDICAL_CARE,
                legalBasis: LEGAL_BASIS.CONSENT,
                dataCategories: [DATA_CATEGORIES.PERSONAL, DATA_CATEGORIES.HEALTH],
                dataSubjects: 'Patienten',
                recipients: [DATA_RECIPIENTS.PRACTICE, DATA_RECIPIENTS.PVS],
                storage: 'Lokale Speicherung gem√§√ü berufsrechtlicher Aufbewahrungspflichten',
                securityMeasures: [
                    'AES-256 Verschl√ºsselung',
                    'Lokale Datenspeicherung (keine Cloud)',
                    'Pseudonymisierung bei Export',
                    'Zugriffskontrolle',
                    'Audit-Logging',
                    'Einwilligungsmanagement'
                ],
                dataTransfer: 'Keine √úbermittlung in Drittl√§nder'
            }
        ],
        created: new Date().toISOString(),
        version: '1.0'
    };
}

// Export processing record as JSON
function exportProcessingRecord() {
    const record = generateProcessingRecord();
    const blob = new Blob([JSON.stringify(record, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `verarbeitungsverzeichnis_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Generate DPIA template (Datenschutz-Folgenabsch√§tzung Art. 35 DSGVO)
function generateDPIATemplate() {
    return {
        title: 'Datenschutz-Folgenabsch√§tzung (DSFA) - GDT-Export-Schnittstelle',
        date: new Date().toISOString().split('T')[0],
        description: 'Bewertung der Risiken bei der Implementierung der GDT-Export-Schnittstelle f√ºr medizinische Anamnese-Daten',
        
        dataProcessing: {
            description: 'Export von medizinischen Anamnese-Daten im GDT-Format zur √úbernahme in Praxisverwaltungssysteme',
            dataTypes: ['Personenbezogene Daten', 'Gesundheitsdaten (Art. 9 DSGVO)'],
            scope: 'Alle Patienten der Praxis',
            necessity: 'Medizinische Dokumentation und Behandlung',
            proportionality: 'Erforderlich f√ºr Behandlungsprozess'
        },
        
        risks: [
            {
                risk: 'Unbefugter Zugriff auf Gesundheitsdaten',
                likelihood: 'NIEDRIG',
                impact: 'HOCH',
                mitigation: [
                    'AES-256 Verschl√ºsselung',
                    'Lokale Speicherung (kein Cloud-Transfer)',
                    'Zugriffskontrolle',
                    'Pseudonymisierung'
                ]
            },
            {
                risk: 'Fehlerhafte Patientenzuordnung',
                likelihood: 'MITTEL',
                impact: 'HOCH',
                mitigation: [
                    'Eindeutige Patientenidentifikatoren',
                    'Validierung vor Export',
                    'Audit-Logging aller Exporte'
                ]
            },
            {
                risk: 'Export ohne g√ºltige Einwilligung',
                likelihood: 'NIEDRIG',
                impact: 'HOCH',
                mitigation: [
                    'Einwilligungsmanagement-System',
                    'Dokumentation aller Einwilligungen',
                    'Pr√ºfung vor jedem Export'
                ]
            }
        ],
        
        technicalMeasures: [
            'AES-256-GCM Verschl√ºsselung',
            'PBKDF2 Key Derivation (100.000 Iterationen)',
            'Lokale Datenspeicherung',
            'Pseudonymisierung sensitiver Daten',
            'Audit-Logging (Art. 30, 32 DSGVO)',
            'Einwilligungsmanagement',
            'GDT 3.0/3.1 Standard-Konformit√§t'
        ],
        
        organizationalMeasures: [
            'Schulung des Praxispersonals',
            'Zugriffsberechtigung nur f√ºr autorisiertes Personal',
            'Regelm√§√üige √úberpr√ºfung der Export-Konfiguration',
            'Dokumentation aller Datenverarbeitungen',
            'Datenschutzbeauftragten konsultieren',
            'Einwilligung vor jedem Export einholen'
        ],
        
        conclusion: {
            acceptable: true,
            residualRisk: 'NIEDRIG',
            approval: 'Freigabe durch Datenschutzbeauftragten erforderlich',
            nextReview: 'J√§hrlich oder bei wesentlichen √Ñnderungen'
        }
    };
}

// Export DPIA template
function exportDPIATemplate() {
    const dpia = generateDPIATemplate();
    const blob = new Blob([JSON.stringify(dpia, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `dsfa_gdt_export_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Get current translations (fallback function)
function getCurrentTranslations() {
    // Try to get from global translations object
    if (typeof translations !== 'undefined' && typeof currentLanguage !== 'undefined') {
        return translations[currentLanguage] || {};
    }
    return {};
}

// Export consent documentation
function exportConsentDocumentation(patientId) {
    const records = getConsentRecords(patientId);
    const blob = new Blob([JSON.stringify(records, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `einwilligungen_${patientId}_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// Initialize GDPR compliance module
if (typeof document !== 'undefined') {
    document.addEventListener('DOMContentLoaded', function() {
        console.log('GDPR Compliance Module initialized');
    });
}

        // ====================================================================
        // GDT BATCH EXPORT MODULE (INLINE)
        // ====================================================================
        // Batch export functionality for multiple patients
        // Optimized for large-scale data transfers
/**
 * GDT Batch Export Module
 * Provides batch export functionality for multiple patients
 * GDPR-compliant with individual consent checks
 */

class GDTBatchExport {
    constructor() {
        this.patients = [];
        this.exportProgress = {
            total: 0,
            completed: 0,
            failed: 0,
            cancelled: false
        };
    }

    /**
     * Initialize batch export with patient list
     * @param {Array} patients - List of patient objects
     */
    initialize(patients) {
        this.patients = patients.map(p => ({
            ...p,
            selected: false,
            hasConsent: this.checkPatientConsent(p),
            exportStatus: 'pending'
        }));
    }

    /**
     * Check if patient has required consent
     * @param {Object} patient - Patient data
     * @returns {boolean}
     */
    checkPatientConsent(patient) {
        const consentKey = `gdt_consent_${patient.id || patient.patientId}`;
        const consent = localStorage.getItem(consentKey);
        if (!consent) return false;
        
        try {
            const consentData = JSON.parse(consent);
            return consentData.dataExport && consentData.timestamp;
        } catch (e) {
            return false;
        }
    }

    /**
     * Get patients with consent
     * @returns {Array}
     */
    getPatientsWithConsent() {
        return this.patients.filter(p => p.hasConsent);
    }

    /**
     * Get selected patients
     * @returns {Array}
     */
    getSelectedPatients() {
        return this.patients.filter(p => p.selected);
    }

    /**
     * Select all patients with consent
     */
    selectAll() {
        this.patients.forEach(p => {
            if (p.hasConsent) {
                p.selected = true;
            }
        });
    }

    /**
     * Deselect all patients
     */
    selectNone() {
        this.patients.forEach(p => p.selected = false);
    }

    /**
     * Toggle patient selection
     * @param {string} patientId - Patient identifier
     */
    toggleSelection(patientId) {
        const patient = this.patients.find(p => 
            (p.id || p.patientId) === patientId
        );
        if (patient && patient.hasConsent) {
            patient.selected = !patient.selected;
        }
    }

    /**
     * Execute batch export
     * @param {string} mode - 'separate' or 'combined'
     * @param {Function} progressCallback - Called with progress updates
     * @returns {Promise<Object>} Export results
     */
    async executeBatchExport(mode = 'separate', progressCallback) {
        const selectedPatients = this.getSelectedPatients();
        
        if (selectedPatients.length === 0) {
            throw new Error('Keine Patienten ausgew√§hlt');
        }

        this.exportProgress = {
            total: selectedPatients.length,
            completed: 0,
            failed: 0,
            cancelled: false,
            startTime: new Date()
        };

        const results = {
            successful: [],
            failed: [],
            mode: mode
        };

        if (mode === 'separate') {
            // Export each patient to separate file
            for (const patient of selectedPatients) {
                if (this.exportProgress.cancelled) break;

                try {
                    await this.exportSinglePatient(patient);
                    patient.exportStatus = 'success';
                    results.successful.push(patient);
                    this.exportProgress.completed++;
                } catch (error) {
                    patient.exportStatus = 'failed';
                    patient.exportError = error.message;
                    results.failed.push({ patient, error: error.message });
                    this.exportProgress.failed++;
                }

                if (progressCallback) {
                    progressCallback(this.exportProgress);
                }
            }
        } else if (mode === 'combined') {
            // Export all patients to single file
            try {
                await this.exportCombinedFile(selectedPatients, progressCallback);
                selectedPatients.forEach(p => {
                    p.exportStatus = 'success';
                    results.successful.push(p);
                });
                this.exportProgress.completed = selectedPatients.length;
            } catch (error) {
                selectedPatients.forEach(p => {
                    p.exportStatus = 'failed';
                    p.exportError = error.message;
                    results.failed.push({ patient: p, error: error.message });
                });
                this.exportProgress.failed = selectedPatients.length;
            }

            if (progressCallback) {
                progressCallback(this.exportProgress);
            }
        }

        this.exportProgress.endTime = new Date();
        
        // Log batch export to audit
        this.logBatchExport(results);

        return results;
    }

    /**
     * Export single patient
     * @param {Object} patient - Patient data
     */
    async exportSinglePatient(patient) {
        // Use existing GDT export functionality
        if (typeof generateGDTContent !== 'function') {
            throw new Error('GDT Export Modul nicht verf√ºgbar');
        }

        const gdtContent = await generateGDTContent(patient);
        const filename = await generateGDTFilename(patient);

        // Use File System Access API
        if ('showSaveFilePicker' in window) {
            const handle = await window.showSaveFilePicker({
                suggestedName: filename,
                types: [{
                    description: 'GDT-Datei',
                    accept: { 'text/plain': ['.gdt'] }
                }]
            });

            const writable = await handle.createWritable();
            await writable.write(gdtContent);
            await writable.close();
        } else {
            // Fallback: download
            const blob = new Blob([gdtContent], { type: 'text/plain;charset=iso-8859-1' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
    }

    /**
     * Export combined file for all patients
     * @param {Array} patients - Patient list
     * @param {Function} progressCallback - Progress callback
     */
    async exportCombinedFile(patients, progressCallback) {
        let combinedContent = '';
        let processed = 0;

        for (const patient of patients) {
            if (this.exportProgress.cancelled) break;

            const gdtContent = await generateGDTContent(patient);
            combinedContent += gdtContent + '\r\n';
            
            processed++;
            this.exportProgress.completed = processed;
            
            if (progressCallback) {
                progressCallback(this.exportProgress);
            }
        }

        const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
        const filename = `GDT_Batch_${timestamp}.gdt`;

        // Use File System Access API
        if ('showSaveFilePicker' in window) {
            const handle = await window.showSaveFilePicker({
                suggestedName: filename,
                types: [{
                    description: 'GDT-Datei',
                    accept: { 'text/plain': ['.gdt'] }
                }]
            });

            const writable = await handle.createWritable();
            await writable.write(combinedContent);
            await writable.close();
        } else {
            // Fallback
            const blob = new Blob([combinedContent], { type: 'text/plain;charset=iso-8859-1' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }
    }

    /**
     * Cancel ongoing batch export
     */
    cancelExport() {
        this.exportProgress.cancelled = true;
    }

    /**
     * Log batch export to audit
     * @param {Object} results - Export results
     */
    logBatchExport(results) {
        if (typeof logGDTExport !== 'function') return;

        const duration = this.exportProgress.endTime - this.exportProgress.startTime;
        
        logGDTExport({
            action: 'batch_export',
            timestamp: new Date().toISOString(),
            patientsTotal: this.exportProgress.total,
            patientsSuccess: results.successful.length,
            patientsFailed: results.failed.length,
            mode: results.mode,
            duration: duration,
            cancelled: this.exportProgress.cancelled
        });
    }

    /**
     * Get batch export statistics
     * @returns {Object}
     */
    getStatistics() {
        return {
            totalPatients: this.patients.length,
            patientsWithConsent: this.getPatientsWithConsent().length,
            selectedPatients: this.getSelectedPatients().length,
            progress: this.exportProgress
        };
    }
}

// Create global instance
const gdtBatchExport = new GDTBatchExport();

        // ====================================================================
        // GDT AUDIT ENHANCED MODULE (INLINE)
        // ====================================================================
        // Enhanced audit logging for GDT operations
        // GDPR Art. 30, 32 compliant audit trail
// Enhanced Audit Functions Module
// CSV/PDF export, filtering, and statistics dashboard

// Export audit log to CSV format
function exportAuditLogCSV() {
    const auditLog = getAuditLog(1000); // Get last 1000 entries
    
    if (auditLog.length === 0) {
        return {
            success: false,
            message: 'Keine Audit-Log Eintr√§ge zum Exportieren vorhanden'
        };
    }
    
    // CSV headers
    const headers = ['Zeitstempel', 'Aktion', 'Dateiname', 'Patienten-ID', 'Pseudonymisiert', 'Einwilligung', 'Benutzer', 'Sprache'];
    
    // Convert audit entries to CSV rows
    const rows = auditLog.map(entry => [
        new Date(entry.timestamp).toLocaleString('de-DE'),
        entry.action,
        entry.filename || '',
        entry.patientId || '',
        entry.pseudonymized ? 'Ja' : 'Nein',
        entry.consentGiven ? 'Erteilt' : 'Nicht erteilt',
        entry.userAgent || '',
        entry.language || ''
    ]);
    
    // Build CSV content
    const csvContent = [headers, ...rows]
        .map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(';'))
        .join('\n');
    
    // Add BOM for proper Excel UTF-8 handling
    const BOM = '\uFEFF';
    const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `GDT_Audit_Log_${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    return {
        success: true,
        message: `Audit-Log mit ${auditLog.length} Eintr√§gen wurde als CSV exportiert`
    };
}

// Export audit log to JSON format
function exportAuditLogJSON() {
    const auditLog = getAuditLog(1000);
    
    if (auditLog.length === 0) {
        return {
            success: false,
            message: 'Keine Audit-Log Eintr√§ge zum Exportieren vorhanden'
        };
    }
    
    const exportData = {
        exportDate: new Date().toISOString(),
        totalEntries: auditLog.length,
        entries: auditLog,
        metadata: {
            version: '1.0',
            application: 'Anamnese-A GDT Export',
            gdprCompliant: true
        }
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `GDT_Audit_Log_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    return {
        success: true,
        message: `Audit-Log mit ${auditLog.length} Eintr√§gen wurde als JSON exportiert`
    };
}

// Filter audit log by date range
function filterAuditLogByDateRange(startDate, endDate) {
    const auditLog = getAuditLog(10000);
    
    const start = startDate ? new Date(startDate) : null;
    const end = endDate ? new Date(endDate) : null;
    
    return auditLog.filter(entry => {
        const entryDate = new Date(entry.timestamp);
        if (start && entryDate < start) return false;
        if (end && entryDate > end) return false;
        return true;
    });
}

// Filter audit log by action type
function filterAuditLogByAction(action) {
    const auditLog = getAuditLog(10000);
    return auditLog.filter(entry => entry.action === action);
}

// Get audit log statistics
function getAuditLogStatistics() {
    const auditLog = getAuditLog(10000);
    
    if (auditLog.length === 0) {
        return {
            totalExports: 0,
            pseudonymizedExports: 0,
            consentGivenExports: 0,
            lastExport: null,
            firstExport: null,
            exportsByDay: {},
            exportsByAction: {}
        };
    }
    
    const stats = {
        totalExports: auditLog.length,
        pseudonymizedExports: auditLog.filter(e => e.pseudonymized).length,
        consentGivenExports: auditLog.filter(e => e.consentGiven).length,
        lastExport: auditLog[auditLog.length - 1].timestamp,
        firstExport: auditLog[0].timestamp,
        exportsByDay: {},
        exportsByAction: {},
        exportsByMonth: {},
        uniquePatients: new Set(auditLog.map(e => e.patientId)).size
    };
    
    // Group by day
    auditLog.forEach(entry => {
        const date = new Date(entry.timestamp).toISOString().split('T')[0];
        stats.exportsByDay[date] = (stats.exportsByDay[date] || 0) + 1;
    });
    
    // Group by month
    auditLog.forEach(entry => {
        const month = new Date(entry.timestamp).toISOString().substring(0, 7);
        stats.exportsByMonth[month] = (stats.exportsByMonth[month] || 0) + 1;
    });
    
    // Group by action
    auditLog.forEach(entry => {
        stats.exportsByAction[entry.action] = (stats.exportsByAction[entry.action] || 0) + 1;
    });
    
    return stats;
}

// Generate audit statistics report HTML
function generateAuditStatsReport() {
    const stats = getAuditLogStatistics();
    
    if (stats.totalExports === 0) {
        return '<p style="text-align: center; color: #666;">Keine Daten f√ºr Statistiken vorhanden</p>';
    }
    
    const pseudoPercentage = Math.round((stats.pseudonymizedExports / stats.totalExports) * 100);
    const consentPercentage = Math.round((stats.consentGivenExports / stats.totalExports) * 100);
    
    // Last 7 days data
    const last7Days = Object.entries(stats.exportsByDay)
        .sort(([a], [b]) => b.localeCompare(a))
        .slice(0, 7)
        .reverse();
    
    const maxExportsPerDay = Math.max(...Object.values(stats.exportsByDay), 1);
    
    return `
        <div style="margin: 20px 0;">
            <h3 style="margin-top: 0;">√úbersicht</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 4px;">
                    <div style="font-size: 24px; font-weight: bold; color: #1976D2;">${stats.totalExports}</div>
                    <div style="font-size: 13px; color: #666;">Gesamt-Exporte</div>
                </div>
                <div style="background: #f3e5f5; padding: 15px; border-radius: 4px;">
                    <div style="font-size: 24px; font-weight: bold; color: #7B1FA2;">${stats.uniquePatients}</div>
                    <div style="font-size: 13px; color: #666;">Eindeutige Patienten</div>
                </div>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 4px;">
                    <div style="font-size: 24px; font-weight: bold; color: #388E3C;">${pseudoPercentage}%</div>
                    <div style="font-size: 13px; color: #666;">Pseudonymisiert</div>
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 4px;">
                    <div style="font-size: 24px; font-weight: bold; color: #F57C00;">${consentPercentage}%</div>
                    <div style="font-size: 13px; color: #666;">Mit Einwilligung</div>
                </div>
            </div>
        </div>
        
        <div style="margin: 30px 0;">
            <h3>Exporte der letzten 7 Tage</h3>
            <div style="background: #f5f5f5; padding: 15px; border-radius: 4px;">
                ${last7Days.length === 0 ? '<p style="text-align: center; color: #666;">Keine Daten</p>' : ''}
                ${last7Days.map(([date, count]) => `
                    <div style="margin: 10px 0;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span style="font-size: 13px;">${new Date(date).toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' })}</span>
                            <span style="font-weight: bold;">${count}</span>
                        </div>
                        <div style="background: #ddd; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: #2196F3; height: 100%; width: ${(count / maxExportsPerDay) * 100}%;"></div>
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
        
        <div style="margin: 30px 0;">
            <h3>Zeitraum</h3>
            <p style="font-size: 13px; color: #666;">
                <strong>Erster Export:</strong> ${new Date(stats.firstExport).toLocaleString('de-DE')}<br>
                <strong>Letzter Export:</strong> ${new Date(stats.lastExport).toLocaleString('de-DE')}
            </p>
        </div>
    `;
}

// Enhanced audit log viewer with filtering
function showEnhancedAuditLogViewer() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '900px';
    content.style.maxHeight = '90vh';
    content.style.overflowY = 'auto';
    
    const initialStats = generateAuditStatsReport();
    
    content.innerHTML = `
        <h2>Audit-Log & Statistiken</h2>
        
        <!-- Tab Navigation -->
        <div style="border-bottom: 2px solid #ddd; margin: 20px 0;">
            <button id="tabStats" class="tab-button active" style="padding: 10px 20px; border: none; background: none; cursor: pointer; border-bottom: 3px solid #2196F3; font-weight: bold;">
                üìä Statistiken
            </button>
            <button id="tabLog" class="tab-button" style="padding: 10px 20px; border: none; background: none; cursor: pointer; color: #666;">
                üìã Log-Eintr√§ge
            </button>
            <button id="tabFilter" class="tab-button" style="padding: 10px 20px; border: none; background: none; cursor: pointer; color: #666;">
                üîç Filter
            </button>
        </div>
        
        <!-- Statistics Tab -->
        <div id="statsContent" class="tab-content">
            ${initialStats}
        </div>
        
        <!-- Log Entries Tab -->
        <div id="logContent" class="tab-content" style="display: none;">
            <div id="logEntries"></div>
        </div>
        
        <!-- Filter Tab -->
        <div id="filterContent" class="tab-content" style="display: none;">
            <h3>Zeitraum-Filter</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 15px 0;">
                <div>
                    <label style="display: block; margin-bottom: 5px;">Von:</label>
                    <input type="date" id="filterStartDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px;">Bis:</label>
                    <input type="date" id="filterEndDate" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            </div>
            <button id="applyFilter" class="btn" style="background: #2196F3; color: white;">Filter anwenden</button>
            <button id="clearFilter" class="btn" style="background: #757575; color: white;">Filter zur√ºcksetzen</button>
            <div id="filterResults" style="margin-top: 20px;"></div>
        </div>
        
        <!-- Action Buttons -->
        <div style="display: flex; justify-content: space-between; margin-top: 20px; gap: 10px; flex-wrap: wrap;">
            <div>
                <button id="exportCSV" class="btn" style="background: #4CAF50; color: white; font-size: 13px;">
                    üì• CSV Export
                </button>
                <button id="exportJSON" class="btn" style="background: #2196F3; color: white; font-size: 13px;">
                    üì• JSON Export
                </button>
            </div>
            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                Schlie√üen
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // Tab switching
    const tabs = content.querySelectorAll('.tab-button');
    const tabContents = content.querySelectorAll('.tab-content');
    
    tabs.forEach((tab, index) => {
        tab.addEventListener('click', () => {
            tabs.forEach(t => {
                t.classList.remove('active');
                t.style.borderBottom = 'none';
                t.style.color = '#666';
                t.style.fontWeight = 'normal';
            });
            tabContents.forEach(tc => tc.style.display = 'none');
            
            tab.classList.add('active');
            tab.style.borderBottom = '3px solid #2196F3';
            tab.style.color = '#000';
            tab.style.fontWeight = 'bold';
            tabContents[index].style.display = 'block';
            
            // Load log entries when tab is activated
            if (index === 1 && !document.getElementById('logEntries').innerHTML) {
                loadLogEntries();
            }
        });
    });
    
    // Export handlers
    document.getElementById('exportCSV').addEventListener('click', () => {
        const result = exportAuditLogCSV();
        alert(result.message);
    });
    
    document.getElementById('exportJSON').addEventListener('click', () => {
        const result = exportAuditLogJSON();
        alert(result.message);
    });
    
    // Filter handlers
    document.getElementById('applyFilter').addEventListener('click', () => {
        const start = document.getElementById('filterStartDate').value;
        const end = document.getElementById('filterEndDate').value;
        const filtered = filterAuditLogByDateRange(start, end);
        
        document.getElementById('filterResults').innerHTML = `
            <div style="background: #e3f2fd; padding: 15px; border-radius: 4px;">
                <strong>${filtered.length} Eintr√§ge gefunden</strong> im Zeitraum 
                ${start ? new Date(start).toLocaleDateString('de-DE') : 'Anfang'} bis 
                ${end ? new Date(end).toLocaleDateString('de-DE') : 'Ende'}
            </div>
        `;
    });
    
    document.getElementById('clearFilter').addEventListener('click', () => {
        document.getElementById('filterStartDate').value = '';
        document.getElementById('filterEndDate').value = '';
        document.getElementById('filterResults').innerHTML = '';
    });
    
    function loadLogEntries() {
        const auditLog = getAuditLog(50);
        const logEntriesDiv = document.getElementById('logEntries');
        
        if (auditLog.length === 0) {
            logEntriesDiv.innerHTML = '<p style="text-align: center; color: #666;">Keine Audit-Log Eintr√§ge vorhanden</p>';
            return;
        }
        
        logEntriesDiv.innerHTML = auditLog.reverse().map(entry => `
            <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <strong>${entry.action}</strong>
                    <span style="color: #666; font-size: 12px;">${new Date(entry.timestamp).toLocaleString('de-DE')}</span>
                </div>
                ${entry.filename ? `<div style="font-size: 13px;"><strong>Datei:</strong> ${entry.filename}</div>` : ''}
                <div style="font-size: 13px;"><strong>Patient-ID:</strong> ${entry.patientId}</div>
                ${entry.pseudonymized !== undefined ? `<div style="font-size: 13px;"><strong>Pseudonymisiert:</strong> ${entry.pseudonymized ? 'Ja' : 'Nein'}</div>` : ''}
                ${entry.consentGiven !== undefined ? `<div style="font-size: 13px;"><strong>Einwilligung:</strong> ${entry.consentGiven ? 'Erteilt' : 'Nicht erteilt'}</div>` : ''}
            </div>
        `).join('');
    }
}

        // ====================================================================
        // GDT FEATURE DETECTION MODULE (INLINE)
        // ====================================================================
        // Detect and adapt to different practice system capabilities
        // Progressive enhancement for GDT features
// Browser Feature Detection and Offline Mode Indicator
// Detects required browser features and provides visual feedback

// Feature detection results
const browserFeatures = {
    fileSystemAccess: false,
    webCrypto: false,
    localStorage: false,
    indexedDB: false,
    serviceWorker: false,
    offlineSupport: false
};

// Check for File System Access API
function checkFileSystemAccess() {
    return 'showSaveFilePicker' in window || 'showOpenFilePicker' in window;
}

// Check for Web Crypto API
function checkWebCrypto() {
    return window.crypto && window.crypto.subtle !== undefined;
}

// Check for localStorage
function checkLocalStorage() {
    try {
        const test = '__localStorage_test__';
        localStorage.setItem(test, test);
        localStorage.removeItem(test);
        return true;
    } catch (e) {
        return false;
    }
}

// Check for IndexedDB
function checkIndexedDB() {
    return 'indexedDB' in window;
}

// Check for Service Worker support
function checkServiceWorker() {
    return 'serviceWorker' in navigator;
}

// Perform all feature checks
function detectBrowserFeatures() {
    browserFeatures.fileSystemAccess = checkFileSystemAccess();
    browserFeatures.webCrypto = checkWebCrypto();
    browserFeatures.localStorage = checkLocalStorage();
    browserFeatures.indexedDB = checkIndexedDB();
    browserFeatures.serviceWorker = checkServiceWorker();
    browserFeatures.offlineSupport = browserFeatures.serviceWorker && browserFeatures.localStorage;
    
    return browserFeatures;
}

// Get feature status for display
function getFeatureStatus() {
    const features = detectBrowserFeatures();
    
    return {
        critical: [
            { name: 'File System Access API', status: features.fileSystemAccess, description: 'F√ºr lokale Dateiauswahl' },
            { name: 'Web Crypto API', status: features.webCrypto, description: 'F√ºr SHA-256 Pseudonymisierung' },
            { name: 'Local Storage', status: features.localStorage, description: 'F√ºr Konfigurationsspeicherung' }
        ],
        optional: [
            { name: 'IndexedDB', status: features.indexedDB, description: 'F√ºr erweiterte Datenspeicherung' },
            { name: 'Service Worker', status: features.serviceWorker, description: 'F√ºr Offline-Funktionalit√§t' }
        ]
    };
}

// Check if all critical features are available
function checkCriticalFeatures() {
    const features = detectBrowserFeatures();
    const missing = [];
    
    if (!features.webCrypto) {
        missing.push('Web Crypto API (f√ºr Pseudonymisierung)');
    }
    if (!features.localStorage) {
        missing.push('Local Storage (f√ºr Konfiguration)');
    }
    
    return {
        isSupported: missing.length === 0,
        missingFeatures: missing,
        fileSystemFallback: !features.fileSystemAccess
    };
}

// Show feature detection dialog
function showFeatureDetectionDialog() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '700px';
    
    const status = getFeatureStatus();
    const criticalCheck = checkCriticalFeatures();
    
    content.innerHTML = `
        <h2>üîç Browser-Kompatibilit√§t</h2>
        
        ${!criticalCheck.isSupported ? `
            <div style="background: #ffebee; border-left: 4px solid #f44336; padding: 15px; margin: 15px 0;">
                <strong>‚ö†Ô∏è Kritische Features fehlen:</strong>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    ${criticalCheck.missingFeatures.map(f => `<li>${f}</li>`).join('')}
                </ul>
                <p style="margin: 0;">GDT-Export kann in diesem Browser nicht vollst√§ndig funktionieren.</p>
            </div>
        ` : `
            <div style="background: #e8f5e9; border-left: 4px solid #4CAF50; padding: 15px; margin: 15px 0;">
                <strong>‚úÖ Alle kritischen Features verf√ºgbar</strong>
                <p style="margin: 5px 0 0 0;">Ihr Browser unterst√ºtzt alle erforderlichen Funktionen f√ºr GDT-Export.</p>
            </div>
        `}
        
        ${criticalCheck.fileSystemFallback ? `
            <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin: 15px 0;">
                <strong>‚ÑπÔ∏è Hinweis:</strong> File System Access API nicht verf√ºgbar.
                <p style="margin: 5px 0 0 0;">Export verwendet Download-Fallback.</p>
            </div>
        ` : ''}
        
        <h3 style="margin-top: 20px;">Kritische Features</h3>
        <div style="margin: 10px 0;">
            ${status.critical.map(f => `
                <div style="display: flex; align-items: center; padding: 10px; margin: 5px 0; background: ${f.status ? '#f1f8f4' : '#fef5f5'}; border-radius: 4px;">
                    <span style="font-size: 24px; margin-right: 10px;">${f.status ? '‚úÖ' : '‚ùå'}</span>
                    <div style="flex: 1;">
                        <strong>${f.name}</strong>
                        <div style="font-size: 13px; color: #666;">${f.description}</div>
                    </div>
                </div>
            `).join('')}
        </div>
        
        <h3 style="margin-top: 20px;">Optionale Features</h3>
        <div style="margin: 10px 0;">
            ${status.optional.map(f => `
                <div style="display: flex; align-items: center; padding: 10px; margin: 5px 0; background: ${f.status ? '#f1f8f4' : '#f5f5f5'}; border-radius: 4px;">
                    <span style="font-size: 24px; margin-right: 10px;">${f.status ? '‚úÖ' : '‚ö™'}</span>
                    <div style="flex: 1;">
                        <strong>${f.name}</strong>
                        <div style="font-size: 13px; color: #666;">${f.description}</div>
                    </div>
                </div>
            `).join('')}
        </div>
        
        <div style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 4px; font-size: 13px;">
            <strong>Empfohlene Browser:</strong>
            <ul style="margin: 10px 0; padding-left: 20px;">
                <li>Google Chrome 86+ oder Microsoft Edge 86+</li>
                <li>Firefox 90+ (mit Download-Fallback)</li>
                <li>Safari 15.2+ (mit Download-Fallback)</li>
            </ul>
        </div>
        
        <div style="text-align: right; margin-top: 20px;">
            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                Schlie√üen
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
}

// Online/Offline status management
let onlineStatus = navigator.onLine;
let statusIndicator = null;

// Create status indicator element
function createStatusIndicator() {
    if (statusIndicator) return statusIndicator;
    
    statusIndicator = document.createElement('div');
    statusIndicator.id = 'connectionStatus';
    statusIndicator.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: bold;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 9999;
        transition: all 0.3s ease;
        cursor: pointer;
    `;
    
    updateStatusIndicator();
    document.body.appendChild(statusIndicator);
    
    // Click to show details
    statusIndicator.addEventListener('click', () => {
        showFeatureDetectionDialog();
    });
    
    return statusIndicator;
}

// Update status indicator appearance
function updateStatusIndicator() {
    if (!statusIndicator) return;
    
    if (onlineStatus) {
        statusIndicator.innerHTML = 'üü¢ Online';
        statusIndicator.style.background = '#4CAF50';
        statusIndicator.style.color = 'white';
    } else {
        statusIndicator.innerHTML = 'üî¥ Offline';
        statusIndicator.style.background = '#f44336';
        statusIndicator.style.color = 'white';
    }
}

// Show temporary notification
function showStatusNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        border-radius: 4px;
        font-size: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        z-index: 10000;
        animation: slideIn 0.3s ease;
    `;
    
    const colors = {
        info: { bg: '#2196F3', color: 'white' },
        success: { bg: '#4CAF50', color: 'white' },
        warning: { bg: '#ff9800', color: 'white' },
        error: { bg: '#f44336', color: 'white' }
    };
    
    const style = colors[type] || colors.info;
    notification.style.background = style.bg;
    notification.style.color = style.color;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// Initialize online/offline monitoring
function initializeStatusMonitoring() {
    // Initial status
    onlineStatus = navigator.onLine;
    
    // Create indicator
    createStatusIndicator();
    
    // Listen for online/offline events
    window.addEventListener('online', () => {
        onlineStatus = true;
        updateStatusIndicator();
        showStatusNotification('‚úÖ Verbindung wiederhergestellt', 'success');
        console.log('GDT Export: Online mode active');
    });
    
    window.addEventListener('offline', () => {
        onlineStatus = false;
        updateStatusIndicator();
        showStatusNotification('‚ö†Ô∏è Offline-Modus aktiv', 'warning');
        console.log('GDT Export: Offline mode active');
    });
    
    // Check features on load
    const criticalCheck = checkCriticalFeatures();
    if (!criticalCheck.isSupported) {
        setTimeout(() => {
            showStatusNotification('‚ö†Ô∏è Browser-Kompatibilit√§tsprobleme erkannt', 'warning');
        }, 1000);
    }
}

// Check if offline mode is supported
function isOfflineModeSupported() {
    return browserFeatures.offlineSupport;
}

// Get current connection status
function getConnectionStatus() {
    return {
        online: onlineStatus,
        features: browserFeatures,
        timestamp: new Date().toISOString()
    };
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(400px);
            opacity: 0;
        }
    }
    
    #connectionStatus:hover {
        transform: scale(1.05);
    }
`;
document.head.appendChild(style);

// Auto-initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeStatusMonitoring);
} else {
    initializeStatusMonitoring();
}

        // ====================================================================
        // GDT PERFORMANCE MODULE (INLINE)
        // ====================================================================
        // Performance monitoring and optimization for GDT operations
        // Tracks export times and data transfer efficiency
// Performance Optimization Module
// Configuration caching, optimized data processing, and performance monitoring

// Configuration cache
const configCache = {
    gdt: null,
    templates: null,
    lastUpdate: null,
    ttl: 5 * 60 * 1000 // 5 minutes cache TTL
};

// Performance metrics
const performanceMetrics = {
    exportTimes: [],
    validationTimes: [],
    pseudonymizationTimes: [],
    averageExportTime: 0,
    averageValidationTime: 0,
    averagePseudonymizationTime: 0
};

// Cache configuration
function cacheGDTConfig(config) {
    configCache.gdt = JSON.parse(JSON.stringify(config));
    configCache.lastUpdate = Date.now();
    
    // Also persist to localStorage
    try {
        localStorage.setItem('gdtExportConfig', JSON.stringify(config));
        localStorage.setItem('gdtConfigTimestamp', Date.now().toString());
    } catch (e) {
        console.warn('Failed to persist config to localStorage:', e);
    }
}

// Get cached configuration
function getCachedGDTConfig() {
    // Check memory cache first
    if (configCache.gdt && (Date.now() - configCache.lastUpdate) < configCache.ttl) {
        return configCache.gdt;
    }
    
    // Try localStorage
    try {
        const stored = localStorage.getItem('gdtExportConfig');
        const timestamp = parseInt(localStorage.getItem('gdtConfigTimestamp') || '0');
        
        if (stored && (Date.now() - timestamp) < configCache.ttl) {
            configCache.gdt = JSON.parse(stored);
            configCache.lastUpdate = timestamp;
            return configCache.gdt;
        }
    } catch (e) {
        console.warn('Failed to load config from localStorage:', e);
    }
    
    return null;
}

// Clear configuration cache
function clearConfigCache() {
    configCache.gdt = null;
    configCache.lastUpdate = null;
}

// Cache templates
function cacheTemplates(templates) {
    configCache.templates = templates;
    configCache.lastUpdate = Date.now();
}

// Get cached templates
function getCachedTemplates() {
    if (configCache.templates && (Date.now() - configCache.lastUpdate) < configCache.ttl) {
        return configCache.templates;
    }
    return null;
}

// Performance monitoring wrapper
function measurePerformance(fn, category) {
    return async function(...args) {
        const startTime = performance.now();
        try {
            const result = await fn.apply(this, args);
            const endTime = performance.now();
            const duration = endTime - startTime;
            
            // Record metric
            if (performanceMetrics[`${category}Times`]) {
                performanceMetrics[`${category}Times`].push(duration);
                
                // Keep only last 100 measurements
                if (performanceMetrics[`${category}Times`].length > 100) {
                    performanceMetrics[`${category}Times`].shift();
                }
                
                // Update average
                const times = performanceMetrics[`${category}Times`];
                performanceMetrics[`average${category.charAt(0).toUpperCase() + category.slice(1)}Time`] = 
                    times.reduce((a, b) => a + b, 0) / times.length;
            }
            
            // Log slow operations
            if (duration > 1000) {
                console.warn(`Slow ${category} operation: ${duration.toFixed(2)}ms`);
            }
            
            return result;
        } catch (error) {
            const endTime = performance.now();
            console.error(`${category} failed after ${(endTime - startTime).toFixed(2)}ms:`, error);
            throw error;
        }
    };
}

// Optimized batch processing
async function processBatch(items, processor, batchSize = 10) {
    const results = [];
    
    for (let i = 0; i < items.length; i += batchSize) {
        const batch = items.slice(i, i + batchSize);
        const batchResults = await Promise.all(batch.map(processor));
        results.push(...batchResults);
        
        // Allow UI to update between batches
        await new Promise(resolve => setTimeout(resolve, 0));
    }
    
    return results;
}

// Debounce function for reducing excessive calls
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Throttle function for rate limiting
function throttle(func, limit) {
    let inThrottle;
    return function(...args) {
        if (!inThrottle) {
            func.apply(this, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// Memoization for expensive computations
function memoize(fn) {
    const cache = new Map();
    return function(...args) {
        const key = JSON.stringify(args);
        if (cache.has(key)) {
            return cache.get(key);
        }
        const result = fn.apply(this, args);
        cache.set(key, result);
        
        // Limit cache size
        if (cache.size > 100) {
            const firstKey = cache.keys().next().value;
            cache.delete(firstKey);
        }
        
        return result;
    };
}

// Get performance statistics
function getPerformanceStats() {
    return {
        export: {
            average: performanceMetrics.averageExportTime.toFixed(2),
            count: performanceMetrics.exportTimes.length,
            min: Math.min(...performanceMetrics.exportTimes).toFixed(2),
            max: Math.max(...performanceMetrics.exportTimes).toFixed(2)
        },
        validation: {
            average: performanceMetrics.averageValidationTime.toFixed(2),
            count: performanceMetrics.validationTimes.length,
            min: Math.min(...performanceMetrics.validationTimes).toFixed(2),
            max: Math.max(...performanceMetrics.validationTimes).toFixed(2)
        },
        pseudonymization: {
            average: performanceMetrics.averagePseudonymizationTime.toFixed(2),
            count: performanceMetrics.pseudonymizationTimes.length,
            min: Math.min(...performanceMetrics.pseudonymizationTimes).toFixed(2),
            max: Math.max(...performanceMetrics.pseudonymizationTimes).toFixed(2)
        },
        cache: {
            gdtConfigCached: configCache.gdt !== null,
            templatesCached: configCache.templates !== null,
            lastUpdate: configCache.lastUpdate ? new Date(configCache.lastUpdate).toLocaleString('de-DE') : 'Nie'
        }
    };
}

// Show performance dashboard
function showPerformanceDashboard() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.style.display = 'block';
    
    const content = document.createElement('div');
    content.className = 'modal-content';
    content.style.maxWidth = '800px';
    
    const stats = getPerformanceStats();
    
    content.innerHTML = `
        <h2>‚ö° Performance-Statistiken</h2>
        
        <div style="margin: 20px 0;">
            <h3>Export-Performance</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 20px; font-weight: bold; color: #1976D2;">${stats.export.average}ms</div>
                    <div style="font-size: 13px; color: #666;">Durchschnitt</div>
                </div>
                <div style="background: #f3e5f5; padding: 15px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 20px; font-weight: bold; color: #7B1FA2;">${stats.export.min}ms</div>
                    <div style="font-size: 13px; color: #666;">Minimum</div>
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 20px; font-weight: bold; color: #F57C00;">${stats.export.max}ms</div>
                    <div style="font-size: 13px; color: #666;">Maximum</div>
                </div>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 20px; font-weight: bold; color: #388E3C;">${stats.export.count}</div>
                    <div style="font-size: 13px; color: #666;">Messungen</div>
                </div>
            </div>
        </div>
        
        <div style="margin: 20px 0;">
            <h3>Validierungs-Performance</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div style="background: #e3f2fd; padding: 15px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 20px; font-weight: bold; color: #1976D2;">${stats.validation.average}ms</div>
                    <div style="font-size: 13px; color: #666;">Durchschnitt</div>
                </div>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 4px; text-align: center;">
                    <div style="font-size: 20px; font-weight: bold; color: #388E3C;">${stats.validation.count}</div>
                    <div style="font-size: 13px; color: #666;">Messungen</div>
                </div>
            </div>
        </div>
        
        <div style="margin: 20px 0;">
            <h3>Cache-Status</h3>
            <div style="background: #f5f5f5; padding: 15px; border-radius: 4px;">
                <div style="margin: 5px 0;">
                    <strong>GDT-Konfiguration:</strong> 
                    <span style="color: ${stats.cache.gdtConfigCached ? '#4CAF50' : '#757575'};">
                        ${stats.cache.gdtConfigCached ? '‚úÖ Im Cache' : '‚ö™ Nicht gecacht'}
                    </span>
                </div>
                <div style="margin: 5px 0;">
                    <strong>Templates:</strong> 
                    <span style="color: ${stats.cache.templatesCached ? '#4CAF50' : '#757575'};">
                        ${stats.cache.templatesCached ? '‚úÖ Im Cache' : '‚ö™ Nicht gecacht'}
                    </span>
                </div>
                <div style="margin: 5px 0;">
                    <strong>Letzte Aktualisierung:</strong> ${stats.cache.lastUpdate}
                </div>
            </div>
        </div>
        
        <div style="margin: 20px 0;">
            <h3>Optimierungsempfehlungen</h3>
            <ul style="font-size: 13px; color: #666; padding-left: 20px;">
                ${parseFloat(stats.export.average) > 500 ? 
                    '<li>‚ö†Ô∏è Export-Zeit √ºber 500ms - Pr√ºfen Sie die Datenmenge</li>' : 
                    '<li>‚úÖ Export-Performance optimal</li>'}
                ${!stats.cache.gdtConfigCached ? 
                    '<li>üí° Konfiguration wird bei jedem Export neu geladen</li>' : 
                    '<li>‚úÖ Konfiguration wird gecacht</li>'}
                ${stats.export.count < 10 ? 
                    '<li>‚ÑπÔ∏è Noch wenige Messungen f√ºr pr√§zise Statistiken</li>' : 
                    '<li>‚úÖ Ausreichend Messungen f√ºr valide Statistiken</li>'}
            </ul>
        </div>
        
        <div style="text-align: right; margin-top: 20px;">
            <button class="btn" style="background: #757575; color: white; margin-right: 10px;" onclick="clearConfigCache(); this.closest('.modal').remove(); alert('Cache geleert');">
                Cache leeren
            </button>
            <button class="btn btn-primary" onclick="this.closest('.modal').remove()">
                Schlie√üen
            </button>
        </div>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
}

// Auto-initialize performance monitoring
if (typeof gdtExportConfig !== 'undefined') {
    // Wrap update function with caching
    const originalUpdate = typeof updateGDTConfig !== 'undefined' ? updateGDTConfig : null;
    if (originalUpdate) {
        window.updateGDTConfig = function(config) {
            const result = originalUpdate.call(this, config);
            cacheGDTConfig(config);
            return result;
        };
    }
}

// Export functions for global use
window.performanceOptimization = {
    measurePerformance,
    processBatch,
    debounce,
    throttle,
    memoize,
    getPerformanceStats,
    showPerformanceDashboard,
    cacheGDTConfig,
    getCachedGDTConfig,
    clearConfigCache
};

console.log('GDT Performance Optimization module loaded');

        // ====================================================================
        // REPOSITORY ANALYSIS DATA
        // ====================================================================
        // Comprehensive repository analysis with file grouping, relationships, and improvements
        window.REPO_ANALYSIS_DATA = {
            "version": "1.0.0",
            "generatedAt": "2025-12-24T04:57:00.000Z",
            "groups": {
                "frontend-pwa": {
                    "name": "Frontend / PWA",
                    "description": "Main application UI and Progressive Web App components",
                    "files": [
                        {
                            "filename": "index_v8_complete.html",
                            "description": "Main application - Complete v8 with all features (812KB)",
                            "purpose": "Primary UI with inline OCR, GDPR, multi-language, PWA",
                            "relationships": ["manifest.json", "sw.js", "translations.js"],
                            "improvements": {
                                "security": "Large file - consider code splitting for CSP",
                                "maintainability": "Single-file makes updates difficult",
                                "performance": "812KB load - lazy load non-critical features",
                                "offline": "‚úì Excellent - fully self-contained",
                                "structure": "Split into modules (GDT, OCR, encryption)"
                            }
                        },
                        {
                            "filename": "anamnese-single-file.html",
                            "description": "Alternative single-file version (633KB)",
                            "purpose": "Standalone version with core features",
                            "relationships": ["index_v8_complete.html"],
                            "improvements": {
                                "maintainability": "Consolidate with index_v8_complete.html",
                                "structure": "Document differences clearly"
                            }
                        },
                        {
                            "filename": "index_v7_no_vosk.html",
                            "description": "Version 7 without Vosk (669KB)",
                            "purpose": "Lighter version without voice input",
                            "relationships": ["index_v8_complete.html"],
                            "improvements": {
                                "maintainability": "Consider deprecating as legacy"
                            }
                        },
                        {
                            "filename": "index.html",
                            "description": "Entry point HTML (12KB)",
                            "purpose": "Entry point or simple redirect",
                            "relationships": ["app.js", "styles.css", "manifest.json"],
                            "improvements": {
                                "structure": "Clarify vs index_v8_complete.html"
                            }
                        },
                        {
                            "filename": "demo-standalone.html",
                            "description": "Standalone demo (42KB)",
                            "purpose": "Demo version for testing",
                            "relationships": [],
                            "improvements": {
                                "structure": "Document when to use vs full"
                            }
                        },
                        {
                            "filename": "admin_dashboard.html",
                            "description": "Admin dashboard (60KB)",
                            "purpose": "Practice management interface",
                            "relationships": ["server.js"],
                            "improvements": {
                                "security": "Ensure proper authentication"
                            }
                        },
                        {
                            "filename": "app.js",
                            "description": "Main app JavaScript (7KB)",
                            "purpose": "Core logic and initialization",
                            "relationships": ["index.html"],
                            "improvements": {
                                "structure": "Clarify vs inline scripts"
                            }
                        },
                        {
                            "filename": "translations.js",
                            "description": "19-language translations (29KB)",
                            "purpose": "Multi-language support",
                            "relationships": ["index_v8_complete.html"],
                            "improvements": {
                                "structure": "Consider JSON format",
                                "maintainability": "Split by language"
                            }
                        },
                        {
                            "filename": "sw.js",
                            "description": "Service Worker (4KB)",
                            "purpose": "Offline caching and PWA",
                            "relationships": ["manifest.json", "index_v8_complete.html"],
                            "improvements": {
                                "offline": "‚úì Excellent",
                                "structure": "Cache versioning strategy"
                            }
                        },
                        {
                            "filename": "manifest.json",
                            "description": "PWA manifest",
                            "purpose": "PWA config (icons, theme)",
                            "relationships": ["sw.js"],
                            "improvements": {
                                "structure": "Ensure all icon sizes"
                            }
                        },
                        {
                            "filename": "styles.css",
                            "description": "Global styles (6KB)",
                            "purpose": "Shared CSS",
                            "relationships": ["index.html"],
                            "improvements": {
                                "structure": "Consider CSS modules"
                            }
                        }
                    ]
                },
                "server": {
                    "name": "Server / Backend",
                    "description": "Node.js Express server and API",
                    "files": [
                        {
                            "filename": "server.js",
                            "description": "Express server (12KB)",
                            "purpose": "Backend API, payment, code gen",
                            "relationships": ["admin_dashboard.html", "package.json"],
                            "improvements": {
                                "security": "Review rate limiting",
                                "structure": "Environment config"
                            }
                        }
                    ]
                },
                "gdt": {
                    "name": "GDT Export/Import",
                    "description": "Medical data exchange for practice systems",
                    "files": [
                        {
                            "filename": "gdt-export.js",
                            "description": "GDT export (24KB)",
                            "purpose": "Export in GDT format",
                            "relationships": ["gdt-export-ui.js", "gdt-export-templates.js"],
                            "improvements": {
                                "structure": "‚úì Well-modularized",
                                "offline": "‚úì Fully client-side"
                            }
                        },
                        {
                            "filename": "gdt-import.js",
                            "description": "GDT import (10KB)",
                            "purpose": "Import from GDT files",
                            "relationships": ["gdt-export.js"],
                            "improvements": {
                                "security": "Validate imported data",
                                "structure": "‚úì Good separation"
                            }
                        },
                        {
                            "filename": "gdt-export-ui.js",
                            "description": "GDT UI (41KB)",
                            "purpose": "Export configuration UI",
                            "relationships": ["gdt-export.js"],
                            "improvements": {
                                "offline": "‚úì Fully client-side"
                            }
                        },
                        {
                            "filename": "gdt-export-templates.js",
                            "description": "GDT templates (12KB)",
                            "purpose": "GDT version templates",
                            "relationships": ["gdt-export.js"],
                            "improvements": {
                                "structure": "‚úì Well-organized"
                            }
                        },
                        {
                            "filename": "gdt-encrypted-export.js",
                            "description": "Encrypted GDT (23KB)",
                            "purpose": "GDT + AES-256 encryption",
                            "relationships": ["gdt-export.js", "encryption.js"],
                            "improvements": {
                                "security": "‚úì Excellent combination"
                            }
                        },
                        {
                            "filename": "gdt-batch-export.js",
                            "description": "Batch export (9KB)",
                            "purpose": "Multi-patient GDT export",
                            "relationships": ["gdt-export.js"],
                            "improvements": {
                                "performance": "Stream large batches"
                            }
                        },
                        {
                            "filename": "gdt-audit-enhanced.js",
                            "description": "GDT audit (16KB)",
                            "purpose": "GDPR audit trail for GDT",
                            "relationships": ["gdt-export.js", "gdpr-compliance.js"],
                            "improvements": {
                                "offline": "‚úì Local audit logging"
                            }
                        },
                        {
                            "filename": "gdt-feature-detection.js",
                            "description": "Feature detection (11KB)",
                            "purpose": "Adapt to practice systems",
                            "relationships": ["gdt-export.js"],
                            "improvements": {
                                "structure": "‚úì Progressive enhancement"
                            }
                        },
                        {
                            "filename": "gdt-performance.js",
                            "description": "Performance monitoring (13KB)",
                            "purpose": "GDT performance tracking",
                            "relationships": ["gdt-export.js"],
                            "improvements": {
                                "performance": "‚úì Dedicated monitoring"
                            }
                        }
                    ]
                },
                "ocr-gdpr": {
                    "name": "OCR & GDPR",
                    "description": "Document scanning and data protection",
                    "files": [
                        {
                            "filename": "ocr-gdpr-module.js",
                            "description": "GDPR OCR module (44KB)",
                            "purpose": "Local OCR via Tesseract.js",
                            "relationships": ["gdpr-compliance.js"],
                            "improvements": {
                                "security": "‚úì No external APIs",
                                "offline": "‚úì Fully local",
                                "performance": "Use Web Workers"
                            }
                        },
                        {
                            "filename": "gdpr-compliance.js",
                            "description": "GDPR utilities (18KB)",
                            "purpose": "Art. 13, 17, 30, 32 DSGVO",
                            "relationships": ["ocr-gdpr-module.js"],
                            "improvements": {
                                "security": "‚úì Comprehensive GDPR",
                                "structure": "‚úì Well-documented"
                            }
                        }
                    ]
                },
                "encryption": {
                    "name": "Security & Encryption",
                    "description": "AES-256 encryption and security",
                    "files": [
                        {
                            "filename": "encryption.js",
                            "description": "AES-256-GCM (7KB)",
                            "purpose": "Web Crypto API encryption",
                            "relationships": ["gdt-encrypted-export.js"],
                            "improvements": {
                                "security": "‚úì Web Crypto API",
                                "structure": "Add PBKDF2 for passwords"
                            }
                        }
                    ]
                },
                "ai": {
                    "name": "AI & Validation",
                    "description": "Local AI validation",
                    "files": [
                        {
                            "filename": "ai-plausibility-check.js",
                            "description": "AI validation (23KB)",
                            "purpose": "Rule-based medical validation",
                            "relationships": ["test-ai-plausibility.html"],
                            "improvements": {
                                "offline": "‚úì Fully local rules",
                                "structure": "‚úì No external AI"
                            }
                        }
                    ]
                },
                "vosk": {
                    "name": "Voice Recognition",
                    "description": "Local speech-to-text",
                    "files": [
                        {
                            "filename": "vosk-integration.js",
                            "description": "Vosk integration (8KB)",
                            "purpose": "Local speech-to-text (50MB)",
                            "relationships": ["vosk-worker.js"],
                            "improvements": {
                                "offline": "‚úì Local recognition",
                                "performance": "Lazy load 50MB model",
                                "structure": "‚úì Uses Web Workers"
                            }
                        },
                        {
                            "filename": "vosk-worker.js",
                            "description": "Vosk Worker (3KB)",
                            "purpose": "Background Vosk processing",
                            "relationships": ["vosk-integration.js"],
                            "improvements": {
                                "performance": "‚úì Prevents UI blocking"
                            }
                        }
                    ]
                },
                "tests": {
                    "name": "Tests",
                    "description": "Test files and documentation",
                    "files": [
                        {
                            "filename": "test-ai-plausibility.html",
                            "description": "AI tests (20KB)",
                            "purpose": "Test AI validation rules",
                            "relationships": ["ai-plausibility-check.js"],
                            "improvements": {
                                "structure": "‚úì Good test coverage"
                            }
                        },
                        {
                            "filename": "test-gdt-export.html",
                            "description": "GDT test UI (5KB)",
                            "purpose": "Visual GDT testing",
                            "relationships": ["test-gdt-export.js", "gdt-export.js"],
                            "improvements": {
                                "structure": "‚úì Visual testing"
                            }
                        },
                        {
                            "filename": "test-gdt-export.js",
                            "description": "GDT tests (11KB)",
                            "purpose": "Automated GDT tests",
                            "relationships": ["gdt-export.js"],
                            "improvements": {
                                "structure": "‚úì Good coverage"
                            }
                        },
                        {
                            "filename": "test-basic.js",
                            "description": "Basic tests (5KB)",
                            "purpose": "Core feature testing",
                            "relationships": [],
                            "improvements": {
                                "structure": "Expand coverage"
                            }
                        },
                        {
                            "filename": "test-integration.js",
                            "description": "Integration tests (13KB)",
                            "purpose": "End-to-end testing",
                            "relationships": [],
                            "improvements": {
                                "structure": "‚úì Good integration"
                            }
                        },
                        {
                            "filename": "test-standalone-demo.js",
                            "description": "Demo tests (5KB)",
                            "purpose": "Demo version tests",
                            "relationships": ["demo-standalone.html"],
                            "improvements": {
                                "structure": "‚úì Demo validation"
                            }
                        },
                        {
                            "filename": "test_anamnese.html",
                            "description": "Anamnese tests (18KB)",
                            "purpose": "Questionnaire testing",
                            "relationships": [],
                            "improvements": {
                                "structure": "Visual test interface"
                            }
                        },
                        {
                            "filename": "test_document_upload.html",
                            "description": "Upload tests (8KB)",
                            "purpose": "Document upload/OCR testing",
                            "relationships": ["ocr-gdpr-module.js"],
                            "improvements": {
                                "structure": "‚úì OCR feature tests"
                            }
                        },
                        {
                            "filename": "test_ocr_gdpr.html",
                            "description": "GDPR tests (15KB)",
                            "purpose": "GDPR compliance testing",
                            "relationships": ["ocr-gdpr-module.js"],
                            "improvements": {
                                "structure": "‚úì Compliance validation"
                            }
                        }
                    ]
                },
                "deployment": {
                    "name": "Deployment",
                    "description": "Deployment configs and infrastructure",
                    "files": [
                        {
                            "filename": "Dockerfile",
                            "description": "Docker container",
                            "purpose": "Containerization",
                            "relationships": ["docker-compose.yml", "server.js"],
                            "improvements": {
                                "security": "Review base image",
                                "structure": "Multi-stage build"
                            }
                        },
                        {
                            "filename": "docker-compose.yml",
                            "description": "Docker Compose",
                            "purpose": "Multi-container orchestration",
                            "relationships": ["Dockerfile"],
                            "improvements": {
                                "structure": "‚úì Local development"
                            }
                        },
                        {
                            "filename": "vercel.json",
                            "description": "Vercel config",
                            "purpose": "Serverless deployment",
                            "relationships": ["server.js"],
                            "improvements": {
                                "structure": "‚úì Easy deployment"
                            }
                        },
                        {
                            "filename": "render.yaml",
                            "description": "Render config",
                            "purpose": "Render.com deployment",
                            "relationships": ["server.js"],
                            "improvements": {
                                "structure": "Alternative option"
                            }
                        },
                        {
                            "filename": "fly.toml",
                            "description": "Fly.io config",
                            "purpose": "Edge deployment",
                            "relationships": ["Dockerfile"],
                            "improvements": {
                                "structure": "‚úì Global edge"
                            }
                        },
                        {
                            "filename": "package.json",
                            "description": "NPM config",
                            "purpose": "Dependencies and scripts",
                            "relationships": ["server.js", "setup.js"],
                            "improvements": {
                                "security": "Run npm audit",
                                "maintainability": "Update deps"
                            }
                        },
                        {
                            "filename": ".eslintrc.json",
                            "description": "ESLint config",
                            "purpose": "Code quality rules",
                            "relationships": [],
                            "improvements": {
                                "structure": "‚úì Good tooling"
                            }
                        },
                        {
                            "filename": ".gitignore",
                            "description": "Git ignore",
                            "purpose": "Version control exclusions",
                            "relationships": [],
                            "improvements": {
                                "structure": "‚úì Standard patterns"
                            }
                        },
                        {
                            "filename": ".env.example",
                            "description": "Environment template",
                            "purpose": "Config template",
                            "relationships": ["server.js"],
                            "improvements": {
                                "security": "‚úì No secrets in repo"
                            }
                        },
                        {
                            "filename": "setup.js",
                            "description": "Setup script (5KB)",
                            "purpose": "Initial setup",
                            "relationships": ["package.json"],
                            "improvements": {
                                "structure": "Document requirements"
                            }
                        }
                    ]
                },
                "docs": {
                    "name": "Documentation",
                    "description": "README and technical docs",
                    "files": [
                        { "filename": "README.md", "description": "Main project documentation" },
                        { "filename": "PROJECT_SUMMARY.md", "description": "Project overview" },
                        { "filename": "QUICK_START.md", "description": "Quick start guide" },
                        { "filename": "INSTALLATION.md", "description": "Installation instructions" },
                        { "filename": "SETUP.md", "description": "Setup guide" },
                        { "filename": "DEPLOYMENT.md", "description": "Deployment instructions" },
                        { "filename": "DEPLOYMENT_GUIDE.md", "description": "Detailed deployment" },
                        { "filename": "DEPLOYMENT_FREE_HOSTING.md", "description": "Free hosting guide" },
                        { "filename": "DSGVO_OCR_COMPLIANCE.md", "description": "GDPR OCR compliance" },
                        { "filename": "GDPR_EXPORT_DOCUMENTATION.md", "description": "GDPR export docs" },
                        { "filename": "OCR_GDPR_IMPLEMENTATION.md", "description": "OCR implementation" },
                        { "filename": "GDT_EXPORT_README.md", "description": "GDT export docs" },
                        { "filename": "PWA_FEATURES.md", "description": "PWA features" },
                        { "filename": "AI_IMPLEMENTATION_SUMMARY.md", "description": "AI implementation" },
                        { "filename": "AI_TECHNICAL_DOCUMENTATION.md", "description": "AI technical docs" },
                        { "filename": "AI_PRIVACY_IMPACT_ASSESSMENT.md", "description": "AI privacy impact" },
                        { "filename": "BFDI_CHECKLIST.md", "description": "Data protection checklist" },
                        { "filename": "PRAXIS_CODE_GENERATOR_README.md", "description": "Code generator docs" },
                        { "filename": "ADMIN_DASHBOARD_README.md", "description": "Admin dashboard docs" },
                        { "filename": "TEST_DOCUMENTATION.md", "description": "Test documentation" },
                        { "filename": "CHANGELOG.md", "description": "Version history" },
                        { "filename": "VISUAL_GUIDE.md", "description": "Visual guide" }
                    ]
                },
                "assets": {
                    "name": "Assets & Binary",
                    "description": "Binary files and static assets",
                    "files": [
                        {
                            "filename": "fragebogen_auflistung excel.xlsx",
                            "description": "Questionnaire Excel (173KB)",
                            "purpose": "Spreadsheet documentation",
                            "relationships": [],
                            "improvements": {
                                "maintainability": "Verify still needed",
                                "structure": "Move to /docs folder"
                            }
                        },
                        {
                            "filename": "Fragebogen_Struktur txt.odt",
                            "description": "Questionnaire ODT (53KB)",
                            "purpose": "OpenDocument format",
                            "relationships": [],
                            "improvements": {
                                "maintainability": "Verify still needed"
                            }
                        },
                        {
                            "filename": "HTMLBASIS",
                            "description": "HTML basis (770KB)",
                            "purpose": "Base template or reference",
                            "relationships": [],
                            "improvements": {
                                "maintainability": "Document purpose"
                            }
                        },
                        {
                            "filename": "gemini.txt",
                            "description": "Large text file (638KB)",
                            "purpose": "AI output or reference",
                            "relationships": [],
                            "improvements": {
                                "structure": "Move to /docs if needed"
                            }
                        },
                        {
                            "filename": "model/",
                            "description": "Vosk model directory (~50MB)",
                            "purpose": "Speech recognition models",
                            "relationships": ["vosk-integration.js"],
                            "improvements": {
                                "performance": "Lazy load models"
                            }
                        },
                        {
                            "filename": "public/",
                            "description": "Public static files",
                            "purpose": "Static assets",
                            "relationships": ["public/index.html", "public/js/app.js"],
                            "improvements": {
                                "structure": "‚úì Standard structure"
                            }
                        },
                        {
                            "filename": "database/",
                            "description": "Database files",
                            "purpose": "DB schemas and files",
                            "relationships": ["server.js"],
                            "improvements": {
                                "structure": "Document schema"
                            }
                        }
                    ]
                }
            }
        };

        // ====================================================================
        // REPOSITORY ANALYSIS UI CONTROLLER
        // ====================================================================
        window.RepoAnalysis = {
            currentFilter: '',
            currentSearch: '',
            currentFile: null,

            /**
             * Open the repository analysis modal
             */
            open() {
                const modal = document.getElementById('repo-analysis-modal');
                if (modal) {
                    modal.style.display = 'flex';
                    this.initialize();
                }
            },

            /**
             * Close the repository analysis modal
             */
            close() {
                const modal = document.getElementById('repo-analysis-modal');
                if (modal) {
                    modal.style.display = 'none';
                }
                this.closeDetail();
            },

            /**
             * Initialize the analysis UI
             */
            initialize() {
                this.populateGroupFilter();
                this.updateStatistics();
                this.renderFileList();
            },

            /**
             * Populate group filter dropdown
             */
            populateGroupFilter() {
                const filter = document.getElementById('repo-filter');
                if (!filter) return;

                // Clear existing options except the first one
                while (filter.options.length > 1) {
                    filter.remove(1);
                }

                // Add group options
                const data = window.REPO_ANALYSIS_DATA;
                Object.keys(data.groups).forEach(groupKey => {
                    const group = data.groups[groupKey];
                    const option = document.createElement('option');
                    option.value = groupKey;
                    option.textContent = `${this.getGroupIcon(groupKey)} ${group.name} (${group.files.length})`;
                    filter.appendChild(option);
                });
            },

            /**
             * Get icon for group
             */
            getGroupIcon(groupKey) {
                const icons = {
                    'frontend-pwa': 'üé®',
                    'server': 'üñ•Ô∏è',
                    'gdt': 'üè•',
                    'ocr-gdpr': 'üîí',
                    'encryption': 'üîê',
                    'ai': 'ü§ñ',
                    'vosk': 'üé§',
                    'tests': 'üß™',
                    'deployment': 'üöÄ',
                    'docs': 'üìö',
                    'assets': 'üì¶'
                };
                return icons[groupKey] || 'üìÅ';
            },

            /**
             * Update statistics display
             */
            updateStatistics() {
                const statsDiv = document.getElementById('repo-stats');
                if (!statsDiv) return;

                const data = window.REPO_ANALYSIS_DATA;
                let totalFiles = 0;
                let totalGroups = Object.keys(data.groups).length;

                Object.values(data.groups).forEach(group => {
                    totalFiles += group.files.length;
                });

                statsDiv.innerHTML = `
                    <div style="padding: 0.75rem; background: var(--primary); color: white; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalFiles}</div>
                        <div style="font-size: 0.8rem;">Total Files</div>
                    </div>
                    <div style="padding: 0.75rem; background: var(--success); color: white; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;">${totalGroups}</div>
                        <div style="font-size: 0.8rem;">Groups</div>
                    </div>
                    <div style="padding: 0.75rem; background: var(--info); color: white; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: bold;">‚úì</div>
                        <div style="font-size: 0.8rem;">100% Offline</div>
                    </div>
                `;
            },

            /**
             * Filter files by group
             */
            filterByGroup(groupKey) {
                this.currentFilter = groupKey;
                this.renderFileList();
            },

            /**
             * Search files by name
             */
            search(query) {
                this.currentSearch = query.toLowerCase();
                this.renderFileList();
            },

            /**
             * Render file list
             */
            renderFileList() {
                const listDiv = document.getElementById('repo-file-list');
                if (!listDiv) return;

                const data = window.REPO_ANALYSIS_DATA;
                let html = '';

                Object.keys(data.groups).forEach(groupKey => {
                    // Skip if filtered and doesn't match
                    if (this.currentFilter && this.currentFilter !== groupKey) {
                        return;
                    }

                    const group = data.groups[groupKey];
                    const filteredFiles = group.files.filter(file => {
                        if (!this.currentSearch) return true;
                        return file.filename.toLowerCase().includes(this.currentSearch) ||
                               (file.description && file.description.toLowerCase().includes(this.currentSearch));
                    });

                    if (filteredFiles.length === 0) return;

                    html += `
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="color: var(--primary); margin-bottom: 0.75rem; font-size: 1.1rem;">
                                ${this.getGroupIcon(groupKey)} ${group.name}
                            </h3>
                            <p style="color: var(--secondary); font-size: 0.85rem; margin-bottom: 0.75rem;">
                                ${group.description}
                            </p>
                            <div style="display: grid; gap: 0.5rem;">
                    `;

                    filteredFiles.forEach(file => {
                        html += `
                            <div onclick="RepoAnalysis.showDetail('${groupKey}', '${this.escapeHtml(file.filename)}')"
                                 style="padding: 0.75rem; background: var(--bg-color); border-radius: 8px; cursor: pointer; border: 1px solid var(--secondary); transition: all 0.2s;"
                                 onmouseover="this.style.borderColor='var(--primary)'; this.style.transform='translateX(4px)';"
                                 onmouseout="this.style.borderColor='var(--secondary)'; this.style.transform='translateX(0)';">
                                <div style="font-weight: bold; color: var(--text); margin-bottom: 0.25rem;">
                                    üìÑ ${this.escapeHtml(file.filename)}
                                </div>
                                <div style="font-size: 0.85rem; color: var(--secondary);">
                                    ${this.escapeHtml(file.description || file.purpose || 'Click for details')}
                                </div>
                            </div>
                        `;
                    });

                    html += `
                            </div>
                        </div>
                    `;
                });

                if (html === '') {
                    html = `
                        <div style="text-align: center; padding: 2rem; color: var(--secondary);">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                            <div style="font-size: 1.1rem;">No files found matching your criteria</div>
                        </div>
                    `;
                }

                listDiv.innerHTML = html;
            },

            /**
             * Show file detail view
             */
            showDetail(groupKey, filename) {
                const data = window.REPO_ANALYSIS_DATA;
                const group = data.groups[groupKey];
                const file = group.files.find(f => f.filename === filename);
                
                if (!file) return;

                this.currentFile = file;
                const detailDiv = document.getElementById('repo-file-detail');
                if (!detailDiv) return;

                let html = `
                    <div style="max-width: 900px; margin: 0 auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2 style="margin: 0;">üìÑ ${this.escapeHtml(file.filename)}</h2>
                            <button onclick="RepoAnalysis.closeDetail()" 
                                    class="btn btn-secondary"
                                    aria-label="Close detail view">
                                ‚Üê Back to List
                            </button>
                        </div>

                        <div style="display: grid; gap: 1.5rem;">
                            <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--primary);">
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--primary);">Description</h3>
                                <p style="margin: 0; color: var(--text);">${this.escapeHtml(file.description || 'No description available')}</p>
                            </div>

                            <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--success);">
                                <h3 style="margin: 0 0 0.5rem 0; color: var(--success);">Purpose</h3>
                                <p style="margin: 0; color: var(--text);">${this.escapeHtml(file.purpose || 'Not specified')}</p>
                            </div>
                `;

                // Relationships
                if (file.relationships && file.relationships.length > 0) {
                    html += `
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--info);">
                            <h3 style="margin: 0 0 0.5rem 0; color: var(--info);">üîó Related Files</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    `;
                    file.relationships.forEach(rel => {
                        html += `
                            <span style="padding: 0.25rem 0.75rem; background: var(--bg-color); border-radius: 16px; font-size: 0.85rem; font-family: monospace; color: var(--text);">
                                ${this.escapeHtml(rel)}
                            </span>
                        `;
                    });
                    html += `
                            </div>
                        </div>
                    `;
                }

                // Improvements
                if (file.improvements && Object.keys(file.improvements).length > 0) {
                    html += `
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--warning);">
                            <h3 style="margin: 0 0 0.75rem 0; color: var(--warning);">üí° Improvement Suggestions</h3>
                            <div style="display: grid; gap: 0.75rem;">
                    `;
                    Object.keys(file.improvements).forEach(category => {
                        const suggestion = file.improvements[category];
                        const icon = this.getCategoryIcon(category);
                        html += `
                            <div style="padding: 0.75rem; background: var(--bg-color); border-radius: 8px;">
                                <div style="font-weight: bold; color: var(--primary); margin-bottom: 0.25rem;">
                                    ${icon} ${this.capitalizeFirst(category)}
                                </div>
                                <div style="color: var(--text); font-size: 0.9rem;">
                                    ${this.escapeHtml(suggestion)}
                                </div>
                            </div>
                        `;
                    });
                    html += `
                            </div>
                        </div>
                    `;
                }

                html += `
                        </div>
                    </div>
                `;

                detailDiv.innerHTML = html;
                detailDiv.style.display = 'block';
            },

            /**
             * Close detail view
             */
            closeDetail() {
                const detailDiv = document.getElementById('repo-file-detail');
                if (detailDiv) {
                    detailDiv.style.display = 'none';
                }
                this.currentFile = null;
            },

            /**
             * Get icon for improvement category
             */
            getCategoryIcon(category) {
                const icons = {
                    'security': 'üîí',
                    'maintainability': 'üîß',
                    'performance': '‚ö°',
                    'offline': 'üì¥',
                    'structure': 'üèóÔ∏è'
                };
                return icons[category] || 'üí°';
            },

            /**
             * Capitalize first letter
             */
            capitalizeFirst(str) {
                return str.charAt(0).toUpperCase() + str.slice(1);
            },

            /**
             * Escape HTML to prevent XSS
             */
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
        };

        console.log('[RepoAnalysis] Repository analysis module loaded');
    </script>
</body>
</html>